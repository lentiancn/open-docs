# V-Express Installation Guide

V-Express is a portrait video generation method developed by Tencent AI Lab. It generates talking head videos under the control of a reference image, an audio, and a sequence of V-Kps images.

## Version Overview

| Version | Status | Description |
|---------|--------|-------------|
| V-Express 1.x | Current | Main release |

## System Requirements

### Hardware Requirements

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| GPU | NVIDIA 16GB VRAM | NVIDIA 24GB+ VRAM |
| RAM | 16GB | 32GB+ |
| Storage | 50GB | 100GB+ |
| CUDA | 11.8+ | 12.1+ |

### Software Requirements

| Software | Version | Notes |
|----------|---------|-------|
| Python | 3.8 - 3.10 | Recommend 3.9 |
| CUDA | 11.8+ | GPU acceleration required |
| cuDNN | 8.5+ | Required for CUDA |
| ffmpeg | Latest | Video processing required |

## Linux/Ubuntu Installation

### Step 1: Install System Dependencies

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Python and development tools
sudo apt install python3.9 python3-pip python3-venv git wget curl

# Install system libraries
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# Install ffmpeg
sudo apt install ffmpeg

# Install git-lfs
sudo apt install git-lfs
```

### Step 2: Clone Project

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express
```

### Step 3: Create Virtual Environment

```bash
python3.9 -m venv venv
source venv/bin/activate

# Verify Python version
python --version
```

### Step 4: Install PyTorch

```bash
# CUDA 11.8 version
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# Verify installation
python -c "import torch; print(torch.cuda.is_available())"
```

### Step 5: Install Dependencies

```bash
pip install -r requirements.txt
```

### Step 6: Download Models

```bash
# Install git-lfs
git lfs install

# Clone models from HuggingFace
git clone https://huggingface.co/tk93/V-Express

# Move models to correct location
mv V-Express/model_ckpts model_ckpts
mv V-Express/*.bin model_ckpts/v-express
```

Alternatively, download models individually:

```bash
# Create models directory
mkdir -p model_ckpts

# Download required models:
# - stabilityai/sd-vae-ft-mse
# - run wayml/stable-diffusion-v1-5 (unet config only)
# - facebook/wav2vec2-base-960h
# - insightface/buffalo_l
```

## Windows Installation

### Step 1: Install Python

1. Download Python 3.9 from python.org
2. Check "Add Python to PATH" during installation
3. Verify: `python --version`

### Step 2: Install CUDA

1. Download CUDA 11.8 from NVIDIA website
2. Install with default settings
3. Download and install cuDNN 8.9

### Step 3: Clone and Setup

```powershell
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python -m venv venv
venv\Scripts\activate
```

### Step 4: Install Dependencies

```powershell
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### Step 5: Download Models

Download models from HuggingFace and place in `model_ckpts/` directory.

## macOS Installation

### Step 1: Install Dependencies

```bash
# Install Homebrew (if not installed)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install Python and ffmpeg
brew install python@3.9 ffmpeg git git-lfs
```

### Step 2: Setup

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python3.9 -m venv venv
source venv/bin/activate

# Install PyTorch (macOS CPU only)
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

Note: macOS only supports CPU mode, cannot use GPU acceleration.

## Verify Installation

```bash
# Test basic functionality
python inference.py --help
```

## Common Issues

### CUDA Out of Memory

**Solutions:**
- Reduce inference steps: `--num_inference_steps 15`
- Enable memory saving: `--save_gpu_memory`
- Use lower resolution

### Missing Libraries (Windows)

**Solutions:**
- Install Visual C++ Redistributable 2015-2022
- Add CUDA to system PATH

### Model Download Failed

**Solutions:**
- Use VPN or proxy
- Download manually from HuggingFace
- Check network connection

### ffmpeg Not Found

**Solutions:**
- Linux: `sudo apt install ffmpeg`
- Windows: Add ffmpeg to PATH
- macOS: `brew install ffmpeg`

## Important Notes

1. **Face Retargeting**: When the target video is not the same person as the reference image, face retargeting is important. Choose a target video with pose more similar to the reference face for better results.

2. **Language Support**: The model performs better on English; other languages have not been tested in detail.

3. **Image Quality**: Use clear square face images with resolution at least 512x512.

## Related Links

- [GitHub Repository](https://github.com/tencent-ailab/V-Express)
- [HuggingFace Models](https://huggingface.co/tk93/V-Express)
- [Paper](https://arxiv.org/abs/2406.02511)
- [Project Page](https://tenvence.github.io/p/v-express/)
