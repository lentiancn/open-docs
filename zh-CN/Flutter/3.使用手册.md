# Flutter 使用手册

> 当前版本：Flutter 3.41.2

---

## 快速开始

### 创建项目

```bash
flutter create my_app
cd my_app
flutter run
```

### 最小应用

```dart
import 'package:flutter/material.dart';

void main() => runApp(const MyApp());

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) => MaterialApp(
    title: '我的应用',
    home: Scaffold(
      appBar: AppBar(title: const Text('首页')),
      body: const Center(child: Text('Hello Flutter!')),
    ),
  );
}
```

---

## Widget 基础

### StatelessWidget

```dart
class Greeting extends StatelessWidget {
  final String name;
  const Greeting({super.key, required this.name});

  @override
  Widget build(BuildContext context) => Text('你好，$name！');
}
```

### StatefulWidget

```dart
class Counter extends StatefulWidget {
  const Counter({super.key});
  @override
  State<Counter> createState() => _CounterState();
}

class _CounterState extends State<Counter> {
  int _count = 0;

  void _increment() => setState(() => _count++);

  @override
  Widget build(BuildContext context) => Column(
    mainAxisSize: MainAxisSize.min,
    children: [
      Text('$_count', style: Theme.of(context).textTheme.headlineLarge),
      const SizedBox(height: 16),
      ElevatedButton(onPressed: _increment, child: const Text('增加')),
    ],
  );
}
```

### 常用 Widget

| Widget | 用途 |
|--------|------|
| Text | 文本 |
| Image | 图片 |
| Icon | 图标 |
| Container | 容器 |
| Scaffold | 页面脚手架 |

---

## 布局系统

### Row（水平）

```dart
Row(
  mainAxisAlignment: MainAxisAlignment.spaceEvenly,
  children: const [
    Icon(Icons.share),
    Icon(Icons.star),
    Icon(Icons.settings),
  ],
)
```

### Column（垂直）

```dart
Column(
  children: const [
    Text('第一行'),
    Text('第二行'),
  ],
)
```

### Stack（层叠）

```dart
Stack(
  children: [
    Container(width: 200, height: 200, color: Colors.blue),
    Positioned(right: 10, bottom: 10, child: Icon(Icons.check)),
  ],
)
```

### ListView（列表）

```dart
ListView.builder(
  itemCount: 100,
  itemBuilder: (context, index) => ListTile(
    leading: CircleAvatar(child: Text('$index')),
    title: Text('标题 $index'),
  ),
)
```

### 间距

```dart
// 水平间距
SizedBox(width: 16)

// 垂直间距
SizedBox(height: 8)

// 内边距
Padding(padding: EdgeInsets.all(16))
```

---

## 状态管理

### setState

适用于单个 Widget：

```dart
setState(() {
  _count++;
});
```

### Provider

**1. 添加依赖**

```yaml
dependencies:
  provider: ^6.1.0
```

**2. 创建状态类**

```dart
class CounterModel extends ChangeNotifier {
  int _count = 0;
  int get count => _count;
  void increment() { _count++; notifyListeners(); }
}
```

**3. 使用**

```dart
// 读取
context.watch<CounterModel>().count

// 触发
context.read<CounterModel>().increment()
```

---

## 路由导航

### 基本路由

```dart
MaterialApp(
  routes: {
    '/': (c) => HomePage(),
    '/detail': (c) => DetailPage(),
  },
)

// 导航
Navigator.pushNamed(context, '/detail')
Navigator.pop(context)
```

### 使用 GoRouter

```yaml
dependencies:
  go_router: ^14.0.0
```

```dart
final router = GoRouter(
  routes: [
    GoRoute(path: '/', builder: (_, __) => HomePage()),
    GoRoute(path: '/detail/:id', builder: (_, state) =>
      DetailPage(id: state.pathParameters['id']!)),
  ],
);

context.go('/detail/123');
```

---

## 网络请求

### Dio

```yaml
dependencies:
  dio: ^5.3.0
```

```dart
final dio = Dio();

// GET
final response = await dio.get('https://api.example.com/data');

// POST
await dio.post('https://api.example.com/create',
  data: {'name': 'Flutter'});
```

### 解析 JSON

```dart
final data = json.decode(response.body);
final name = data['name'] as String;
```

---

## 数据存储

### SharedPreferences

```yaml
dependencies:
  shared_preferences: ^2.2.0
```

```dart
// 写入
final prefs = await SharedPreferences.getInstance();
await prefs.setString('name', 'Flutter');
await prefs.setInt('count', 42);

// 读取
String name = prefs.getString('name') ?? '';

// 删除
await prefs.remove('name');
```

---

## 调试

### DevTools

```bash
flutter devtools
```

功能：Inspector / Debugger / Performance / Memory

### 热重载

| 命令 | 说明 |
|------|------|
| S | 热重载 |
| R | 热重启 |

### 测试

```dart
// 单元测试
test('测试', () {
  expect(1 + 1, 2);
});

// Widget 测试
testWidgets('按钮测试', (tester) async {
  await tester.pumpWidget(ElevatedButton(
    onPressed: () {}, child: const Text('点击')));
  await tester.tap(find.byType(ElevatedButton));
});
```

---

## 常用命令

```bash
# 运行
flutter run

# 构建
flutter build apk    # Android
flutter build ios    # iOS
flutter build web    # Web

# 工具
flutter doctor       # 检查环境
flutter analyze      # 代码分析
flutter test         # 运行测试
flutter clean        # 清理缓存
```

---

## 下一步

- [常见问题](./4.常见问题.md)
