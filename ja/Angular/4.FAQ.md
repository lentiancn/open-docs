# Angular FAQ

一般的な質問と回答。

## インストール

### Q: Angular CLIのインストールに失敗した？

**解決策:**
1. Node.jsバージョンを確認
```bash
node --version  # 18+ または 20+ が必要
```
2. npmキャッシュをクリア
```bash
npm cache clean --force
```
3. 管理者を使用（Windows）
4. ネットワーク接続を確認

### Q: ngコマンドが見つからない？

**解決策:**
1. Angular CLIがインストールされていることを確認
```bash
npm list -g @angular/cli
```
2. PATH環境変数を 확인
3. 再インストール
```bash
npm uninstall -g @angular/cli
npm install -g @angular/cli@latest
```

### Q: プロジェクト作成に失敗した？

**解決策:**
1. ディスク容量を確認
2. npm権限を確認
3. --skip-installを使用
```bash
ng new my-app --skip-install
cd my-app
npm install
```

## 開発

### Q: コンポーネントが表示されない？

**解決策:**
1. コンポーネントが正しくインポートされていることを確認
2. セレクタが正しく使用されていることを確認
3. テンプレート構文を確認
4. コンソールのエラーを確認

### Q: データが更新されない？

**解決策:**
1. Signalsの場合、set/updateメソッドを使用
```typescript
count.set(1);           // 新しい値を設定
count.update(c => c + 1); // 古い値に基づいて更新
```
2. RxJSの場合、適切なsubscriptionを確認
3. 手動検出にChangeDetectorRefを使用
```typescript
constructor(private cdr: ChangeDetectorRef) {}

refresh() {
  this.cdr.detectChanges();
}
```

### Q: ルーティングが機能しない？

**解決策:**
1. ルート設定が正しいことを確認
2. RouterOutletが配置されていることを確認
3. ルート順序を確認
```typescript
// ワイルドカードの前に特定のルート
{ path: 'user/:id', ... },
{ path: '**', component: NotFoundComponent }
```

### Q: フォーム検証が機能しない？

**解決策:**
1. ReactiveFormsModuleまたはFormsModuleをインポート
2. FormControl名が正しいことを確認
3. バリデーターを正しく使用
```typescript
this.form = this.fb.group({
  email: ['', [Validators.required, Validators.email]],
  password: ['', [Validators.required, Validators.minLength(6)]]
});
```

## パフォーマンス

### Q: 初期ロードが遅い？

**解決策:**
1. ルートで遅延ロードを使用
```typescript
{
  path: 'admin',
  loadComponent: () => import('./admin/admin.component')
    .then(m => m.AdminComponent)
}
```
2. 本番モードを有効化
```bash
ng build --configuration=production
```
3. AOTコンパイルはデフォルトで有効

### Q: メモリリーク？

**解決策:**
1. 適切にunsubscribe
```typescript
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';

@Component({...})
export class MyComponent implements OnDestroy {
  private destroy$ = new Subject<void>();

  ngOnInit() {
    this.http.get('/api').pipe(
      takeUntil(this.destroy$)
    ).subscribe();
  }

  ngOnDestroy() {
    this.destroy$.next();
    this.destroy$.complete();
  }
}
```
2. async pipeで自動subscribe/unsubscribe

### Q: バンドルサイズが大きい？

**解決策:**
1. 依存関係のサイズを確認
```bash
npm run build -- --stats-json
npx webpack-bundle-analyzer dist/stats.json
```
2. 遅延ロードを使用
3. 未使用のインポートを削除

## テスト

### Q: ユニットテストの書き方は？

**解決策:**
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { UserCardComponent } from './user-card.component';

describe('UserCardComponent', () => {
  let component: UserCardComponent;
  let fixture: ComponentFixture<UserCardComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [UserCardComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(UserCardComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should display user name', () => {
    component.user = { name: '田中', email: 'test@example.com' };
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h3')?.textContent).toContain('田中');
  });
});
```

### Q: テストモジュールが見つからない？

**解決策:**
```typescript
TestBed.configureTestingModule({
  imports: [
    CommonModule,
    HttpClientModule,
    // 他の必要なモジュール
  ]
});
```

## ビルド

### Q: ビルドに失敗した？

**解決策:**
1. TypeScriptエラーを確認
```bash
npx tsc --noEmit
```
2. キャッシュをクリア
```bash
rm -rf node_modules
npm install
```
3. Angularバージョンを更新
```bash
ng update @angular/core @angular/cli
```

### Q: 環境変数が機能しない？

**解決策:**
1. 環境ファイル名が正しいことを確認
2. angular.jsonで環境を構成
```json
"configurations": {
  "production": {
    "fileReplacements": [
      {
        "replace": "src/environments/environment.ts",
        "with": "src/environments/environment.prod.ts"
      }
    ]
  }
}
```

## セキュリティ

### Q: XSS攻撃を防ぐ方法は？

**解決策:**
1. Angularはデフォルトで自動エスケープ
2. innerHTMLに注意
```typescript
import { DomSanitizer } from '@angular/platform-browser';

constructor(private sanitizer: DomSanitizer) {}

getHtml() {
  // 信頼されたコンテンツのみに使用
  return this.sanitizer.bypassSecurityTrustHtml(this.trustedContent);
}
```

### Q: CSRF保護？

**解決策:**
```typescript
import { HttpClientModule } from '@angular/common/http';

@NgModule({
  imports: [
    HttpClientModule,
    HttpClientXsrfModule.withOptions({
      cookieName: 'XSRF-TOKEN',
      headerName: 'X-XSRF-TOKEN'
    })
  ]
})
export class AppModule {}
```

## アップグレード

### Q: Angularバージョンをアップグレードする方法は？

**解決策:**
1. ng updateを使用
```bash
ng update @angular/core@17 @angular/cli@17
```
2. マイグレーションガイドを確認
3. 依存関係のバージョンを更新
4. 互換性を確認するためにテストを実行

### Q: アップグレード後コードが互換性がない？

**解決策:**
1. 公式アップグレードガイドを確認
2. ng updateで自動マイグレーション
3. バージョンを飛蝗ず incrementallyにアップグレード

## 学習リソース

### Q: どこでAngularを学べる？

- 公式ドキュメント: https://angular.io
- Angular University: https://angular-university.io
- StackBlitz: オンラインAngularコード作成

### Q: どこでヘルプを得られる？

- Stack Overflow: https://stackoverflow.com/questions/tagged/angular
- Discord: https://discord.com/invite/angular
- GitHub Discussions: https://github.com/angular/angular/discussions
