# GitLab Installation Guide

This guide provides detailed instructions for installing GitLab on all major platforms.

---

## Table of Contents

- [Installation Methods](#installation-methods)
- [Docker (Recommended for Quick Start)](#docker-recommended-for-quick-start)
- [Ubuntu/Debian](#ubuntudebian)
- [CentOS/RHEL](#centosrhel)
- [Cloud Providers](#cloud-providers)
- [Kubernetes (Helm)](#kubernetes-helm)
- [System Requirements](#system-requirements)
- [Initial Configuration](#initial-configuration)
- [Uninstall GitLab](#uninstall-gitlab)

---

## Installation Methods

| Method | Description | Best For |
|--------|-------------|----------|
| **Docker** | Run in containers | Quick testing, small deployments |
| **Linux Package** | Official deb/rpm packages | Production, recommended |
| **Helm Chart** | Kubernetes deployment | Cloud-native environments |
| **Source** | Compile from source | Unsupported platforms |

> **Note:** GitLab does not support Windows. Use a virtual machine.

---

## Docker (Recommended for Quick Start)

### Quick Start

```bash
# Run GitLab CE (Community Edition)
docker run -d \
  --name gitlab \
  --hostname gitlab.example.com \
  -p 8080:80 -p 8443:443 -p 2222:22 \
  -v gitlab-config:/etc/gitlab \
  -v gitlab-logs:/var/log/gitlab \
  -v gitlab-data:/var/opt/gitlab \
  gitlab/gitlab-ce:latest

# Run GitLab EE (Enterprise Edition)
docker run -d \
  --name gitlab \
  --hostname gitlab.example.com \
  -p 8080:80 -p 8443:443 -p 2222:22 \
  gitlab/gitlab-ee:latest
```

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `GITLAB_OMNIBUS_CONFIG` | GitLab configuration | - |
| `GITLAB_ROOT_PASSWORD` | Root password | - |

### Persist Data

```bash
# Create volumes
docker volume create gitlab-config
docker volume create gitlab-logs
docker volume create gitlab-data

# Run with volumes
docker run -d \
  --name gitlab \
  -p 8080:80 \
  -v gitlab-config:/etc/gitlab \
  -v gitlab-logs:/var/log/gitlab \
  -v gitlab-data:/var/opt/gitlab \
  gitlab/gitlab-ce:latest
```

### Access GitLab

- Web UI: http://localhost:8080
- SSH: ssh://git@localhost:2222

### Initial Login

- Username: `root`
- Password: Set during first visit or use `GITLAB_ROOT_PASSWORD`

---

## Ubuntu/Debian

### Install Dependencies

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install dependencies
sudo apt install -y curl openssh-server ca-certificates tzdata perl
```

### Add GitLab Repository

```bash
# Add GitLab repository
curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash

# Or use OMNIBUS variable
export GITLAB_ROOT_PASSWORD='your_secure_password'
```

### Install GitLab

```bash
# Install GitLab CE
sudo EXTERNAL_URL="https://gitlab.example.com" apt install gitlab-ce

# Or install without external URL (configure later)
sudo apt install gitlab-ce
```

### Configure GitLab

```bash
# Edit configuration
sudo nano /etc/gitlab/gitlab.rb

# Reconfigure GitLab
sudo gitlab-ctl reconfigure
```

---

## CentOS/RHEL

### Install Dependencies

```bash
# Update system
sudo yum update -y

# Install dependencies
sudo yum install -y curl policycoreutils openssh-server openssh-clients
```

### Add GitLab Repository

```bash
# Add GitLab repository
curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
```

### Install GitLab

```bash
# Install GitLab CE
sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-ce

# Or install without external URL
sudo yum install -y gitlab-ce
```

### Configure GitLab

```bash
# Edit configuration
sudo nano /etc/gitlab/gitlab.rb

# Reconfigure GitLab
sudo gitlab-ctl reconfigure
```

---

## Cloud Providers

### AWS

```bash
# Using AWS Marketplace AMI
# 1. Go to AWS Marketplace
# 2. Search for GitLab
# 3. Launch EC2 instance
```

### Google Cloud

```bash
# Using GCP Marketplace
# 1. Go to GCP Marketplace
# 2. Search for GitLab
# 3. Deploy using Deployment Manager
```

### Azure

```bash
# Using Azure Marketplace
# 1. Go to Azure Marketplace
# 2. Search for GitLab
# 3. Deploy using Azure portal
```

---

## Kubernetes (Helm)

### Prerequisites

- Kubernetes cluster
- Helm 3+
- kubectl configured

### Install GitLab

```bash
# Add GitLab chart repository
helm repo add gitlab https://charts.gitlab.io
helm repo update

# Install GitLab
helm install gitlab gitlab/gitlab \
  --timeout 600s \
  --set global.hosts.domain=example.com \
  --set certmanager-issuer.email=admin@example.com
```

### Common Options

```bash
# With custom values
helm install gitlab gitlab/gitlab \
  -f values.yaml \
  --timeout 600s \
  --set global.hosts.domain=example.com
```

---

## System Requirements

### Minimum Requirements

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| CPU | 2 cores | 4+ cores |
| RAM | 4 GB | 8+ GB |
| Storage | 20 GB | 50+ GB |

### Recommended for Production

| Component | Recommended |
|-----------|-------------|
| CPU | 8+ cores |
| RAM | 16+ GB |
| Storage | 100+ GB SSD |

---

## Initial Configuration

### Access Web UI

1. Open browser to your GitLab URL
2. Set password for root user
3. Create first project

### Basic Configuration (/etc/gitlab/gitlab.rb)

```ruby
# External URL
external_url 'https://gitlab.example.com'

# Timezone
gitlab_rails['time_zone'] = 'Asia/Shanghai'

# Email settings
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "smtp_user"
gitlab_rails['smtp_password'] = "smtp_password"

# Backup settings
gitlab_rails['backup_keep_time'] = 604800  # 7 days

# Reconfigure
sudo gitlab-ctl reconfigure
```

### Common Commands

```bash
# Check status
sudo gitlab-ctl status

# Restart GitLab
sudo gitlab-ctl restart

# Stop GitLab
sudo gitlab-ctl stop

# View logs
sudo gitlab-ctl logs

# Check health
sudo gitlab-rake gitlab:env:info
```

---

## Backup and Restore

### Backup

```bash
# Create backup
sudo gitlab-backup create

# Backup location: /var/opt/gitlab/backups/
```

### Restore

```bash
# Stop GitLab
sudo gitlab-ctl stop

# Restore backup
sudo gitlab-backup restore BACKUP=timestamp

# Restart GitLab
sudo gitlab-ctl start
```

---

## Uninstall GitLab

### Ubuntu/Debian

```bash
# Stop GitLab
sudo gitlab-ctl stop

# Remove package
sudo apt remove --purge gitlab-ce

# Remove data
sudo rm -rf /var/opt/gitlab
sudo rm -rf /etc/gitlab
```

### CentOS/RHEL

```bash
# Stop GitLab
sudo gitlab-ctl stop

# Remove package
sudo yum remove gitlab-ce

# Remove data
sudo rm -rf /var/opt/gitlab
sudo rm -rf /etc/gitlab
```

### Docker

```bash
# Stop and remove container
docker stop gitlab
docker rm gitlab

# Optionally remove volumes
docker volume rm gitlab-config gitlab-logs gitlab-data
```

---

## Version Information

### GitLab Editions

| Edition | Description |
|---------|-------------|
| **CE (Community Edition)** | Free, open source |
| **EE (Enterprise Edition)** | Paid, additional features |
| **SaaS** | GitLab.com hosted |

### Version Numbering

- **Major**: New features, may have breaking changes
- **Minor**: New features, backward compatible
- **Patch**: Bug fixes only

Example: `17.6.0` - Major 17, Minor 6, Patch 0

---

## Next Steps

- [Usage Guide](./2.使用指南.md)
- [GitLab Official Documentation](https://docs.gitlab.com/)
- [GitLab Runner Installation](https://docs.gitlab.com/runner/install/)
