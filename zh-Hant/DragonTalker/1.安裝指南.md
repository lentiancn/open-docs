# DragonTalker 安裝指南

> 詳細記錄 DragonTalker 在各作業系統環境下的安裝步驟
> 
> 更新日期：2026年2月

---

## 一、背景介紹

DragonTalker 是一款基於深度學習的說話頭像生成工具，能夠從單張人物圖像和音頻文件合成逼真的動態說話影片。該技術廣泛應用於虛擬主播、數字人客服、AI教育等場景。

### 1.1 核心技術

DragonTalker 採用多階段流水線架構：首先通過音頻分析提取梅爾頻譜特徵；其次利用 3D 面部關鍵點檢測技術獲取面部運動參數；然後結合圖像渲染技術生成連續的影片幀；最後通過面部增強網絡提升畫質。整個過程不需要大量訓練數據，部署便捷。

### 1.2 主要特性

- 音頻驅動動畫：僅需提供目標人物的靜態圖像和音頻文件即可生成同步的說話影片
- 3D 運動估計：基於面部 landmark 的 3D 重建技術，生成自然的頭部姿勢和表情變化
- 多姿勢支援：內置 45 種以上預定義頭部姿勢模板，滿足不同應用場景需求
- 面部增強：整合 GFPGAN、RestoreFormer、CodeFormer 等先進的面部修復技術
- Web 演示介面：提供友善的瀏覽器端操作入口，無需配置開發環境
- Python API：提供完整的編程接口，支援二次開發和批量處理

---

## 二、系統要求

### 2.1 硬體配置

| 組件 | 最低配置 | 推薦配置 |
|------|----------|----------|
| 顯示卡 | NVIDIA GTX 1060 (6GB 記憶體) | NVIDIA RTX 3080 及以上 (16GB記憶體) |
| 記憶體 | 8GB | 32GB |
| 儲存空間 | 20GB 可用空間 | 50GB SSD |

### 2.2 軟體環境

| 軟體 | 版本要求 | 說明 |
|------|----------|------|
| 作業系統 | Ubuntu 18.04/20.04/22.04, Windows 10/11, macOS 11+ | 建議使用64位元系統 |
| Python | 3.8 - 3.10 | 更高版本可能存在兼容性問題 |
| CUDA | 11.7 或更高 | GPU 推理必需 |
| ffmpeg | 任意穩定版本 | 影片編解碼必需 |

---

## 三、安裝步驟

### 3.1 Ubuntu/Linux 安裝

#### 3.1.1 系統依賴安裝

打開終端，依次執行以下命令安裝系統依賴：

```bash
# 更新軟體包列表
sudo apt-get update

# 安裝基礎建構工具
sudo apt-get install -y build-essential git wget curl

# 安裝 Python 及相關工具
sudo apt-get install -y python3.8 python3-pip python3-venv

# 安裝影片處理依賴
sudo apt-get install -y ffmpeg libsm6 libxext6 libxrender-dev libgl1-mesa-glx
```

#### 3.1.2 建立虛擬環境

為避免與系統其他 Python 專案產生衝突，建議使用虛擬環境：

```bash
# 進入專案目錄
cd DragonTalker

# 建立虛擬環境
python3 -m venv venv

# 啟動虛擬環境
source venv/bin/activate

# 確認啟動成功
python --version
```

#### 3.1.3 安裝 Python 依賴

```bash
# 升級 pip 版本
pip install --upgrade pip

# 安裝 PyTorch（選擇與 CUDA 版本匹配的版本）
pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 -f https://download.pytorch.org/whl/cu113

# 安裝專案依賴
pip install -r requirements.txt
```

#### 3.1.4 下載預訓練模型

```bash
# 執行模型下載腳本
bash scripts/download_models.sh
```

### 3.2 Windows 安裝

#### 3.2.1 安裝前置軟體

1. **安裝 Python**：從 Python 官網下載 3.8-3.10 版本，安裝時勾選 "Add Python to PATH"

2. **安裝 Git**：從 Git 官網下載並安裝

3. **安裝 CUDA**：根據顯示卡型號從 NVIDIA 官網下載對應版本的 CUDA Toolkit 11.7+

4. **安裝 ffmpeg**：推薦使用 Chocolatey 包管理器：
```powershell
choco install ffmpeg
```

#### 3.2.2 複製專案並配置

```powershell
# 複製專案
git clone https://github.com/your-repo/DragonTalker.git
cd DragonTalker

# 建立虛擬環境
python -m venv venv

# 啟動虛擬環境
venv\Scripts\activate

# 安裝依賴
pip install --upgrade pip
pip install torch==1.12.1+cu113 --extra-index-url https://download.pytorch.org/whl/cu113
pip install -r requirements.txt
```

#### 3.2.3 下載模型文件

```powershell
# 在 PowerShell 中執行
.\scripts\download_models.ps1
```

### 3.3 macOS 安裝

#### 3.3.1 安裝 Homebrew 和依賴

```bash
# 安裝 Homebrew（如未安裝）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安裝必要軟體
brew install ffmpeg python@3.10 git wget
```

#### 3.3.2 配置 Python 環境

```bash
# 複製專案
git clone https://github.com/your-repo/DragonTalker.git
cd DragonTalker

# 建立虛擬環境
python3 -m venv venv
source venv/bin/activate

# 安裝 PyTorch（macOS 版本使用 CPU 或 MPS）
pip install torch torchvision

# 安裝專案依賴
pip install -r requirements.txt
```

#### 3.3.3 下載模型

```bash
bash scripts/download_models.sh
```

---

## 四、驗證安裝

安裝完成後，可以通過以下方式驗證環境是否正確配置：

### 4.1 檢查 Python 環境

```bash
# 啟動虛擬環境
source venv/bin/activate  # Linux/macOS
# 或
venv\Scripts\activate     # Windows

# 檢查關鍵包版本
python -c "import torch; print(f'PyTorch: {torch.__version__}')"
python -c "import cv2; print(f'OpenCV: {cv2.__version__}')"
python -c "import librosa; print(f'Librosa: {librosa.__version__}')"
```

### 4.2 執行範例

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir ./results \
  --preprocess full \
  --enhancer gfpgan
```

成功執行後，會在 `./results` 目錄下生成名為 `result.mp4` 的影片文件。

---

## 五、Docker 安裝（推薦）

為簡化環境配置，推薦使用 Docker 方式部署：

### 5.1 建構映像檔

```bash
docker build -t dragon-talker:latest .
```

### 5.2 執行容器

```bash
docker run --gpus all -v $(pwd)/examples:/app/examples \
  -v $(pwd)/results:/app/results \
  dragon-talker:latest \
  python inference.py \
    --source_image /app/examples/source_image.jpg \
    --driven_audio /app/examples/driven_audio.wav \
    --result_dir /app/results
```

---

## 六、卸載步驟

如需卸載 DragonTalker：

```bash
# 退出虛擬環境
deactivate

# 刪除虛擬環境目錄
rm -rf venv

# 如使用 Docker
docker rmi dragon-talker:latest
```

---

## 七、參考資源

- 官方 GitHub 倉庫：https://github.com/your-repo/DragonTalker
- 專案論文：查看 `docs/paper.md`
- 社區討論：https://github.com/your-repo/DragonTalker/discussions
- 問題回報：https://github.com/your-repo/DragonTalker/issues
