# Docker 安装指南

本指南将帮助你在各种操作系统上安装和配置 Docker。

## 系统要求

### Docker Desktop

| 操作系统 | 要求 |
|----------|------|
| Windows | Windows 10/11 64位，专业版/企业版/教育版 |
| macOS | macOS 10.15+ (Catalina) 或更高 |
| Linux | Ubuntu 18.04+, Debian 10+, Fedora 33+ |

### Docker Engine (Linux)

| 资源 | 最低要求 | 推荐配置 |
|------|----------|----------|
| CPU | 2 核心 | 4+ 核心 |
| 内存 | 4 GB | 8+ GB |
| 磁盘 | 20 GB | 50+ GB |

## Windows 安装

### 方法一：Docker Desktop（推荐）

1. **下载 Docker Desktop**
   访问：https://www.docker.com/products/docker-desktop
   下载 Windows 安装包

2. **运行安装程序**
   - 双击 `Docker Desktop Installer.exe`
   - 勾选 "Use WSL 2 instead of Hyper-V"（推荐）
   - 点击 "Install"

3. **启动 Docker Desktop**
   - 安装完成后，启动 Docker Desktop
   - 等待 Docker 引擎启动完成

4. **验证安装**
   ```powershell
   docker --version
   docker-compose --version
   docker run hello-world
   ```

### 方法二：手动安装（WSL 2）

1. **启用 WSL 2**
   ```powershell
   # 以管理员身份运行 PowerShell
   wsl --install
   ```

2. **安装 Docker**
   ```bash
   # 更新包索引
   sudo apt-get update
   
   # 安装依赖
   sudo apt-get install -y ca-certificates curl gnupg lsb-release
   
   # 添加 Docker GPG 密钥
   curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
   
   # 添加 Docker 仓库
   echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
   
   # 安装 Docker
   sudo apt-get update
   sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
   ```

3. **配置 Docker**
   ```bash
   # 启动 Docker 服务
   sudo service docker start
   
   # 当前用户添加到 docker 组
   sudo usermod -aG docker $USER
   ```

## macOS 安装

### 方法一：Docker Desktop（推荐）

1. **下载 Docker Desktop**
   访问：https://www.docker.com/products/docker-desktop
   下载 Apple Silicon 或 Intel 版本

2. **安装**
   - 双击 `Docker.dmg`
   - 将 Docker 拖入 Applications 文件夹

3. **启动**
   - 打开 Docker Desktop
   - 等待启动完成

4. **验证**
   ```bash
   docker --version
   docker-compose --version
   docker run hello-world
   ```

### 方法二：Homebrew

```bash
# 安装 Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Docker
brew install --cask docker

# 启动 Docker
open -a Docker
```

## Linux 安装

### Ubuntu/Debian

```bash
# 1. 更新系统
sudo apt-get update
sudo apt-get upgrade

# 2. 安装依赖
sudo apt-get install -y ca-certificates curl gnupg lsb-release

# 3. 添加 Docker GPG 密钥
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# 4. 添加 Docker 仓库
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 5. 安装 Docker
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 6. 启动 Docker
sudo systemctl start docker
sudo systemctl enable docker

# 7. 验证安装
sudo docker run hello-world

# 8. 当前用户添加到 docker 组（无需 sudo 运行 Docker）
sudo usermod -aG docker $USER
```

### CentOS/RHEL

```bash
# 1. 安装依赖
sudo yum install -y yum-utils

# 2. 添加 Docker 仓库
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# 3. 安装 Docker
sudo yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 4. 启动 Docker
sudo systemctl start docker
sudo systemctl enable docker

# 5. 验证
sudo docker run hello-world
```

### Fedora

```bash
# 1. 安装依赖
sudo dnf -y install dnf-plugins-core

# 2. 添加 Docker 仓库
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo

# 3. 安装 Docker
sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 4. 启动 Docker
sudo systemctl start docker
sudo systemctl enable docker

# 5. 验证
sudo docker run hello-world
```

## 配置国内镜像加速

由于网络原因，国内访问 Docker Hub 较慢，建议配置国内镜像加速。

### Linux/macOS

```bash
# 创建配置目录
sudo mkdir -p /etc/docker

# 配置镜像加速（任选其一或多个）
sudo tee /etc/docker/daemon.json <<EOF
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# 重启 Docker
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### Windows/macOS Docker Desktop

1. 打开 Docker Desktop
2. 点击 Settings → Docker Engine
3. 在 JSON 配置中添加：
   ```json
   {
     "registry-mirrors": [
       "https://docker.mirrors.ustc.edu.cn",
       "https://hub-mirror.c.163.com"
     ]
   }
   ```
4. 点击 Apply & Restart

## 验证安装

### 基础验证

```bash
# 查看 Docker 版本
docker --version
# 输出：Docker version 24.0.0, build xxxxxx

# 查看 Docker Compose 版本
docker-compose --version
# 或
docker compose version

# 查看 Docker 信息
docker info
```

### 运行测试容器

```bash
# 运行 hello-world
docker run hello-world

# 运行 nginx
docker run -d -p 8080:80 --name mynginx nginx

# 访问测试
curl http://localhost:8080

# 停止并删除
docker stop mynginx
docker rm mynginx
```

## Docker 配置

### 配置 Docker 服务

```bash
# 编辑 Docker 配置
sudo vim /etc/docker/daemon.json

# 常用配置
{
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"],
  "storage-driver": "overlay2",
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "data-root": "/data/docker",
  "live-restore": true
}
```

### 配置网络

```bash
# 允许容器访问外网（默认）
# 如需限制，配置 iptables
```

## 常用命令

### 镜像操作

```bash
# 搜索镜像
docker search nginx

# 拉取镜像
docker pull nginx:latest

# 查看镜像列表
docker images

# 删除镜像
docker rmi nginx:latest

# 构建镜像
docker build -t myapp:latest .
```

### 容器操作

```bash
# 运行容器
docker run -d -p 8080:80 --name myapp myapp:latest

# 查看容器
docker ps           # 运行中
docker ps -a        # 所有

# 停止/启动容器
docker stop myapp
docker start myapp

# 删除容器
docker rm myapp

# 查看日志
docker logs myapp
docker logs -f myapp

# 进入容器
docker exec -it myapp bash
```

### 常用参数

| 参数 | 说明 |
|------|------|
| -d | 后台运行 |
| -p | 端口映射（主机:容器） |
| -v | 卷挂载（主机:容器） |
| --name | 指定容器名称 |
| --network | 指定网络 |
| -e | 环境变量 |
| --restart | 自动重启策略 |

## 卸载 Docker

### Ubuntu/Debian

```bash
# 卸载 Docker
sudo apt-get purge -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 删除数据
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
```

### Windows

1. 打开 Settings → Apps
2. 找到 Docker Desktop
3. 点击 Uninstall

### macOS

```bash
# 使用 Homebrew
brew uninstall --cask docker

# 或手动删除
rm -rf /Applications/Docker
rm -rf ~/Library/Containers/com.docker.docker
rm -rf ~/.docker
```

## 常见问题

### Q1: Docker 启动失败

**解决方案：**
```bash
# 查看错误日志
journalctl -u docker -n 50
# 或
docker info
```

### Q2: 端口冲突

**解决方案：**
```bash
# 查看端口占用
netstat -tlnp | grep 8080
# 更换端口
docker run -d -p 8081:80 nginx
```

### Q3: 权限不足

**解决方案：**
```bash
# 将用户添加到 docker 组
sudo usermod -aG docker $USER
# 重新登录
```

### Q4: 磁盘空间不足

**解决方案：**
```bash
# 清理未使用的镜像和容器
docker system prune -a

# 清理构建缓存
docker builder prune
```

## 下一步

- [Docker 使用手册](./3.使用手册.md) - 学习 Docker 常用操作
- [Docker 常见问题](./4.常见问题.md) - 解答常见问题
- 官方文档：https://docs.docker.com
