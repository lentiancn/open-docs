# Jenkins 常见问题

本章节汇总了 Jenkins 使用中的常见问题。

## 启动问题

### Q1: 启动失败

**问题描述：**
Jenkins 无法启动。

**解决方案：**
```bash
# 查看日志
docker logs jenkins

# Linux
sudo journalctl -u jenkins -n 100
sudo cat /var/log/jenkins/jenkins.log
```

### Q2: 端口被占用

**问题描述：**
8080 端口被占用。

**解决方案：**
```bash
# 查找占用端口的进程
netstat -tlnp | grep :8080

# 更改端口
# /etc/default/jenkins
HTTP_PORT=8081
```

## 构建问题

### Q3: 构建失败

**问题描述：**
构建过程出错。

**解决方案：**
1. 查看构建日志
2. 检查构建步骤
3. 确认环境配置

### Q4: 构建太慢

**问题描述：**
构建时间过长。

**解决方案：**
1. 开启并行构建
2. 使用缓存
3. 增加 Agent

### Q5: 依赖下载失败

**问题描述：**
无法下载依赖。

**解决方案：**
```groovy
// 配置代理
tools {
    maven 'Maven'
}

// settings.xml 配置镜像
```

## 权限问题

### Q6: 权限不足

**问题描述：**
无法执行某些操作。

**解决方案：**
1. 检查角色权限配置
2. 确认用户组
3. 配置 Matrix Authorization

## Pipeline 问题

### Q7: Pipeline 无法启动

**问题描述：**
Pipeline 构建失败。

**解决方案：**
1. 检查 Jenkinsfile 语法
2. 查看 Pipeline 错误日志
3. 使用 Pipeline Syntax 生成代码

### Q8: 变量未定义

**问题描述：**
变量使用错误。

**解决方案：**
```groovy
// 使用正确的变量引用
echo "${env.BUILD_NUMBER}"

// 定义环境变量
environment {
    MY_VAR = 'value'
}
```

## 插件问题

### Q9: 插件安装失败

**问题描述：**
无法安装插件。

**解决方案：**
1. 检查网络
2. 配置代理
3. 手动安装

### Q10: 插件冲突

**问题描述：**
插件冲突。

**解决方案：**
1. 禁用冲突插件
2. 升级到兼容版本

## 通知问题

### Q11: 邮件不发送

**问题描述：**
邮件通知失败。

**解决方案：**
1. 配置 SMTP
2. 检查垃圾邮件
3. 查看日志

### Q12: Slack 不工作

**问题描述：**
Slack 通知失败。

**解决方案：**
1. 检查凭据
2. 验证 Webhook URL

## 分布式问题

### Q13: Agent 连接失败

**问题描述：**
Agent 无法连接。

**解决方案：**
1. 检查网络
2. 验证凭据
3. 查看日志

### Q14: 任务分配不均

**问题描述：**
构建任务分布不均。

**解决方案：**
配置标签和分配规则。

## 安全问题

### Q15: 登录失败

**问题描述：**
无法登录 Jenkins。

**解决方案：**
```bash
# 重置 admin 密码
# 关闭 Jenkins
# 修改 hudson.model.SecurityRealm
# 重启 Jenkins
```

### Q16: CSRF 防护

**问题描述：**
CSRF 错误。

**解决方案：**
配置 CSRF 保护，或使用crumb。

## 备份问题

### Q17: 备份失败

**问题描述：**
无法备份。

**解决方案：**
1. 备份 JENKINS_HOME
2. 使用 ThinBackup 插件

### Q18: 恢复失败

**问题描述：**
无法恢复备份。

**解决方案：**
1. 确保版本兼容
2. 正确放置文件

## 性能问题

### Q19: 内存不足

**问题描述：**
Jenkins 内存占用过高。

**解决方案：**
```bash
# 增加内存
# /etc/default/jenkins
JAVA_ARGS="-Xmx2048m -XX:MaxPermSize=512m"
```

### Q20: 磁盘空间不足

**问题描述：**
磁盘空间不足。

**解决方案：**
1. 清理旧构建
2. 配置自动清理

## 总结

本章节涵盖了 Jenkins 使用中的常见问题：

- **启动**：失败、端口
- **构建**：失败、慢、依赖
- **权限**：不足、登录
- **Pipeline**：启动、变量
- **插件**：安装、冲突
- **通知**：邮件、Slack
- **分布式**：连接、分配
- **安全**：登录、CSRF
- **备份**：失败、恢复
- **性能**：内存、磁盘

如需更多信息，请参考官方文档：https://www.jenkins.io/zh/doc/
