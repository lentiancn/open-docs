# Go 常見問題

> Go 語言使用過程中的常見問題解答

---

## 安裝

### Q: 安裝後指令找不到？

**A**: 
- 確認 Go 已添加到 PATH 環境變數
- Windows 預設安裝到 C:\Go，需要添加到 PATH
- Linux/macOS 通常需要手動添加到 ~/.bashrc 或 ~/.zshrc

### Q: 怎麼檢查 Go 是否安裝成功？

**A**: 
```bash
go version
go env GOPATH
```

### Q: 如何更新 Go 版本？

**A**: 
- Windows：下載新版本重新安裝
- macOS：`brew upgrade go`
- Linux：下載新版本替換或使用套件管理器

---

## 語法

### Q: Go 有異常機制嗎？

**A**: Go 沒有傳統意義上的異常機制。錯誤通過返回值傳遞：
```go
result, err := doSomething()
if err != nil {
    // 處理錯誤
}
```

### Q: 為什麼 := 和 var 不能混用？

**A**: 
- `:=` 是短變數宣告，用於函數內
- `var` 是顯式宣告，可用於函數外
- 兩者不能同時用於同一變數

### Q: Go 支援泛型嗎？

**A**: Go 1.18+ 開始支援泛型：
```go
func Print[T any](s []T) {
    for _, v := range s {
        fmt.Println(v)
    }
}
```

---

## 並發

### Q: Goroutine 和線程的區別？

**A**: 
- Goroutine 由 Go 執行時期管理，比線程更輕量
- 建立數千個 Goroutine 不會耗盡資源
- 使用通道（channel）進行通訊

### Q: 通道應該關閉嗎？

**A**: 
- 通常由發送方關閉通道
- 接收方可以使用 `v, ok := <-ch` 檢查通道是否關閉
- 不要給已關閉的通道發送資料

### Q: 如何優雅地等待 Goroutine 完成？

**A**: 使用 `sync.WaitGroup`：
```go
var wg sync.WaitGroup

for i := 0; i < 5; i++ {
    wg.Add(1)
    go func(i int) {
        defer wg.Done()
        fmt.Println(i)
    }(i)
}

wg.Wait()
```

---

## 套件管理

### Q: GOPATH 和 Go Module 有什麼區別？

**A**: 
- GOPATH：舊的依賴管理方式，依賴放在 `$GOPATH/src`
- Go Module（go.mod）：現代方式，更好的版本控制

### Q: 依賴下載很慢怎麼辦？

**A**: 
```bash
# 使用國內鏡像
go env -w GOPROXY=https://goproxy.cn,direct

# 還可以設定
go env -w GOPROXY=https://proxy.golang.org,direct
```

### Q: 怎麼查看依賴關係？

**A**: 
```bash
go mod graph
go list -m all
```

---

## 效能

### Q: 如何進行效能分析？

**A**: 
```bash
# CPU 分析
go test -cpuprofile=cpu.out

# 記憶體分析
go test -memprofile=mem.out

# 使用 pprof 分析
go tool pprof cpu.out
```

### Q: 如何優化 Go 程式？

**A**: 
- 使用 `strings.Builder` 拼接字串
- 避免不必要的記憶體配置
- 使用池（sync.Pool）複用物件
- 合理使用通道

---

## 工具

### Q: go fmt 和 go vet 有什麼區別？

**A**: 
- `go fmt`：格式化程式碼風格
- `go vet`：靜態分析，檢查潛在錯誤

### Q: 怎麼生成文檔？

**A**: 
```bash
go doc <套件名>
go doc <函數名>

# 本地文檔伺服器
go doc -http=:6060
```

---

## 錯誤

### Q: 常見編譯錯誤有哪些？

**A**: 
- `undefined: xxx` - 變數未定義
- `mismatched types` - 類型不匹配
- `invalid character` - 字元編碼問題
- `package xxx is not in GOROOT` - 套件路徑錯誤

### Q: 執行期 panic 怎麼辦？

**A**: 
- 使用 defer 和 recover 捕獲：
```go
func safeCall() {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("已恢復:", r)
        }
    }()
    // 可能會 panic 的程式碼
}
```
