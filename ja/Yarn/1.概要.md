# Yarn 🧶

## Yarnとは？

YarnはFacebook（現在のMeta）によって開発されたJavaScriptパッケージマネージャーです。現代のJavaScript開発者により高速で、信頼性が高く、安全な依存関係管理を提供します。シンプルなプロジェクトでも、大規模なmonorepoでも、Yarnがサポートします。

Yarnは2016年に初めてリリースされ、npmのインストール速度の遅さや依存関係のバージョンの不確実性などの問題を解決するために作成されました。年月を経て、Yarnは単純なパッケージマネージャーから完全なJavaScriptプロジェクト管理ツールに進化し、Workspaces、プラグインシステム、Zero-Installsなどの強力な機能を提供しています。

### コア設計思想

**速度最優先**：Yarnは並列ダウンロードとインテリジェントキャッシュメカニズムを採用し、依存関係のインストール速度を大幅に向上させます。

**決定論的保証**：Yarnはyarn.lockファイルを通じて各依存関係の詳細なバージョンを記録し、異なるマシンや異なる時間でのインストールが同一の結果得られることを保証します。

**セキュリティ強化**：Yarnはインストールプロセス中に各パッケージのチェックサムを検証し、供給チェーン攻撃やセキュリティ脅威を防ぎます。

**開発者体験**：Yarnは開発者体験を重視し、明確なコマンドライン出力、インタラクティブな更新、豊富なプロンプト情報を提供します。

### Yarnと他のパッケージマネージャーの比較

JavaScriptエコシステムでは、npm、Yarn、pnpmの3つの主なパッケージマネージャーがあります。

**npmとの比較**：npmはNode.js公式のパッケージマネージャーで最大のユーザーベースを持っています。Yarnは速度、決定論性、オフラインサポートでnpmより優れています。

**pnpmとの比較**：pnpmは一意のシンボリックリンク戦略を採用し、ディスク空間の効率をより良く管理します。Yarnは機能豊かさとコミュニティサポートで優れています。

---

## 主な機能

### ワークスペース

ワークスペースはYarn最も革新的な機能で、単一のリポジトリで複数の関連するパッケージを管理できます。

### オフラインキャッシュ

Yarnのオフラインキャッシュは最も人気がある機能です。最初のパッケージインストール時にYarnはローカルにキャッシュします。

### 並列インストール

npmのシリアルインストールとは異なり、Yarnはデフォルトで並列インストール戦略を使用します。

### ハードニングモード

ハードニングモードは企業向けセキュリティ機能で、インストール中にyarn.lockが変更されそうな場合、Yarnは即座にエラーで終了します。

### Zero-Installs

Zero-InstallsはYarn 4.xで導入された革命的な機能で、依存関係のインストールをスキップできます。

### プラグインシステム

Yarnのプラグインシステムは開発者が機能を拡張およびカスタマイズすることを可能にします。

---

## クイックスタート

### インストール

**Corepackを使用（推奨）**：

```bash
corepack enable
corepack prepare yarn@stable --activate
```

**npmを使用**：

```bash
npm install -g yarn
```

### 確認

```bash
yarn --version
```

### 初期化

```bash
yarn init -2
```

### 依存関係インストール

```bash
yarn install
```

---

## 一般的なコマンド

### 依存関係追加

```bash
yarn add lodash
yarn add -D typescript
yarn add lodash@4.17.21
```

### 依存関係削除

```bash
yarn remove lodash
```

### 依存関係更新

```bash
yarn up lodash
yarn up --all
```

### スクリプト実行

```bash
yarn dev
yarn build
yarn test
```

---

## ワークスペース

### 設定

```json
{
  "workspaces": ["packages/*"]
}
```

### コマンド

```bash
yarn workspace @my-org/core add lodash
yarn workspaces foreach -pt run build
```

---

## 設定

### .yarnrc.yml

```yaml
npmRegistryServer: "https://registry.npmjs.org"
nodeLinker: node-modules
```

---

## ベストプラクティス

1. yarn.lockを常にコミット
2. CIで--immutableを使用
3. 依存関係を定期的に更新
4. ワークスペースを使用

---

## よくある質問

### Yarnとnpmの違いは？

- 速度：Yarnは並列ダウンロードでより速い
- 決定論性：yarn.lockが一貫したインストールを保証
- オフラインサポート：Yarnは優れたオフラインキャッシュを持つ

### インストールに失敗した場合は？

1. Node.jsバージョンを確認
2. npmキャッシュをクリア
3. Corepackを使用

### yarn.lockの目的は？

yarn.lockは各依存関係の詳細なバージョンを記録し毎回同じインストール結果を保証します。

---

## 関連リンク

- ウェブサイト：https://yarnpkg.com
- ドキュメント：https://yarnpkg.com/docs
- GitHub：https://github.com/yarnpkg/berry
- Discord：https://discord.gg/yarn
