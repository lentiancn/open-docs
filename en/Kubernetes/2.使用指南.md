# Kubernetes Usage Guide

Comprehensive guide for using Kubernetes effectively.

---

## Table of Contents

- [Basic Concepts](#basic-concepts)
- [kubectl Basics](#kubectl-basics)
- [Pods](#pods)
- [Deployments](#deployments)
- [Services](#services)
- [ConfigMaps and Secrets](#configmaps-and-secrets)
- [Ingress](#ingress)
- [Storage](#storage)
- [Namespaces](#namespaces)
- [Scaling](#scaling)
- [Helm](#helm)
- [Troubleshooting](#troubleshooting)

---

## Basic Concepts

| Concept | Description |
|---------|-------------|
| **Pod** | Smallest deployable unit (one or more containers) |
| **Deployment** | Manages Pods, ensures desired state |
| **Service** | Network abstraction for Pods |
| **Node** | Worker machine (physical or virtual) |
| **Cluster** | Collection of nodes |
| **Namespace** | Virtual cluster for resource isolation |

---

## kubectl Basics

### Common Commands

```bash
# Get cluster info
kubectl cluster-info

# List nodes
kubectl get nodes

# List pods
kubectl get pods

# List pods in all namespaces
kubectl get pods -A

# Describe resource
kubectl describe pod <pod-name>

# View logs
kubectl logs <pod-name>

# Execute command in pod
kubectl exec -it <pod-name> -- /bin/bash

# Apply configuration
kubectl apply -f deployment.yaml

# Delete resource
kubectl delete -f deployment.yaml
```

### kubectl Shortcuts

```bash
# Short resource names
kubectl get po      # pods
kubectl get svc    # services
kubectl get deploy # deployments
kubectl get ns     # namespaces
kubectl get secret # secrets
```

---

## Pods

### Create Pod

```yaml
# pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
  - name: nginx
    image: nginx:alpine
    ports:
    - containerPort: 80
```

```bash
kubectl apply -f pod.yaml
```

### Manage Pods

```bash
# List pods
kubectl get pods

# View pod details
kubectl describe pod my-pod

# View pod logs
kubectl logs my-pod

# Follow logs
kubectl logs -f my-pod

# Execute in pod
kubectl exec -it my-pod -- sh

# Delete pod
kubectl delete pod my-pod
```

---

## Deployments

### Create Deployment

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
```

```bash
kubectl apply -f deployment.yaml
```

### Manage Deployments

```bash
# List deployments
kubectl get deployments

# Scale deployment
kubectl scale deployment my-app --replicas=5

# Update image
kubectl set image deployment/my-app nginx=nginx:1.25

# Check rollout status
kubectl rollout status deployment/my-app

# Rollback to previous version
kubectl rollout undo deployment/my-app

# View deployment details
kubectl describe deployment my-app
```

### Deployment Strategies

```yaml
# Rolling Update (default)
spec:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Recreate
spec:
  strategy:
    type: Recreate
```

---

## Services

### Service Types

| Type | Description |
|------|-------------|
| **ClusterIP** | Internal cluster IP (default) |
| **NodePort** | Expose on each node's IP |
| **LoadBalancer** | External load balancer |
| **ExternalName** | DNS alias |

### Create Service

```yaml
# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
```

```bash
# Expose deployment as service
kubectl expose deployment my-app --port=80 --target-port=80 --type=ClusterIP

# NodePort
kubectl expose deployment my-app --port=80 --type=NodePort

# LoadBalancer
kubectl expose deployment my-app --port=80 --type=LoadBalancer
```

### Manage Services

```bash
# List services
kubectl get services

# Describe service
kubectl describe service my-service

# Delete service
kubectl delete service my-service
```

---

## ConfigMaps and Secrets

### ConfigMap

```yaml
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-config
data:
  DATABASE_URL: "postgres://db:5432/app"
  CACHE_ENABLED: "true"
```

```bash
# Create ConfigMap
kubectl apply -f configmap.yaml

# Use in pod
kubectl set env deployment/my-app --from=configmap/my-config
```

### Secrets

```yaml
# secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
stringData:
  password: my-password
```

```bash
# Create secret
kubectl apply -f secret.yaml

# Use in pod
kubectl set env deployment/my-app --from=secret/my-secret
```

---

## Ingress

### Create Ingress

```yaml
# ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: my-service
            port:
              number: 80
```

```bash
kubectl apply -f ingress.yaml
```

### Install Ingress Controller

```bash
# Install NGINX Ingress Controller
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.9.0/deploy/static/provider/cloud/deploy.yaml
```

---

## Storage

### PersistentVolume (PV)

```yaml
# pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: my-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  storageClassName: standard
  hostPath:
    path: "/mnt/data"
```

### PersistentVolumeClaim (PVC)

```yaml
# pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
```

```bash
# Create PVC
kubectl apply -f pvc.yaml

# Use in pod
kubectl set volume deployment/my-app --add --name=data --mount-path=/data --type=pvc --claim-name=my-pvc
```

---

## Namespaces

### Manage Namespaces

```bash
# Create namespace
kubectl create namespace my-namespace

# List namespaces
kubectl get namespaces

# Switch namespace
kubectl config set-context --current --namespace=my-namespace

# Delete namespace (deletes all resources)
kubectl delete namespace my-namespace
```

---

## Scaling

### Horizontal Pod Autoscaler (HPA)

```yaml
# hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: my-app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: my-app
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

```bash
kubectl apply -f hpa.yaml

# View HPA status
kubectl get hpa
```

---

## Helm

Helm is a package manager for Kubernetes.

### Install Helm

```bash
# macOS
brew install helm

# Linux
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

# Windows
choco install helm
```

### Use Helm

```bash
# Add chart repository
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# Install chart
helm install my-release bitnami/nginx

# List releases
helm list

# Upgrade release
helm upgrade my-release bitnami/nginx

# Uninstall release
helm uninstall my-release
```

### Create Custom Chart

```bash
# Create chart
helm create my-chart

# Package chart
helm package my-chart

# Install from chart
helm install my-app ./my-chart
```

---

## Troubleshooting

### Common Issues

```bash
# Pod not starting
kubectl describe pod <pod-name>
kubectl logs <pod-name>

# Service not accessible
kubectl describe service <service-name>
kubectl get endpoints

# Node issues
kubectl describe node <node-name>

# Check events
kubectl get events --sort-by='.lastTimestamp'
```

### Debug Pods

```bash
# Debug with ephemeral container
kubectl debug my-pod -it --image=busybox

# Copy from pod
kubectl cp my-pod:/path/in/pod ./local/path

# Port forward
kubectl port-forward my-pod 8080:80
```

### Check Resources

```bash
# Resource usage
kubectl top nodes
kubectl top pods

# Show pod resource requests
kubectl get pods -o=custom-columns=NAME:.metadata.name,CPU:.spec.containers[0].resources.requests.cpu,MEMORY:.spec.containers[0].resources.requests.memory
```

---

## Quick Reference

### Common Commands

```bash
kubectl get           # List resources
kubectl describe     # Show details
kubectl apply        # Create/update
kubectl delete       # Delete resources
kubectl logs         # View logs
kubectl exec         # Execute command
kubectl port-forward # Forward port
kubectl scale        # Scale deployment
kubectl rollout      # Manage rollout
```

### Resource Shortcuts

| Shortcut | Full Name |
|----------|-----------|
| po | pods |
| svc | services |
| deploy | deployments |
| ns | namespaces |
| cm | configmaps |
| secret | secrets |
| pvc | persistentvolumeclaims |
| pv | persistentvolumes |
| hpa | horizontalpodautoscalers |

---

## Next Steps

- Explore [Kubernetes Addons](https://kubernetes.io/docs/concepts/cluster-administration/add-ons/)
- Learn about [Kubernetes Networking](https://kubernetes.io/docs/concepts/cluster-administration/networking/)
- Read [Kubernetes Security](https://kubernetes.io/docs/concepts/security/)
