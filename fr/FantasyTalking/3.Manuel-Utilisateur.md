# FantasyTalking - Manuel Utilisateur

Guide détaillé d'utilisation et exemples.

## Utilisation de base

### Générer une vidéo

```bash
python inference.py \
  --source_image face.jpg \
  --audio speech.wav \
  --output output.mp4
```

### Paramètres

| Paramètre | Abrégé | Description | Par défaut |
|-----------|--------|-------------|------------|
| --source_image | -s | Chemin de l'image d'entrée | Requis |
| --audio | -a | Fichier audio d'entrée | Requis |
| --output | -o | Chemin de la vidéo de sortie | output.mp4 |
| --face_enhancer | -f | Modèle d'amélioration du visage | None |
| --max_frames | -m | Images maximales | 300 |
| --fps | -fps | Images par seconde en sortie | 25 |

### Exemple complet

```bash
python inference.py \
  --source_image photos/person1.jpg \
  --audio audio/speech.wav \
  --output results/video1.mp4 \
  --face_enhancer realusf \
  --fps 30
```

## Utilisation avancée

### Python API

```python
from fantasytalking import FantasyTalking

# Initialiser le modèle
ft = FantasyTalking(
    checkpoint_path="./models/checkpoint.pth",
    face_enhancer="realusf"
)

# Générer une vidéo
ft.generate(
    source_image="face.jpg",
    audio="speech.wav",
    output="output.mp4"
)
```

### Traitement par lots

```python
import os
from fantasytalking import FantasyTalking

ft = FantasyTalking()

images_dir = "./images"
audio_dir = "./audio"
output_dir = "./output"

for image_file in os.listdir(images_dir):
    for audio_file in os.listdir(audio_dir):
        output_name = f"{image_file}_{audio_file}.mp4"
        ft.generate(
            source_image=os.path.join(images_dir, image_file),
            audio=os.path.join(audio_dir, audio_file),
            output=os.path.join(output_dir, output_name)
        )
```

### Service Web API

```bash
# Démarrer le service API
python api.py --port 8080
```

Exemple d'appel :

```bash
curl -X POST http://localhost:8080/generate \
  -F "image=@face.jpg" \
  -F "audio=@speech.wav" \
  -o output.mp4
```

## Exigences d'entrée

### Format d'image

- **Formats pris en charge** : JPG, PNG, BMP
- **Résolution recommandée** : 512x512 ou plus
- **Exigences du visage** :
  - Photo frontale claire fonctionne mieux
  - Le visage doit occuper 50%+ de l'image
  - Bon éclairage, expression naturelle

### Format audio

- **Formats pris en charge** : WAV, MP3, FLAC
- **Fréquence d'échantillonnage** : 16000 Hz ou 44100 Hz
- **Durée** : 1-60 secondes recommandé
- **Langue** : Détection multilingue automatique

## Paramètres de sortie

### Résolution

```bash
# Définir la résolution de sortie
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --size 512
```

Résolutions prises en charge : 256, 512, 768, 1024

### FPS

```bash
# Définir le nombre d'images par seconde
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --fps 30
```

### Format vidéo

Formats de sortie pris en charge : MP4 (H.264), AVI, MOV

## Optimisation des performances

### Accélération GPU

Assurez-vous d'utiliser CUDA :

```python
ft = FantasyTalking(device="cuda")
```

### Traitement par lots

Utilisez le traitement par lots pour plusieurs fichiers :

```python
ft.batch_generate(image_list, audio_list, output_dir)
```

### Précision mixte

Activer l'accélération FP16 :

```python
ft = FantasyTalking(precision="fp16")
```

## Problèmes courants

### Échec de la génération vidéo ?

1. Vérifier que l'image d'entrée contient un visage
2. Confirmer que le format audio est correct
3. Assurer suffisamment de VRAM

### Visage déformé ?

1. Utiliser des images d'entrée plus claires
2. Ajuster les paramètres des points clés du visage

### Lèvres non synchronisées ?

1. S'assurer que l'audio est clair
2. Ajuster les paramètres de synchronisation

## Bonnes pratiques

1. **Choisir des images appropriées** : Frontale, haute résolution, éclairage uniforme
2. **Préparer un audio clair** : Sans bruit, vitesse d'élocution modérée
3. **Définir les paramètres de manière raisonnable** : Ajuster la résolution et les FPS selon les besoins
4. **Utiliser l'amélioration du visage** : Améliore la qualité de sortie

## Étapes suivantes

- FAQ : Voir 4.FAQ.md
