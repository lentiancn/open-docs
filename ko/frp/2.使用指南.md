# frp 사용 가이드

이 가이드에서는 frp를 사용하여 내망 침투(NAT 관통)와 포트 매핑을 하는 방법을 설명합니다.

## 빠른 시작

### 서버 시작

```bash
# frps 시작
./frps -c frps.ini
```

### 클라이언트 시작

```bash
# frpc 시작
./frpc -c frpc.ini
```

## 설정 상세

### 서버 설정

#### 기본 설정

```ini
[common]
bind_port = 7000           # frp 서비스 포트
dashboard_port = 7500      # 대시보드 포트
token = password           # 인증 토큰
```

#### 포트 매핑

```ini
[common]
vhost_http_port = 80       # HTTP 가상 호스트 포트
vhost_https_port = 443    # HTTPS 가상 호스트 포트
```

#### 로드밸런싱

```ini
[common]
max_pool_count = 10        # 커넥션 풀 크기
max_ports_per_client = 0   # 클라이언트당 포트 수 제한
```

### 클라이언트 설정

#### TCP 매핑

```ini
# 로컬 SSH 매핑
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

#### HTTP 매핑

```ini
# 웹 서비스 매핑
[web]
type = http
local_port = 8080
custom_domains = example.com
```

#### HTTPS 매핑

```ini
[web_https]
type = https
local_port = 8443
custom_domains = example.com
```

## 고급 기능

### 로드밸런싱

```ini[test_http]
type = http
local_port = 8080
custom_domains = web.example.com
group = web_group
group_key = 123
```

### 플러그인

#### HTTP 프록시

```ini
[http_proxy]
type = tcp
plugin = http_proxy
plugin_http_user = user
plugin_http_password = password
local_port = 8080
remote_port = 8000
```

#### 정적 파일

```ini
[static_file]
type = tcp
plugin = static_file
plugin_local_path = /var/www
pluginstrip_prefix = static
remote_port = 8000
```

## 보안 설정

### 암호화

```ini
[common]
use_encryption = true
```

### 압축

```ini
[common]
use_compression = true
```

### 인증

```ini
[common]
authentication_method = token
token = your_secure_token
```

## 모니터링

### 대시보드

```ini
[common]
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
```

http://your_server:7500에서 상태 확인.

### 포트 통계

```ini
[common]
plugin = ports_stats
```

## 성능 최적화

### 커넥션 풀

```ini
[common]
max_pool_count = 50
max_conn_per_proxy = 10
```

### 하트비트

```ini
[common]
heartbeat_interval = 30
heartbeat_timeout = 90
```

### 로그 레벨

```ini
[common]
log_level = warn
log_max_days = 3
```

## 사용 시나리오

### 1. 내망 SSH 원격 접근

```ini
[ssh]
type = tcp
local_ip = 192.168.1.100
local_port = 22
remote_port = 6000
```

### 2. 내망 웹 서비스 노출

```ini
[web]
type = http
local_port = 8080
custom_domains = yourdomain.com
```

### 3. 내망 데이터베이스 접근

```ini
[mysql]
type = tcp
local_ip = 192.168.1.100
local_port = 3306
remote_port = 13306
```

### 4. WeChat/결제 콜백

```ini
[wechat]
type = http
local_port = 8080
custom_domains = callback.yourdomain.com
```

## 문제 해결

### 연결 문제

1. 서버 로그 확인
2. 포트 개방 여부 검증
3. 방화벽 확인

### 성능 문제

1. 커넥션 풀 크기 조정
2. 압축 활성화
3. 네트워크 대역폭 확인

## 관련 자료

- [frp 공식 문서](https://gofrp.org/docs/)
- [GitHub](https://github.com/fatedier/frp)
