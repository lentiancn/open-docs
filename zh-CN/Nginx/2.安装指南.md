# Nginx 安装指南

本指南将帮助你在各种操作系统上安装 Nginx。

## 环境要求

| 软件 | 要求 |
|------|------|
| 操作系统 | Windows/macOS/Linux |
| 内存 | 最低 512MB |
| 磁盘 | 至少 100MB 可用空间 |

## Windows 安装

### 方法一：官方二进制

1. 下载 Nginx：https://nginx.org/en/download.html
2. 解压到目录（如 C:\nginx）
3. 运行：
   ```cmd
   nginx.exe
   ```

### 方法二：使用 WSL（推荐）

```bash
# 安装 Nginx
sudo apt install nginx

# 启动
sudo service nginx start
```

## macOS 安装

### 方法一：Homebrew（推荐）

```bash
# 安装 Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Nginx
brew install nginx

# 启动 Nginx
brew services start nginx

# 或手动启动
nginx

# 停止
nginx -s stop

# 重载配置
nginx -s reload
```

### 方法二：源码编译

```bash
# 安装编译依赖
brew install pcre openssl

# 下载源码
curl -O https://nginx.org/download/nginx-1.24.0.tar.gz
tar xzf nginx-1.24.0.tar.gz
cd nginx-1.24.0

# 编译
./configure --with-http_ssl_module
make
sudo make install
```

## Linux 安装

### Ubuntu/Debian

```bash
# 更新软件源
sudo apt update

# 安装 Nginx
sudo apt install nginx

# 启动服务
sudo systemctl start nginx

# 设置开机自启
sudo systemctl enable nginx

# 检查状态
sudo systemctl status nginx
```

### CentOS/RHEL

```bash
# 添加 EPEL 仓库
sudo yum install epel-release

# 安装 Nginx
sudo yum install nginx

# 启动服务
sudo systemctl start nginx

# 设置开机自启
sudo systemctl enable nginx
```

### Fedora

```bash
sudo dnf install nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

## 配置文件

### 配置文件位置

```bash
# Ubuntu/Debian
/etc/nginx/nginx.conf
/etc/nginx/sites-available/default
/etc/nginx/sites-enabled/

# CentOS
/etc/nginx/nginx.conf

# macOS (Homebrew)
/usr/local/etc/nginx/nginx.conf
```

### 常用配置

```nginx
# nginx.conf
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # 日志格式
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    
    # Gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    
    # 包含网站配置
    include /etc/nginx/conf.d/*.conf;
}
```

### 简单配置示例

```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    index index.html;
    
    location / {
        try_files $uri $uri/ =404;
    }
}
```

## 常用命令

```bash
# 启动
nginx

# 停止
nginx -s stop

# 优雅停止
nginx -s quit

# 重载配置
nginx -s reload

# 检查配置
nginx -t

# 查看版本
nginx -v

# 详细版本信息
nginx -V
```

## 验证安装

```bash
# 检查版本
nginx -v

# 测试配置
nginx -t

# 查看进程
ps aux | grep nginx

# 访问测试
curl http://localhost
```

## Docker 部署

### 基本使用

```bash
# 运行 Nginx 容器
docker run -d -p 80:80 --name mynginx nginx

# 自定义配置
docker run -d -p 80:80 -v /mynginx.conf:/etc/nginx/nginx.conf --name mynginx nginx
```

### Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./html:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./logs:/var/log/nginx
    restart: unless-stopped
```

## 模块

### 常用模块

| 模块 | 说明 |
|------|------|
| ngx_http_core_module | 核心模块 |
| ngx_http_ssl_module | SSL/TLS |
| ngx_http_gzip_module | Gzip 压缩 |
| ngx_http_rewrite_module | URL 重写 |
| ngx_http_proxy_module | 代理模块 |
| ngx_http_upstream_module | 负载均衡 |
| ngx_http_limit_req_module | 请求限流 |
| ngx_http_limit_conn_module | 连接限流 |

### 查看已安装模块

```bash
nginx -V
```

## 常见问题

### Q1: 端口被占用

**解决方案：**
```bash
# 查找占用端口的进程
netstat -tlnp | grep :80

# 更改 Nginx 端口
listen 8080;
```

### Q2: 403 错误

**解决方案：**
1. 检查文件权限
   ```bash
   chmod 755 /var/www
   ```

2. 检查 index 文件是否存在

### Q3: 配置错误

**解决方案：**
```bash
# 测试配置
nginx -t

# 查看错误日志
tail -f /var/log/nginx/error.log
```

## 下一步

- [Nginx 使用手册](./3.使用手册.md) - 学习 Nginx 配置和使用
- [Nginx 常见问题](./4.常见问题.md) - 解答常见问题
- 官方文档：https://nginx.org/en/docs/
