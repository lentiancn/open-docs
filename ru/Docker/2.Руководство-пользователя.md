# Docker Руководство пользователя

Это руководство содержит подробные инструкции по базовому использованию Docker, включая управление образами, операции с контейнерами, настройку сети, управление томами и многое другое.

---

## Содержание

1. [Основные концепции Docker](#основные-концепции-docker)
2. [Операции с образами](#операции-с-образами)
3. [Операции с контейнерами](#операции-с-контейнерами)
4. [Управление сетью](#управление-сетью)
5. [Управление томами](#управление-томами)
6. [Использование Docker Compose](#использование-docker-compose)
7. [Написание Dockerfiles](#написание-dockerfiles)
8. [Краткий справочник common команд Docker](#краткий-справочник-по-командам-docker)
9. [Лучшие практики](#лучшие-практики)
10. [Устранение неполадок](#устранение-неполадок)

---

## Основные концепции Docker

### Что такое контейнер?

Контейнеры — это лёгкие, исполняемые автономные пакеты, содержащие всё необходимое для запуска программного обеспечения: код, среду выполнения, системные инструменты, системные библиотеки и настройки. Контейнеризация обеспечивает согласованную работу программного обеспечения в любой среде.

### Основные компоненты

- **Образ (Image)**: Шаблон только для чтения, используемый для создания контейнеров
- **Контейнер (Container)**: Запущенный экземпляр образа
- **Репозиторий (Repository)**: Место для хранения образов
- **Dockerfile**: Скрипт для создания образов
- **Docker Compose**: Инструмент для определения и запуска многоконтейнерных приложений

---

## Операции с образами

### Загрузка образов

Загрузите образы из Docker Hub:

```bash
# Загрузить последнюю версию
docker pull nginx

# Загрузить конкретную версию
docker pull nginx:1.25
```

### Просмотр образов

```bash
# Список всех локальных образов
docker images
```

### Удаление образов

```bash
# Удалить указанный образ
docker rmi nginx:latest

# Принудительное удаление
docker rmi -f nginx:latest
```

### Создание образов

Создайте образ с помощью Dockerfile:

```bash
docker build -t myapp:latest .
```

---

## Операции с контейнерами

### Создание и запуск контейнеров

```bash
# Интерактивный контейнер (с терминалом)
docker run -it ubuntu /bin/bash

# Демон-контейнер (запущен в фоне)
docker run -d nginx

# Проброс портов
docker run -d -p 8080:80 nginx

# Указать имя контейнера
docker run -d --name my-nginx nginx
```

### Просмотр контейнеров

```bash
# Список запущенных контейнеров
docker ps

# Список всех контейнеров (включая остановленные)
docker ps -a
```

### Управление жизненным циклом контейнера

```bash
# Запустить контейнер
docker start my-nginx

# Остановить контейнер
docker stop my-nginx

# Перезапустить контейнер
docker restart my-nginx

# Удалить контейнер
docker rm my-nginx
```

### Вход в контейнер

```bash
# Используйте exec для входа в запущенный контейнер
docker exec -it my-nginx /bin/bash
```

---

## Управление сетью

### Просмотр сетей

```bash
# Список всех сетей
docker network ls

# Подробная информация о сети
docker network inspect bridge
```

### Создание сети

```bash
# Создать мостовую сеть
docker network create my-network
```

---

## Управление томами

### Создание тома

```bash
# Создать том
docker volume create my-volume

# Список томов
docker volume ls
```

### Использование томов

```bash
# Монтировать том
docker run -d -v my-volume:/container/path nginx

# Монтировать каталог хоста
docker run -d -v /host/path:/container/path nginx
```

---

## Использование Docker Compose

### Структура файла Docker Compose

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### Common команды

```bash
# Запустить все службы
docker-compose up

# Запустить в фоне
docker-compose up -d

# Остановить все службы
docker-compose down
```

---

## Написание Dockerfiles

### Basic инструкции

```dockerfile
# Указать базовый образ
FROM node:18-alpine

# Установить рабочий каталог
WORKDIR /app

# Копировать файлы
COPY . .

# Открыть порты
EXPOSE 3000

# Команда запуска
CMD ["node", "index.js"]
```

### Пример многоэтапной сборки

```dockerfile
# Этап сборки
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# Этап выполнения
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Краткий справочник по командам Docker

### Команды для образов

| Команда | Описание |
|---------|-------------|
| `docker pull <образ>` | Загрузить образ |
| `docker images` | Список образов |
| `docker rmi <образ>` | Удалить образ |
| `docker build -t <имя> .` | Создать образ |

### Команды для контейнеров

| Команда | Описание |
|---------|-------------|
| `docker run -d <образ>` | Запустить контейнер в фоне |
| `docker run -it <образ>` | Запустить контейнер интерактивно |
| `docker ps` | Список запущенных контейнеров |
| `docker ps -a` | Список всех контейнеров |
| `docker start <контейнер>` | Запустить контейнер |
| `docker stop <контейнер>` | Остановить контейнер |
| `docker rm <контейнер>` | Удалить контейнер |
| `docker exec -it <контейнер> /bin/bash` | Войти в контейнер |

---

## Лучшие практики

### Оптимизация образов

1. **Используйте многоэтапную сборку**: Уменьшите размер финального образа
2. **Выбирайте подходящие базовые образы**: Предпочитайте лёгкие образы типа alpine
3. **Сокращайте количество слоёв**: Объединяйте инструкции RUN
4. **Используйте .dockerignore**: Исключайте ненужные файлы

### Рекомендации по безопасности

1. **Не запускайте от root**: Используйте инструкцию USER
2. **Регулярно обновляйте базовые образы**: Получайте последние исправления безопасности
3. **Используйте официальные образы**: Предпочитайте проверенные официальные образы

---

## Устранение неполадок

### Контейнер не запускается

```bash
# Просмотреть логи контейнера
docker logs <контейнер>
```

### Конфликты портов

```bash
# Проверить использование порта
netstat -tlnp | grep <порт>

# Использовать другой порт
docker run -d -p 8081:80 nginx
```

### Проблемы с дисковым пространством

```bash
# Очистить неиспользуемые образы
docker image prune -a

# Очистить все неиспользуемые ресурсы
docker system prune -a
```

---

## Полезные ссылки

- [Официальная документация Docker](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Документация Docker Compose](https://docs.docker.com/compose/)
