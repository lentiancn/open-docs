# MySQL 사용자 매뉴얼

이 매뉴얼은 MySQL을 효과적으로 사용하는 방법에 대한 종합적인 지침을 제공합니다.

---

## 데이터베이스 연산

### 데이터베이스 생성

```sql
-- 새 데이터베이스 생성
CREATE DATABASE myapp;

-- 문자 세트 지정하여 생성
CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 데이터베이스 표시
SHOW DATABASES;

-- 데이터베이스 선택
USE myapp;

-- 데이터베이스 삭제
DROP DATABASE myapp;
```

### 테이블 생성

```sql
-- 기본 테이블 생성
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 외래 키가 있는 테이블
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered') DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## 데이터 조작

### 데이터 삽입

```sql
-- 단일 행 삽입
INSERT INTO users (username, email, password)
VALUES ('kim', 'kim@example.kr', 'hashed_password');

-- 여러 행 삽입
INSERT INTO users (username, email, password) VALUES
    ('lee', 'lee@example.kr', 'pass1'),
    ('park', 'park@example.kr', 'pass2');
```

### 데이터 업데이트

```sql
-- 단일 행 업데이트
UPDATE users SET password = 'new_hash' WHERE id = 1;

-- 여러 행 업데이트
UPDATE users SET status = 'active' WHERE last_login > '2024-01-01';
```

### 데이터 삭제

```sql
-- 단일 행 삭제
DELETE FROM users WHERE id = 1;

-- 모든 행 삭제
TRUNCATE TABLE users;
```

---

## 데이터 조회

### 기본 SELECT

```sql
-- 모든 열 선택
SELECT * FROM users;

-- 특정 열 선택
SELECT username, email FROM users;

-- WHERE 절 포함
SELECT * FROM users WHERE status = 'active';

-- ORDER BY 포함
SELECT * FROM users ORDER BY created_at DESC;

-- LIMIT 포함
SELECT * FROM users LIMIT 10;
```

### JOIN 연산

```sql
-- INNER JOIN
SELECT o.id, u.username, o.total
FROM orders o
INNER JOIN users u ON o.user_id = u.id;

-- LEFT JOIN
SELECT u.username, o.id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;
```

### 집계 함수

```sql
-- COUNT
SELECT COUNT(*) FROM users;

-- SUM, AVG, MIN, MAX
SELECT SUM(amount) FROM orders;
SELECT AVG(price) FROM products;

-- GROUP BY
SELECT country, COUNT(*) as count
FROM users
GROUP BY country
HAVING count > 10;
```

---

## 사용자 관리

### 사용자 생성

```sql
-- 사용자 생성
CREATE USER 'kim'@'localhost' IDENTIFIED BY 'password123';

-- 특정 권한을 가진 사용자 생성
CREATE USER 'app_user'@'%' IDENTIFIED BY 'password123';
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'app_user'@'%';
```

### 권한 관리

```sql
-- 권한 부여
GRANT SELECT, INSERT ON myapp.* TO 'user'@'localhost';

-- 권한 취소
REVOKE INSERT ON myapp.* FROM 'user'@'localhost';

-- 권한 표시
SHOW GRANTS FOR 'user'@'localhost';

-- 권한 새로고침
FLUSH PRIVILEGES;
```

---

## 백업 및 복원

### 백업

```bash
# 단일 데이터베이스 백업
mysqldump -u root -p myapp > myapp_backup.sql

# 모든 데이터베이스 백업
mysqldump -u root -p --all-databases > full_backup.sql
```

### 복원

```bash
# 백업에서 복원
mysql -u root -p myapp < myapp_backup.sql
```

---

## 인덱스

### 인덱스 생성

```sql
-- 단일 열 인덱스
CREATE INDEX idx_email ON users(email);

--复合 인덱스
CREATE INDEX idx_name_date ON users(name, created_at);

-- 고유 인덱스
CREATE UNIQUE INDEX idx_username ON users(username);
```

### 쿼리 최적화

```sql
-- EXPLAIN - 쿼리 분석
EXPLAIN SELECT * FROM users WHERE email = 'kim@example.kr';

-- 테이블 최적화
OPTIMIZE TABLE users;
```

---

## 복제

### 마스터-슬레이브 복제

**마스터 설정 (my.cnf):**
```ini
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=myapp
```

**슬레이브 설정 (my.cnf):**
```ini
[mysqld]
server-id=2
relay-log=relay-bin
read-only=1
```
