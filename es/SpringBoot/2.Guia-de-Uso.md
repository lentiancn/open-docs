# Spring Boot Guía de Uso

Esta guía proporciona información detallada sobre cómo desarrollar aplicaciones con Spring Boot.

## Conceptos Básicos

### Anotaciones Principales

@SpringBootApplication
Combina tres anotaciones:
- @Configuration
- @EnableAutoConfiguration
- @ComponentScan

```java
@SpringBootApplication
public class MiAplicacion {
    public static void main(String[] args) {
        SpringApplication.run(MiAplicacion.class, args);
    }
}
```

### Inyección de Dependencias

```java
@Service
public class MiServicio {
    
    @Autowired
    private MiComponente componente;
    
    public String saludar() {
        return "Hola, " + componente.getNombre();
    }
}

@Component
public class MiComponente {
    public String getNombre() {
        return "Mundo";
    }
}
```

## Controllers REST

### Crear un REST Controller

```java
@RestController
@RequestMapping("/api")
public class MiController {
    
    @GetMapping("/hola")
    public String hola() {
        return "¡Hola, Mundo!";
    }
    
    @GetMapping("/saludo/{nombre}")
    public String saludo(@PathVariable String nombre) {
        return "¡Hola, " + nombre + "!";
    }
    
    @PostMapping("/datos")
    public Datos datos(@RequestBody Datos datos) {
        datos.setId(1L);
        return datos;
    }
}
```

### Controlador con Servicio

```java
@RestController
@RequestMapping("/usuarios")
public class UsuarioController {
    
    @Autowired
    private UsuarioService usuarioService;
    
    @GetMapping
    public List<Usuario> listar() {
        return usuarioService.findAll();
    }
    
    @GetMapping("/{id}")
    public Usuario obtener(@PathVariable Long id) {
        return usuarioService.findById(id);
    }
    
    @PostMapping
    public Usuario crear(@RequestBody Usuario usuario) {
        return usuarioService.save(usuario);
    }
    
    @PutMapping("/{id}")
    public Usuario actualizar(@PathVariable Long id, @RequestBody Usuario usuario) {
        usuario.setId(id);
        return usuarioService.save(usuario);
    }
    
    @DeleteMapping("/{id}")
    public void eliminar(@PathVariable Long id) {
        usuarioService.deleteById(id);
    }
}
```

## Acceso a Datos

### JPA Repository

```java
@Entity
@Table(name = "usuarios")
public class Usuario {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String nombre;
    
    @Column(unique = true)
    private String email;
    
    // Getters y Setters
}
```

```java
@Repository
public interface UsuarioRepository extends JpaRepository<Usuario, Long> {
    
    Optional<Usuario> findByEmail(String email);
    
    List<Usuario> findByNombreContaining(String nombre);
    
    @Query("SELECT u FROM Usuario u WHERE u.email = ?1")
    Usuario buscarPorEmail(String email);
}
```

### Servicio

```java
@Service
@Transactional
public class UsuarioService {
    
    @Autowired
    private UsuarioRepository usuarioRepository;
    
    public List<Usuario> findAll() {
        return usuarioRepository.findAll();
    }
    
    public Optional<Usuario> findById(Long id) {
        return usuarioRepository.findById(id);
    }
    
    public Usuario save(Usuario usuario) {
        return usuarioRepository.save(usuario);
    }
    
    public void deleteById(Long id) {
        usuarioRepository.deleteById(id);
    }
}
```

## Configuración

### application.yml Avanzado

```yaml
server:
  port: 8080
  servlet:
    context-path: /miapp

spring:
  application:
    name: demo-app
  
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: secret
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true
  
  data:
    redis:
      host: localhost
      port: 6379

logging:
  level:
    root: INFO
    com.demo: DEBUG
```

### Perfiles

```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/devdb

# application-prod.yml
spring:
  datasource:
    url: jdbc:mysql://prodserver/proddb
```

Activar perfil:
```bash
java -jar app.jar --spring.profiles.active=dev
```

## Seguridad

### Configuración Básica de Seguridad

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/publico/**").permitAll()
                .requestMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutSuccessUrl("/")
                .permitAll()
            );
        
        return http.build();
    }
}
```

## Excepciones

### Manejo Global de Excepciones

```java
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<ErrorResponse> manejarNotFound(ResourceNotFoundException ex) {
        ErrorResponse error = new ErrorResponse(
            HttpStatus.NOT_FOUND.value(),
            ex.getMessage()
        );
        return new ResponseEntity<>(error, HttpStatus.NOT_FOUND);
    }
    
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> manejarGeneral(Exception ex) {
        ErrorResponse error = new ErrorRecord(
            HttpStatus.INTERNAL_SERVER_ERROR.value(),
            "Error interno del servidor"
        );
        return new ResponseEntity<>(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

## Testing

### Pruebas Unitarias

```java
@SpringBootTest
class MiServicioTest {
    
    @Autowired
    private MiServicio servicio;
    
    @Test
    void testSaludar() {
        String resultado = servicio.saludar();
        assertEquals("Hola, Mundo", resultado);
    }
}
```

### Pruebas de Controlador

```java
@SpringBootTest
@AutoConfigureMockMvc
class MiControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    void testHola() throws Exception {
        mockMvc.perform(get("/api/hola"))
            .andExpect(status().isOk())
            .andExpect(content().string("¡Hola, Mundo!"));
    }
}
```

## Mejores Prácticas

1. Usa inyección de constructores sobre inyección de campos
2. Mantén la configuración externalizada
3. Usa perfiles para diferentes entornos
4. Implementa manejo de excepciones centralizado
5. Escribe pruebas unitarias y de integración
6. Usa DTOs para transferencia de datos
7. Implementa logging apropiado
