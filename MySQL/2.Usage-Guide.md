# MySQL Usage Guide

Comprehensive guide for using MySQL effectively.

---

## Table of Contents

- [Basic Concepts](#basic-concepts)
- [Database Operations](#database-operations)
- [Table Operations](#table-operations)
- [CRUD Operations](#crud-operations)
- [Users and Permissions](#users-and-permissions)
- [Backup and Restore](#backup-and-restore)
- [Optimization](#optimization)
- [Common Recipes](#common-recipes)
- [Troubleshooting](#troubleshooting)

---

## Basic Concepts

### What is MySQL?

MySQL is an open-source relational database management system (RDBMS) based on SQL.

### Key Terms

| Term | Description |
|------|-------------|
| Database | Structured collection of data |
| Table | Collection of rows and columns |
| Row | Single record |
| Column | Attribute/field |
| Primary Key | Unique identifier |
| Index | Speed up queries |
| View | Virtual table |

### Connect to MySQL

```bash
# Connect with username
mysql -u username -p

# Connect to specific database
mysql -u username -p database_name

# Connect to remote MySQL
mysql -h hostname -u username -p database_name

# Execute SQL from command line
mysql -u username -p -e "SELECT * FROM table"
```

---

## Database Operations

### Create Database

```sql
-- Basic create
CREATE DATABASE myapp_db;

-- With character set
CREATE DATABASE myapp_db 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- Check database exists
CREATE DATABASE IF NOT EXISTS myapp_db;
```

### List Databases

```sql
SHOW DATABASES;
```

### Use Database

```sql
USE myapp_db;
```

### Drop Database

```sql
DROP DATABASE myapp_db;
DROP DATABASE IF EXISTS myapp_db;
```

---

## Table Operations

### Create Table

```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### Table Data Types

| Category | Types |
|----------|-------|
| Numeric | INT, BIGINT, FLOAT, DOUBLE, DECIMAL |
| String | CHAR, VARCHAR, TEXT, BLOB |
| Date | DATE, DATETIME, TIMESTAMP, TIME, YEAR |
| JSON | JSON |

### List Tables

```sql
SHOW TABLES;
DESCRIBE users;
SHOW CREATE TABLE users;
```

### Modify Table

```sql
-- Add column
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- Drop column
ALTER TABLE users DROP COLUMN phone;

-- Modify column
ALTER TABLE users MODIFY COLUMN phone VARCHAR(30);

-- Add index
ALTER TABLE users ADD INDEX idx_email(email);

-- Add primary key
ALTER TABLE users ADD PRIMARY KEY (id);

-- Rename table
RENAME TABLE users TO app_users;
```

### Delete Table

```sql
DROP TABLE users;
DROP TABLE IF EXISTS users;
```

---

## CRUD Operations

### INSERT - Create

```sql
-- Single insert
INSERT INTO users (username, email, password) 
VALUES ('john', 'john@example.com', 'hashed_password');

-- Multiple inserts
INSERT INTO users (username, email, password) VALUES 
  ('john', 'john@example.com', 'pass1'),
  ('jane', 'jane@example.com', 'pass2'),
  ('bob', 'bob@example.com', 'pass3');

-- Insert or update
INSERT INTO users (id, username, email) 
VALUES (1, 'john', 'john@example.com')
ON DUPLICATE KEY UPDATE email = 'john@example.com';
```

### SELECT - Read

```sql
-- Select all
SELECT * FROM users;

-- Select specific columns
SELECT username, email FROM users;

-- With condition
SELECT * FROM users WHERE status = 'active';

-- With LIMIT
SELECT * FROM users LIMIT 10;

-- With ORDER BY
SELECT * FROM users ORDER BY created_at DESC;

-- With GROUP BY
SELECT status, COUNT(*) FROM users GROUP BY status;

-- With JOIN
SELECT u.username, o.order_id 
FROM users u 
INNER JOIN orders o ON u.id = o.user_id;

-- With subquery
SELECT * FROM users 
WHERE id IN (SELECT user_id FROM orders);

-- Distinct
SELECT DISTINCT status FROM users;
```

### UPDATE - Update

```sql
-- Update single row
UPDATE users 
SET email = 'newemail@example.com' 
WHERE id = 1;

-- Update multiple rows
UPDATE users 
SET status = 'inactive' 
WHERE created_at < '2024-01-01';

-- Update multiple columns
UPDATE users 
SET email = 'new@example.com', status = 'active' 
WHERE id = 1;
```

### DELETE - Delete

```sql
-- Delete single row
DELETE FROM users WHERE id = 1;

-- Delete multiple rows
DELETE FROM users WHERE status = 'inactive';

-- Delete all rows (keep table)
TRUNCATE TABLE users;
```

---

## Users and Permissions

### Create User

```sql
-- Create user
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'password';

-- Create user with specific host
CREATE USER 'app_user'@'%' IDENTIFIED BY 'password';
```

### Grant Permissions

```sql
-- Grant all privileges
GRANT ALL PRIVILEGES ON myapp_db.* TO 'app_user'@'localhost';

-- Grant specific privileges
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp_db.* TO 'app_user'@'localhost';

-- Grant with grant option
GRANT ALL PRIVILEGES ON myapp_db.* TO 'app_user'@'localhost' WITH GRANT OPTION;
```

### Common Privileges

| Privilege | Description |
|------------|-------------|
| ALL PRIVILEGES | All available privileges |
| SELECT | Read data |
| INSERT | Insert data |
| UPDATE | Update data |
| DELETE | Delete data |
| CREATE | Create tables/databases |
| DROP | Drop tables/databases |
| ALTER | Modify table structure |

### Revoke Permissions

```sql
REVOKE DELETE ON myapp_db.* FROM 'app_user'@'localhost';
```

### Show Permissions

```sql
SHOW GRANTS FOR 'app_user'@'localhost';
```

### Delete User

```sql
DROP USER 'app_user'@'localhost';
```

---

## Backup and Restore

### Backup Database

```bash
# Backup single database
mysqldump -u root -p myapp_db > backup.sql

# Backup multiple databases
mysqldump -u root -p --databases db1 db2 > backup.sql

# Backup all databases
mysqldump -u root -p --all-databases > full_backup.sql

# Backup with compression
mysqldump -u root -p myapp_db | gzip > backup.sql.gz

# Backup specific tables
mysqldump -u root -p myapp_db users orders > tables.sql
```

### Restore Database

```bash
# Restore from backup
mysql -u root -p myapp_db < backup.sql

# Restore from compressed backup
gunzip < backup.sql.gz | mysql -u root -p

# Restore to remote server
mysql -h remote_host -u root -p myapp_db < backup.sql
```

### Export/Import CSV

```sql
-- Export to CSV
SELECT * INTO OUTFILE '/tmp/users.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM users;

-- Import from CSV
LOAD DATA INFILE '/tmp/users.csv'
INTO TABLE users
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
(username, email, password, status);
```

---

## Optimization

### Index Optimization

```sql
-- Create index
CREATE INDEX idx_email ON users(email);

-- Create composite index
CREATE INDEX idx_status_created ON users(status, created_at);

-- Show indexes
SHOW INDEX FROM users;

-- Drop index
DROP INDEX idx_email ON users;
```

### Query Optimization

```sql
-- Explain query
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';

-- Analyze table
ANALYZE TABLE users;

-- Optimize table
OPTIMIZE TABLE users;
```

### Configuration Tuning

```sql
-- Show variables
SHOW VARIABLES LIKE 'max_connections';
SHOW VARIABLES LIKE 'innodb_buffer_pool_size';

-- Set session variable
SET SESSION max_connections = 200;

-- Set global variable
SET GLOBAL max_connections = 200;
```

---

## Common Recipes

### Pagination

```sql
-- Page 1 (10 items per page)
SELECT * FROM users 
ORDER BY created_at DESC 
LIMIT 10 OFFSET 0;

-- Page 2
SELECT * FROM users 
ORDER BY created_at DESC 
LIMIT 10 OFFSET 10;
```

### Count Rows

```sql
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM users WHERE status = 'active';
```

### Duplicate Records

```sql
-- Find duplicates
SELECT email, COUNT(*) 
FROM users 
GROUP BY email 
HAVING COUNT(*) > 1;

-- Remove duplicates
DELETE FROM users 
WHERE id NOT IN (
  SELECT MIN(id) 
  FROM users 
  GROUP BY email
);
```

### Auto Increment Reset

```sql
ALTER TABLE users AUTO_INCREMENT = 1000;
```

---

## Troubleshooting

### Connection Issues

```bash
# Check MySQL status
sudo systemctl status mysql

# Check port
netstat -tulpn | grep 3306

# Test connection
mysql -u root -p -h localhost
```

### Common Errors

| Error | Solution |
|-------|----------|
| Access denied | Check user permissions |
| Can't connect | Check MySQL is running |
| Unknown database | Check database name |
| Table doesn't exist | Check table name/spelling |

### Log Files

```bash
# Error log (Linux)
tail -f /var/log/mysql/error.log

# Slow query log
tail -f /var/log/mysql/slow.log
```

---

## Next Steps

- Explore [MySQL Workbench](https://www.mysql.com/products/workbench/) for GUI
- Learn about [MySQL Replication](https://dev.mysql.com/doc/refman/8.0/en/replication.html)
- Read about [MySQL Performance](https://dev.mysql.com/doc/refman/8.0/en/optimization.html)
