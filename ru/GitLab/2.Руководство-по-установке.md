# Руководство по установке GitLab

> Полное руководство по установке и настройке GitLab

---

## Системные требования

| Ресурс | Минимум | Рекомендуется |
|---------|---------|---------------|
| CPU | 2 ядра | 4+ ядра |
| Память | 4 ГБ | 8+ ГБ |
| Хранилище | 10 ГБ | 50+ ГБ |
| ОС | Ubuntu, Debian, CentOS, RHEL, Kubernetes | - |

---

## Способы установки

### Пакет Omnibus (рекомендуется для Linux)

#### Ubuntu/Debian

```bash
# Установка зависимостей
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificates tzdata perl

# Добавление репозитория GitLab
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash

# Установка GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" apt-get install gitlab-ee
```

#### CentOS/RHEL

```bash
# Установка зависимостей
sudo yum install -y curl policycoreutils openssh-server

# Добавление репозитория GitLab
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# Установка GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-ee
```

### Установка через Docker

```bash
# Загрузка образа GitLab Docker
docker run --detach \
  --hostname gitlab.example.com \
  --publish 443:443 --publish 80:80 --publish 22:22 \
  --name gitlab \
  --restart always \
  --volume /srv/gitlab/config:/etc/gitlab \
  --volume /srv/gitlab/logs:/var/log/gitlab \
  --volume /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ee:latest
```

### Установка в Kubernetes

```bash
# Использование Helm-чарта
helm repo add gitlab https://charts.gitlab.io
helm install gitlab gitlab/gitlab \
  --set externalUrl="https://gitlab.example.com" \
  --set certmanager-issuer.email="admin@example.com"
```

---

## Начальная настройка

### Настройка внешнего URL

```bash
# Редактирование конфигурационного файла GitLab
sudo vim /etc/gitlab/gitlab.rb

# Установка внешнего URL
external_url 'https://gitlab.example.com'

# Перенастройка GitLab
sudo gitlab-ctl reconfigure
```

### Настройка SMTP (почта)

```bash
# Настройка SMTP в /etc/gitlab/gitlab.rb
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "smtp_user"
gitlab_rails['smtp_password'] = "smtp_password"
gitlab_rails['smtp_domain'] = "example.com"

# Применение изменений
sudo gitlab-ctl reconfigure
```

### Включение HTTPS с Let's Encrypt

```bash
# В /etc/gitlab/gitlab.rb
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com']

# Перенастройка
sudo gitlab-ctl reconfigure
```

---

## Первый вход

1. Откройте GitLab по вашему внешнему URL
2. Войдите с именем пользователя: `root`
3. Установите пароль при первом посещении
4. Создайте свой первый проект

---

## Частые команды

```bash
# Проверка статуса
sudo gitlab-ctl status

# Запуск служб
sudo gitlab-ctl start

# Остановка служб
sudo gitlab-ctl stop

# Перезапуск служб
sudo gitlab-ctl restart

# Просмотр логов
sudo gitlab-ctl tail

# Проверка конфигурации
sudo gitlab-rake gitlab:env:info
```

---

## Устранение неполадок

### Ошибка установки?

- Проверьте системные требования
- Убедитесь, что все зависимости установлены
- Проверьте настройки брандмауэра и SELinux
- Проверьте логи установки

### GitLab не запускается?

```bash
# Проверка конфликтов портов
sudo netstat -tulpn | grep -E ':(80|443|22)\s'

# Проверка места на диске
df -h

# Просмотр логов
sudo gitlab-ctl tail
```

### Низкая производительность?

- Увеличьте ресурсы сервера
- Включите метрики Prometheus
- Настройте соответствующий файл подкачки
- Используйте настройку PostgreSQL

---

## Ресурсы

- Официальная документация по установке: https://docs.gitlab.com/ee/install/
- Аппаратные требования: https://docs.gitlab.com/ee/install/requirements.html
- Форум сообщества: https://forum.gitlab.com/
