# V-Express インストールガイド

V-Expressは、Tencent AI Labが開発したポートレート動画生成手法です。参照画像、音声、V-Kps配列制御下でアバター動画を生成します。

## バージョン概要

| バージョン | ステータス | 説明 |
|------------|------------|------|
| V-Express 1.x | 現行 | メジャーリリース |

## システム要件

### ハードウェア要件

| コンポーネント | 最小要件 | 推奨要件 |
|----------------|----------|----------|
| GPU | NVIDIA 16GB VRAM | NVIDIA 24GB+ VRAM |
| RAM | 16GB | 32GB+ |
| ストレージ | 50GB | 100GB+ |
| CUDA | 11.8+ | 12.1+ |

### ソフトウェア要件

| ソフトウェア | バージョン | 備考 |
|--------------|------------|------|
| Python | 3.8 - 3.10 | 推奨 3.9 |
| CUDA | 11.8+ | GPUアクセラレーションが必要 |
| cuDNN | 8.5+ | CUDAに必須 |
| ffmpeg | 最新版 | 動画処理に必須 |

## Linux/Ubuntu インストール

### ステップ1：システム依存关系的インストール

```bash
# システム更新
sudo apt update && sudo apt upgrade -y

# Pythonと開発ツールのインストール
sudo apt install python3.9 python3-pip python3-venv git wget curl

# システムライブラリのインストール
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# ffmpegのインストール
sudo apt install ffmpeg

# git-lfsのインストール
sudo apt install git-lfs
```

### ステップ2：プロジェクトのクローン

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express
```

### ステップ3：仮想環境の作成

```bash
python3.9 -m venv venv
source venv/bin/activate

# Pythonバージョンの確認
python --version
```

### ステップ4：PyTorchのインストール

```bash
# CUDA 11.8バージョン
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# インストール確認
python -c "import torch; print(torch.cuda.is_available())"
```

### ステップ5：依存関係のインストール

```bash
pip install -r requirements.txt
```

### ステップ6：モデルのダウンロード

```bash
# git-lfsのインストール
git lfs install

# HuggingFaceからモデルをクローン
git clone https://huggingface.co/tk93/V-Express

# モデルを正しい位置に配置
mv V-Express/model_ckpts model_ckpts
mv V-Express/*.bin model_ckpts/v-express
```

または個別にモデルをダウンロード：

```bash
# モデルディレクトリの作成
mkdir -p model_ckpts

# 必要なモデルをダウンロード：
# - stabilityai/sd-vae-ft-mse
# - run wayml/stable-diffusion-v1-5 (unet設定のみ)
# - facebook/wav2vec2-base-960h
# - insightface/buffalo_l
```

## Windows インストール

### ステップ1：Pythonのインストール

1. python.orgからPython 3.9をダウンロード
2. インストール時に「Add Python to PATH」にチェック
3. 確認：`python --version`

### ステップ2：CUDAのインストール

1. NVIDIA WebサイトからCUDA 11.8をダウンロード
2. デフォルト設定でインストール
3. cuDNN 8.9をダウンロードしてインストール

### ステップ3：クローンとセットアップ

```powershell
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python -m venv venv
venv\Scripts\activate
```

### ステップ4：依存関係のインストール

```powershell
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### ステップ5：モデルのダウンロード

HuggingFaceからモデルをダウンロードし、`model_ckpts/`ディレクトリに配置します。

## macOS インストール

### ステップ1：依存関係のインストール

```bash
# Homebrewのインストール（未 설치の場合）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Pythonとffmpegのインストール
brew install python@3.9 ffmpeg git git-lfs
```

### ステップ2：セットアップ

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python3.9 -m venv venv
source venv/bin/activate

# PyTorchのインストール（macOSはCPUのみ）
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

注意：macOSはCPUモードのみサポートしており、GPUアクセラレーションは使用できません。

## インストール確認

```bash
# 基本機能のテスト
python inference.py --help
```

## 一般的な問題

### CUDA メモリ不足

**解決策：**
- 推論ステップ数を減らす：`--num_inference_steps 15`
- メモリ節約を有効化：`--save_gpu_memory`
- より低い解像度を使用

### ライブラリ不足（Windows）

**解決策：**
- Visual C++ Redistributable 2015-2022をインストール
- CUDAをシステムPATHに追加

### モデルダウンロード失敗

**解決策：**
- VPNまたはプロキシを使用
- HuggingFaceから手動でダウンロード
- ネットワーク接続を確認

### ffmpegが見つからない

**解決策：**
- Linux：`sudo apt install ffmpeg`
- Windows：ffmpegをPATHに追加
- macOS：`brew install ffmpeg`

## 重要な注意

1. **顔リターゲット**：ターゲット動画が参照画像と同じ人物でない場合、顔リターゲット重要です。参照顔のポーズにより類似したターゲット動画を選択すると、より良い結果が得られます。

2. **言語サポート**：モデルは英語で最も良いパフォーマンスを示します。他の言語は詳細にテストされていません。

3. **画像品質**：512x512以上の解像度で明るい正方形の顔画像を使用してください。

## 関連リンク

- [GitHubリポジトリ](https://github.com/tencent-ailab/V-Express)
- [HuggingFaceモデル](https://huggingface.co/tk93/V-Express)
- [論文](https://arxiv.org/abs/2406.02511)
- [プロジェクトページ](https://tenvence.github.io/p/v-express/)
