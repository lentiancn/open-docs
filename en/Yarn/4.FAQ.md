# Yarn FAQ

This page compiles the most common questions and answers about using Yarn. If you encounter problems while using Yarn, you should first look for solutions here. If still unresolved, it's recommended to check official documentation or seek help from the community.

---

## Basic Questions

### What is Yarn?

Yarn is a JavaScript package manager developed and maintained by Facebook (now Meta). It helps you install, update, configure, and remove dependency packages in your projects. Yarn is known for its speed, determinism, and security, making it a popular alternative to npm.

### What's the Difference Between Yarn and npm?

The main differences are:

- **Speed**: Yarn uses parallel downloads, usually faster than npm
- **Determinism**: Yarn's yarn.lock file ensures completely consistent installation results every time
- **Offline Support**: Yarn has powerful offline caching capabilities
- **Workspaces**: Yarn has native support for monorepo workspaces
- **Output**: Yarn's command-line output is clearer and more beautiful

### Is Yarn Free?

Yes, Yarn is completely free and open source, using the MIT license. Source code is hosted on GitHub.

### What Version of Node.js Do I Need?

- **Yarn 4.x**: Requires Node.js 16.0.0 or higher
- **Yarn 3.x**: Requires Node.js 14.0.0 or higher
- **Yarn 1.x**: Requires Node.js 8.0.0 or higher

Using Node.js 18 LTS or 20 LTS is recommended for best performance and stability.

### What's the Difference Between Yarn 1.x and Yarn 4.x?

Yarn 1.x is the classic version and no longer receives new feature development. Yarn 4.x (also known as Berry) is a completely rewritten version offering:

- Better performance
- PnP (Plug'n'Play) mode
- More powerful plugin system
- Zero-Installs feature
- More modern configuration approach (.yarnrc.yml)

---

## Installation Questions

### What if Installation Fails?

1. Check Node.js version:
   ```bash
   node --version
   ```
   Ensure Node.js version >= 16.0.0

2. Clean npm cache:
   ```bash
   npm cache clean --force
   ```

3. Use official recommended installation:
   ```bash
   corepack enable
   corepack prepare yarn@stable --activate
   ```

4. Check permission issues, don't use sudo

### Having Problems Installing on Windows?

Windows users are recommended to use one of the following:

1. **Using PowerShell (Recommended)**:
   ```powershell
   iwr -useb https://yarnpkg.com/install.ps1 | iex
   ```

2. **Using winget**:
   ```bash
   winget install Yarn.Yarn
   ```

3. **Using Chocolatey**:
   ```bash
   choco install yarn
   ```

If you encounter issues, try disabling antivirus software and reinstalling.

### How to Upgrade Yarn?

Using Corepack to upgrade:

```bash
corepack prepare yarn@stable --activate
```

Or using npm:

```bash
npm update -g yarn
```

### Command Not Found After Installation?

Ensure Yarn's global bin directory is in PATH:

```bash
# Add temporarily
export PATH="$(yarn global bin):$PATH"

# Add permanently (add to ~/.bashrc or ~/.zshrc)
echo 'export PATH="$(yarn global bin):$PATH"' >> ~/.bashrc
source ~/.bashrc
```

### How to Switch Yarn Versions?

Use Corepack to easily switch:

```bash
# Switch to Yarn 4.x
corepack prepare yarn@4.0.0 --activate

# Switch to Yarn 1.x
corepack prepare yarn@1.22.22 --activate
```

---

## Usage Questions

### How to Add Dependencies?

```bash
# Add production dependency
yarn add lodash

# Add development dependency
yarn add -D typescript
yarn add --dev eslint

# Add specific version
yarn add lodash@4.17.21
```

### How to Remove Dependencies?

```bash
yarn remove lodash
```

### How to Update Dependencies?

```bash
# Update to latest version
yarn up lodash

# Interactive update
yarn up -i

# Update all dependencies
yarn up --all
```

### Dependency Installation Failed?

1. Clean cache:
   ```bash
   yarn cache clean
   ```

2. Remove node_modules and yarn.lock:
   ```bash
   rm -rf node_modules yarn.lock
   ```

3. Reinstall:
   ```bash
   yarn install
   ```

### How to Run Scripts?

```bash
# Run scripts defined in package.json
yarn dev
yarn build
yarn test

# Run custom scripts
yarn run my-script
```

### How to View Dependency Tree?

```bash
yarn list

# Show only top-level dependencies
yarn list --level=0
```

---

## Workspace Questions

### What are Workspaces?

Workspaces allow you to manage multiple related packages in a single code repository (monorepo). Especially useful when you have a core library and multiple related tools.

### How to Configure Workspaces?

Add to root package.json:

```json
{
  "workspaces": [
    "packages/*"
  ]
}
```

### How to Reference Between Workspaces?

Use workspace: protocol:

```json
{
  "dependencies": {
    "@my-org/utils": "workspace:^"
  }
}
```

### How to Run Commands in Workspaces?

```bash
# Add dependency to specific workspace
yarn workspace @my-org/core add lodash

# Run script in specific workspace
yarn workspace @my-org/core run build

# Run in all workspaces
yarn workspaces foreach -pt run build
```

### Workspace Dependencies Out of Sync?

Use Constraints to force synchronization:

Create constraints.pro file and run:

```bash
yarn constraints
```

---

## Configuration Questions

### Where are Configuration Files?

- **Yarn 4.x**: `.yarnrc.yml`
- **Yarn 1.x**: `.yarnrc`

### How to Configure Private Registry?

In `.yarnrc.yml`:

```yaml
npmRegistryServer: "https://registry.mycompany.com"
```

Or use command:

```bash
yarn config set registry https://registry.mycompany.com
```

### How to Use PnP Mode?

In `.yarnrc.yml`:

```yaml
nodeLinker: pnp
```

### How to Enable Hardened Mode?

```bash
yarn install --immutable
```

---

## Performance Questions

### Installation Too Slow?

1. Use offline cache:
   ```bash
   yarn install --offline
   ```

2. Parallel downloads are enabled by default, ensure good network conditions

3. Clean unnecessary cache:
   ```bash
   yarn cache clean
   ```

### How to Speed Up CI/CD?

1. Use Zero-Installs:
   ```yaml
   # .yarnrc.yml
   enableGlobalCache: false
   ```

2. Commit cache to codebase

3. Use --immutable to prevent accidental modifications

---

## Dependency Questions

### Dependency Version Conflicts?

Yarn automatically resolves dependency conflicts. If issues arise:

1. Check dependency tree:
   ```bash
   yarn list
   ```

2. View why a package was installed:
   ```bash
   yarn why lodash
   ```

3. Use Constraints to force version synchronization

### PeerDependencies Warnings?

This is normal. Ensure corresponding dependencies are installed:

```bash
yarn add -P react
```

### Dependencies Outdated?

```bash
yarn outdated
yarn up
```

---

## Lock File Questions

### What is yarn.lock?

yarn.lock records the exact version of each dependency in the dependency tree, ensuring consistent installation results every time.

### Should I Commit yarn.lock?

**Yes**, always commit yarn.lock to version control. This is one of Yarn's most important features.

### Lock File Accidentally Modified?

Restore lock file:

```bash
git checkout yarn.lock
```

Detect accidental modifications in CI:

```bash
yarn install --immutable
```

---

## Other Questions

### How to View Yarn Version?

```bash
yarn --version
```

### How to Get Help?

- Official Documentation: https://yarnpkg.com/docs
- GitHub Issues: https://github.com/yarnpkg/berry/issues
- Discord Community: https://discord.gg/yarn
- Stack Overflow: Add "yarnpkg" tag

### How to Report Bugs?

1. Confirm issue is reproducible
2. Collect information:
   ```bash
   yarn --version
   node --version
   yarn config list
   ```
3. Submit Issue on GitHub

### How to Delete node_modules?

```bash
rm -rf node_modules
```

### Can npm and Yarn Be Mixed?

Technically possible, but not recommended. Mixing can lead to dependency version inconsistencies. It's recommended to stick with one package manager in a project.

### How to Migrate from npm to Yarn?

Simply delete node_modules and package-lock.json, then run:

```bash
yarn install
```

Yarn will generate a new yarn.lock file.

### How to Migrate from Yarn to npm?

Delete yarn.lock, then run:

```bash
npm install
```

npm will generate a new package-lock.json.

---

## Related Resource Links

- Official Website: https://yarnpkg.com
- Official Documentation: https://yarnpkg.com/docs
- CLI Reference: https://yarnpkg.com/cli
- Configuration Reference: https://yarnpkg.com/configuration
- GitHub: https://github.com/yarnpkg/berry
- Discord: https://discord.gg/yarn
