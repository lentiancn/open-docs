# Руководство пользователя MySQL

Это руководство содержит полные инструкции по эффективному использованию MySQL.

---

## Операции с базами данных

### Создание базы данных

```sql
-- Создать новую базу данных
CREATE DATABASE myapp;

-- Создать с набором символов
CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Показать базы данных
SHOW DATABASES;

-- Выбрать базу данных
USE myapp;

-- Удалить базу данных
DROP DATABASE myapp;
```

### Создание таблиц

```sql
-- Базовое создание таблицы
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица с внешними ключами
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered') DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## Манипуляция данными

### Вставка данных

```sql
-- Вставить одну строку
INSERT INTO users (username, email, password)
VALUES ('ivan', 'ivan@example.ru', 'hashed_password');

-- Вставить несколько строк
INSERT INTO users (username, email, password) VALUES
    ('alexey', 'alexey@example.ru', 'pass1'),
    ('petr', 'petr@example.ru', 'pass2');
```

### Обновление данных

```sql
-- Обновить одну строку
UPDATE users SET password = 'new_hash' WHERE id = 1;

-- Обновить несколько строк
UPDATE users SET status = 'active' WHERE last_login > '2024-01-01';
```

### Удаление данных

```sql
-- Удалить одну строку
DELETE FROM users WHERE id = 1;

-- Удалить все строки
TRUNCATE TABLE users;
```

---

## Запросы данных

### Базовый SELECT

```sql
-- Выбрать все столбцы
SELECT * FROM users;

-- Выбрать конкретные столбцы
SELECT username, email FROM users;

-- С WHERE
SELECT * FROM users WHERE status = 'active';

-- С ORDER BY
SELECT * FROM users ORDER BY created_at DESC;

-- С LIMIT
SELECT * FROM users LIMIT 10;
```

### Операции JOIN

```sql
-- INNER JOIN
SELECT o.id, u.username, o.total
FROM orders o
INNER JOIN users u ON o.user_id = u.id;

-- LEFT JOIN
SELECT u.username, o.id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;
```

### Агрегатные функции

```sql
-- COUNT
SELECT COUNT(*) FROM users;

-- SUM, AVG, MIN, MAX
SELECT SUM(amount) FROM orders;
SELECT AVG(price) FROM products;

-- GROUP BY
SELECT country, COUNT(*) as count
FROM users
GROUP BY country
HAVING count > 10;
```

---

## Управление пользователями

### Создание пользователя

```sql
-- Создать пользователя
CREATE USER 'ivan'@'localhost' IDENTIFIED BY 'password123';

-- Создать пользователя с определёнными привилегиями
CREATE USER 'app_user'@'%' IDENTIFIED BY 'password123';
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'app_user'@'%';
```

### Управление привилегиями

```sql
-- Предоставить привилегии
GRANT SELECT, INSERT ON myapp.* TO 'user'@'localhost';

-- Отозвать привилегии
REVOKE INSERT ON myapp.* FROM 'user'@'localhost';

-- Показать привилегии
SHOW GRANTS FOR 'user'@'localhost';

-- Перезагрузить привилегии
FLUSH PRIVILEGES;
```

---

## Резервное копирование и восстановление

### Резервное копирование

```bash
# Резервная копия одной базы данных
mysqldump -u root -p myapp > myapp_backup.sql

# Резервная копия всех баз данных
mysqldump -u root -p --all-databases > full_backup.sql
```

### Восстановление

```bash
# Восстановить из резервной копии
mysql -u root -p myapp < myapp_backup.sql
```

---

## Индексы

### Создание индексов

```sql
-- Индекс на один столбец
CREATE INDEX idx_email ON users(email);

-- Составной индекс
CREATE INDEX idx_name_date ON users(name, created_at);

-- Уникальный индекс
CREATE UNIQUE INDEX idx_username ON users(username);
```

### Оптимизация запросов

```sql
-- EXPLAIN — анализ запроса
EXPLAIN SELECT * FROM users WHERE email = 'ivan@example.ru';

-- Оптимизировать таблицу
OPTIMIZE TABLE users;
```

---

## Репликация

### Репликация мастер-слейв

**Конфигурация мастера (my.cnf):**
```ini
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=myapp
```

**Конфигурация слейва (my.cnf):**
```ini
[mysqld]
server-id=2
relay-log=relay-bin
read-only=1
```
