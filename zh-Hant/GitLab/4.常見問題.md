# GitLab 常見問題

> 解答 GitLab 使用過程中的常見問題

---

## 安裝相關

### Q: GitLab 安裝後無法存取？

**A**: 檢查以下幾個方面：
- 確認外部 URL 設定正確
- 檢查防火牆是否放行了 80、443 連接埠
- 確認服務是否啟動：`sudo gitlab-ctl status`
- 查看日誌排查：`sudo gitlab-ctl tail`

### Q: 記憶體佔用過高怎麼辦？

**A**: GitLab 是資源密集型應用，建議：
- 最低 4GB 記憶體，推薦 8GB 及以上
- 可以透過以下方式優化：
  ```ruby
  # /etc/gitlab/gitlab.rb
  postgresql['shared_buffers'] = "256MB"
  unicorn['worker_processes'] = 2
  ```

### Q: 如何遷移 GitLab 資料？

**A**: 使用 GitLab 備份和還原功能：
```bash
# 備份
sudo gitlab-backup create

# 還原
sudo gitlab-backup restore BACKUP=timestamp
```

---

## Git 操作相關

### Q: 推送程式碼時提示權限不足？

**A**: 
1. 確認已將 SSH 公鑰添加到 GitLab 個人設定中
2. 檢查專案成員權限是否足夠
3. 如果使用 HTTPS，檢查使用者名稱和存取權杖

### Q: 合併請求顯示有衝突怎麼辦？

**A**:
1. 在本機拉取目標分支最新程式碼
2. 將你的分支變基到目標分支
3. 解決衝突後強制推送：
   ```bash
   git fetch origin
   git checkout your-branch
   git rebase origin/main
   # 解決衝突後
   git push --force-with-lease
   ```

### Q: 大檔案推送失敗怎麼解決？

**A**: GitLab 預設限制檔案大小，可以透過設定調整：
```ruby
# /etc/gitlab/gitlab.rb
gitlab_rails['max_attachment_size'] = 100 * 1024 * 1024 # 100MB
```
或使用 Git LFS：
```bash
git lfs install
git lfs track "*.psd"
```

---

## CI/CD 相關

### Q: 流水線一直處於 pending 狀態？

**A**: 
1. 檢查 GitLab Runner 是否已註冊並處於上線狀態
2. 確認 Runner 標籤與 Jobs 匹配
3. 檢查 Runner 的並發限制

### Q: 如何使用私人映像檔倉庫？

**A**: 
```yaml
build:
  image: my-private-image
  variables:
    DOCKER_AUTH_CONFIG: '{"auths":{"registry.example.com":{"username":"user","password":"pass"}}}'
```

### Q: 快取不起作用怎麼辦？

**A**: 確保快取設定正確：
```yaml
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
  policy: pull-push
```

---

## 權限相關

### Q: 如何設定分支保護？

**A**: 
1. 進入專案 → 設定 → 倉庫 → 分支保護
2. 選擇要保護的分支
3. 設定誰可以推送、合併

### Q: 無法存取專案怎麼辦？

**A**: 
1. 確認專案可見性設定（公開/內部/私人）
2. 檢查是否被新增為專案成員
3. 聯繫專案管理員取得權限

---

## 效能優化

### Q: 頁面載入緩慢怎麼優化？

**A**: 
1. 啟用 Prometheus 監控分析
2. 優化 PostgreSQL 設定
3. 使用 Redis 快取
4. 考慮使用 PostgreSQL 主從複寫

### Q: 如何限制使用者配額？

**A**: 在管理後台設定：
- 儲存配額限制
- 倉庫數量限制
- 使用者配額限制

---

## 備份還原

### Q: 如何自動備份？

**A**: 設定 cron 任務：
```bash
# 每天凌晨2點自動備份
0 2 * * * /opt/gitlab/bin/gitlab-backup create CRON=1
```

### Q: 備份檔案在哪裡？

**A**: 預設在 `/var/opt/gitlab/backups/` 目錄

---

## 升級相關

### Q: 如何升級 GitLab？

**A**: 
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install gitlab-ee

# 然後重新設定
sudo gitlab-ctl reconfigure
```

### Q: 升級前需要備份嗎？

**A**: 強烈建議升級前建立完整備份：
```bash
sudo gitlab-backup create
sudo gitlab-ctl stop
```

---

## 常見錯誤代碼

| 錯誤代碼 | 說明 | 解決方法 |
|---------|------|----------|
| 500 | 伺服器內部錯誤 | 查看日誌 |
| 502 | 閘道錯誤 | 檢查服務狀態 |
| 503 | 服務不可用 | 檢查資源使用 |
| 404 | 資源不存在 | 檢查 URL |
| 422 | 請求無法處理 | 檢查參數 |
