# Docker 사용자 매뉴얼

이 매뉴얼에서는 이미지 관리, 컨테이너 작업, 네트워크 구성, 볼륨管理等 Docker의 기본 사용법에 대해詳細히 설명합니다.

---

## 목차

1. [Docker 기본 개념](#docker-기본-개념)
2. [이미지 작업](#이미지-작업)
3. [컨테이너 작업](#컨테이너-작업)
4. [네트워크 관리](#네트워크-관리)
5. [볼륨 관리](#볼륨-관리)
6. [Docker Compose 사용](#docker-compose-사용)
7. [Dockerfile 작성](#dockerfile-작성)
8. [Docker 일반 명령어 빠른 참조](#docker-일반-명령어-빠른-참조)
9. [모범 사례](#모범-사례)
10. [문제 해결](#문제-해결)

---

## Docker 기본 개념

### 컨테이너란?

컨테이너는 소프트웨어를 실행하는 데 필요한 모든 것(코드, 런타임, 시스템 도구, 시스템 라이브러리 및 설정)을 포함하는 가볍고 실행 가능한 독립 실행형 패키지입니다. 컨테이너화를 통해 소프트웨어가 어떤 환경에서든 일관되게 실행됩니다.

### 핵심 구성 요소

- **이미지(Image)**: 컨테이너를 생성하는 데 사용되는 읽기 전용 템플릿
- **컨테이너(Container)**: 이미지의 실행 중인 인스턴스
- **저장소(Repository)**: 이미지를 저장하는 위치
- **Dockerfile**: 이미지를 빌드하는 데 사용되는 스크립트 파일
- **Docker Compose**: 다중 컨테이너 애플리케이션을 정의하고 실행하는 도구

---

## 이미지 작업

### 이미지 가져오기

Docker Hub에서 이미지 가져오기:

```bash
# 최신 버전 가져오기
docker pull nginx

# 특정 버전 가져오기
docker pull nginx:1.25
```

### 이미지 목록 보기

```bash
# 모든 로컬 이미지 나열
docker images
```

### 이미지 제거

```bash
# 지정된 이미지 제거
docker rmi nginx:latest

# 강제 제거
docker rmi -f nginx:latest
```

### 이미지 빌드

Dockerfile을 사용하여 이미지 빌드:

```bash
docker build -t myapp:latest .
```

---

## 컨테이너 작업

### 컨테이너 생성 및 시작

```bash
# 대화형 컨테이너 (터미널 포함)
docker run -it ubuntu /bin/bash

# 데몬 컨테이너 (백그라운드에서 실행)
docker run -d nginx

# 포트 매핑
docker run -d -p 8080:80 nginx

# 컨테이너 이름 지정
docker run -d --name my-nginx nginx
```

### 컨테이너 보기

```bash
# 실행 중인 컨테이너 나열
docker ps

# 모든 컨테이너 나열 (중지된 컨테이너 포함)
docker ps -a
```

### 컨테이너 수명 주기 관리

```bash
# 컨테이너 시작
docker start my-nginx

# 컨테이너 중지
docker stop my-nginx

# 컨테이너 재시작
docker restart my-nginx

# 컨테이너 제거
docker rm my-nginx
```

### 컨테이너 내부로 들어가기

```bash
# exec를 사용하여 실행 중인 컨테이너로 들어가기
docker exec -it my-nginx /bin/bash
```

---

## 네트워크 관리

### 네트워크 보기

```bash
# 모든 네트워크 나열
docker network ls

# 네트워크 상세 정보 보기
docker network inspect bridge
```

### 네트워크 생성

```bash
# 브릿지 네트워크 생성
docker network create my-network
```

---

## 볼륨 관리

### 볼륨 생성

```bash
# 볼륨 생성
docker volume create my-volume

# 볼륨 나열
docker volume ls
```

### 볼륨 사용

```bash
# 볼륨 마운트
docker run -d -v my-volume:/container/path nginx

# 호스트 디렉토리 마운트
docker run -d -v /host/path:/container/path nginx
```

---

## Docker Compose 사용

### Docker Compose 파일 구조

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### 일반 명령어

```bash
# 모든 서비스 시작
docker-compose up

# 백그라운드에서 시작
docker-compose up -d

# 모든 서비스 중지
docker-compose down
```

---

## Dockerfile 작성

### 기본 명령

```dockerfile
# 기본 이미지 지정
FROM node:18-alpine

# 작업 디렉토리 설정
WORKDIR /app

# 파일 복사
COPY . .

# 포트 노출
EXPOSE 3000

# 시작 명령
CMD ["node", "index.js"]
```

### 다단계 빌드 예시

```dockerfile
# 빌드 단계
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# 실행 단계
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Docker 일반 명령어 빠른 참조

### 이미지 명령

| 명령 | 설명 |
|------|------|
| `docker pull <이미지>` | 이미지 가져오기 |
| `docker images` | 이미지 나열 |
| `docker rmi <이미지>` | 이미지 제거 |
| `docker build -t <이름> .` | 이미지 빌드 |

### 컨테이너 명령

| 명령 | 설명 |
|------|------|
| `docker run -d <이미지>` | 백그라운드에서 컨테이너 실행 |
| `docker run -it <이미지>` | 대화형으로 컨테이너 실행 |
| `docker ps` | 실행 중인 컨테이너 나열 |
| `docker ps -a` | 모든 컨테이너 나열 |
| `docker start <컨테이너>` | 컨테이너 시작 |
| `docker stop <컨테이너>` | 컨테이너 중지 |
| `docker rm <컨테이너>` | 컨테이너 제거 |
| `docker exec -it <컨테이너> /bin/bash` | 컨테이너 내부로 들어가기 |

---

## 모범 사례

### 이미지 최적화

1. **다단계 빌드 사용**: 최종 이미지 크기 줄이기
2. **적절한 기본 이미지 선택**: alpine과 같은 가벼운 이미지 선호
3. **레이어 수 줄이기**: RUN 명령 결합
4. **.dockerignore 사용**: 불필요한 파일 제외

### 보안 권장 사항

1. **root로 실행 안 함**: USER 명령 사용
2. **기본 이미지 정기적으로 업데이트**: 최신 보안 패치 받기
3. **공식 이미지 사용**: 검증된 공식 이미지 선호

---

## 문제 해결

### 컨테이너가 시작되지 않음

```bash
# 컨테이너 로그 보기
docker logs <컨테이너>
```

### 포트 충돌

```bash
# 포트 사용 확인
netstat -tlnp | grep <포트>

# 다른 포트 사용
docker run -d -p 8081:80 nginx
```

### 디스크 공간 문제

```bash
# 사용되지 않는 이미지 정리
docker image prune -a

# 사용되지 않는 모든 리소스 정리
docker system prune -a
---

## 관련 링크

- [Docker 공식 문서](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose 문서](https://docs.docker.com/compose/)
