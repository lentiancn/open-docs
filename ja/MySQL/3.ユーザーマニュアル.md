# MySQL ユーザーマニュアル

このマニュアルは、MySQLを効果的に使用するための包括的な手順を提供します。

---

## データベース操作

### データベースの作成

```sql
-- 新しいデータベースを作成
CREATE DATABASE myapp;

-- 文字セットを指定して作成
CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- データベースを表示
SHOW DATABASES;

-- データベースを選択
USE myapp;

-- データベースを削除
DROP DATABASE myapp;
```

### テーブルの作成

```sql
-- 基本的なテーブル作成
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 外部キーを持つテーブル
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered') DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## データ操作

### データの挿入

```sql
-- 単一行を挿入
INSERT INTO users (username, email, password)
VALUES ('tanaka', 'tanaka@example.jp', 'hashed_password');

-- 複数行を挿入
INSERT INTO users (username, email, password) VALUES
    ('suzuki', 'suzuki@example.jp', 'pass1'),
    ('sato', 'sato@example.jp', 'pass2');
```

### データの更新

```sql
-- 単一行を更新
UPDATE users SET password = 'new_hash' WHERE id = 1;

-- 複数行を更新
UPDATE users SET status = 'active' WHERE last_login > '2024-01-01';
```

### データの削除

```sql
-- 単一行を削除
DELETE FROM users WHERE id = 1;

-- 全行を削除
TRUNCATE TABLE users;
```

---

## データのクエリ

### 基本的なSELECT

```sql
-- すべての列を選択
SELECT * FROM users;

-- 特定の列を選択
SELECT username, email FROM users;

-- WHERE句付き
SELECT * FROM users WHERE status = 'active';

-- ORDER BY付き
SELECT * FROM users ORDER BY created_at DESC;

-- LIMIT付き
SELECT * FROM users LIMIT 10;
```

### JOIN操作

```sql
-- INNER JOIN
SELECT o.id, u.username, o.total
FROM orders o
INNER JOIN users u ON o.user_id = u.id;

-- LEFT JOIN
SELECT u.username, o.id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;
```

### 集計関数

```sql
-- COUNT
SELECT COUNT(*) FROM users;

-- SUM, AVG, MIN, MAX
SELECT SUM(amount) FROM orders;
SELECT AVG(price) FROM products;

-- GROUP BY
SELECT country, COUNT(*) as count
FROM users
GROUP BY country
HAVING count > 10;
```

---

## ユーザー管理

### ユーザーの作成

```bash
-- ユーザーを作成
CREATE USER 'tanaka'@'localhost' IDENTIFIED BY 'password123';

-- 特定の権限を持つユーザーを作成
CREATE USER 'app_user'@'%' IDENTIFIED BY 'password123';
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'app_user'@'%';
```

### 権限の管理

```sql
-- 権限を付与
GRANT SELECT, INSERT ON myapp.* TO 'user'@'localhost';

-- 権限を取り消し
REVOKE INSERT ON myapp.* FROM 'user'@'localhost';

-- 権限を表示
SHOW GRANTS FOR 'user'@'localhost';

-- 権限をリロード
FLUSH PRIVILEGES;
```

---

## バックアップと復元

### バックアップ

```bash
# 単一データベースをバックアップ
mysqldump -u root -p myapp > myapp_backup.sql

# すべてのデータベースをバックアップ
mysqldump -u root -p --all-databases > full_backup.sql
```

### 復元

```bash
# バックアップから復元
mysql -u root -p myapp < myapp_backup.sql
```

---

## インデックス

### インデックスの作成

```sql
-- 単一列のインデックス
CREATE INDEX idx_email ON users(email);

-- 複合インデックス
CREATE INDEX idx_name_date ON users(name, created_at);

-- 一意インデックス
CREATE UNIQUE INDEX idx_username ON users(username);
```

### クエリの最適化

```sql
-- EXPLAIN - クエリを分析
EXPLAIN SELECT * FROM users WHERE email = 'tanaka@example.jp';

-- テーブルを最適化
OPTIMIZE TABLE users;
```

---

## レプリケーション

### マスター・スレーブレプリケーション

**マスター設定 (my.cnf):**
```ini
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=myapp
```

**スレーブ設定 (my.cnf):**
```ini
[mysqld]
server-id=2
relay-log=relay-bin
read-only=1
```
