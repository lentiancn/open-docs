# JDK 使用ガイド

このガイドでは、JDKを効果的に使用してJava開発を行う方法について説明します。

## 基本的なコマンド

### Javaのコンパイル

```bash
# 単一ファイルをコンパイル
javac HelloWorld.java

# カスタムクラスパスでコンパイル
javac -cp "lib/*" MyApp.java

# 特定のディレクトリにコンパイル
javac -d ./build MyApp.java

# すべての警告を有効にする
javac -Xlint:all MyApp.java
```

### Javaの実行

```bash
# コンパイル済みクラスを実行
java HelloWorld

# カスタムクラスパスで実行
java -cp "lib/*:." MyApp

# より多くのメモリで実行
java -Xmx512m -Xms256m MyApp

# システムプロパティで実行
java -Dapp.name=MyApp -Denv=prod MyApp
```

### Jarコマンド

```bash
# JARを作成
jar cf myapp.jar -C out .

# 実行可能JARを作成
jar cfe myapp.jar com.example.Main -C out .

# JARの内容を表示
jar tf myapp.jar

# JARを展開
jar xf myapp.jar
```

## JVMオプション

### メモリオプション

```bash
# ヒープサイズ
-Xms256m          # 初期ヒープサイズ
-Xmx1024m         # 最大ヒープサイズ
-Xmn128m          #  молодого поколенияサイズ

# Metaspace（Java 8+）
-XX:MetaspaceSize=128m
-XX:MaxMetaspaceSize=256m
```

### ガベージコレクション

```bash
# G1GC（Java 9のデフォルト）
-XX:+UseG1GC

# ZGC（低レイテンシ）
-XX:+UseZGC

# Parallel GC（スループット）
-XX:+UseParallelGC

# GCログ
-Xlog:gc*:file=gc.log
```

### パフォーマンス

```bash
# JITコンパイル
-XX:+TieredCompilation

# 文字列重複排除（Java 8u20+）
-XX:+UseStringDeduplication

# クラスデータ共有
-Xshare:on
```

## ビルドツール

### Maven

```bash
# プロジェクト作成
mvn archetype:generate

# コンパイル
mvn compile

# テスト実行
mvn test

# パッケージング
mvn package

# 実行
mvn spring-boot:run
```

### Gradle

```bash
# プロジェクト作成
gradle init

# コンパイル
gradle compileJava

# テスト実行
gradle test

# ビルド
gradle build

# 実行
gradle bootRun
```

## モジュールシステム（Java 9+）

### モジュール宣言

```java
// module-info.java
module com.example.myapp {
    requires com.example.utils;
    exports com.example.api;
}
```

### モジュールで実行

```bash
# モジュールを一覧表示
java --list-modules

# モジュール解決を表示
java --show-module-resolution

# モジュールパスを追加
java --module-path lib -m com.example.myapp
```

## セキュリティ

### Keytoolコマンド

```bash
# キーストア生成
keytool -genkeypair -alias myapp -keyalg RSA -keysize 2048 -validity 365 -keystore keystore.jks

# 証明書一覧
keytool -list -keystore keystore.jks

# 証明書をエクスポート
keytool -exportcert -alias myapp -file myapp.crt -keystore keystore.jks
```

### セキュリティポリシー

```bash
# セキュリティポリシーを設定
java -Djava.security.manager -Djava.security.policy=app.policy MyApp

# セキュリティマネージャーを無効化（Java 17+）
java --add-opens java.base/java.lang=ALL-UNNAMED MyApp
```

## 診断ツール

### jcmd

```bash
# Javaプロセスを一覧表示
jcmd -l

# VM情報を表示
jcmd <pid> VM.flags

# システムプロパティを表示
jcmd <pid> VM.system_properties
```

### jstack

```bash
# スレッドダンプを表示
jstack <pid>

# ロック付きスレッドダンプを表示
jstack -l <pid>
```

### jmap / jhsdb

```bash
# ヒープダンプ
jmap -dump:format=b,file=heap.bin <pid>

# ヒープサマリー
jmap -heap <pid>

# クラスヒストグラム
jmap -histo <pid>
```

## Docker

### Dockerfile

```dockerfile
# ビルドイメージ
FROM eclipse-temurin:21-jdk-alpine AS build
WORKDIR /app
COPY . .
RUN ./mvnw package -DskipTests

# ランタイムイメージ
FROM eclipse-temurin:21-jre-alpine
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### ビルドと実行

```bash
docker build -t myapp .
docker run -p 8080:8080 myapp
```

## ベストプラクティス

1. **LTSバージョンを使用する** - 本番環境にはJDK 21またはJDK 17を使用
2. **適切なヒープサイズを設定する** - アプリケーションのニーズに基づいて監視・調整
3. **GCログを有効にする** - パフォーマンス問題のトラブルシューティングに
4. **モジュール式JDKを使用する** - jlinkでコンテナイメージサイズを削減
5. **最新の状態を保つ** - セキュリティパッチを定期的に適用

## 関連リンク

- [Java公式ドキュメント](https://docs.oracle.com/en/java/javase/)
- [JVMオプションリファレンス](https://docs.oracle.com/en/java/javase/21/tools/java.html)
- [Maven Central](https://maven.apache.org/)
- [Gradle](https://gradle.org/)
