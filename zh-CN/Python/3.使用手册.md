# Python 使用手册

本手册介绍 Python 的核心语法和常用操作。

## 基础语法

### 变量和数据类型

```python
# 整数
age = 25
count = 100

# 浮点数
price = 19.99
pi = 3.14159

# 字符串
name = "Alice"
message = 'Hello, World!'

# 布尔值
is_active = True
is_deleted = False

# 列表
numbers = [1, 2, 3, 4, 5]
fruits = ["apple", "banana", "orange"]

# 元组（不可变）
coordinates = (10, 20)
point = (1.5, 2.5, 3.0)

# 字典
person = {"name": "Tom", "age": 30}
config = {"host": "localhost", "port": 8080}

# 集合
unique_numbers = {1, 2, 3, 4, 5}
```

### 运算符

```python
# 算术运算符
a, b = 10, 3
print(a + b)   # 加法: 13
print(a - b)   # 减法: 7
print(a * b)   # 乘法: 30
print(a / b)   # 浮点除法: 3.333...
print(a // b)  # 整数除法: 3
print(a % b)   # 取余: 1
print(a ** b)  # 幂运算: 1000

# 比较运算符
print(a == b)  # False
print(a != b)  # True
print(a > b)   # True
print(a < b)   # False

# 逻辑运算符
x, y = True, False
print(x and y) # False
print(x or y)  # True
print(not x)   # False
```

### 流程控制

```python
# if-elif-else
score = 85

if score >= 90:
    grade = "A"
elif score >= 80:
    grade = "B"
elif score >= 70:
    grade = "C"
else:
    grade = "D"

# for 循环
for i in range(5):
    print(i)  # 0, 1, 2, 3, 4

for fruit in ["apple", "banana", "orange"]:
    print(fruit)

# while 循环
count = 0
while count < 5:
    print(count)
    count += 1

# break 和 continue
for i in range(10):
    if i == 3:
        continue  # 跳过 3
    if i == 7:
        break     # 跳出循环
    print(i)
```

## 函数

### 定义函数

```python
# 基本函数
def greet(name):
    return f"Hello, {name}!"

# 默认参数
def power(base, exponent=2):
    return base ** exponent

# 可变参数
def sum_all(*args):
    return sum(args)

# 关键字参数
def config(name, value, **kwargs):
    print(f"{name} = {value}")
    for key, val in kwargs.items():
        print(f"  {key}: {val}")

# 匿名函数
square = lambda x: x ** 2
add = lambda a, b: a + b
```

### 高级函数

```python
# 高阶函数
def apply_operation(x, y, operation):
    return operation(x, y)

result = apply_operation(5, 3, lambda a, b: a + b)  # 8

# 闭包
def outer(x):
    def inner(y):
        return x + y
    return inner

add_5 = outer(5)
print(add_5(3))  # 8

# 装饰器
def timer(func):
    import time
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        print(f"执行时间: {time.time() - start:.4f}s")
        return result
    return wrapper

@timer
def slow_function():
    import time
    time.sleep(1)
```

## 数据结构

### 列表操作

```python
numbers = [1, 2, 3, 4, 5]

# 添加元素
numbers.append(6)        # 末尾添加
numbers.insert(0, 0)     # 指定位置插入
numbers.extend([7, 8])  # 批量添加

# 删除元素
numbers.pop()           # 末尾删除
numbers.remove(3)       # 删除第一个匹配的
del numbers[0]          # 删除指定位置

# 查找
index = numbers.index(5)
count = numbers.count(2)

# 排序
numbers.sort()          # 原地排序
sorted_numbers = sorted(numbers)  # 返回新列表
numbers.reverse()       # 原地反转

# 切片
first_three = numbers[:3]
last_three = numbers[-3:]
reversed_list = numbers[::-1]
```

### 字典操作

```python
person = {"name": "Tom", "age": 30, "city": "Beijing"}

# 访问
name = person["name"]
age = person.get("age", 0)  # 默认值

# 添加/修改
person["email"] = "tom@example.com"
person["age"] = 31

# 删除
del person["city"]
email = person.pop("email")

# 遍历
for key in person:
    print(f"{key}: {person[key]}")

for key, value in person.items():
    print(f"{key}: {value}")

# 合并字典
config = {**person, "country": "China"}
```

### 集合操作

```python
a = {1, 2, 3, 4}
b = {3, 4, 5, 6}

# 并集
union = a | b
union = a.union(b)

# 交集
intersection = a & b
intersection = a.intersection(b)

# 差集
difference = a - b
difference = a.difference(b)

# 对称差集
symmetric_diff = a ^ b
```

## 面向对象

### 类和对象

```python
class Person:
    # 类属性
    species = "Human"
    
    # 初始化方法
    def __init__(self, name, age):
        # 实例属性
        self.name = name
        self._age = age  # 私有属性
    
    # 实例方法
    def introduce(self):
        return f"I'm {self.name}, {self.age} years old."
    
    # 属性装饰器
    @property
    def age(self):
        return self._age
    
    @age.setter
    def age(self, value):
        if value < 0:
            raise ValueError("Age cannot be negative")
        self._age = value
    
    # 类方法
    @classmethod
    def create_child(cls, name):
        return cls(name, 0)
    
    # 静态方法
    @staticmethod
    def is_adult(age):
        return age >= 18

# 创建对象
person = Person("Tom", 30)
print(person.introduce())

# 继承
class Student(Person):
    def __init__(self, name, age, grade):
        super().__init__(name, age)
        self.grade = grade
    
    def introduce(self):
        return f"I'm {self.name}, {self.grade} grade student."
```

### 特殊方法

```python
class Vector:
    def __init__(self, x, y):
        self.x = x
        self.y = y
    
    def __add__(self, other):
        return Vector(self.x + other.x, self.y + other.y)
    
    def __str__(self):
        return f"Vector({self.x}, {self.y})"
    
    def __repr__(self):
        return f"Vector(x={self.x}, y={self.y})"
    
    def __len__(self):
        return 2
    
    def __getitem__(self, index):
        if index == 0:
            return self.x
        elif index == 1:
            return self.y
        raise IndexError()
```

## 异常处理

```python
# 基础异常处理
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"错误: {e}")
except Exception as e:
    print(f"未知错误: {e}")
else:
    print("没有错误")
finally:
    print("总是执行")

# 抛出异常
def divide(a, b):
    if b == 0:
        raise ValueError("除数不能为零")
    return a / b

# 自定义异常
class MyError(Exception):
    def __init__(self, message):
        self.message = message
        super().__init__(self.message)
```

## 文件操作

### 读取文件

```python
# 读取整个文件
with open("file.txt", "r", encoding="utf-8") as f:
    content = f.read()

# 逐行读取
with open("file.txt", "r", encoding="utf-8") as f:
    for line in f:
        print(line.strip())

# 读取所有行
with open("file.txt", "r", encoding="utf-8") as f:
    lines = f.readlines()
```

### 写入文件

```python
# 写入（覆盖）
with open("output.txt", "w", encoding="utf-8") as f:
    f.write("Hello, World!\n")
    f.write("Second line")

# 追加
with open("output.txt", "a", encoding="utf-8") as f:
    f.write("\nAppended line")
```

### JSON 操作

```python
import json

# 写入 JSON
data = {"name": "Tom", "age": 30}
with open("data.json", "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

# 读取 JSON
with open("data.json", "r", encoding="utf-8") as f:
    data = json.load(f)
```

## 并发编程

### 多线程

```python
import threading
import time

def worker(name, delay):
    for i in range(3):
        print(f"{name}: {i}")
        time.sleep(delay)

# 创建线程
t1 = threading.Thread(target=worker, args=("Thread-1", 1))
t2 = threading.Thread(target=worker, args=("Thread-2", 0.5))

# 启动
t1.start()
t2.start()

# 等待完成
t1.join()
t2.join()

print("完成")
```

### 异步编程

```python
import asyncio

async def fetch_data(delay, name):
    print(f"{name} 开始")
    await asyncio.sleep(delay)
    print(f"{name} 完成")
    return f"{name} 数据"

async def main():
    # 并发执行
    results = await asyncio.gather(
        fetch_data(2, "任务1"),
        fetch_data(1, "任务2"),
        fetch_data(3, "任务3")
    )
    print(results)

asyncio.run(main())
```

## 常用标准库

### os 模块

```python
import os

# 文件和目录
os.mkdir("new_dir")
os.rmdir("new_dir")
os.remove("file.txt")
os.rename("old.txt", "new.txt")

# 路径
path = os.path.join("dir", "file.txt")
dirname = os.path.dirname(path)
basename = os.path.basename(path)
exists = os.path.exists(path)

# 环境变量
home = os.environ.get("HOME")
os.environ["MY_VAR"] = "value"
```

### datetime 模块

```python
from datetime import datetime, timedelta

# 当前时间
now = datetime.now()
today = datetime.today()

# 创建时间
dt = datetime(2024, 1, 1, 12, 0, 0)

# 格式化
formatted = dt.strftime("%Y-%m-%d %H:%M:%S")
parsed = datetime.strptime("2024-01-01", "%Y-%m-%d")

# 时间计算
tomorrow = today + timedelta(days=1)
diff = dt2 - dt1
```

### collections 模块

```python
from collections import Counter, defaultdict, deque, OrderedDict

# 计数器
counter = Counter(["a", "b", "c", "a", "a"])
print(counter["a"])  # 3

# 默认字典
d = defaultdict(int)
d["count"] += 1

# 双端队列
deque = deque([1, 2, 3])
deque.appendleft(0)
deque.append(4)
```

## 常用第三方库

### requests（HTTP 请求）

```python
import requests

# GET 请求
response = requests.get("https://api.example.com/data")
print(response.status_code)
print(response.json())

# POST 请求
data = {"name": "Tom", "age": 30}
response = requests.post("https://api.example.com/create", json=data)
```

### pandas（数据分析）

```python
import pandas as pd

# 创建 DataFrame
df = pd.DataFrame({
    "name": ["Tom", "Jerry", "Spike"],
    "age": [25, 30, 35]
})

# 读取 CSV
df = pd.read_csv("data.csv")

# 数据筛选
adults = df[df["age"] >= 18]

# 统计分析
mean_age = df["age"].mean()
```

### flask（Web 框架）

```python
from flask import Flask, jsonify, request

app = Flask(__name__)

@app.route("/api/hello", methods=["GET"])
def hello():
    return jsonify({"message": "Hello, World!"})

@app.route("/api/echo", methods=["POST"])
def echo():
    data = request.json
    return jsonify(data)

if __name__ == "__main__":
    app.run(debug=True)
```

## 测试

### 单元测试

```python
import unittest

class TestMath(unittest.TestCase):
    def test_add(self):
        self.assertEqual(1 + 1, 2)
    
    def test_divide(self):
        with self.assertRaises(ZeroDivisionError):
            1 / 0

if __name__ == "__main__":
    unittest.main()
```

### pytest

```bash
# 安装
pip install pytest

# 运行测试
pytest test_file.py
pytest -v
pytest -k "test_name"
```

```python
# test_example.py
def test_add():
    assert 1 + 1 == 2

def test_list():
    assert len([1, 2, 3]) == 3
```

## 总结

本手册涵盖了 Python 开发的核心知识点：

- **基础语法**：变量、运算符、流程控制
- **函数**：定义、参数、装饰器
- **数据结构**：列表、字典、集合
- **面向对象**：类、继承、多态
- **异常处理**：try-except、自定义异常
- **文件操作**：读写、JSON
- **并发**：多线程、异步
- **常用库**：os、datetime、requests、pandas、flask
- **测试**：unittest、pytest

掌握这些内容后，你就可以开始 Python 开发之旅了。
