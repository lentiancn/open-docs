# MySQL 使用手冊

本手冊提供有效使用 MySQL 的完整說明。

---

## 資料庫操作

### 建立資料庫

```sql
-- 建立新資料庫
CREATE DATABASE myapp;

-- 建立並指定字符集
CREATE DATABASE myapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 顯示資料庫
SHOW DATABASES;

-- 選擇資料庫
USE myapp;

-- 刪除資料庫
DROP DATABASE myapp;
```

### 建立資料表

```sql
-- 基本資料表建立
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 帶有外鍵的資料表
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    status ENUM('pending', 'processing', 'shipped', 'delivered') DEFAULT 'pending',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## 資料操作

### 插入資料

```sql
-- 插入單一列
INSERT INTO users (username, email, password)
VALUES ('john', 'john@example.com', 'hashed_password');

-- 插入多列
INSERT INTO users (username, email, password) VALUES
    ('alice', 'alice@example.com', 'pass1'),
    ('bob', 'bob@example.com', 'pass2');
```

### 更新資料

```sql
-- 更新單一列
UPDATE users SET password = 'new_hash' WHERE id = 1;

-- 更新多列
UPDATE users SET status = 'active' WHERE last_login > '2024-01-01';
```

### 刪除資料

```sql
-- 刪除單一列
DELETE FROM users WHERE id = 1;

-- 刪除所有列
TRUNCATE TABLE users;
```

---

## 查詢資料

### 基本 SELECT

```sql
-- 選擇所有欄位
SELECT * FROM users;

-- 選擇特定欄位
SELECT username, email FROM users;

-- 使用 WHERE 子句
SELECT * FROM users WHERE status = 'active';

-- 使用 ORDER BY
SELECT * FROM users ORDER BY created_at DESC;

-- 使用 LIMIT
SELECT * FROM users LIMIT 10;
```

### JOIN 操作

```sql
-- INNER JOIN
SELECT o.id, u.username, o.total
FROM orders o
INNER JOIN users u ON o.user_id = u.id;

-- LEFT JOIN
SELECT u.username, o.id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;
```

### 聚合函數

```sql
-- COUNT
SELECT COUNT(*) FROM users;

-- SUM, AVG, MIN, MAX
SELECT SUM(amount) FROM orders;
SELECT AVG(price) FROM products;

-- GROUP BY
SELECT country, COUNT(*) as count
FROM users
GROUP BY country
HAVING count > 10;
```

---

## 使用者管理

### 建立使用者

```sql
-- 建立使用者
CREATE USER 'john'@'localhost' IDENTIFIED BY 'password123';

-- 建立具有特定權限的使用者
CREATE USER 'app_user'@'%' IDENTIFIED BY 'password123';
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'app_user'@'%';
```

### 管理權限

```sql
-- 授予權限
GRANT SELECT, INSERT ON myapp.* TO 'user'@'localhost';

-- 撤銷權限
REVOKE INSERT ON myapp.* FROM 'user'@'localhost';

-- 顯示權限
SHOW GRANTS FOR 'user'@'localhost';

-- 重新載入權限
FLUSH PRIVILEGES;
```

---

## 備份和復原

### 備份

```bash
# 備份單一資料庫
mysqldump -u root -p myapp > myapp_backup.sql

# 備份所有資料庫
mysqldump -u root -p --all-databases > full_backup.sql
```

### 復原

```bash
# 從備份復原
mysql -u root -p myapp < myapp_backup.sql
```

---

## 索引

### 建立索引

```sql
-- 單一欄位索引
CREATE INDEX idx_email ON users(email);

-- 複合索引
CREATE INDEX idx_name_date ON users(name, created_at);

-- 唯一索引
CREATE UNIQUE INDEX idx_username ON users(username);
```

### 優化查詢

```sql
-- EXPLAIN - 分析查詢
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';

-- 優化資料表
OPTIMIZE TABLE users;
```

---

## 複寫

### 主從複寫

**主伺服器設定 (my.cnf):**
```ini
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=myapp
```

**從伺服器設定 (my.cnf):**
```ini
[mysqld]
server-id=2
relay-log=relay-bin
read-only=1
```
