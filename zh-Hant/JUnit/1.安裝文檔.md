# JUnit 安裝指南

JUnit 是 Java 最流行的單元測試框架，也是 Spring Boot 應用程式的預設測試框架。

## 版本概述

JUnit 有兩個主要版本在使用中：

| 版本 | 名稱 | Java 版本 | 發布日期 | 狀態 |
|---------|------|-------------|-------------|--------|
| JUnit 5 | Jupiter | Java 8+ | 2016 | 目前使用 |
| JUnit 4 | - | Java 5+ | 2005 | 已淘汰 |

**建議：** 所有新專案都應使用 JUnit 5（Jupiter）。JUnit 4 已淘汰，僅為向後相容性進行維護。

### 版本差異

| 功能 | JUnit 4 | JUnit 5 |
|---------|---------|----------|
| 註解 | @Test、@Before、@After | @Test、@BeforeEach、@AfterEach |
| 測試類別 | 僅限公開類別 | 任何類別 |
| 斷言 | Assert 方法 | 支援 Lambda 的 Assertions 類別 |
| 參數化測試 | @Parameters | @ParameterizedTest |
| 巢狀測試 | @RunWith(Nested.class) | @Nested |
| 測試套件 | @RunWith(Suite.class) | @SelectPackages |

## 軟體需求

### Java 需求

| JUnit 版本 | 最低 Java 版本 |
|-------------|-------------|
| JUnit 5.11.x | Java 8+ |
| JUnit 5.10.x | Java 8+ |
| JUnit 5.9.x | Java 8+ |
| JUnit 4.13.x | Java 5+ |

### 建構工具

- **Maven**：3.6+
- **Gradle**：5.6+
- **Ant**：1.8+

## 安裝相依性

### Maven（JUnit 5 - 建議）

新增至您的 `pom.xml`：

```xml
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>my-project</artifactId>
    <version>1.0-SNAPSHOT</version>
    
    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <junit.version>5.11.0</junit.version>
    </properties>

    <dependencies>
        <!-- JUnit 5 -->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        
        <!-- JUnit Platform Launcher（用於 IDE 支援） -->
        <dependency>
            <groupId>org.junit.platform</groupId>
            <artifactId>junit-platform-launcher</artifactId>
            <version>1.11.0</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>3.2.5</version>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <version>3.2.5</version>
            </plugin>
        </plugins>
    </build>
</project>
```

### Gradle（JUnit 5 - 建議）

新增至您的 `build.gradle`：

```groovy
plugins {
    id 'java'
    id 'application'
}

repositories {
    mavenCentral()
}

dependencies {
    // JUnit 5 (Jupiter)
    testImplementation 'org.junit.jupiter:junit-jupiter:5.11.0'
    
    // JUnit Platform 用於 IDE 支援
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    
    // JUnit 5 Gradle 支援
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.11.0'
    testRuntimeOnly 'org.junit.vintage:junit-vintage-engine:5.11.0'
}

test {
    useJUnitPlatform()  // 啟用 JUnit 5
}

// 啟用詳細測試輸出
test {
    testLogging {
        events 'passed', 'skipped', 'failed'
        exceptionFormat 'full'
    }
}
```

### JUnit 4（已淘汰 - 不建議）

僅用於無法遷移的現有專案：

```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```

## IDE 支援

### IntelliJ IDEA

| 版本 | JUnit 5 支援 |
|---------|----------------|
| 2023.x | 完整支援 |
| 2022.x | 完整支援 |
| 2021.x | 完整支援 |
| 2020.x | 完整支援 |
| 2019.2+ | 完整支援 |

**設定：**
1. IntelliJ IDEA 內建 JUnit 5 支援
2. 無需額外外掛
3. 只需將相依性新增至 pom.xml 或 build.gradle

**執行測試：**
- 在測試類別上按右鍵 → 執行
- 使用執行配置來獲得更多選項

### VS Code

**必要擴展：**
1. Extension Pack for Java（Microsoft）
2. Language Support for Java by Red Hat

**安裝：**
```bash
code --install-extension vscjava.vscode-java-pack
```

**設定：**
```json
{
    "java.test.config": {
        "name": "JUnit 5",
        "workingDirectory": "${workspaceFolder}",
        "args": ["-m", "org.junit.platform.console", "--include-classname=.*"]
    }
}
```

### Eclipse

**安裝：**
1. 建議使用 Eclipse IDE for Enterprise Java Developers
2. 或透過 Eclipse Marketplace 安裝：
   - 說明 → Eclipse Marketplace
   - 搜尋「JUnit」
   - 安裝「JUnit」

**執行測試：**
- 在測試類別上按右鍵 → 執行 as → JUnit 測試
- 使用執行配置來獲得更多選項

### NetBeans

**安裝：**
1. NetBeans 12+ 內建 JUnit 5 支援
2. 或使用 工具 → 外掛 → 可用外掛

### 舊版 IDE 的 JUnit 5

若使用不原生支援 JUnit 5 的舊版 IDE：

```xml
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-console-standalone</artifactId>
    <version>1.11.0</version>
</dependency>
```

從命令列執行：
```bash
java -jar junit-platform-console-standalone-1.11.0.jar -c MyTestClass
```

## Spring Boot 整合

### Spring Boot 2.2+（預設 JUnit 5）

Spring Boot 2.2+ 預設使用 JUnit 5：

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.3.0</version>
</parent>

<dependencies>
    <!-- 包含 JUnit 5 + Mockito + AssertJ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

此 starter 包含：
- **JUnit Jupiter** - JUnit 5 框架
- **Mockito** - 模擬框架
- **AssertJ** - 流暢式斷言
- **Spring Test** - Spring 測試支援

### Spring Boot 2.1 及更早版本（JUnit 4）

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
    <exclusions>
        <exclusion>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- 新增 JUnit 5 -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <scope>test</scope>
</dependency>
```

### JUnit 5 的 Spring 擴展

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-test</artifactId>
    <scope>test</scope>
    <exclusions>
        <exclusion>
            <groupId>org.junit.vintage</groupId>
            <artifactId>junit-vintage-engine</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

## 獨立使用

### 主控台啟動器

無需建構工具即可執行測試：

```bash
# 下載獨立 JAR
wget https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.11.0/junit-platform-console-standalone-1.11.0.jar

# 執行測試
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest
```

### JUnit 5 主控台選項

```bash
# 執行特定測試類別
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest

# 使用自訂 classpath 執行
java -jar junit-platform-console-standalone-1.11.0.jar -cp myclasses -c com.example.MyTest

# 使用詳細輸出執行
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest --details=verbose

# 執行特定測試方法
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest#myTestMethod

# 執行套件中的測試
java -jar junit-platform-console-standalone-1.11.0.jar --scan-classpath -p com.example.tests
```

## 版本相容性矩陣

### JUnit 5 版本相容性

| JUnit 5 | Platform | Vintage | Spring Boot |
|----------|----------|---------|-------------|
| 5.11.x | 1.11.x | 5.11.x | 3.3.x |
| 5.10.x | 1.10.x | 5.10.x | 3.2.x |
| 5.9.x | 1.9.x | 5.9.x | 3.1.x |
| 5.8.x | 1.8.x | 5.8.x | 2.7.x |

### Java 相容性

| JUnit 5 版本 | 最低 Java 版本 |
|-----------------|-------------|
| 5.11.x | Java 8 |
| 5.10.x | Java 8 |
| 5.9.x | Java 8 |
| 5.8.x | Java 8 |
| 5.7.x | Java 8 |
| 5.6.x | Java 8 |
| 5.5.x | Java 8 |
| 5.4.x | Java 8 |
| 5.3.x | Java 8 |
| 5.2.x | Java 8 |
| 5.1.x | Java 8 |
| 5.0.x | Java 8 |

## 從 JUnit 4 遷移至 JUnit 5

### 註解變更

| JUnit 4 | JUnit 5 |
|----------|-----------|
| @Test（來自 org.junit.Test）| @Test（來自 org.junit.jupiter.api.Test）|
| @Before | @BeforeEach |
| @After | @AfterEach |
| @BeforeClass | @BeforeAll |
| @AfterClass | @AfterAll |
| @Ignore | @Disabled |
| @RunWith | @ExtendWith |
| @Category | @Tag |

### 匯入變更

```java
// JUnit 4
import org.junit.Test;
import org.junit.Before;
import org.junit.After;
import org.junit.BeforeClass;
import org.junit.AfterClass;
import org.junit.Ignore;
import org.junit.runner.RunWith;

// JUnit 5
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.extension.ExtendWith;
```

### 斷言變更

```java
// JUnit 4
import static org.junit.Assert.*;

@Test
public void testExample() {
    assertEquals("expected", "actual");
    assertTrue(condition);
    assertFalse(condition);
    assertNull(object);
    assertNotNull(object);
    assertSame(obj1, obj2);
    assertArrayEquals(arr1, arr2);
}

// JUnit 5
import static org.junit.jupiter.api.Assertions.*;

@Test
void testExample() {
    assertEquals("expected", "actual", "選用訊息");
    assertTrue(condition, () -> "延遲訊息");
    assertFalse(condition);
    assertNull(object);
    assertNotNull(object);
    assertSame(obj1, obj2);
    assertArrayEquals(arr1, arr2);
    
    // JUnit 5 新功能
    assertAll(() -> assertEquals("a", "a"),
              () -> assertTrue(true));
}
```

### 遷移工具

使用 JUnit Vintage 進行逐步遷移：

```xml
<dependency>
    <groupId>org.junit.vintage</groupId>
    <artifactId>junit-vintage-engine</artifactId>
    <scope>test</scope>
</dependency>
```

這允許使用 JUnit 5 平台執行 JUnit 4 測試。

## 疑難排解

### 測試無法執行

**問題：** 測試在 IDE 中無法執行

**解決方案：**
1. 確認 JUnit 5 相依性正確
2. 檢查 Maven/Gradle 能夠解析相依性
3. 驗證 IDE 支援 JUnit 5
4. 清除 IDE 快取並重新建構

### 找不到測試

**問題：** 顯示「No tests found」訊息

**解決方案：**
1. 為測試方法新增 @Test 註解
2. 確認測試類別名稱以「Test」結尾
3. 檢查套件結構
4. 驗證測試位於 src/test/java

### 相依性衝突

**問題：** 與其他函式庫的版本衝突

**解決方案：**
1. 在 Maven 中使用 dependencyManagement
2. 檢查傳遞相依性
3. 排除衝突的相依性

### 效能問題

**問題：** 測試執行緩慢

**解決方案：**
1. 對相關測試使用 @TestInstance(Lifecycle.PER_CLASS)
2. 對慢速測試使用 @Disabled
3. 考慮測試平行化

## 最佳實踐

1. **使用 JUnit 5** - 始終優先選擇 JUnit 5 而非 JUnit 4
2. **有意义的測試名稱** - 命名測試以描述情境
3. **每個測試一個斷言** - 或使用 assertAll 進行多個斷言
4. **測試行為而非實作** - 專注於「什麼」而非「如何」
5. **謹慎使用 @BeforeEach** - 保持設定最小化
6. **利用測試介面** - 使用預設方法進行共享設定

## 相關連結

- [JUnit 官方網站](https://junit.org)
- [JUnit 5 文件](https://junit.org/junit5/)
- [JUnit 5 GitHub](https://github.com/junit-team/junit5)
- [JUnit 5 使用者指南](https://junit.org/junit5/docs/current/user-guide/)
- [Maven Surefire 外掛](https://maven.apache.org/surefire/maven-surefire-plugin/)
- [Gradle 測試](https://docs.gradle.org/current/userguide/java_testing.html)
