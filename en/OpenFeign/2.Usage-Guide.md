# OpenFeign Usage Guide

This guide covers how to use OpenFeign to create REST clients in Spring Boot applications.

## Create Feign Client

### Basic Client

```java
@FeignClient(name = "user-service", url = "http://localhost:8081")
public interface UserClient {
    
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @GetMapping("/users")
    List<User> getAllUsers();
    
    @PostMapping("/users")
    User createUser(@RequestBody User user);
    
    @PutMapping("/users/{id}")
    User updateUser(@PathVariable("id") Long id, @RequestBody User user);
    
    @DeleteMapping("/users/{id}")
    void deleteUser(@PathVariable("id") Long id);
}
```

### Using Service Discovery

```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
}
```

### With Fallback

```java
@FeignClient(name = "user-service", fallback = UserClientFallback.class)
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
}

@Component
public class UserClientFallback implements UserClient {
    @Override
    public User getUserById(Long id) {
        return new User(); // Return default user on failure
    }
}
```

### With Circuit Breaker

```java
@FeignClient(name = "user-service", circuitBreaker = "userCircuitBreaker")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
}
```

## Request Parameters

### Path Variable

```java
@GetMapping("/users/{id}/profile")
User getUserProfile(@PathVariable("id") Long id);
```

### Query Parameter

```java
@GetMapping("/users")
List<User> searchUsers(@RequestParam("name") String name);
```

### Header

```java
@GetMapping("/users")
List<User> getUsers(@RequestHeader("Authorization") String token);
```

### Request Body

```java
@PostMapping("/users")
User createUser(@RequestBody User user);
```

## Advanced Configuration

### Custom Encoder/Decoder

```java
@FeignClient(name = "user-service", configuration = CustomFeignConfig.class)
public interface UserClient {
}

public class CustomFeignConfig {
    @Bean
    public Encoder encoder() {
        return new JacksonEncoder();
    }
    
    @Bean
    public Decoder decoder() {
        return new JacksonDecoder();
    }
}
```

### Logging

```properties
feign.client.config.default.loggerLevel=full
```

### Timeout Configuration

```properties
feign.client.config.default.connectTimeout=10000
feign.client.config.default.readTimeout=30000
```

## Error Handling

```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
}

@Component
public class UserService {
    
    @Autowired
    private UserClient userClient;
    
    public User getUser(Long id) {
        try {
            return userClient.getUserById(id);
        } catch (FeignException e) {
            // Handle error
            return null;
        }
    }
}
```

## Interceptors

### Add Custom Interceptor

```java
@Bean
public RequestInterceptor requestInterceptor() {
    return new RequestInterceptor() {
        @Override
        public void apply(RequestTemplate template) {
            template.header("X-Custom-Header", "value");
        }
    };
}
```

### Authentication Interceptor

```java
@Bean
public RequestInterceptor authInterceptor() {
    return template -> {
        String token = obtainToken();
        template.header("Authorization", "Bearer " + token);
    };
}
```

## Multiple Clients

```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
}

@FeignClient(name = "order-service")
public interface OrderClient {
    @GetMapping("/orders/{id}")
    Order getOrderById(@PathVariable("id") Long id);
}
```

## Best Practices

1. **Use interfaces** - Define Feign clients as interfaces
2. **Add fallbacks** - Handle failures gracefully
3. **Configure timeouts** - Set appropriate timeouts
4. **Use circuit breakers** - Prevent cascade failures
5. **Log appropriately** - Enable logging for debugging

## Related Links

- [OpenFeign GitHub](https://github.com/OpenFeign/feign)
- [Spring Cloud OpenFeign](https://spring.io/projects/spring-cloud-openfeign)
- [OpenFeign Documentation](https://openfeign.github.io/)
