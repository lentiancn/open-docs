# MySQL Usage Guide

Comprehensive guide for using MySQL effectively.

---

## Table of Contents

- [Basic Operations](#basic-operations)
- [Database Management](#database-management)
- [Table Management](#table-management)
- [Data Types](#data-types)
- [CRUD Operations](#crud-operations)
- [Indexes](#indexes)
- [Joins](#joins)
- [Aggregation](#aggregation)
- [Subqueries](#subqueries)
- [Transactions](#transactions)
- [User Management](#user-management)
- [Backup and Restore](#backup-and-restore)
- [Performance Optimization](#performance-optimization)

---

## Basic Operations

### Connect to MySQL

```bash
# Connect with username and password
mysql -u root -p

# Connect to specific database
mysql -u root -p mydb

# Connect to remote server
mysql -h hostname -u root -p

# Docker exec
docker exec -it mysql mysql -u root -p
```

### Common Commands

```sql
-- Show all databases
SHOW DATABASES;

-- Create database
CREATE DATABASE mydb;

-- Use database
USE mydb;

-- Show current database
SELECT DATABASE();

-- Show tables
SHOW TABLES;

-- Show MySQL version
SELECT VERSION();

-- Show system information
SHOW STATUS;

-- Show variables
SHOW VARIABLES;
```

---

## Database Management

### Create Database

```sql
-- Simple database
CREATE DATABASE myapp;

-- With charset
CREATE DATABASE myapp DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;

-- If not exists (prevents error)
CREATE DATABASE IF NOT EXISTS myapp;
```

### Drop Database

```sql
-- Drop database
DROP DATABASE myapp;

-- Safe drop
DROP DATABASE IF EXISTS myapp;
```

---

## Table Management

### Create Table

```sql
-- Basic table
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table with foreign key
CREATE TABLE posts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- With index
CREATE TABLE products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    category_id INT,
    INDEX idx_category (category_id)
) ENGINE=InnoDB;
```

### Table Constraints

| Constraint | Description |
|------------|-------------|
| PRIMARY KEY | Unique identifier |
| NOT NULL | Cannot be NULL |
| UNIQUE | No duplicate values |
| DEFAULT | Default value |
| FOREIGN KEY | Reference to another table |
| AUTO_INCREMENT | Auto-incrementing number |

### Modify Table

```sql
-- Add column
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- Add index
ALTER TABLE users ADD INDEX idx_email (email);

-- Rename table
ALTER TABLE users RENAME TO app_users;

-- Drop column
ALTER TABLE users DROP COLUMN phone;

-- Change column type
ALTER TABLE users MODIFY COLUMN name VARCHAR(150);
```

### Drop Table

```sql
-- Drop table
DROP TABLE posts;

-- Safe drop
DROP TABLE IF EXISTS posts;
```

---

## Data Types

### Numeric Types

| Type | Range | Usage |
|------|-------|-------|
| TINYINT | -128 to 127 | Small integers |
| INT | -2B to 2B | Regular integers |
| BIGINT | Very large | Large integers |
| DECIMAL(10,2) | Precise | Money/currency |
| FLOAT | Single precision | Approximate numbers |
| DOUBLE | Double precision | Approximate numbers |

### String Types

| Type | Max Length | Usage |
|------|-----------|-------|
| CHAR(10) | Fixed | Fixed length |
| VARCHAR(255) | Variable | Variable length |
| TEXT | 65KB | Long text |
| MEDIUMTEXT | 16MB | Large text |
| LONGTEXT | 4GB | Very large text |

### Date/Time Types

| Type | Format | Usage |
|------|--------|-------|
| DATE | YYYY-MM-DD | Dates only |
| TIME | HH:MM:SS | Time only |
| DATETIME | YYYY-MM-DD HH:MM:SS | Date and time |
| TIMESTAMP | Unix timestamp | Auto timestamps |
| YEAR | YYYY | Year only |

---

## CRUD Operations

### INSERT - Create

```sql
-- Insert single row
INSERT INTO users (name, email, password) 
VALUES ('John', 'john@example.com', 'pass123');

-- Insert multiple rows
INSERT INTO users (name, email, password) VALUES 
('Alice', 'alice@example.com', 'pass123'),
('Bob', 'bob@example.com', 'pass123');

-- Insert with auto-generated ID
INSERT INTO users (name, email) VALUES ('Charlie', 'charlie@example.com');
SELECT LAST_INSERT_ID();
```

### SELECT - Read

```sql
-- Select all columns
SELECT * FROM users;

-- Select specific columns
SELECT name, email FROM users;

-- With WHERE condition
SELECT * FROM users WHERE id = 1;

-- Multiple conditions
SELECT * FROM users WHERE name = 'John' AND email LIKE '%@example.com';

-- With LIMIT
SELECT * FROM users LIMIT 10;

-- With OFFSET (pagination)
SELECT * FROM users LIMIT 10 OFFSET 20;

-- With ORDER BY
SELECT * FROM users ORDER BY created_at DESC;

-- DISTINCT values
SELECT DISTINCT category FROM products;
```

### UPDATE - Update

```sql
-- Update single row
UPDATE users SET email = 'newemail@example.com' WHERE id = 1;

-- Update multiple columns
UPDATE users SET name = 'John', phone = '123456' WHERE id = 1;

-- Update all rows (be careful!)
UPDATE users SET status = 'active';
```

### DELETE - Delete

```sql
-- Delete single row
DELETE FROM users WHERE id = 1;

-- Delete with condition
DELETE FROM users WHERE status = 'inactive' AND created_at < '2024-01-01';

-- Delete all rows (be careful!)
DELETE FROM users;
```

---

## Indexes

### Create Index

```sql
-- Single column index
CREATE INDEX idx_name ON users(name);

-- Composite index
CREATE INDEX idx_name_email ON users(name, email);

-- Unique index
CREATE UNIQUE INDEX idx_email ON users(email);

-- Full-text index
ALTER TABLE articles ADD FULLTEXT(title, content);
```

### Show Indexes

```sql
SHOW INDEX FROM users;
```

### Drop Index

```sql
DROP INDEX idx_name ON users;
```

---

## Joins

### INNER JOIN

```sql
-- Get posts with user names
SELECT posts.title, users.name 
FROM posts 
INNER JOIN users ON posts.user_id = users.id;
```

### LEFT JOIN

```sql
-- All users and their posts (including users without posts)
SELECT users.name, posts.title 
FROM users 
LEFT JOIN posts ON users.id = posts.user_id;
```

### RIGHT JOIN

```sql
-- All posts and their users (including posts without users)
SELECT users.name, posts.title 
FROM users 
RIGHT JOIN posts ON users.id = posts.user_id;
```

### Multiple Joins

```sql
SELECT posts.title, users.name, categories.name as category
FROM posts
INNER JOIN users ON posts.user_id = users.id
INNER JOIN categories ON posts.category_id = categories.id;
```

---

## Aggregation

### COUNT, SUM, AVG, MIN, MAX

```sql
-- Count rows
SELECT COUNT(*) FROM users;

-- Count with condition
SELECT COUNT(*) FROM orders WHERE status = 'completed';

-- Sum
SELECT SUM(amount) FROM orders;

-- Average
SELECT AVG(price) FROM products;

-- Min/Max
SELECT MIN(price), MAX(price) FROM products;
```

### GROUP BY

```sql
-- Count by category
SELECT category_id, COUNT(*) as count 
FROM products 
GROUP BY category_id;

-- Sum by user
SELECT user_id, SUM(amount) as total 
FROM orders 
GROUP BY user_id;

-- With HAVING (filter groups)
SELECT user_id, COUNT(*) as order_count
FROM orders
GROUP BY user_id
HAVING order_count > 5;
```

---

## Subqueries

```sql
-- Subquery in WHERE
SELECT * FROM products 
WHERE price > (SELECT AVG(price) FROM products);

-- Subquery in FROM
SELECT * FROM (
    SELECT category, AVG(price) as avg_price 
    FROM products 
    GROUP BY category
) as category_avg;

-- Subquery in INSERT
INSERT INTO orders (user_id, amount)
SELECT id, 100 FROM users WHERE status = 'active';
```

---

## Transactions

```sql
-- Start transaction
START TRANSACTION;

-- Perform operations
INSERT INTO accounts (user_id, amount) VALUES (1, 100);
UPDATE accounts SET balance = balance + 100 WHERE user_id = 1;

-- Commit (save changes)
COMMIT;

-- Or rollback (undo changes)
ROLLBACK;
```

### Transaction Example (Transfer Money)

```sql
START TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE user_id = 1 AND balance >= 100;
UPDATE accounts SET balance = balance + 100 WHERE user_id = 2;

-- Check if both succeeded, then commit
COMMIT;
```

---

## User Management

### Create User

```sql
-- Create user
CREATE USER 'myuser'@'localhost' IDENTIFIED BY 'mypassword';

-- Create user with specific host
CREATE USER 'myuser'@'%' IDENTIFIED BY 'mypassword';
```

### Grant Privileges

```sql
-- Grant all privileges
GRANT ALL PRIVILEGES ON mydb.* TO 'myuser'@'localhost';

-- Grant specific privileges
GRANT SELECT, INSERT, UPDATE ON mydb.* TO 'myuser'@'localhost';

-- Grant with permission to grant
GRANT ALL ON mydb.* TO 'myuser'@'localhost' WITH GRANT OPTION;
```

### Common Privileges

| Privilege | Description |
|-----------|-------------|
| ALL | All privileges |
| SELECT | Read data |
| INSERT | Insert data |
| UPDATE | Update data |
| DELETE | Delete data |
| CREATE | Create tables |
| DROP | Drop tables |

### Revoke Privileges

```sql
REVOKE INSERT ON mydb.* FROM 'myuser'@'localhost';
```

### Drop User

```sql
DROP USER 'myuser'@'localhost';
```

### Change Password

```sql
-- For MySQL 5.7+
ALTER USER 'root'@'localhost' IDENTIFIED BY 'newpassword';

-- Or
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('newpassword');
```

---

## Backup and Restore

### Backup (mysqldump)

```bash
# Backup single database
mysqldump -u root -p mydb > mydb.sql

# Backup multiple databases
mysqldump -u root -p --databases db1 db2 > backup.sql

# Backup all databases
mysqldump -u root -p --all-databases > all_backup.sql

# Backup with compression
mysqldump -u root -p mydb | gzip > mydb.sql.gz

# Backup specific tables
mysqldump -u root -p mydb users orders > tables.sql
```

### Restore

```bash
# Restore database
mysql -u root -p mydb < mydb.sql

# Restore all databases
mysql -u root -p < all_backup.sql

# Restore with compression
gunzip < mydb.sql.gz | mysql -u root -p mydb
```

### Docker Backup/Restore

```bash
# Backup
docker exec mysql mysqldump -u root -p mydb > backup.sql

# Restore
cat backup.sql | docker exec -i mysql mysql -u root -p mydb
```

---

## Performance Optimization

### EXPLAIN - Analyze Queries

```sql
EXPLAIN SELECT * FROM users WHERE email = 'test@example.com';
```

### Tips

1. **Use INDEXES** on columns used in WHERE, JOIN, ORDER BY
2. **SELECT only needed columns** - avoid `SELECT *`
3. **Use LIMIT** when you only need a few rows
4. **Avoid functions on indexed columns** in WHERE
5. **Use EXPLAIN** to analyze slow queries
6. **Optimize data types** - use INT instead of VARCHAR for IDs

### Query Cache (MySQL 8.0 removed this)

In MySQL 8.0+, use persistent query results with:
- Query Rewrite Plugins
- Prepared Statements

---

## Common Errors

### Access Denied

```sql
-- Grant access
GRANT ALL ON mydb.* TO 'user'@'localhost';
FLUSH PRIVILEGES;
```

### Table Doesn't Exist

```sql
-- Check if database is selected
USE mydb;
SHOW TABLES;
```

### Duplicate Entry

```sql
-- Check for existing data
SELECT * FROM users WHERE email = 'test@example.com';

-- Use INSERT IGNORE
INSERT IGNORE INTO users (email) VALUES ('test@example.com');

-- Or use ON DUPLICATE KEY UPDATE
INSERT INTO users (email, name) VALUES ('test@example.com', 'John')
ON DUPLICATE KEY UPDATE name = 'John';
```

---

## Quick Reference

### Common Data Types

```sql
-- Numbers
INT, BIGINT, DECIMAL(10,2), FLOAT, DOUBLE

-- Strings
VARCHAR(255), TEXT, CHAR(10)

-- Dates
DATE, DATETIME, TIMESTAMP
```

### Common Commands

```sql
SHOW DATABASES;      -- List databases
USE dbname;          -- Select database
SHOW TABLES;         -- List tables
DESC tablename;      -- Show table structure
SHOW CREATE TABLE tablename; -- Show CREATE statement
```

---

## Next Steps

- Explore [MySQL Workbench](https://www.mysql.com/products/workbench/) for GUI
- Learn about [MySQL Replication](https://dev.mysql.com/doc/refman/8.0/en/replication.html)
- Read [MySQL Performance](https://dev.mysql.com/doc/refman/8.0/en/optimization.html)
