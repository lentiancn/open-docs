# Redis Usage Guide

Comprehensive guide for using Redis effectively.

---

## Table of Contents

- [Basic Concepts](#basic-concepts)
- [Data Types](#data-types)
- [String Operations](#string-operations)
- [List Operations](#list-operations)
- [Hash Operations](#hash-operations)
- [Set Operations](#set-operations)
- [Sorted Set Operations](#sorted-set-operations)
- [Keys and Expiry](#keys-and-expiry)
- [Pub/Sub](#pub-sub)
- [Transactions](#transactions)
- [Pipeline](#pipeline)
- [Lua Scripts](#lua-scripts)
- [Persistence](#persistence)
- [Replication](#replication)
- [Cluster](#cluster)
- [Security](#security)
- [Performance Optimization](#performance-optimization)
- [Common Recipes](#common-recipes)

---

## Basic Concepts

### What is Redis?

Redis is an in-memory data structure store, used as a database, cache, and message broker. It supports various data structures and provides high performance.

### Key Features

- In-memory storage
- Data persistence
- Replication
- Clustering
- Pub/Sub messaging
- Lua scripting

### Key Terms

| Term | Description |
|------|-------------|
| Key | Unique identifier for value |
| Value | Data stored in Redis |
| TTL | Time To Live (expiration) |
| Pipeline | Batch multiple commands |
| Master | Primary Redis instance |
| Slave | Replica of master |

---

## Data Types

Redis supports various data types:

| Type | Description |
|------|-------------|
| String | Text or binary data |
| List | Ordered list of strings |
| Hash | Collection of field-value pairs |
| Set | Unordered collection of unique strings |
| Sorted Set | Set with scores for ordering |
| HyperLogLog | Probabilistic data structure |
| Bitmap | String with bit operations |
| Stream | Log-structured message broker |

---

## String Operations

### Basic Commands

```bash
# Set value
SET key "value"

# Get value
GET key

# Set multiple keys
MSET key1 "value1" key2 "value2"

# Get multiple keys
MGET key1 key2

# Append to string
APPEND key " appended"

# Get string length
STRLEN key
```

### Numeric Operations

```bash
# Increment
INCR counter
INCRBY counter 10

# Decrement
DECR counter
DECRBY counter 5

# Float increment
INCRBYFLOAT price 0.5
```

---

## List Operations

### Basic Commands

```bash
# Push to left
LPUSH mylist "first"

# Push to right
RPUSH mylist "last"

# Pop from left
LPOP mylist

# Pop from right
RPOP mylist

# Get range
LRANGE mylist 0 -1

# Get list length
LLEN mylist
```

---

## Hash Operations

### Basic Commands

```bash
# Set hash field
HSET user:1 name "John"

# Set multiple hash fields
HMSET user:1 name "John" email "john@example.com"

# Get hash field
HGET user:1 name

# Get all fields and values
HGETALL user:1

# Get multiple fields
HMGET user:1 name email

# Delete field
HDEL user:1 email
```

---

## Set Operations

### Basic Commands

```bash
# Add to set
SADD myset "member1"

# Remove from set
SREM myset "member1"

# Get all members
SMEMBERS myset

# Check membership
SISMEMBER myset "member1"

# Get set size
SCARD myset
```

### Set Operations

```bash
# Union
SUNION set1 set2

# Intersection
SINTER set1 set2

# Difference
SDIFF set1 set2
```

---

## Sorted Set Operations

### Basic Commands

```bash
# Add to sorted set
ZADD leaderboard 100 "player1"

# Get range (ascending)
ZRANGE leaderboard 0 -1 WITHSCORES

# Get range (descending)
ZREVRANGE leaderboard 0 -1 WITHSCORES

# Get rank
ZRANK leaderboard "player1"

# Increment score
ZINCRBY leaderboard 50 "player1"
```

---

## Keys and Expiry

### Key Management

```bash
# Delete key
DEL key

# Check if key exists
EXISTS key

# Get key type
TYPE key

# Rename key
RENAME key newkey

# Get all keys
KEYS pattern

# Scan keys
SCAN 0 MATCH pattern
```

### Expiry

```bash
# Set expiration (seconds)
EXPIRE key 60

# Set expiration (milliseconds)
PEXPIRE key 60000

# Set key with expiration
SETEX key 60 "value"

# Remove expiration
PERSIST key

# Get time to live (seconds)
TTL key

# Get time to live (milliseconds)
PTTL key
```

---

## Pub/Sub

### Publishing

```bash
# Subscribe to channel
SUBSCRIBE mychannel

# Publish message
PUBLISH mychannel "Hello"

# Pattern subscribe
PSUBSCRIBE news.*
```

### Commands

```bash
# Subscribe
SUBSCRIBE channel1 channel2

# Publish
PUBLISH channel1 "message"

# Unsubscribe
UNSUBSCRIBE channel1
```

---

## Transactions

### Basic Commands

```bash
# Start transaction
MULTI

# Queue commands
SET key1 "value1"
SET key2 "value2"

# Execute transaction
EXEC

# Discard transaction
DISCARD
```

### Watch

```bash
WATCH key
# ... some operations ...
MULTI
SET key newvalue
EXEC  # Fails if key was modified
```

---

## Pipeline

### Using Pipeline

```bash
# Pipeline multiple commands
redis-cli PING
redis-cli SET key1 "value1"
redis-cli GET key1

# In code (Python example)
pipe = r.pipeline()
pipe.set('key1', 'value1')
pipe.get('key1')
pipe.execute()
```

---

## Lua Scripts

### Basic Script

```bash
# Execute Lua script
EVAL "return redis.call('get', 'key')" 0

# Set key with Lua
EVAL "redis.call('set', KEYS[1], ARGV[1])" 1 mykey myvalue
```

### Script Example

```lua
-- Increment counter
local current = redis.call('get', KEYS[1])
if current then
    current = tonumber(current) + 1
else
    current = 1
end
redis.call('set', KEYS[1], current)
return current
```

---

## Persistence

### RDB (Redis Database)

```bash
# Save manually
BGSAVE

# Get last save time
LASTSAVE
```

### AOF (Append Only File)

```bash
# Enable AOF in config
appendonly yes

# Rewrite AOF
BGREWRITEAOF
```

### Configuration

```bash
# Save frequency
save 900 1
save 300 10
save 60 10000
```

---

## Replication

### Setup Slave

```bash
# In redis.conf
replicaof masterip masterport

# Or via command
REPLICAOF masterip masterport
```

### Commands

```bash
# Check replication status
INFO replication

# Become master
REPLICAOF NO ONE
```

---

## Cluster

### Create Cluster

```bash
# Create cluster
redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 --cluster-replicas 1

# Check cluster nodes
redis-cli -c cluster nodes
```

---

## Security

### Password Authentication

```bash
# Set password in config
requirepass yourpassword

# Authenticate via CLI
AUTH yourpassword
```

### ACL (Redis 6+)

```bash
# Create user
ACL SETUSER alice on >password ~cached:* +get +set

# List users
ACL LIST
```

---

## Performance Optimization

### Memory Optimization

```bash
# Set max memory
maxmemory 2gb

# Eviction policy
maxmemory-policy allkeys-lru
```

### Connection Optimization

```bash
# Use connection pooling
# In code
redis_pool = redis.ConnectionPool(host='localhost', port=6379, max_connections=50)
```

---

## Common Recipes

### Caching

```bash
# Cache with expiration
SET user:1:profile "data" EX 3600

# Check cache
GET user:1:profile
```

### Rate Limiting

```bash
# Simple rate limit
INCR rate_limit:ip:192.168.1.1
EXPIRE rate_limit:ip:192.168.1.1 60
```

### Distributed Lock

```bash
# Acquire lock
SET lock:myresource unique_value NX EX 10

# Release lock
EVAL "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end" 1 lock:myresource unique_value
```

### Session Storage

```bash
# Store session
HSET session:abc123 user_id 12345
EXPIRE session:abc123 1800
```

---

## Next Steps

- Explore [Redis Stack](https://redis.io/docs/stack/)
- Learn about [Redis Enterprise](https://redis.com/redis-enterprise/)
- Read [Performance Tuning Guide](https://redis.io/docs/management/optimization/)
