# JUnit インストールガイド

JUnitはJavaで最も人気のユニットテストフレームワークであり、Spring Bootアプリケーションのデフォルトテストフレームワークです。

## バージョンの概要

JUnitには2つの主要なバージョンが使用されています：

| バージョン | 名前 | Javaバージョン | リリース日 | ステータス |
|---------|------|-------------|-------------|--------|
| JUnit 5 | Jupiter | Java 8+ | 2016 | 現在使用中 |
| JUnit 4 | - | Java 5+ | 2005 | レガシー |

**推奨：** すべての新規プロジェクトにはJUnit 5（Jupiter）を使用してください。JUnit 4はレガシーであり、下位互換性のためだけにメンテナンスされています。

### バージョンの違い

| 機能 | JUnit 4 | JUnit 5 |
|---------|---------|----------|
| アノテーション | @Test、@Before、@After | @Test、@BeforeEach、@AfterEach |
| テストクラス | 公開クラスのみ | 任意のクラス |
| アサーション | Assertメソッド | LambdaをサポートするAssertionsクラス |
| パラメータ化テスト | @Parameters | @ParameterizedTest |
| ネストされたテスト | @RunWith(Nested.class) | @Nested |
| テストスイート | @RunWith(Suite.class) | @SelectPackages |

## 前提条件

### Java要件

| JUnitバージョン | 最小Javaバージョン |
|-------------|-------------|
| JUnit 5.11.x | Java 8+ |
| JUnit 5.10.x | Java 8+ |
| JUnit 5.9.x | Java 8+ |
| JUnit 4.13.x | Java 5+ |

### ビルドツール

- **Maven**：3.6+
- **Gradle**：5.6+
- **Ant**：1.8+

## 依存関係のインストール

### Maven（JUnit 5 - 推奨）

`pom.xml`に追加：

```xml
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>my-project</artifactId>
    <version>1.0-SNAPSHOT</version>
    
    <properties>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <junit.version>5.11.0</junit.version>
    </properties>

    <dependencies>
        <!-- JUnit 5 -->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        
        <!-- JUnit Platform Launcher（IDEサポート用） -->
        <dependency>
            <groupId>org.junit.platform</groupId>
            <artifactId>junit-platform-launcher</artifactId>
            <version>1.11.0</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>3.2.5</version>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <version>3.2.5</version>
            </plugin>
        </plugins>
    </build>
</project>
```

### Gradle（JUnit 5 - 推奨）

`build.gradle`に追加：

```groovy
plugins {
    id 'java'
    id 'application'
}

repositories {
    mavenCentral()
}

dependencies {
    // JUnit 5 (Jupiter)
    testImplementation 'org.junit.jupiter:junit-jupiter:5.11.0'
    
    // IDEサポート用のJUnit Platform
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    
    // JUnit 5 Gradleサポート
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.11.0'
    testRuntimeOnly 'org.junit.vintage:junit-vintage-engine:5.11.0'
}

test {
    useJUnitPlatform()  // JUnit 5を有効化
}

// 詳細なテスト出力を有効化
test {
    testLogging {
        events 'passed', 'skipped', 'failed'
        exceptionFormat 'full'
    }
}
```

### JUnit 4（レガシー - 非推奨）

移行できない既存プロジェクトのみに使用：

```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```

## IDEサポート

### IntelliJ IDEA

| バージョン | JUnit 5サポート |
|---------|----------------|
| 2023.x | フルサポート |
| 2022.x | フルサポート |
| 2021.x | フルサポート |
| 2020.x | フルサポート |
| 2019.2+ | フルサポート |

**設定：**
1. IntelliJ IDEAはJUnit 5のサポートが組み込まれています
2. 追加のプラグインは不要です
3. pom.xmlまたはbuild.gradleに依存関係を追加するだけです

**テストの実行：**
- テストクラスを右クリック → 実行
- 実行構成で更多のオプションを使用

### VS Code

**必要な拡張機能：**
1. Extension Pack for Java（Microsoft）
2. Language Support for Java by Red Hat

**インストール：**
```bash
code --install-extension vscjava.vscode-java-pack
```

**設定：**
```json
{
    "java.test.config": {
        "name": "JUnit 5",
        "workingDirectory": "${workspaceFolder}",
        "args": ["-m", "org.junit.platform.console", "--include-classname=.*"]
    }
}
```

### Eclipse

**インストール：**
1. Eclipse IDE for Enterprise Java Developersrecommended（推奨）
2. またはEclipse Marketplaceからインストール：
   - ヘルプ → Eclipse Marketplace
   - 「JUnit」を検索
   - 「JUnit」をインストール

**テストの実行：**
- テストクラスを右クリック → 実行 → JUnitテスト
- 実行構成で更多のオプションを使用

### NetBeans

**インストール：**
1. NetBeans 12+はJUnit 5のサポートが組み込まれています
2. またはツール → プラグイン → 使用可能なプラグインを使用

### 古いIDEでのJUnit 5

JUnit 5をネイティブサポートしていない古いIDEバージョンを使用する場合：

```xml
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-console-standalone</artifactId>
    <version>1.11.0</version>
</dependency>
```

コマンドラインから実行：
```bash
java -jar junit-platform-console-standalone-1.11.0.jar -c MyTestClass
```

## Spring Boot統合

### Spring Boot 2.2+（デフォルトJUnit 5）

Spring Boot 2.2+はデフォルトでJUnit 5を使用します：

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.3.0</version>
</parent>

<dependencies>
    <!-- JUnit 5 + Mockito + AssertJを含む -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

このスターターには以下が含まれます：
- **JUnit Jupiter** - JUnit 5フレームワーク
- **Mockito** - モックフレームワーク
- **AssertJ** - 流暢なアサーション
- **Spring Test** - Springテストサポート

### Spring Boot 2.1以前（JUnit 4）

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
    <exclusions>
        <exclusion>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- JUnit 5を追加 -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <scope>test</scope>
</dependency>
```

### JUnit 5のSpring拡張

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-test</artifactId>
    <scope>test</scope>
    <exclusions>
        <exclusion>
            <groupId>org.junit.vintage</groupId>
            <artifactId>junit-vintage-engine</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

## スタンドアロン使用

### コンソールランチャー

ビルドツールなしでテストを実行：

```bash
# スタンドアロンJARをダウンロード
wget https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.11.0/junit-platform-console-standalone-1.11.0.jar

# テストを実行
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest
```

### JUnit 5コンソールオプション

```bash
# 特定のテストクラスを実行
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest

# カスタムclasspathで実行
java -jar junit-platform-console-standalone-1.11.0.jar -cp myclasses -c com.example.MyTest

# 詳細出力で実行
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest --details=verbose

# 特定のテストメソッドを実行
java -jar junit-platform-console-standalone-1.11.0.jar -c com.example.MyTest#myTestMethod

# パッケージ内のテストを実行
java -jar junit-platform-console-standalone-1.11.0.jar --scan-classpath -p com.example.tests
```

## バージョン互換性マトリックス

### JUnit 5バージョン互換性

| JUnit 5 | Platform | Vintage | Spring Boot |
|----------|----------|---------|-------------|
| 5.11.x | 1.11.x | 5.11.x | 3.3.x |
| 5.10.x | 1.10.x | 5.10.x | 3.2.x |
| 5.9.x | 1.9.x | 5.9.x | 3.1.x |
| 5.8.x | 1.8.x | 5.8.x | 2.7.x |

### Java互換性

| JUnit 5バージョン | 最小Javaバージョン |
|-----------------|-------------|
| 5.11.x | Java 8 |
| 5.10.x | Java 8 |
| 5.9.x | Java 8 |
| 5.8.x | Java 8 |
| 5.7.x | Java 8 |
| 5.6.x | Java 8 |
| 5.5.x | Java 8 |
| 5.4.x | Java 8 |
| 5.3.x | Java 8 |
| 5.2.x | Java 8 |
| 5.1.x | Java 8 |
| 5.0.x | Java 8 |

## JUnit 4からJUnit 5への移行

### アノテーションの変更

| JUnit 4 | JUnit 5 |
|----------|-----------|
| @Test（org.junit.Testから）| @Test（org.junit.jupiter.api.Testから）|
| @Before | @BeforeEach |
| @After | @AfterEach |
| @BeforeClass | @BeforeAll |
| @AfterClass | @AfterAll |
| @Ignore | @Disabled |
| @RunWith | @ExtendWith |
| @Category | @Tag |

### インポートの変更

```java
// JUnit 4
import org.junit.Test;
import org.junit.Before;
import org.junit.After;
import org.junit.BeforeClass;
import org.junit.AfterClass;
import org.junit.Ignore;
import org.junit.runner.RunWith;

// JUnit 5
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.extension.ExtendWith;
```

### アサーションの変更

```java
// JUnit 4
import static org.junit.Assert.*;

@Test
public void testExample() {
    assertEquals("expected", "actual");
    assertTrue(condition);
    assertFalse(condition);
    assertNull(object);
    assertNotNull(object);
    assertSame(obj1, obj2);
    assertArrayEquals(arr1, arr2);
}

// JUnit 5
import static org.junit.jupiter.api.Assertions.*;

@Test
void testExample() {
    assertEquals("expected", "actual", "オプションメッセージ");
    assertTrue(condition, () -> "レイジーメッセージ");
    assertFalse(condition);
    assertNull(object);
    assertNotNull(object);
    assertSame(obj1, obj2);
    assertArrayEquals(arr1, arr2);
    
    // JUnit 5の新機能
    assertAll(() -> assertEquals("a", "a"),
              () -> assertTrue(true));
}
```

### 移行ツール

段階的な移行にはJUnit Vintageを使用：

```xml
<dependency>
    <groupId>org.junit.vintage</groupId>
    <artifactId>junit-vintage-engine</artifactId>
    <scope>test</scope>
</dependency>
```

これにより、JUnit 5プラットフォームでJUnit 4テストを実行できます。

## トラブルシューティング

### テストが実行されない

**問題：** IDEでテストが実行されない

**解決策：**
1. JUnit 5の依存関係が正しいことを確認
2. Maven/Gradleが依存関係を解決できるか確認
3. IDEがJUnit 5をサポートしているか検証
4. IDEキャッシュをクリアして再ビルド

### テストが見つからない

**問題：** 「No tests found」メッセージ

**解決策：**
1. テストメソッドに@Testアノテーションを追加
2. テストクラスが「Test」で終わることを確認
3. パッケージ構造を確認
4. テストがsrc/test/javaにあるか検証

### 依存関係の競合

**問題：** 他のライブラリとのバージョン競合

**解決策：**
1. MavenでdependencyManagementを使用
2. 推移的依存関係を確認
3. 競合する依存関係を除外

### パフォーマンスの問題

**問題：** テストの実行が遅い

**解決策：**
1. 関連するテストには@TestInstance(Lifecycle.PER_CLASS)を使用
2. 遅いテストには@Disabledを使用
3. テストの並列化を検討

## ベストプラクティス

1. **JUnit 5を使用** - 常にJUnit 4よりJUnit 5を優先
2. **意味のあるテスト名** - シナリオを説明するようにテストに名前を付ける
3. **テストごとに1つのアサーション** - 複数のアサーションにはassertAllを使用
4. **実装ではなく動作をテスト** - 「どのように」ではなく「何を」に焦点を当てる
5. **@BeforeEachを賢く使用** - セットアップを最小限に保つ
6. **テストインターフェースを活用** - デフォルトメソッドで共有セットアップを実現

## 関連リンク

- [JUnit公式ウェブサイト](https://junit.org)
- [JUnit 5ドキュメント](https://junit.org/junit5/)
- [JUnit 5 GitHub](https://github.com/junit-team/junit5)
- [JUnit 5ユーザーガイド](https://junit.org/junit5/docs/current/user-guide/)
- [Maven Surefireプラグイン](https://maven.apache.org/surefire/maven-surefire-plugin/)
- [Gradleテスト](https://docs.gradle.org/current/userguide/java_testing.html)
