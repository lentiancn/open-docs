# frp 使用指南

本指南介紹如何使用 frp 進行內網穿透和連接埠映射。

## 快速開始

### 服務端啟動

```bash
# 啟動 frps
./frps -c frps.ini
```

### 用戶端啟動

```bash
# 啟動 frpc
./frpc -c frpc.ini
```

## 配置詳解

### 服務端配置

#### 基本設定

```ini
[common]
bind_port = 7000           # frp 服務連接埠
dashboard_port = 7500      # 控制面板連接埠
token = password           # 認證令牌
```

#### 連接埠映射

```ini
[common]
vhost_http_port = 80       # HTTP 虛擬主機連接埠
vhost_https_port = 443    # HTTPS 虛擬主機連接埠
```

#### 負載均衡

```ini
[common]
max_pool_count = 10        # 連線池大小
max_ports_per_client = 0   # 每用戶端連接埠數限制
```

### 用戶端配置

#### TCP 映射

```ini
# 映射本地 SSH
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

#### HTTP 映射

```ini
# 映射 Web 服務
[web]
type = http
local_port = 8080
custom_domains = example.com
```

#### HTTPS 映射

```ini
[web_https]
type = https
local_port = 8443
custom_domains = example.com
```

## 進階功能

### 負載均衡

```ini[test_http]
type = http
local_port = 8080
custom_domains = web.example.com
group = web_group
group_key = 123
```

### 外掛

#### HTTP 代理

```ini
[http_proxy]
type = tcp
plugin = http_proxy
plugin_http_user = user
plugin_http_password = password
local_port = 8080
remote_port = 8000
```

#### 靜態檔案

```ini
[static_file]
type = tcp
plugin = static_file
plugin_local_path = /var/www
pluginstrip_prefix = static
remote_port = 8000
```

## 安全配置

### 加密

```ini
[common]
use_encryption = true
```

### 壓縮

```ini
[common]
use_compression = true
```

### 身份驗證

```ini
[common]
authentication_method = token
token = your_secure_token
```

## 監控

### Dashboard

```ini
[common]
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
```

存取 http://your_server:7500 查看狀態。

### 連接埠統計

```ini
[common]
plugin = ports_stats
```

## 效能優化

### 連線池

```ini
[common]
max_pool_count = 50
max_conn_per_proxy = 10
```

### 心跳

```ini
[common]
heartbeat_interval = 30
heartbeat_timeout = 90
```

### 日誌級別

```ini
[common]
log_level = warn
log_max_days = 3
```

## 使用場景

### 1. 遠端存取內網 SSH

```ini
[ssh]
type = tcp
local_ip = 192.168.1.100
local_port = 22
remote_port = 6000
```

### 2. 暴露內網 Web 服務

```ini
[web]
type = http
local_port = 8080
custom_domains = yourdomain.com
```

### 3. 存取內網資料庫

```ini
[mysql]
type = tcp
local_ip = 192.168.1.100
local_port = 3306
remote_port = 13306
```

### 4. 微信/支付回調

```ini
[wechat]
type = http
local_port = 8080
custom_domains = callback.yourdomain.com
```

## 故障排除

### 連線問題

1. 檢查服務端日誌
2. 驗證連接埠是否開放
3. 檢查防火牆

### 效能問題

1. 調整連線池大小
2. 啟用壓縮
3. 檢查網路頻寬

## 相關資源

- [frp 官方文件](https://gofrp.org/docs/)
- [GitHub](https://github.com/fatedier/frp)
