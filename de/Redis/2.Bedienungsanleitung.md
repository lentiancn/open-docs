# Redis Bedienungsanleitung

Umfassende Anleitung zur effektiven Nutzung von Redis.

---

## Inhaltsverzeichnis

- [Grundkonzepte](#grundkonzepte)
- [Datentypen](#datentypen)
- [String-Operationen](#string-operationen)
- [Listen-Operationen](#listen-operationen)
- [Hash-Operationen](#hash-operationen)
- [Set-Operationen](#set-operationen)
- [Sorted Set-Operationen](#sorted-set-operationen)
- [Keys und Ablaufzeit](#keys-und-ablaufzeit)
- [Pub/Sub](#pubsub)
- [Transaktionen](#transaktionen)
- [Pipeline](#pipeline)
- [Lua-Skripte](#lua-skripte)
- [Persistenz](#persistenz)
- [Replikation](#replikation)
- [Cluster](#cluster)
- [Sicherheit](#sicherheit)
- [Leistungsoptimierung](#leistungsoptimierung)
- [Häufige Rezepte](#häufige-rezepte)

---

## Grundkonzepte

### Was ist Redis?

Redis ist ein Open-Source-In-Memory-Datenspeicher, der als Datenbank, Cache und Message-Broker verwendet wird. Es unterstützt verschiedene Datenstrukturen und bietet hohe Leistung.

### Hauptmerkmale

- In-Memory-Speicherung
- Datenpersistenz
- Replikation
- Clusterbildung
- Pub/Sub-Messaging
- Lua-Scripting

### Wichtige Begriffe

| Begriff | Beschreibung |
|---------|-------------|
| Key | Eindeutiger Bezeichner für einen Wert |
| Value | In Redis gespeicherte Daten |
| TTL | Time To Live (Ablaufzeit) |
| Pipeline | Mehrere Befehle stapeln |
| Master | Primäre Redis-Instanz |
| Slave | Replik des Masters |

---

## Datentypen

Redis unterstützt verschiedene Datentypen:

| Typ | Beschreibung |
|------|-------------|
| String | Text oder Binärdaten |
| List | Geordnete Liste von Strings |
| Hash | Sammlung von Feld-Wert-Paaren |
| Set | Ungeordnete Sammlung eindeutiger Strings |
| Sorted Set | Set mit Scores zur Sortierung |
| HyperLogLog | Probabilistische Datenstruktur |
| Bitmap | String mit Bit-Operationen |
| Stream | Log-strukturierter Message-Broker |

---

## String-Operationen

### Grundbefehle

```bash
# Wert setzen
SET key "value"

# Wert abrufen
GET key

# Mehrere Keys setzen
MSET key1 "value1" key2 "value2"

# Mehrere Keys abrufen
MGET key1 key2

# String anhängen
APPEND key " appended"

# String-Länge abrufen
STRLEN key
```

### Numerische Operationen

```bash
# Inkrementieren
INCR counter
INCRBY counter 10

# Dekrementieren
DECR counter
DECRBY counter 5

# Fließkomma-Inkrement
INCRBYFLOAT price 0.5
```

---

## Listen-Operationen

### Grundbefehle

```bash
# Links einfügen
LPUSH mylist "first"

# Rechts einfügen
RPUSH mylist "last"

# Links ausgeben
LPOP mylist

# Rechts ausgeben
RPOP mylist

# Bereich abrufen
LRANGE mylist 0 -1

# Listenlänge abrufen
LLEN mylist
```

---

## Hash-Operationen

### Grundbefehle

```bash
# Hash-Feld setzen
HSET user:1 name "John"

# Mehrere Hash-Felder setzen
HMSET user:1 name "John" email "john@example.com"

# Hash-Feld abrufen
HGET user:1 name

# Alle Felder und Werte abrufen
HGETALL user:1

# Mehrere Felder abrufen
HMGET user:1 name email

# Feld löschen
HDEL user:1 email
```

---

## Set-Operationen

### Grundbefehle

```bash
# Zu Set hinzufügen
SADD myset "member1"

# Aus Set entfernen
SREM myset "member1"

# Alle Mitglieder abrufen
SMEMBERS myset

# Mitgliedschaft prüfen
SISMEMBER myset "member1"

# Set-Größe abrufen
SCARD myset
```

### Set-Operationen

```bash
# Vereinigung
SUNION set1 set2

# Schnittmenge
SINTER set1 set2

# Differenz
SDIFF set1 set2
```

---

## Sorted Set-Operationen

### Grundbefehle

```bash
# Zu Sorted Set hinzufügen
ZADD leaderboard 100 "player1"

# Bereich abrufen (aufsteigend)
ZRANGE leaderboard 0 -1 WITHSCORES

# Bereich abrufen (absteigend)
ZREVRANGE leaderboard 0 -1 WITHSCORES

# Rang abrufen
ZRANK leaderboard "player1"

# Score erhöhen
ZINCRBY leaderboard 50 "player1"
```

---

## Keys und Ablaufzeit

### Key-Verwaltung

```bash
# Key löschen
DEL key

# Prüfen ob Key existiert
EXISTS key

# Key-Typ abrufen
TYPE key

# Key umbenennen
RENAME key newkey

# Alle Keys abrufen
KEYS pattern

# Keys scannen
SCAN 0 MATCH pattern
```

### Ablaufzeit

```bash
# Ablaufzeit setzen (Sekunden)
EXPIRE key 60

# Ablaufzeit setzen (Millisekunden)
PEXPIRE key 60000

# Key mit Ablaufzeit setzen
SETEX key 60 "value"

# Ablaufzeit entfernen
PERSIST key

# Restzeit abrufen (Sekunden)
TTL key

# Restzeit abrufen (Millisekunden)
PTTL key
```

---

## Pub/Sub

### Veröffentlichen

```bash
# Kanal abonnieren
SUBSCRIBE mychannel

# Nachricht veröffentlichen
PUBLISH mychannel "Hello"

# Muster abonnieren
PSUBSCRIBE news.*
```

### Befehle

```bash
# Abonnieren
SUBSCRIBE channel1 channel2

# Veröffentlichen
PUBLISH channel1 "message"

# Abonnement beenden
UNSUBSCRIBE channel1
```

---

## Transaktionen

### Grundbefehle

```bash
# Transaktion starten
MULTI

# Befehle einreihen
SET key1 "value1"
SET key2 "value2"

# Transaktion ausführen
EXEC

# Transaktion verwerfen
DISCARD
```

### Watch

```bash
WATCH key
# ... einige Operationen ...
MULTI
SET key newvalue
EXEC  # Schlägt fehl wenn Key geändert wurde
```

---

## Pipeline

### Pipeline verwenden

```bash
# Mehrere Befehle pipelinen
redis-cli PING
redis-cli SET key1 "value1"
redis-cli GET key1

# Im Code (Python-Beispiel)
pipe = r.pipeline()
pipe.set('key1', 'value1')
pipe.get('key1')
pipe.execute()
```

---

## Lua-Skripte

### Grundskript

```bash
# Lua-Skript ausführen
EVAL "return redis.call('get', 'key')" 0

# Key mit Lua setzen
EVAL "redis.call('set', KEYS[1], ARGV[1])" 1 mykey myvalue
```

### Skript-Beispiel

```lua
-- Zähler erhöhen
local current = redis.call('get', KEYS[1])
if current then
    current = tonumber(current) + 1
else
    current = 1
end
redis.call('set', KEYS[1], current)
return current
```

---

## Persistenz

### RDB (Redis Database)

```bash
# Manuell speichern
BGSAVE

# Letzte Speicherzeit abrufen
LASTSAVE
```

### AOF (Append Only File)

```bash
# In Config aktivieren
appendonly yes

# AOF umschreiben
BGREWRITEAOF
```

### Konfiguration

```bash
# Speicherhäufigkeit
save 900 1
save 300 10
save 60 10000
```

---

## Replikation

### Slave einrichten

```bash
# In redis.conf
replicaof masterip masterport

# Oder per Befehl
REPLICAOF masterip masterport
```

### Befehle

```bash
# Replikationsstatus prüfen
INFO replication

# Master werden
REPLICAOF NO ONE
```

---

## Cluster

### Cluster erstellen

```bash
# Cluster erstellen
redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 --cluster-replicas 1

# Cluster-Knoten anzeigen
redis-cli -c cluster nodes
```

---

## Sicherheit

### Passwort-Authentifizierung

```bash
# Passwort in Config setzen
requirepass yourpassword

# Über CLI authentifizieren
AUTH yourpassword
```

### ACL (Redis 6+)

```bash
# Benutzer erstellen
ACL SETUSER alice on >password ~cached:* +get +set

# Benutzer auflisten
ACL LIST
```

---

## Leistungsoptimierung

### Speicheroptimierung

```bash
# Max. Speicher setzen
maxmemory 2gb

# Eviction-Policy
maxmemory-policy allkeys-lru
```

### Verbindungsoptimierung

```bash
# Connection Pooling verwenden
# Im Code
redis_pool = redis.ConnectionPool(host='localhost', port=6379, max_connections=50)
```

---

## Häufige Rezepte

### Caching

```bash
# Cache mit Ablaufzeit
SET user:1:profile "data" EX 3600

# Cache prüfen
GET user:1:profile
```

### Rate Limiting

```bash
# Einfaches Rate Limit
INCR rate_limit:ip:192.168.1.1
EXPIRE rate_limit:ip:192.168.1.1 60
```

### Verteilte Sperre

```bash
# Sperre acquire
SET lock:myresource unique_value NX EX 10

# Sperre freigeben
EVAL "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end" 1 lock:myresource unique_value
```

### Sitzungsspeicher

```bash
# Sitzung speichern
HSET session:abc123 user_id 12345
EXPIRE session:abc123 1800
```

---

## Nächste Schritte

- [Redis Stack](https://redis.io/docs/stack/) erkunden
- Mehr über [Redis Enterprise](https://redis.com/redis-enterprise/) lernen
- [Leistungsoptimierungsanleitung](https://redis.io/docs/management/optimization/) lesen
