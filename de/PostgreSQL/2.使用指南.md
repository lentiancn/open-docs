# PostgreSQL Benutzerhandbuch

Dieses Handbuch beschreibt, wie Sie das PostgreSQL-Datenbankverwaltungssystem verwenden.

## Schnellstart

### Mit Datenbank verbinden

```bash
# psql verwenden
psql -U postgres -h localhost

# Datenbank erstellen
CREATE DATABASE myapp;

# Mit Datenbank verbinden
\c myapp

# Beenden
\q
```

### Tabelle erstellen

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Daten einfügen

```sql
INSERT INTO users (username, email, password)
VALUES ('john', 'john@example.com', 'hashed_password');

-- Masseneinfügung
INSERT INTO users (username, email, password)
VALUES 
    ('alice', 'alice@example.com', 'hash1'),
    ('bob', 'bob@example.com', 'hash2');
```

### Daten abfragen

```sql
-- Alle abfragen
SELECT * FROM users;

-- Bedingte Abfrage
SELECT * FROM users WHERE id = 1;

-- Paginierung
SELECT * FROM users LIMIT 10 OFFSET 0;

-- Sortierung
SELECT * FROM users ORDER BY created_at DESC;
```

### Daten aktualisieren

```sql
UPDATE users 
SET email = 'newemail@example.com' 
WHERE id = 1;
```

### Daten löschen

```sql
DELETE FROM users WHERE id = 1;
```

## Häufig verwendete Datentypen

### Numerische Typen

| Typ | Beschreibung |
|-----|--------------|
| SMALLINT | 2-Byte-Integer (-32768 bis 32767) |
| INTEGER | 4-Byte-Integer |
| BIGINT | 8-Byte-Integer |
| DECIMAL | Genauer Wert |
| REAL | 4-Byte-Gleitkomma |
| DOUBLE PRECISION | 8-Byte-Gleitkomma |

### Stringtypen

| Typ | Beschreibung |
|-----|--------------|
| CHAR(n) | Feste Länge |
| VARCHAR(n) | Variable Länge |
| TEXT | Variable Länge (unbegrenzt) |

### Datums- und Zeittypen

| Typ | Beschreibung |
|-----|--------------|
| DATE | Datum |
| TIME | Zeit |
| TIMESTAMP | Datum und Zeit |
| TIMESTAMPTZ | Datum und Zeit mit Zeitzone |

### JSON-Typen

```sql
-- JSON-Typ
CREATE TABLE events (
    id SERIAL PRIMARY KEY,
    data JSON
);

INSERT INTO events (data) VALUES 
    ('{"name": "John", "age": 30}');

-- JSON-Daten abfragen
SELECT data->>'name' FROM events;
```

## Einschränkungen

### Primärschlüssel

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);
```

### Fremdschlüssel

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    total DECIMAL(10,2)
);
```

### Unique-Einschränkung

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE
);
```

### NOT NULL-Einschränkung

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);
```

### CHECK-Einschränkung

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10,2) CHECK (price > 0)
);
```

## Indizes

### Indizes erstellen

```sql
-- Einzelne Spalte
CREATE INDEX idx_users_email ON users(email);

-- Mehrere Spalten
CREATE INDEX idx_orders_user_id_total ON orders(user_id, total);

-- Eindeutiger Index
CREATE UNIQUE INDEX idx_users_username ON users(username);
```

### Indizes löschen

```sql
DROP INDEX idx_users_email;
```

## Ansichten

### Ansicht erstellen

```sql
CREATE VIEW active_users AS
SELECT * FROM users 
WHERE created_at > '2024-01-01';
```

### Ansicht verwenden

```sql
SELECT * FROM active_users;
```

## Gespeicherte Prozeduren und Funktionen

### Funktion erstellen

```sql
CREATE OR REPLACE FUNCTION get_user_count()
RETURNS INTEGER AS $$
DECLARE
    count INTEGER;
BEGIN
    SELECT COUNT(*) INTO count FROM users;
    RETURN count;
END;
$$ LANGUAGE plpgsql;
```

### Funktion aufrufen

```sql
SELECT get_user_count();
```

## Transaktionen

```sql
BEGIN;

INSERT INTO users (username, email) VALUES ('user1', 'user1@example.com');
INSERT INTO users (username, email) VALUES ('user2', 'user2@example.com');

COMMIT;  -- oder ROLLBACK;
```

## Sicherung und Wiederherstellung

### Sichern

```bash
# Einzelne Datenbank sichern
pg_dump -U postgres mydb > backup.sql

# Alle Datenbanken sichern
pg_dumpall -U postgres > all_backup.sql

# Komprimierte Sicherung
pg_dump -U postgres mydb | gzip > backup.sql.gz
```

### Wiederherstellen

```bash
# Datenbank wiederherstellen
psql -U postgres mydb < backup.sql

# Alle Datenbanken wiederherstellen
psql -U postgres -f all_backup.sql

# Komprimiert wiederherstellen
gunzip -c backup.sql.gz | psql -U postgres mydb
```

## Benutzerverwaltung

### Benutzer erstellen

```sql
CREATE USER myuser WITH PASSWORD 'mypassword';
```

### Berechtigungen erteilen

```sql
-- Datenbankberechtigungen erteilen
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;

-- Tabellenberechtigungen erteilen
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO myuser;

-- Sequenzberechtigungen erteilen
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO myuser;
```

### Benutzer löschen

```sql
DROP USER myuser;
```

## Leistungsoptimierung

### Analyse mit EXPLAIN

```sql
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';
```

### Statistiken mit ANALYZE aktualisieren

```sql
ANALYZE users;
```

### Bereinigung mit VACUUM

```sql
-- Tote Tupel bereinigen
VACUUM users;

-- Tabelle neu erstellen
VACUUM FULL users;
```

## Verwandte Ressourcen

- [PostgreSQL Offizielle Dokumentation](https://www.postgresql.org/docs/)
- [PostgreSQL Dokumentation](https://www.postgresql.org/docs/)
- [pgAdmin Werkzeug](https://www.pgadmin.org/)
