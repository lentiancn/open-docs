# GitLab Usage Guide

Comprehensive guide for using GitLab effectively.

---

## Table of Contents

- [Getting Started](#getting-started)
- [Projects](#projects)
- [Version Control](#version-control)
- [Branching Strategy](#branching-strategy)
- [Merge Requests](#merge-requests)
- [CI/CD Pipelines](#cicd-pipelines)
- [Groups](#groups)
- [Users and Permissions](#users-and-permissions)
- [Integrations](#integrations)
- [Best Practices](#best-practices)

---

## Getting Started

### Initial Setup

1. **Create Account**
   - First user becomes admin
   - Set strong password

2. **Create First Project**
   - Click "New Project"
   - Choose template or blank project
   - Add description and settings

3. **Clone Repository**

```bash
# Clone via HTTPS
git clone https://gitlab.example.com/username/project.git

# Clone via SSH
git clone git@gitlab.example.com:username/project.git
```

---

## Projects

### Create Project

```bash
# Using GitLab CLI (glab)
glab project create --name my-project --description "My project" --visibility private
```

Or via Web UI:
1. Click "+" button
2. Select "New project"
3. Fill in details

### Project Settings

| Setting | Description |
|---------|-------------|
| Visibility | Public, Internal, Private |
| Default Branch | Main branch name |
| Auto-devops | Enable CI/CD pipeline |
| Merge Requests | Enable/disable |

### Project Topics

Add topics to organize projects:
- Tags for categorization
- Searchable metadata

---

## Version Control

### Basic Git Commands

```bash
# Configure Git
git config --global user.name "Your Name"
git config --global user.email "your@email.com"

# Initialize repository
git init

# Add remote
git remote add origin git@gitlab.example.com:group/project.git

# Create branch
git checkout -b feature/my-feature

# Commit changes
git add .
git commit -m "Add new feature"

# Push to remote
git push origin feature/my-feature

# Pull changes
git pull origin main
```

### Tags and Releases

```bash
# Create tag
git tag -a v1.0.0 -m "Release v1.0.0"

# Push tag
git push origin v1.0.0

# Create release via UI
# Releases > New release > Add tag and details
```

---

## Branching Strategy

### GitLab Flow

```
main (production)
  └─ pre-production
       └─ feature branches
```

### Example Workflow

```bash
# Start new feature
git checkout -b feature/login

# Work on feature
git add .
git commit -m "Add login form"

# Push feature
git push -u origin feature/login

# Create Merge Request via UI
# Or using glab
glab mr create --title "Add login" --description "Implements login feature"
```

---

## Merge Requests

### Create Merge Request

1. Push your branch
2. Click "Create merge request"
3. Fill in title and description
4. Add reviewers
5. Set labels and milestones

### Merge Request Options

| Option | Description |
|--------|-------------|
| Source branch | Branch to merge from |
| Target branch | Branch to merge into |
| Title | Descriptive title |
| Description | Details and context |
| Reviewers | People to review |
| Labels | Categorization |
| Milestone | Project milestone |

### Code Review

```markdown
# In MR description, use:
- ## TODO
- ## Changes
- ## Testing
- !1 to reference other MRs
- #1 to reference issues
```

### Approvals

- Configure approval rules in project settings
- Require N approvals before merge
- Prevent self-approval

---

## CI/CD Pipelines

### Basic .gitlab-ci.yml

```yaml
stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist/
    expire_in: 1 week

test:
  stage: test
  script:
    - npm test
  coverage: '/Coverage: \d+\.\d+%/'

deploy:
  stage: deploy
  script:
    - npm run deploy
  only:
    - main
```

### CI/CD Variables

1. **Project Settings > CI/CD > Variables**
2. Add key-value pairs
3. Mark as "Masked" for secrets

### Pipeline Examples

```yaml
# Docker build
build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA

# Multi-stage deploy
deploy:staging:
  stage: deploy
  script:
    - echo "Deploying to staging"
  environment:
    name: staging
    url: https://staging.example.com

deploy:production:
  stage: deploy
  script:
    - echo "Deploying to production"
  environment:
    name: production
    url: https://example.com
  when: manual
```

### Pipeline Artifacts

```yaml
artifacts:
  paths:
    - build/
  reports:
    junit: test-results.xml
    coverage: coverage/lcov.info
```

---

## Groups

### Create Group

1. Click "+" > "New group"
2. Choose group type:
   - **Group**: For projects
   - **Subgroup**: Nested groups
   - **Organization**: Large team organization

### Group Settings

| Setting | Description |
|---------|-------------|
| Visibility | Group visibility level |
| Members | Users and roles |
| CI/CD variables | Shared variables |
| Webhooks | Group-level webhooks |

### Shared Projects

```bash
# Add project to group
glab project create --group mygroup --name project

# Or via UI
# Settings > General > Permissions > Share with group
```

---

## Users and Permissions

### Permission Levels

| Role | Description |
|------|-------------|
| Guest | View projects |
| Reporter | Clone and pull |
| Developer | Push branches, create MRs |
| Maintainer | Manage branches, settings |
| Owner | Full access |

### Manage Users

```bash
# Add member to project
glab api projects/:id/members \
  --method POST \
  --form user_id=123 \
  --form access_level=30

# Access levels:
# 10 = Guest
# 20 = Reporter
# 30 = Developer
# 40 = Maintainer
# 50 = Owner
```

### LDAP Integration

Configure in Admin Area > Authentication > LDAP

---

## Integrations

### Common Integrations

| Integration | Purpose |
|-------------|---------|
| Jenkins | CI/CD |
| Slack | Notifications |
| Jira | Issue tracking |
| Kubernetes | Deployments |
| Prometheus | Monitoring |

### Webhooks

```bash
# Add webhook via API
glab api projects/:id/webhooks \
  --method POST \
  --form url="https://example.com/webhook" \
  --form "token=xxx"
```

### GitLab CI Integration

```yaml
# .gitlab-ci.yml
include:
  - template: Security/SAST.gitlab-ci.yml
  - template: Security/Dependency-Scanning.gitlab-ci.yml
```

---

## Best Practices

### Project Setup

1. **Use README.md**
   - Project description
   - Getting started guide
   - Contributing guidelines

2. **Add .gitignore**
   - Use language templates
   - Exclude build outputs

3. **Enable Protected Branches**
   - Protect `main` branch
   - Require reviews

### Code Review

1. **Keep PRs Small**
   - Under 400 lines
   - Single concern

2. **Write Good Descriptions**
   - What and why
   - How to test
   - Related issues

3. **Respond to Comments**
   - Address feedback
   - Explain decisions

### CI/CD

1. **Fast Pipelines**
   - Cache dependencies
   - Parallel jobs

2. **Meaningful Tests**
   - Unit tests
   - Integration tests

3. **Secure Pipelines**
   - Mask secrets
   - Use secure variables

---

## Troubleshooting

### Common Issues

```bash
# Runner not picking up jobs
# Check runner status and tags

# Pipeline failed
# Check job logs

# Permission denied
# Check deploy token and variables

# Merge blocked
# Check approval rules
```

### Check GitLab Status

```bash
# Check GitLab health
sudo gitlab-rake gitlab:env:info

# Check database
sudo gitlab-rake gitlab:db:diagnose

# Check files
sudo gitlab-rake gitlab:git:fsck
```

---

## Quick Reference

### GitLab URLs

```
https://gitlab.example.com              # Web UI
git@gitlab.example.com:group/project.git  # SSH
https://gitlab.example.com/api/v4        # API
```

### Common glab Commands

```bash
glab auth login           # Authenticate
glab project list        # List projects
glab mr list            # List MRs
glab issue list         # List issues
glab pipeline list      # List pipelines
glab release list       # List releases
```

---

## Next Steps

- Explore [GitLab CI/CD](https://docs.gitlab.com/ee/ci/)
- Learn [GitLab Admin](https://docs.gitlab.com/ee/administration/)
- Read [GitLab API](https://docs.gitlab.com/ee/api/)
