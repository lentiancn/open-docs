# Guide d'utilisation DragonTalker

DragonTalker utilise l'apprentissage profond pour générer des vidéos réalistes de tête parlante à partir d'une seule image et d'une entrée audio.

## Démarrage rapide

### Commande de base

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir ./results
```

### Avec amélioration

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir ./results \
  --preprocess full \
  --enhancer gfpgan
```

## Paramètres de commande

### Paramètres d'entrée

| Paramètre | Description | Par défaut |
|-----------|-------------|------------|
| `--source_image` | Chemin de l'image portrait d'entrée | Requis |
| `--driven_audio` | Fichier audio d'entrée (WAV/MP3) | Requis |
| `--result_dir` | Répertoire de sortie | ./results |

### Paramètres de traitement

| Paramètre | Description | Par défaut |
|-----------|-------------|------------|
| `--preprocess` | Prétraitement de l'image : crop, resize, full | full |
| `--size` | Taille de l'image : 256, 512 | 256 |
| `--pose_style` | Style de pose 0-45 | 0 |
| `--expression_scale` | Intensité d'expression 0.5-1.5 | 1.0 |

### Paramètres d'amélioration

| Paramètre | Description | Par défaut |
|-----------|-------------|------------|
| `--enhanceur` | Améliorateur de visage : gfpgan, RestoreFormer, CodeFormer | Aucun |

### Paramètres de performance

| Paramètre | Description | Par défaut |
|-----------|-------------|------------|
| `--batch_size` | Taille du lot | 1 |
| `--fps` | Images/seconde vidéo de sortie | 25 |

## Exemples d'utilisation

### Exemple 1 : Génération de base

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir results/basic
```

### Exemple 2 : Amélioration GFPGAN

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir results/enhanced \
  --enhancer gfpgan
```

### Exemple 3 : Pose personnalisée

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir results/pose5 \
  --pose_style 5
```

### Exemple 4 : Résolution supérieure

```bash
python inference.py \
  --source_image examples/source_image.jpg \
  --driven_audio examples/driven_audio.wav \
  --result_dir results/hd \
  --size 512 \
  --enhancer gfpgan
```

## API Python

### Utilisation de base

```python
from inference import DragonTalker

# Initialiser DragonTalker
dragon = DragonTalker()

# Générer une vidéo
video_path = dragon.generate(
    source_image="image.jpg",
    driven_audio="audio.wav",
    preprocess="full",
    enhancer="gfpgan"
)

print(f"Vidéo enregistrée : {video_path}")
```

### Utilisation avancée

```python
from inference import DragonTalker
import torch

# Initialiser avec des paramètres personnalisés
dragon = DragonTalker(
    checkpoint_path="checkpoints/DragonTalker.pth",
    config_path="config/DragonTalker.yaml",
    device="cuda" if torch.cuda.is_available() else "cpu"
)

# Générer une vidéo avec des options avancées
video_path = dragon.generate(
    source_image="image.jpg",
    driven_audio="audio.wav",
    preprocess="full",
    pose_style=10,
    expression_scale=1.2,
    enhancer="gfpgan",
    batch_size=1,
    output_video="output.mp4"
)
```

### Traitement par lots

```python
from inference import DragonTalker
import os

dragon = DragonTalker()

# Traiter plusieurs images (même audio)
audio_file = "audio.wav"
image_dir = "images/"

for image_file in os.listdir(image_dir):
    if image_file.endswith(('.jpg', '.png')):
        output_path = f"results/{image_file}"
        dragon.generate(
            source_image=os.path.join(image_dir, image_file),
            driven_audio=audio_file,
            preprocess="full"
        )
```

## Interface Web

### Lancer la démo Web

```bash
python app.py
```

Puis ouvrir http://localhost:8888 dans le navigateur

### Fonctionnalités de l'interface Web

1. **Téléversement d'image** - Glisser-déposer une image portrait
2. **Téléversement d'audio** - Sélectionner un fichier audio (WAV/MP3)
3. **Aperçu** - Prévisualiser l'image source et l'audio
4. **Ajustement des paramètres** - Ajuster pose, expression, améliorateur
5. **Générer** - Générer la vidéo en un clic
6. **Télécharger** - Enregistrer la vidéo générée

## Améliorateurs de visage

### Améliorateurs disponibles

| Améliorateur | Qualité | Vitesse | VRAM |
|--------------|---------|---------|------|
| Aucun | Basique | Rapide | Faible |
| gfpgan | Bonne | Moyen | Moyen |
| RestoreFormer | Très bonne | Lent | Élevé |
| CodeFormer | Très bonne | Lent | Élevé |

### Recommandations

- **Faible VRAM** : Sans améliorateur ou gfpgan
- **Équilibré** : gfpgan
- **Meilleure qualité** : RestoreFormer ou CodeFormer

## Modes de prétraitement

| Mode | Description | Cas d'utilisation |
|------|-------------|-------------------|
| crop | Rogner le visage au centre | Traitement rapide |
| resize | Redimensionner à la taille cible | Arrière-plan simple |
| full | Pipeline de traitement complet | Meilleure qualité |

## Exigences d'entrée

### Exigences pour l'image

- Format : JPG, PNG
- Résolution : 512x512 ou supérieur recommandé
- Visage : De face, sans occlusion
- Arrière-plan : Simple préférable

### Exigences pour l'audio

- Format : WAV, MP3
- Durée : 1-60 secondes
- Fréquence d'échantillonnage : 16000-48000 Hz
- Discours : Clair, bruit minimal

## Sortie

### Format vidéo

- Format : MP4
- Codec : H.264
- Résolution : 256x256 ou 512x512
- Images/seconde : 25
- Débit : 2-5 Mbps

### Répertoire de sortie

Les résultats sont enregistrés dans le répertoire de sortie spécifié :
```
results/
├── video.mp4          # Vidéo générée
└── (fichiers temporaires)
```

## Dépannage

### Vidéo trop sombre/Claire

**Cause :** Inadéquation de l'éclairage entre l'entraînement et l'entrée

**Solutions :**
- Ajuster le paramètre expression_scale (0.8-1.2)
- Utiliser une image source de meilleure qualité
- Essayer un améliorateur différent

### Lèvres désynchronisées

**Cause :** Problèmes de qualité ou d'alignement audio

**Solutions :**
- Utiliser un audio de haute qualité
- S'assurer que l'audio contient un discours clair
- Vérifier la synchronisation audio-vidéo

### Visage déformé

**Cause :** Qualité d'entrée faible ou inhabituelle

**Solutions :**
- Utiliser une image de résolution plus élevée (512)
- Essayer un mode de prétraitement différent
- Utiliser un améliorateur de visage
- S'assurer que le visage est clairement visible

### Traitement lent

**Solutions :**
- Utiliser `--preprocess crop`
- Définir `--size 256`
- Désactiver l'amélioreur
- Réduire la taille du lot

### Mémoire GPU insuffisante

**Solutions :**
- Réduire batch_size à 1
- Utiliser une taille d'image plus petite
- Fermer d'autres applications GPU

## Conseils de performance

### Traitement plus rapide

1. Utiliser `--preprocess crop`
2. Définir `--size 256`
3. Désactiver l'amélioreur

### Meilleure qualité

1. Utiliser `--size 512`
2. Activer `--enhancer gfpgan`
3. Utiliser `--preprocess full`

## Liens connexes

- [GitHub](https://github.com/your-repo/DragonTalker)
- [HuggingFace](https://huggingface.co/spaces)
- [Modèles](https://github.com/your-repo/DragonTalker/releases)
