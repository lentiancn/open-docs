# Docker ä½¿ç”¨æŒ‡å—

é«˜æ•ˆä½¿ç”¨ Docker çš„å®Œæ•´æŒ‡å—ã€?
---

## ç›®éŒ„

- [åŸºæœ¬æ¦‚å¿µ](#åŸºæœ¬æ¦‚å¿µ)
- [æ˜ åƒæª”æ“ä½œ](#æ˜ åƒæª”æ“ä½?
- [å®¹å™¨æ“ä½œ](#å®¹å™¨æ“ä½œ)
- [ç¶²è·¯ç®¡ç†](#ç¶²è·¯ç®¡ç†)
- [å„²å­˜ç®¡ç†](#å„²å­˜ç®¡ç†)
- [Docker Compose](#docker-compose)
- [Dockerfile æœ€ä½³å¯¦è¸](#dockerfile-æœ€ä½³å¯¦è¸?
- [å¸¸ç”¨ç¯„ä¾‹](#å¸¸ç”¨ç¯„ä¾‹)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## åŸºæœ¬æ¦‚å¿µ

### ä»€éº¼æ˜¯ Dockerï¼?
- **æ˜ åƒæª?*ï¼šç”¨æ–¼å»ºç«‹å®¹å™¨çš„å”¯è®€æ¨¡æ¿
- **å®¹å™¨**ï¼šæ˜ åƒæª”çš„åŸ·è¡Œå€‹é«”
- **å€‰åº«**ï¼šå„²å­˜æ˜ åƒæª”çš„åœ°æ–¹ï¼ˆDocker Hubã€GCR ç­‰ï¼‰

### é—œéµè¡“èª

| è¡“èª | èªªæ˜ |
|------|------|
| `image` | å”¯è®€æ¨¡æ¿ |
| `container` | æ˜ åƒæª”çš„åŸ·è¡Œå€‹é«” |
| `volume` | æŒä¹…åŒ–å„²å­?|
| `network` | å®¹å™¨é€šè¨Š |
| `dockerfile` | æ˜ åƒæª”æ§‹å»ºè…³æœ?|

---

## æ˜ åƒæª”æ“ä½?
### æ‹‰å–æ˜ åƒæª?
```bash
# æ‹‰å–æœ€æ–°æ˜ åƒæª”
docker pull nginx

# æ‹‰å–æŒ‡å®šæ¨™ç±¤
docker pull nginx:alpine
docker pull ubuntu:22.04
```

### åˆ—å‡ºæ˜ åƒæª?
```bash
# åˆ—å‡ºæ‰€æœ‰æ˜ åƒæª”
docker images

# åˆ—å‡ºæ˜ åƒæª?ID
docker images -q
```

### åˆªé™¤æ˜ åƒæª?
```bash
# åˆªé™¤å–®å€‹æ˜ åƒæª”
docker rmi nginx

# æ¸…ç†æœªä½¿ç”¨çš„æ˜ åƒæª?docker image prune
```

### æ§‹å»ºæ˜ åƒæª?
```bash
# å¾?Dockerfile æ§‹å»º
docker build -t myapp:1.0 .

# ä¸ä½¿ç”¨å¿«å–æ§‹å»?docker build --no-cache -t myapp:1.0 .
```

---

## å®¹å™¨æ“ä½œ

### åŸ·è¡Œå®¹å™¨

```bash
# èƒŒæ™¯åŸ·è¡Œ
docker run -d nginx

# é€£æ¥åŸ å°æ‡?docker run -d -p 8080:80 nginx

# æ›è¼‰å?docker run -d -v /my/data:/data nginx

# ç’°å¢ƒè®Šæ•¸
docker run -d -e APP_ENV=production nginx

# äº’å‹•å¼åŸ·è¡?docker run -it ubuntu bash

# åŸ·è¡Œå¾Œåˆªé™?docker run --rm ubuntu ls
```

### å¸¸ç”¨åŸ·è¡Œé¸é …

| é¸é … | èªªæ˜ |
|------|------|
| `-d` | èƒŒæ™¯åŸ·è¡Œ |
| `-p` | é€£æ¥åŸ å°æ‡‰ï¼ˆä¸»æ©Ÿ:å®¹å™¨ï¼?|
| `-v` | å·æ›è¼?|
| `-e` | ç’°å¢ƒè®Šæ•¸ |
| `--name` | å®¹å™¨åç¨± |
| `--network` | åŠ å…¥ç¶²è·¯ |
| `-it` | äº’å‹•å¼?TTY |
| `--rm` | é€€å‡ºæ™‚è‡ªå‹•åˆªé™¤ |

### ç®¡ç†å®¹å™¨

```bash
# åˆ—å‡ºåŸ·è¡Œä¸­çš„å®¹å™¨
docker ps

# åˆ—å‡ºæ‰€æœ‰å®¹å™?docker ps -a

# åœæ­¢å®¹å™¨
docker stop <å®¹å™¨ID>

# å•Ÿå‹•å®¹å™¨
docker start <å®¹å™¨ID>

# é‡å•Ÿå®¹å™¨
docker restart <å®¹å™¨ID>

# åˆªé™¤å®¹å™¨
docker rm <å®¹å™¨ID>

# å¼·åˆ¶åˆªé™¤åŸ·è¡Œä¸­çš„å®¹å™¨
docker rm -f <å®¹å™¨ID>

# æŸ¥çœ‹æ—¥èªŒ
docker logs <å®¹å™¨ID>

# å³æ™‚æŸ¥çœ‹æ—¥èªŒ
docker logs -f <å®¹å™¨ID>

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œå‘½ä»¤
docker exec -it <å®¹å™¨ID> bash
```

---

## ç¶²è·¯ç®¡ç†

### å»ºç«‹ç¶²è·¯

```bash
# å»ºç«‹æ©‹æ¥ç¶²è·¯
docker network create my-network
```

### é€£æ¥å®¹å™¨

```bash
# åœ¨ç¶²è·¯ä¸­åŸ·è¡Œå®¹å™¨
docker run -d --network my-network nginx

# é€£æ¥ç¾æœ‰å®¹å™¨åˆ°ç¶²è·?docker network connect my-network container_name
```

---

## å„²å­˜ç®¡ç†

### å?
```bash
# å»ºç«‹å?docker volume create my-volume

# åˆ—å‡ºå?docker volume ls

# åˆªé™¤æœªä½¿ç”¨çš„å?docker volume prune
```

### æ›è¼‰ä¸»æ©Ÿç›®éŒ„

```bash
# æ›è¼‰ä¸»æ©Ÿç›®éŒ„
docker run -v /host/path:/container/path nginx

# å”¯è®€æ›è¼‰
docker run -v /host/path:/container/path:ro nginx
```

---

## Docker Compose

### åŸºæœ¬ docker-compose.yml

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./html:/usr/share/nginx/html
    depends_on:
      - api

  api:
    build: ./api
    environment:
      - DATABASE_URL=postgres://db:5432/app

  db:
    image: postgres:15-alpine
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

### å¸¸ç”¨å‘½ä»¤

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹?docker compose up -d

# åœæ­¢æ‰€æœ‰æœå‹?docker compose down

# æŸ¥çœ‹æ—¥èªŒ
docker compose logs -f

# é‡æ–°æ§‹å»ºæœå‹™
docker compose up -d --build

# åœ¨æœå‹™ä¸­åŸ·è¡Œå‘½ä»¤
docker compose exec web bash
```

---

## Dockerfile æœ€ä½³å¯¦è¸?
### å¥½çš„ Dockerfile ç¯„ä¾‹

```dockerfile
# ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ¨™ç±¤
FROM node:20-alpine

# è¨­å®šå·¥ä½œç›®éŒ„
WORKDIR /app

# å…ˆè¤‡è£½åŒ…æ–‡ä»¶ï¼ˆåˆ©ç”¨å¿«å–ï¼‰
COPY package*.json ./

# å®‰è£ä¾è³´
RUN npm ci --only=production

# è¤‡è£½åŸå§‹ç¢?COPY . .

# æš´éœ²é€£æ¥åŸ?EXPOSE 3000

# å®šç¾©å•Ÿå‹•å‘½ä»¤
CMD ["node", "server.js"]
```

### é—œéµæœ€ä½³å¯¦è¸?
1. **ä½¿ç”¨ç‰¹å®šæ¨™ç±¤**ï¼šä¸è¦ä½¿ç”?`latest`
2. **ä½¿ç”¨ Alpine æ˜ åƒæª?*ï¼šé«”ç©å°ï¼Œæ¼æ´å°‘
3. **åˆç†æ’åºå±?*ï¼šå°‡ä¸å¸¸è®ŠåŒ–çš„æ”¾åœ¨å‰é?4. **ä½¿ç”¨ .dockerignore**ï¼šæ’é™¤ä¸å¿…è¦çš„æª”æ¡?5. **ä»¥é root ä½¿ç”¨è€…åŸ·è¡?*ï¼šæ–°å¢?`USER` æŒ‡ä»¤

---

## å¸¸ç”¨ç¯„ä¾‹

### åŸ·è¡Œ Nginx

```bash
docker run -d -p 80:80 -v $(pwd)/html:/usr/share/nginx/html nginx
```

### åŸ·è¡Œ MySQL

```bash
docker run -d \
  --name mysql \
  -e MYSQL_ROOT_PASSWORD=secret \
  -e MYSQL_DATABASE=app \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

### åŸ·è¡Œ PostgreSQL

```bash
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -e POSTGRES_DB=app \
  -v postgres-data:/var/lib/postgresql/data \
  -p 5432:5432 \
  postgres:15
```

### åŸ·è¡Œ Redis

```bash
docker run -d \
  --name redis \
  -v redis-data:/data \
  -p 6379:6379 \
  redis:alpine redis-server --appendonly yes
```

---

## æ•…éšœæ’é™¤

### å®¹å™¨ç„¡æ³•å•Ÿå‹•

```bash
# æª¢æŸ¥æ—¥èªŒ
docker logs <å®¹å™¨ID>

# æª¢æŸ¥å®¹å™¨ç‹€æ…?docker inspect <å®¹å™¨ID>
```

### ç£ç¢Ÿç©ºé–“ä¸è¶³

```bash
# é¡¯ç¤ºç£ç¢Ÿä½¿ç”¨æƒ…æ³
docker system df

# æ¸…ç†
docker system prune -a
```

### æ¬Šé™å•é¡Œ

```bash
# ä¿®å¾©æ‰€æœ‰æ¬Š
sudo chown -R $(id -u):$(id -g) ./data

# æˆ–æŒ‡å®šä½¿ç”¨è€…åŸ·è¡?docker run -u $(id -u):$(id -g) -v $(pwd):/app app
```

---

## ä¸‹ä¸€æ­?
- æ¢ç´¢ [Docker Hub](https://hub.docker.com/) ç²å–æ˜ åƒæª?- å­¸ç¿’ [Kubernetes](https://kubernetes.io/) é€²è¡Œç·¨æ’
- é–±è®€ [Docker å®‰å…¨](https://docs.docker.com/engine/security/) æœ€ä½³å¯¦è¸?
