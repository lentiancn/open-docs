# Jenkins 사용 가이드

이 가이드에서는 Jenkins를 사용하여 지속적인 통합과 지속적인 배포를 구현하는 방법을 설명합니다.

## 빠른 시작

### 첫 번째 작업 생성

1. "새 항목" 클릭
2. 작업 이름 입력
3. "자유 스타일 프로젝트" 선택
4. 소스 코드 관리(Git) 설정
5. 빌드 트리거 설정
6. 빌드 단계 설정
7. 저장 및 빌드

## 작업 유형

### 자유 스타일 프로젝트

```groovy
// 빌드 단계 예시
pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/example/repo.git'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install'
                sh 'npm test'
            }
        }
        stage('Deploy') {
            steps {
                sh 'npm run deploy'
            }
        }
    }
}
```

### 파이프라인 프로젝트

```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        APP_NAME = 'my-app'
    }
    
    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                sh 'npm install'
            }
        }
        
        stage('Test') {
            steps {
                echo 'Testing...'
                sh 'npm test'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                echo 'Deploying...'
            }
        }
    }
    
    post {
        always {
            echo 'Cleaning up...'
        }
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
```

## 일반적인 플러그인

### Git 플러그인

```groovy
git branch: 'main',
    credentialsId: 'github-credentials',
    url: 'https://github.com/example/repo.git'
```

### Docker 플러그인

```groovy
docker.build('my-app:latest')
```

### Maven 플러그인

```groovy
mvn clean package
```

## 빌드 트리거

### 예약된 빌드

```groovy
// 매시간 빌드
cron('H * * * *')

// 매일 자정 빌드
cron('H 0 * * *')
```

### SCM 폴링

```groovy
pollScm('H * * * *')
```

### 웹훅 트리거

1. "Generic Webhook Trigger" 플러그인 설치
2. 작업 트리거 설정
3. GitHub/GitLab에서 웹훅 설정

## 환경 변수

### 내장 변수

```groovy
echo "현재 빌드: ${BUILD_NUMBER}"
echo "작업 디렉토리: ${WORKSPACE}"
echo "GIT_BRANCH: ${GIT_BRANCH}"
```

### 사용자 정의 변수

```groovy
environment {
    APP_VERSION = '1.0.0'
    DEPLOY_ENV = 'production'
}
```

## 자격 증명 관리

### 자격 증명 추가

1. "Manage Jenkins" → "Manage Credentials"로 이동
2. 자격 증명 추가:
   - Username with password
   - SSH Username with private key
   - Secret file

### 자격 증명 사용

```groovy
withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
    sh 'echo $USER:$PASS'
}
```

## 분산 빌드

### 에이전트 노드 설정

1. "Manage Jenkins" → "Manage Nodes"로 이동
2. 새 노드 추가
3. 연결 정보 설정

### 레이블 사용

```groovy
pipeline {
    agent {
        label 'docker'
    }
    // 빌드 단계
}
```

## 알림

### 이메일 알림

```groovy
emailext (
    subject: "빌드 알림: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    body: "빌드 상태: ${currentBuild.result}",
    to: 'team@example.com'
)
```

### Slack 알림

1. "Slack Notification" 플러그인 설치
2. 워크스페이스 설정
3. 알림 단계 추가

## 백업 및 복원

### 백업

```bash
# JENKINS_HOME 백업
tar -czvf jenkins-backup.tar.gz $JENKINS_HOME
```

### 복원

```bash
# Jenkins 중지
# 백업 압축 해제
tar -xzvf jenkins-backup.tar.gz -C $JENKINS_HOME
# Jenkins 재시작
```

## 모범 사례

### 1. 파이프라인 사용

```groovy
# 선언적 파이프라인 사용 권장
pipeline {
    // 전체 프로세스 정의
}
```

### 2. 매개변수화된 빌드

```groovy
parameters {
    choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: '배포 환경')
    string(name: 'VERSION', defaultValue: '', description: '버전 번호')
}
```

### 3. 작업 공간 정리

```groovy
post {
    always {
        cleanWs()
    }
}
```

## 관련 자료

- [Jenkins 공식 문서](https://www.jenkins.io/doc/)
- [파이프라인 문법](https://www.jenkins.io/doc/book/pipeline/syntax/)
