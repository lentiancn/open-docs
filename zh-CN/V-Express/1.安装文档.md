# V-Express 安装指南

V-Express 是腾讯 AI Lab 开发的人像视频生成方法。它在参考图像、音频和 V-Kps 序列的控制下生成说话头像视频。

## 版本概述

| 版本 | 状态 | 描述 |
|------|------|------|
| V-Express 1.x | 当前 | 主要版本 |

## 系统要求

### 硬件要求

| 组件 | 最低配置 | 推荐配置 |
|------|----------|----------|
| GPU | NVIDIA 16GB 显存 | NVIDIA 24GB+ 显存 |
| 内存 | 16GB | 32GB+ |
| 存储 | 50GB | 100GB+ |
| CUDA | 11.8+ | 12.1+ |

### 软件要求

| 软件 | 版本 | 说明 |
|------|------|------|
| Python | 3.8 - 3.10 | 推荐 3.9 |
| CUDA | 11.8+ | GPU 加速必需 |
| cuDNN | 8.5+ | CUDA 必需 |
| ffmpeg | 最新版 | 视频处理必需 |

## Linux/Ubuntu 安装

### 步骤 1：安装系统依赖

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装 Python 和开发工具
sudo apt install python3.9 python3-pip python3-venv git wget curl

# 安装系统库
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# 安装 ffmpeg
sudo apt install ffmpeg

# 安装 git-lfs
sudo apt install git-lfs
```

### 步骤 2：克隆项目

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express
```

### 步骤 3：创建虚拟环境

```bash
python3.9 -m venv venv
source venv/bin/activate
```

### 步骤 4：安装 PyTorch

```bash
# CUDA 11.8 版本
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118
```

### 步骤 5：安装依赖

```bash
pip install -r requirements.txt
```

### 步骤 6：下载模型

```bash
# 安装 git-lfs
git lfs install

# 从 HuggingFace 克隆模型
git clone https://huggingface.co/tk93/V-Express

# 移动模型到正确位置
mv V-Express/model_ckpts model_ckpts
mv V-Express/*.bin model_ckpts/v-express
```

## Windows 安装

### 步骤 1：安装 Python

1. 从 python.org 下载 Python 3.9
2. 安装时勾选"Add Python to PATH"
3. 验证：`python --version`

### 步骤 2：安装 CUDA

1. 从 NVIDIA 网站下载 CUDA 11.8
2. 默认安装

### 步骤 3：克隆和设置

```powershell
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python -m venv venv
venv\Scripts\activate
```

### 步骤 4：安装依赖

```powershell
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

## 验证安装

```bash
# 测试基本功能
python inference.py --help
```

## 常见问题

### CUDA 内存不足

**解决方案：**
- 减少推理步数：`--num_inference_steps 15`
- 启用内存节省：`--save_gpu_memory`

### 模型下载失败

**解决方案：**
- 使用 VPN 或代理
- 从 HuggingFace 手动下载
- 检查网络连接

## 注意事项

1. **人脸重定向**：当目标视频与参考图像不是同一个人时，人脸重定向很重要。选择与参考人脸姿势更相似的目标视频可以获得更好的结果。

2. **语言支持**：模型在英语上效果更好，其他语言尚未详细测试。

3. **图像质量**：使用清晰的正方形人脸图像，分辨率不低于 512x512。

## 相关链接

- [GitHub 仓库](https://github.com/tencent-ailab/V-Express)
- [HuggingFace 模型](https://huggingface.co/tk93/V-Express)
- [论文](https://arxiv.org/abs/2406.02511)
- [项目主页](https://tenvence.github.io/p/v-express/)
