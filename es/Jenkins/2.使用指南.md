# Guía de Usuario de Jenkins

Esta guía explica cómo usar Jenkins para implementar Integración Continua y Despliegue Continuo.

## Inicio Rápido

### Crear el Primer Trabajo

1. Hacer clic en "Nueva Tarea"
2. Ingresar el nombre del trabajo
3. Seleccionar "Proyecto Estilo Libre"
4. Configurar gestión de código fuente (Git)
5. Configurar disparadores de compilación
6. Configurar pasos de compilación
7. Guardar y construir

## Tipos de Trabajo

### Proyecto Estilo Libre

```groovy
// Ejemplo de paso de construcción
pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/example/repo.git'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install'
                sh 'npm test'
            }
        }
        stage('Deploy') {
            steps {
                sh 'npm run deploy'
            }
        }
    }
}
```

### Proyecto Pipeline

```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        APP_NAME = 'my-app'
    }
    
    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                sh 'npm install'
            }
        }
        
        stage('Test') {
            steps {
                echo 'Testing...'
                sh 'npm test'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                echo 'Deploying...'
            }
        }
    }
    
    post {
        always {
            echo 'Cleaning up...'
        }
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
```

## Plugins Comunes

### Plugin de Git

```groovy
git branch: 'main',
    credentialsId: 'github-credentials',
    url: 'https://github.com/example/repo.git'
```

### Plugin de Docker

```groovy
docker.build('my-app:latest')
```

### Plugin de Maven

```groovy
mvn clean package
```

## Disparadores de Construcción

### Construcción Programada

```groovy
// Construir cada hora
cron('H * * * *')

// Construir a medianoche cada día
cron('H 0 * * *')
```

### Sondeo de SCM

```groovy
pollScm('H * * * *')
```

### Activador por Webhook

1. Instalar el plugin "Generic Webhook Trigger"
2. Configurar el disparador del trabajo
3. Configurar Webhook en GitHub/GitLab

## Variables de Entorno

### Variables Incorporadas

```groovy
echo "Construcción actual: ${BUILD_NUMBER}"
echo "Directorio de trabajo: ${WORKSPACE}"
echo "GIT_BRANCH: ${GIT_BRANCH}"
```

### Variables Personalizadas

```groovy
environment {
    APP_VERSION = '1.0.0'
    DEPLOY_ENV = 'production'
}
```

## Gestión de Credenciales

### Agregar Credenciales

1. Ir a "Manage Jenkins" → "Manage Credentials"
2. Agregar credenciales:
   - Username with password
   - SSH Username with private key
   - Secret file

### Usar Credenciales

```groovy
withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
    sh 'echo $USER:$PASS'
}
```

## Construcción Distribuida

### Configurar Nodos Agente

1. Ir a "Manage Jenkins" → "Manage Nodes"
2. Agregar nuevo nodo
3. Configurar información de conexión

### Usar Etiquetas

```groovy
pipeline {
    agent {
        label 'docker'
    }
    // Pasos de construcción
}
```

## Notificaciones

### Notificación por Correo

```groovy
emailext (
    subject: "Notificación de Construcción: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    body: "Estado de Construcción: ${currentBuild.result}",
    to: 'team@example.com'
)
```

### Notificación por Slack

1. Instalar el plugin "Slack Notification"
2. Configurar el espacio de trabajo
3. Agregar paso de notificación

## Respaldo y Restauración

### Respaldo

```bash
# Respaldar JENKINS_HOME
tar -czvf jenkins-backup.tar.gz $JENKINS_HOME
```

### Restauración

```bash
# Detener Jenkins
# Extraer el respaldo
tar -xzvf jenkins-backup.tar.gz -C $JENKINS_HOME
# Reiniciar Jenkins
```

## Mejores Prácticas

### 1. Usar Pipeline

```groovy
// Se recomienda usar Pipeline declarativo
pipeline {
    // Definir todo el proceso
}
```

### 2. Construcción Parametrizada

```groovy
parameters {
    choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: 'Entorno de despliegue')
    string(name: 'VERSION', defaultValue: '', description: 'Número de versión')
}
```

### 3. Limpiar Workspace

```groovy
post {
    always {
        cleanWs()
    }
}
```

## Recursos Relacionados

- [Documentación Oficial de Jenkins](https://www.jenkins.io/doc/)
- [Sintaxis de Pipeline](https://www.jenkins.io/doc/book/pipeline/syntax/)
