# Docker ä½¿ç”¨æ‰‹å†Œ

> ğŸ¯ æœ¬æ–‡è¯¦ç»†ä»‹ç» Docker çš„æ ¸å¿ƒæ¦‚å¿µã€åŸºæœ¬ç”¨æ³•å’Œå¼€å‘æŒ‡å—
> 
> ğŸ“… æ›´æ–°æ—¶é—´ï¼š2026å¹´2æœˆ
> 
> ğŸ“– é€‚ç”¨ç‰ˆæœ¬ï¼šDocker 27.x

---

## ç›®å½•

1. [Docker æ ¸å¿ƒæ¦‚å¿µ](#1-docker-æ ¸å¿ƒæ¦‚å¿µ)
2. [é•œåƒæ“ä½œ](#2-é•œåƒæ“ä½œ)
3. [å®¹å™¨æ“ä½œ](#3-å®¹å™¨æ“ä½œ)
4. [Dockerfile ç¼–å†™](#4-dockerfile-ç¼–å†™)
5. [Docker Compose](#5-docker-compose)
6. [ç½‘ç»œç®¡ç†](#6-ç½‘ç»œç®¡ç†)
7. [æ•°æ®ç®¡ç†](#7-æ•°æ®ç®¡ç†)
8. [Dockerfile æœ€ä½³å®è·µ](#8-dockerfile-æœ€ä½³å®è·µ)
9. [ç›‘æ§å’Œè°ƒè¯•](#9-ç›‘æ§å’Œè°ƒè¯•)
10. [å®‰å…¨é…ç½®](#10-å®‰å…¨é…ç½®)

---

## 1. Docker æ ¸å¿ƒæ¦‚å¿µ

### 1.1 é•œåƒï¼ˆImageï¼‰

é•œåƒæ˜¯åªè¯»æ¨¡æ¿ï¼Œç”¨äºåˆ›å»ºå®¹å™¨ã€‚å¯ä»¥æŠŠé•œåƒç†è§£ä¸ºé¢å‘å¯¹è±¡çš„ç±»ã€‚

#### å¸¸è§é•œåƒæ“ä½œ

```bash
# æŸ¥çœ‹é•œåƒåˆ—è¡¨
docker images
docker image ls

# æ‹‰å–é•œåƒ
docker pull ubuntu:22.04
docker pull nginx:latest

# åˆ é™¤é•œåƒ
docker rmi ubuntu:22.04
docker image rm nginx:latest

# æ„å»ºé•œåƒ
docker build -t my-image:tag .

# æŸ¥çœ‹é•œåƒè¯¦æƒ…
docker image inspect nginx:latest
```

### 1.2 å®¹å™¨ï¼ˆContainerï¼‰

å®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œå¯ä»¥æŠŠå®¹å™¨ç†è§£ä¸ºé¢å‘å¯¹è±¡çš„å®ä¾‹å¯¹è±¡ã€‚

#### å¸¸è§å®¹å™¨æ“ä½œ

```bash
# è¿è¡Œå®¹å™¨
docker run -it ubuntu:22.04 /bin/bash
docker run -d nginx:latest
docker run -p 8080:80 nginx:latest

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# åœæ­¢å®¹å™¨
docker stop container_id

# å¯åŠ¨å®¹å™¨
docker start container_id

# åˆ é™¤å®¹å™¨
docker rm container_id

# è¿›å…¥å®¹å™¨
docker exec -it container_id /bin/bash
docker attach container_id
```

### 1.3 ä»“åº“ï¼ˆRepositoryï¼‰

ä»“åº“æ˜¯å­˜å‚¨é•œåƒçš„åœ°æ–¹ï¼ŒDocker Hub æ˜¯å®˜æ–¹å…¬å…±ä»“åº“ã€‚

```bash
# ç™»å½• Docker Hub
docker login

# æ¨é€é•œåƒ
docker push my-image:tag

# æœç´¢é•œåƒ
docker search ubuntu
```

---

## 2. é•œåƒæ“ä½œ

### 2.1 æ‹‰å–é•œåƒ

```bash
# æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull ubuntu

# æ‹‰å–æŒ‡å®šç‰ˆæœ¬
docker pull ubuntu:22.04

# æ‹‰å–æ‰€æœ‰æ ‡ç­¾
docker pull -a ubuntu

# æ‹‰å–æ—¶æ˜¾ç¤ºè¿›åº¦
docker pull -q ubuntu
```

### 2.2 æ„å»ºé•œåƒ

```bash
# ä» Dockerfile æ„å»º
docker build -t my-app:1.0 .

# ä½¿ç”¨æŒ‡å®š Dockerfile
docker build -f Dockerfile.dev -t my-app:dev .

# ä½¿ç”¨æ„å»ºç¼“å­˜
docker build --cache-from my-app:old .

# å¤šé˜¶æ®µæ„å»º
docker build -t my-app:prod .
```

### 2.3 ç®¡ç†é•œåƒ

```bash
# åˆ—å‡ºé•œåƒ
docker images
docker image ls

# åˆ—å‡º dangling é•œåƒï¼ˆæœªæ ‡è®°ï¼‰
docker images -f dangling=true

# åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ
docker image prune
docker image prune -a

# æ ‡ç­¾é•œåƒ
docker tag my-app:latest my-app:1.0
docker tag my-app:1.0 username/my-app:1.0

# å¯¼å‡ºé•œåƒ
docker save -o my-app.tar my-app:1.0

# å¯¼å…¥é•œåƒ
docker load -i my-app.tar
```

---

## 3. å®¹å™¨æ“ä½œ

### 3.1 åˆ›å»ºå’Œè¿è¡Œå®¹å™¨

```bash
# äº¤äº’å¼å®¹å™¨
docker run -it ubuntu /bin/bash

# å®ˆæŠ¤è¿›ç¨‹å®¹å™¨ï¼ˆåå°è¿è¡Œï¼‰
docker run -d nginx

# æŒ‡å®šåç§°è¿è¡Œ
docker run --name my-nginx nginx

# ç«¯å£æ˜ å°„
docker run -p 8080:80 nginx
# éšæœºç«¯å£
docker run -P nginx

# ç¯å¢ƒå˜é‡
docker run -e APP_ENV=production -e DB_HOST=localhost my-app

# æŒ‚è½½å·
docker run -v /host/path:/container/path my-app

# èµ„æºé™åˆ¶
docker run -m 512m --cpus=0.5 my-app
```

### 3.2 å®¹å™¨ç”Ÿå‘½å‘¨æœŸ

```bash
# å¯åŠ¨å®¹å™¨
docker start container_id

# åœæ­¢å®¹å™¨
docker stop container_id

# é‡å¯å®¹å™¨
docker restart container_id

# æš‚åœå®¹å™¨
docker pause container_id

# å–æ¶ˆæš‚åœ
docker unpause container_id

# åˆ é™¤å®¹å™¨
docker rm container_id

# å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨
docker rm -f container_id

# åˆ é™¤å·²é€€å‡ºçš„å®¹å™¨
docker container prune
```

### 3.3 è¿›å…¥å®¹å™¨

```bash
# exec æ–¹å¼ï¼ˆæ¨èï¼‰
docker exec -it container_id /bin/bash

# attach æ–¹å¼
docker attach container_id

# åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
docker exec container_id cat /etc/passwd
```

### 3.4 æŸ¥çœ‹å®¹å™¨

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker ps -a

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs container_id
docker logs -f container_id
docker logs --tail 100 container_id

# æŸ¥çœ‹å®¹å™¨è¿›ç¨‹
docker top container_id

# æŸ¥çœ‹å®¹å™¨è¯¦æƒ…
docker inspect container_id

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats container_id
docker stats --no-stream
```

---

## 4. Dockerfile ç¼–å†™

### 4.1 åŸºç¡€è¯­æ³•

```dockerfile
# åŸºç¡€é•œåƒ
FROM ubuntu:22.04

# ç»´æŠ¤è€…
MAINTAINER Your Name <your@email.com>

# é•œåƒæ ‡ç­¾
LABEL version="1.0"
LABEL description="My Application"

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶æ–‡ä»¶
COPY package*.json ./
COPY . .

# æ‰§è¡Œå‘½ä»¤
RUN npm install
RUN apt update && apt install -y nginx

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV APP_ENV=production
ENV PORT=8080

# æš´éœ²ç«¯å£
EXPOSE 8080

# è®¾ç½®å¯åŠ¨å‘½ä»¤
CMD ["npm", "start"]
ENTRYPOINT ["nginx", "-g", "daemon off;"]
```

### 4.2 å¸¸ç”¨æŒ‡ä»¤

| æŒ‡ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| FROM | æŒ‡å®šåŸºç¡€é•œåƒ | FROM ubuntu:22.04 |
| RUN | æ‰§è¡Œå‘½ä»¤ | RUN apt update |
| COPY | å¤åˆ¶æ–‡ä»¶ | COPY . /app |
| ADD | å¤åˆ¶ï¼ˆæ”¯æŒ URL å’Œ tarï¼‰ | ADD app.tar.gz /app |
| WORKDIR | è®¾ç½®å·¥ä½œç›®å½• | WORKDIR /app |
| ENV | è®¾ç½®ç¯å¢ƒå˜é‡ | ENV NODE_ENV=prod |
| EXPOSE | å£°æ˜ç«¯å£ | EXPOSE 8080 |
| CMD | é»˜è®¤å‘½ä»¤ | CMD ["npm", "start"] |
| ENTRYPOINT | å…¥å£ç‚¹ | ENTRYPOINT ["nginx"] |

### 4.3 å¤šé˜¶æ®µæ„å»º

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM node:18 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# è¿è¡Œé˜¶æ®µ
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 4.4 .dockerignore

```
node_modules
npm-debug.log
.git
.gitignore
README.md
.env
*.md
```

---

## 5. Docker Compose

### 5.1 docker-compose.yml åŸºç¡€

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "8080:80"
    environment:
      - NODE_ENV=production
    volumes:
      - ./data:/app/data
    depends_on:
      - db
    networks:
      - frontend
      - backend

  db:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: secret
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend

volumes:
  db-data:

networks:
  frontend:
  backend:
```

### 5.2 å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æ„å»ºé•œåƒ
docker-compose build

# é‡æ–°åˆ›å»ºå®¹å™¨
docker-compose up --force-recreate

# è¿›å…¥æœåŠ¡å®¹å™¨
docker-compose exec web /bin/bash
```

### 5.3 ç¯å¢ƒå˜é‡

```yaml
services:
  app:
    environment:
      - DB_HOST=db
      - DB_PORT=5432
    env_file:
      - .env.production
```

---

## 6. ç½‘ç»œç®¡ç†

### 6.1 ç½‘ç»œæ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ |
|------|------|
| bridge | é»˜è®¤æ¨¡å¼ï¼Œå®¹å™¨é—´é€šä¿¡ |
| host | å…±äº«ä¸»æœºç½‘ç»œ |
| none | æ— ç½‘ç»œ |
| container | å…±äº«å¦ä¸€ä¸ªå®¹å™¨çš„ç½‘ç»œ |

### 6.2 åˆ›å»ºç½‘ç»œ

```bash
# åˆ›å»ºç½‘ç»œ
docker network create my-network

# æŸ¥çœ‹ç½‘ç»œ
docker network ls

# æŸ¥çœ‹ç½‘ç»œè¯¦æƒ…
docker network inspect my-network

# åˆ é™¤ç½‘ç»œ
docker network rm my-network
```

### 6.3 å®¹å™¨ç½‘ç»œ

```bash
# å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œ
docker network connect my-network container_name

# æ–­å¼€å®¹å™¨ç½‘ç»œ
docker network disconnect my-network container_name
```

---

## 7. æ•°æ®ç®¡ç†

### 7.1 å·ï¼ˆVolumeï¼‰

```bash
# åˆ›å»ºå·
docker volume create my-volume

# æŸ¥çœ‹å·
docker volume ls

# æŸ¥çœ‹å·è¯¦æƒ…
docker volume inspect my-volume

# åˆ é™¤å·
docker volume rm my-volume

# åˆ é™¤æœªä½¿ç”¨çš„å·
docker volume prune
```

### 7.2 ç»‘å®šæŒ‚è½½

```bash
# ç»‘å®šæŒ‚è½½ï¼ˆä¸»æœºç›®å½•ï¼‰
docker run -v /host/path:/container/path my-app

# åªè¯»æŒ‚è½½
docker run -v /host/path:/container/path:ro my-app
```

### 7.3 tmpfs æŒ‚è½½

```bash
# å†…å­˜æŒ‚è½½
docker run --tmpfs /app/data my-app
```

---

## 8. Dockerfile æœ€ä½³å®è·µ

### 8.1 ä¼˜åŒ–æ„å»ºé€Ÿåº¦

```dockerfile
# å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œå†å®‰è£…ï¼Œæœ€åå¤åˆ¶ä»£ç 
COPY package*.json ./
RUN npm install
COPY . .
```

### 8.2 å‡å°‘é•œåƒå¤§å°

```dockerfile
# ä½¿ç”¨ alpine é•œåƒ
FROM node:18-alpine

# æ¸…ç†ç¼“å­˜
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

# å¤šé˜¶æ®µæ„å»º
```

### 8.3 å®‰å…¨æœ€ä½³å®è·µ

```dockerfile
# ä¸ä½¿ç”¨ root ç”¨æˆ·
RUN groupadd -r appgroup && useradd -r -g appgroup appuser
USER appuser

# æœ€å°åŒ–æš´éœ²ç«¯å£
EXPOSE 8080
```

---

## 9. ç›‘æ§å’Œè°ƒè¯•

### 9.1 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs container_id

# å®æ—¶æ—¥å¿—
docker logs -f container_id

# æœ€è¿‘ 100 è¡Œ
docker logs --tail 100 container_id

# æ—¶é—´æˆ³
docker logs -t container_id
```

### 9.2 èµ„æºç›‘æ§

```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats
docker stats container_id

# ç³»ç»Ÿä¿¡æ¯
docker info
```

### 9.3 è°ƒè¯•

```bash
# è¿›å…¥å®¹å™¨
docker exec -it container_id /bin/bash

# æŸ¥çœ‹è¿›ç¨‹
docker top container_id

# æŸ¥çœ‹è¯¦ç»†é…ç½®
docker inspect container_id
```

---

## 10. å®‰å…¨é…ç½®

### 10.1 ä»¥é root ç”¨æˆ·è¿è¡Œ

```dockerfile
FROM node:18-alpine
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser
```

### 10.2 æ‰«ææ¼æ´

```bash
# å®‰è£… trivy
brew install aquasecurity/trivy/trivy

# æ‰«æé•œåƒ
trivy image my-app:latest
```

### 10.3 é™åˆ¶å®¹å™¨èƒ½åŠ›

```bash
# è¿è¡Œå®¹å™¨æ—¶é™åˆ¶èƒ½åŠ›
docker run --cap-drop ALL --cap-add NET_BIND_SERVICE my-app
```

---

## ğŸ“š ç›¸å…³èµ„æº

- å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.docker.com
- Docker Hubï¼šhttps://hub.docker.com
- Docker Composeï¼šhttps://docs.docker.com/compose

---

*æœ¬æ–‡æ¡£ç”± AI åŠ©æ‰‹ç”Ÿæˆï¼Œæ¬¢è¿æäº¤åé¦ˆå’Œæ”¹è¿›å»ºè®®ã€‚*
