# JMeter ユーザーマニュアル

## JMeter入門

### 最初のテストplanを作成

1. **JMeterを起動**: JMeter GUIを起動
2. **スレッドグループを追加**: テスト planを右クリック → 追加 → スレッドグループ
3. **スレッドグループを設定**:
   - スレッド数: ユーザー数
   - ランプアップ期間: 全ユーザーを起動するまでの時間
   - ループ回数: テストを実行する回数
4. **サンプラーを追加**: スレッドグループを右クリック → 追加 → HTTPリクエスト
5. **HTTPリクエストを設定**: サーバー名、パス、パラメータを入力
6. **リスナーを追加**: スレッドグループを右クリック → 追加 → リスナー（結果ツリー、概要レポート）
7. **テストを実行**: 緑の「開始」ボタンをクリック

## コアコンポーネント

### スレッドグループ
スレッドグループはユーザーをシミュレートします。重要な設定:
- **スレッド数**: 同時ユーザー数
- **ランプアップ期間**: フル負荷に達するまでの時間
- **ループ回数**: 各ユーザーがテストを実行する回数
- **スレッド作成の遅延**: スレッド作成間の遅延を追加

### サンプラー
サンプラーは実際のリクエストを実行:

| サンプラー | 説明 |
|-----------|------|
| HTTPリクエスト | Webサーバーをテスト |
| JDBCリクエスト | データベースをテスト |
| LDAPリクエスト | LDAPサーバーをテスト |
| FTPリクエスト | FTPサーバーをテスト |
| SOAP/XML-RPC | Webサービスをテスト |
| TCPサンプラー | TCPサーバーをテスト |

### コントローラー
コントローラー はテストフローを整理:

- **シンプルコントローラー**: リクエストをグループ化
- **ループコントローラー**: リクエストを繰り返す
- **IFコントローラー**: 条件付き実行
- **トランザクションコントローラー**: トランザクション時間を測定

### リスナー
リスナーはテスト結果を表示:
- **結果ツリー**: 詳細リクエスト/レスポンス
- **概要レポート**: 集計統計
- **グラフ結果**: 視覚的なパフォーマンスチャート
- **レスポンス時間グラフ**: レスポンス時間の視覚化

### タイマー
タイマーはリクエスト間に遅延を追加:
- **定数タイマー**: 固定遅延
- **ガウスランダムタイマー**: ガウス分布のランダム遅延
- **均一ランダムタイマー**: 範囲内のランダム遅延

### アサーション
アサーションはレスポンスを検証:
- **レスポンスアサーション**: レスポンス内容をチェック
- **Durationアサーション**: レスポンス時間をチェック
- **サイズアサーション**: レスポンスサイズをチェック
- **XMLアサーション**: XML形式を検証

## 高度な機能

### データ抽出（相関）

動的データのためにレスポンスから値を抽出:

1. **JSONエクストラクター**: JSON値を抽出
2. **XPathエクストラクター**: XML値を抽出
3. **CSS/JQueryエクストラクター**: HTML値を抽出
4. **正規表現エクストラクター**: 正規表現で抽出

### 変数と関数

変数を使用してテストをパラメータ化:
- `${variable_name}`: 変数を参照
- `${__functionName(param)}`: 組み込み関数を使用

一般的な関数:
- `__Random`: ランダム値を生成
- `__time`: 現在のタイムスタンプ
- `__counter`: 増分カウンター
- `__property`: プロパティを読み取り

### 分散テスト

複数 マシンでテストを実行:

1. **リモートサーバーを設定**: jmeter.propertiesで`remote_hosts`を編集
2. **リモートサーバーを起動**: 各スレーブで`jmeter-server`を実行
3. **テストを実行**: GUIで「リモート開始」をクリック

```bash
# リモートサーバーを起動
jmeter-server

# 分散テストを実行
jmeter -R server1,server2 -t testplan.jmx
```

### プロパティファイル

JMeterの動作をカスタマイズ:
- `jmeter.properties`: メイン設定
- `user.properties`: ユーザー固有の設定
- `system.properties`: システムプロパティ

## ベストプラクティス

1. **負荷テストにはCLIモードを使用**: GUIモードはより多くのメモリを使用
2. **低負荷から開始**: スケールアップ前にテストが機能することを確認
3. **アサーションを使用**: エラーを検出するためにレスポンスを検証
4. **動的データを抽出**: セッションID、トークンなどを処理
5. **リソースをクリーンアップ**: クリーンアップにtearDownスレッドグループを使用
6. **システムリソースを監視**: CPU、メモリ、ネットワーク
7. **適切な命名を使用**: 明確な名前はデバッグを容易に
8. **バージョン管理**: テストplanをバージョン管理下に置く

## パフォーマンスチューニング

### JVM設定
```bash
HEAP="-Xms1g -Xmx4g"
NEW="-XX:NewSize=512m -XX:MaxNewSize=1024m"
```

### JMeter設定
```properties
# スレッド制限を増加
thread_nums_higher_limit=10000

# 冗長なロギングを無効化
log_level.jmeter=INFO
```

## トラブルシューティング

### OutOfMemoryError
- ヒープサイズを増加
- スレッド数を削減
- CLIモードを使用

### 高いレイテンシ
- ネットワーク条件を確認
- テストplanを最適化
- 分散テストを使用

### スクリプトエラー
- 結果ツリーで詳細を確認
- デバッグロギングを有効化
- アサーションを確認
