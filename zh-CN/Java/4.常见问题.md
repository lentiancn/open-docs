# Java 常见问题

本章节汇总了 Java 开发中的常见问题。

## 编译和运行问题

### Q1: java 命令找不到

**问题描述：**
运行 `java` 或 `javac` 提示命令找不到。

**解决方案：**
1. 检查 JAVA_HOME 环境变量
   ```bash
   echo $JAVA_HOME  # Linux/macOS
   echo %JAVA_HOME%  # Windows
   ```

2. 配置环境变量
   ```bash
   # Linux/macOS
   export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
   export PATH=$JAVA_HOME/bin:$PATH
   
   # Windows
   setx JAVA_HOME "C:\Program Files\Java\jdk-21"
   ```

### Q2: 类找不到

**问题描述：**
`NoClassDefFoundError` 或 `ClassNotFoundException`

**解决方案：**
1. 检查类路径
   ```bash
   java -cp .:lib/* MyClass
   ```

2. 检查包名是否正确

### Q3: 编码问题

**问题描述：**
编译或运行时出现乱码。

**解决方案：**
```bash
# 编译时指定编码
javac -encoding UTF-8 MyClass.java

# 运行指定编码
java -Dfile.encoding=UTF-8 MyClass
```

## 语法问题

### Q4: 常见编译错误

**问题描述：**
语法错误。

**常见错误：**
- 缺少分号
- 括号不匹配
- 变量未声明
- 类型不匹配

**解决方案：**
使用 IDE（IntelliJ IDEA/Eclipse）可以自动提示语法错误。

### Q5: 泛型类型问题

**问题描述：**
`Generic array creation` 或 `unchecked cast`

**解决方案：**
```java
// 错误
List<String>[] array = new List<String>[10];

// 正确
List<String>[] array = (List<String>[]) new List[10];
```

### Q6: 可变参数问题

**问题描述：**
方法重载时可变参数匹配错误。

**解决方案：**
避免重载包含可变参数的方法。

## 面向对象问题

### Q7: 空指针异常

**问题描述：**
`NullPointerException`

**解决方案：**
```java
// 使用前检查
if (obj != null) {
    obj.method();
}

// 使用 Optional
Optional<String> optional = Optional.ofNullable(getString());
optional.ifPresent(System.out::println);
```

### Q8: 继承问题

**问题描述：**
子类无法访问父类私有成员。

**解决方案：**
使用 protected 或提供 getter/setter 方法。

### Q9: 接口和抽象类区别

**问题描述：**
不知道该用接口还是抽象类。

**选择原则：**
- 接口：行为抽象，多实现
- 抽象类：属性抽象，单继承

## 集合问题

### Q10: 遍历时修改集合

**问题描述：**
`ConcurrentModificationException`

**解决方案：**
```java
// 使用迭代器删除
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    if (it.next().equals("remove")) {
        it.remove();
    }
}

// 使用 CopyOnWriteArrayList
List<String> list = new CopyOnWriteArrayList<>();
```

### Q11: HashMap 性能问题

**问题描述：**
HashMap 性能差或出现冲突。

**解决方案：**
1. 设置合理的初始容量
   ```java
   new HashMap<>(16, 0.75f);
   ```

2. 确保 key 的 hashCode 和 equals 正确实现

### Q12: List 选择问题

**问题描述：**
ArrayList 和 LinkedList 选择困惑。

**选择原则：**
- 频繁读取：ArrayList
- 频繁插入/删除：LinkedList

## 并发问题

### Q13: 线程安全问题

**问题描述：**
多线程访问共享资源出错。

**解决方案：**
```java
// 使用 synchronized
synchronized (object) {
    // 临界区代码
}

// 使用 Lock
ReentrantLock lock = new ReentrantLock();
lock.lock();
try {
    // 临界区代码
} finally {
    lock.unlock();
}
```

### Q14: 死锁

**问题描述：**
程序卡死，两个或多个线程相互等待。

**解决方案：**
1. 统一加锁顺序
2. 使用 tryLock
3. 减少的粒度

锁### Q15: 线程通信问题

**问题描述：**
线程间无法正确通信。

**解决方案：**
使用 wait/notify 或 BlockingQueue。

## 性能问题

### Q16: 内存溢出

**问题描述：**
`OutOfMemoryError`

**解决方案：**
1. 增加堆内存
   ```bash
   java -Xmx2g MyClass
   ```

2. 优化代码，避免内存泄漏

3. 使用分析工具（VisualVM/JProfiler）

### Q17: GC 频繁

**问题描述：**
垃圾回收过于频繁。

**解决方案：**
1. 调整堆大小
   ```bash
   java -Xms512m -Xmx2g MyClass
   ```

2. 选择合适的 GC 策略
   ```bash
   java -XX:+UseG1GC MyClass
   ```

## Spring 问题

### Q18: Bean 注入失败

**问题描述：**
`NoSuchBeanDefinitionException`

**解决方案：**
1. 检查 ComponentScan
2. 检查 Bean 名称
3. 确保依赖类被扫描到

### Q19: 循环依赖

**问题描述：**
`BeanCurrentlyInCreationException`

**解决方案：**
1. 重新设计代码
2. 使用 setter 注入
3. 使用 @Lazy

### Q20: 事务不生效

**问题描述：**
数据库操作未回滚。

**解决方案：**
1. 确保在同一个事务中
2. 检查异常类型
3. 检查传播行为

## 测试问题

### Q21: 单元测试

**解决方案：**
使用 JUnit 5：
```java
import org.junit.jupiter.api.*;

@Test
void testAddition() {
    Assertions.assertEquals(4, 2 + 2);
}
```

## 构建问题

### Q22: Maven 依赖冲突

**问题描述：**
依赖版本冲突。

**解决方案：**
```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-core</artifactId>
    <version>5.3.20</version>
</dependency>
```

使用 mvn dependency:tree 查看依赖树。

### Q23: 构建速度慢

**解决方案：**
1. 使用 Maven Wrapper
2. 配置镜像
3. 使用并行编译

## 总结

本章节涵盖了 Java 开发中的常见问题：

- **编译运行**：环境变量、类路径、编码
- **语法**：泛型、可变参数
- **面向对象**：空指针、继承
- **集合**：遍历、选择
- **并发**：线程安全、死锁
- **性能**：内存、GC
- **Spring**：Bean、事务
- **构建**：依赖、速度

如需更多信息，请参考官方文档：https://docs.oracle.com/javase/
