# GitLab 安裝指南

> GitLab 安裝和配置的完整指南

---

## 系統需求

| 資源 | 最低配置 | 推薦配置 |
|------|----------|----------|
| CPU | 2 核心 | 4 核心及以上 |
| 記憶體 | 4 GB | 8 GB 及以上 |
| 儲存 | 10 GB | 50 GB 及以上 |
| 作業系統 | Ubuntu、Debian、CentOS、RHEL、Kubernetes | - |

---

## 安裝方式

### Omnibus 安裝包（Linux 推薦方式）

#### Ubuntu/Debian

```bash
# 安裝依賴
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificates tzdata perl

# 新增 GitLab 倉庫
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash

# 安裝 GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" apt-get install gitlab-ee
```

#### CentOS/RHEL

```bash
# 安裝依賴
sudo yum install -y curl policycoreutils openssh-server

# 新增 GitLab 倉庫
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# 安裝 GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-ee
```

### Docker 安裝

```bash
# 拉取 GitLab Docker 映像檔
docker run --detach \
  --hostname gitlab.example.com \
  --publish 443:443 --publish 80:80 --publish 22:22 \
  --name gitlab \
  --restart always \
  --volume /srv/gitlab/config:/etc/gitlab \
  --volume /srv/gitlab/logs:/var/log/gitlab \
  --volume /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ee:latest
```

### Kubernetes 安裝

```bash
# 使用 Helm chart 安裝
helm repo add gitlab https://charts.gitlab.io
helm install gitlab gitlab/gitlab \
  --set externalUrl="https://gitlab.example.com" \
  --set certmanager-issuer.email="admin@example.com"
```

---

## 初始設定

### 設定外部 URL

```bash
# 編輯 GitLab 設定檔
sudo vim /etc/gitlab/gitlab.rb

# 設定外部 URL
external_url 'https://gitlab.example.com'

# 重新設定 GitLab
sudo gitlab-ctl reconfigure
```

### 設定 SMTP（郵件）

```bash
# 在 /etc/gitlab/gitlab.rb 中設定 SMTP
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "smtp_user"
gitlab_rails['smtp_password'] = "smtp_password"
gitlab_rails['smtp_domain'] = "example.com"

# 套用變更
sudo gitlab-ctl reconfigure
```

### 使用 Let's Encrypt 啟用 HTTPS

```bash
# 在 /etc/gitlab/gitlab.rb 中設定
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com']

# 重新設定
sudo gitlab-ctl reconfigure
```

---

## 首次登入

1. 透過外部 URL 存取 GitLab
2. 使用使用者名稱 `root` 登入
3. 首次登入時設定密碼
4. 建立你的第一個專案

---

## 常用指令

```bash
# 查看狀態
sudo gitlab-ctl status

# 啟動服務
sudo gitlab-ctl start

# 停止服務
sudo gitlab-ctl stop

# 重新啟動服務
sudo gitlab-ctl restart

# 查看日誌
sudo gitlab-ctl tail

# 檢查設定
sudo gitlab-rake gitlab:env:info
```

---

## 故障排除

### 安裝失敗怎麼辦？

- 檢查系統需求
- 確保所有依賴都已安裝
- 檢查防火牆和 SELinux 設定
- 查看安裝日誌

### GitLab 無法啟動怎麼辦？

```bash
# 檢查連接埠衝突
sudo netstat -tulpn | grep -E ':(80|443|22)\s'

# 檢查磁碟空間
df -h

# 查看日誌
sudo gitlab-ctl tail
```

### 效能緩慢怎麼辦？

- 增加伺服器資源
- 啟用 Prometheus 監控指標
- 設定適當的交換空間
- 使用 PostgreSQL 調優

---

## 相關資源

- 官方安裝文檔：https://docs.gitlab.com/ee/install/
- 硬體需求：https://docs.gitlab.com/ee/install/requirements.html
- 社群論壇：https://forum.gitlab.com/
