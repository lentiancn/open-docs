# OpenFeign User Manual

## Basic Usage

### Creating a Feign Client

Define an interface with `@FeignClient` annotation:

```java
@FeignClient(name = "user-service", url = "https://api.users.com")
public interface UserClient {
    
    @RequestMapping(method = RequestMethod.GET, value = "/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @RequestMapping(method = RequestMethod.POST, value = "/users")
    User createUser(@RequestBody User user);
    
    @RequestMapping(method = RequestMethod.PUT, value = "/users/{id}")
    User updateUser(@PathVariable("id") Long id, @RequestBody User user);
    
    @RequestMapping(method = RequestMethod.DELETE, value = "/users/{id}")
    void deleteUser(@PathVariable("id") Long id);
}
```

### Using the Client

Inject and use the client in your service:

```java
@Service
public class UserService {
    
    @Autowired
    private UserClient userClient;
    
    public User getUser(Long id) {
        return userClient.getUserById(id);
    }
}
```

---

## Advanced Features

### Request/Response Interceptors

```java
@FeignClient(name = "example")
public interface ExampleClient {
    // Define your endpoints
}

@Component
public class AuthInterceptor implements RequestInterceptor {
    
    @Override
    public void apply(RequestTemplate template) {
        template.header("Authorization", "Bearer " + getToken());
    }
}
```

### Error Handling

```java
@FeignClient(name = "example")
public interface ExampleClient {
    @RequestMapping(method = RequestMethod.GET, value = "/data")
    Data getData();
}

@Component
public class ErrorDecoder implements ErrorDecoder {
    
    @Override
    public Exception decode(String methodKey, Response response) {
        if (response.status() == 404) {
            return new NotFoundException("Resource not found");
        }
        return new RuntimeException("Unknown error: " + response.status());
    }
}
```

### Fallback Mechanism

```java
@FeignClient(name = "user-service", fallback = UserClientFallback.class)
public interface UserClient {
    @RequestMapping(method = RequestMethod.GET, value = "/users/{id}")
    User getUser(@PathVariable("id") Long id);
}

@Component
public class UserClientFallback implements UserClient {
    
    @Override
    public User getUser(Long id) {
        return new User(); // Return default/fallback user
    }
}
```

### Load Balancing

With Spring Cloud:

```java
@FeignClient(name = "user-service")
public interface UserClient {
    // Service name is used for load balancing
    @RequestMapping(method = RequestMethod.GET, value = "/users/{id}")
    User getUser(@PathVariable("id") Long id);
}
```

---

## Configuration

### Application Properties

```yaml
feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 5000
        loggerLevel: basic
      user-service:
        connectTimeout: 10000
        readTimeout: 10000
```

### Custom Configuration

```java
@FeignClient(name = "example", configuration = CustomFeignConfiguration.class)
public interface ExampleClient {
    // ...
}

public class CustomFeignConfiguration {
    
    @Bean
    public Logger.Level loggerLevel() {
        return Logger.Level.FULL;
    }
}
```

---

## Best Practices

1. **Use interfaces**: Define Feign clients as interfaces for better testability
2. **Enable Hystrix**: Add circuit breaker for fault tolerance
3. **Use fallback**: Always provide fallback implementations
4. **Log appropriately**: Set appropriate log levels for debugging
5. **Timeouts**: Configure appropriate timeouts for your use case
6. **Headers**: Use interceptors for common headers like authentication
