# Jenkins 安装指南

本指南将帮助你在各种环境中安装 Jenkins。

## 环境要求

| 软件 | 要求 |
|------|------|
| JDK | JDK 8-17 |
| 内存 | 最低 1GB，推荐 4GB+ |
| 磁盘 | 至少 10GB |

## Windows 安装

### 方法一：安装包

1. 下载 LTS 安装包：https://www.jenkins.io/zh/download/
2. 运行安装程序
3. 安装向导完成安装
4. 访问：http://localhost:8080

### 方法二：WAR 包

```bash
# 下载 WAR 包
curl -O https://get.jenkins.io/war-stable/latest/jenkins.war

# 运行
java -jar jenkins.war

# 访问
# http://localhost:8080
```

## macOS 安装

### 方法一：Homebrew

```bash
# 安装 Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Jenkins
brew install jenkins-lts

# 启动 Jenkins
brew services start jenkins-lts

# 访问
# http://localhost:8080

# 停止
brew services stop jenkins-lts
```

### 方法二：Docker

```bash
# 运行 Jenkins 容器
docker run -d -p 8080:8080 -v jenkins_home:/var/jenkins_home jenkins/jenkins:lts

# 访问
# http://localhost:8080
```

## Linux 安装

### Ubuntu/Debian

```bash
# 添加 Jenkins 仓库
curl -fsSL https://pkg.jenkins.io/debian/jenkins.io-2023.key | sudo tee /usr/share/keyrings/jenkins-keyring.asc

echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian binary/ | sudo tee /etc/apt/sources.list.d/jenkins.list

# 安装 Jenkins
sudo apt-get update
sudo apt-get install jenkins

# 启动 Jenkins
sudo systemctl start jenkins
sudo systemctl enable jenkins

# 访问
# http://localhost:8080
```

### CentOS/RHEL

```bash
# 添加 Jenkins 仓库
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo

# 导入密钥
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key

# 安装
sudo yum install jenkins

# 启动
sudo systemctl start jenkins
sudo systemctl enable jenkins
```

## Docker 安装

### 基本使用

```bash
# 运行 Jenkins
docker run -d -p 8080:8080 -p 50000:50000 \
  -v jenkins_home:/var/jenkins_home \
  --name jenkins \
  jenkins/jenkins:lts

# 访问
# http://localhost:8080
```

### Docker Compose

```yaml
version: '3'

services:
  jenkins:
    image: jenkins/jenkins:lts
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home
    restart: unless-stopped
```

## 初始配置

### 1. 解锁 Jenkins

首次访问需要解锁：

1. 访问 http://localhost:8080
2. 获取初始密码：
   ```bash
   # Docker
   docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
   
   # Linux
   sudo cat /var/lib/jenkins/secrets/initialAdminPassword
   ```

### 2. 安装插件

- 选择"安装推荐的插件"
- 或手动选择需要的插件

### 3. 创建管理员

- 设置管理员账户
- 完成配置

## 配置

### 配置 JDK

```bash
# 自动安装
# Jenkins > 全局工具配置 > JDK > 新增 JDK

# 或手动指定
# JAVA_HOME=/usr/lib/jvm/java-17
```

### 配置 Maven

```bash
# 自动安装
# Jenkins > 全局工具配置 > Maven > 新增 Maven
```

### 配置 Git

```bash
# 通常系统自带
# 检查
which git
```

## 常用配置

### 配置代理

- 系统管理 > 系统设置 > 高级 > 代理设置

### 配置邮件

- 系统管理 > 系统设置 > 邮件通知

### 配置凭据

- 凭据 > 系统 > 添加域

## 常用命令

```bash
# 启动
sudo systemctl start jenkins

# 停止
sudo systemctl stop jenkins

# 重启
sudo systemctl restart jenkins

# 查看状态
sudo systemctl status jenkins
```

## Docker 运维

```bash
# 查看日志
docker logs jenkins

# 进入容器
docker exec -it jenkins bash

# 备份数据
docker cp jenkins:/var/jenkins_home ./backup

# 恢复数据
docker cp ./backup jenkins:/var/jenkins_home
```

## 常见问题

### Q1: 启动失败

**解决方案：**
```bash
# 查看日志
docker logs jenkins

# 或
sudo journalctl -u jenkins -n 50
```

### Q2: 端口被占用

**解决方案：**
```bash
# 更改端口
# /etc/default/jenkins
HTTP_PORT=8081
```

### Q3: 内存不足

**解决方案：**
```bash
# 增加内存
# /etc/default/jenkins
JAVA_ARGS="-Xmx2048m"
```

## 下一步

- [Jenkins 使用手册](./3.使用手册.md) - 学习 Jenkins Pipeline
- [Jenkins 常见问题](./4.常见问题.md) - 解答常见问题
- 官方文档：https://www.jenkins.io/zh/doc/
