# JUnit Usage Guide

This guide covers how to write effective unit tests using JUnit 5 (Jupiter).

## Basic Test Structure

### Simple Test Class

```java
package com.example;

import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class MyFirstTest {
    
    @Test
    void simpleTest() {
        // Arrange - Set up test data
        int a = 1;
        int b = 2;
        
        // Act - Perform the action
        int result = a + b;
        
        // Assert - Verify the result
        assertEquals(3, result);
    }
    
    @Test
    void anotherTest() {
        assertEquals(4, 2 + 2, "Optional assertion message");
    }
}
```

### Test File Location

```
src/
├── main/
│   └── java/
│       └── com/example/
│           └── Calculator.java
└── test/
    └── java/
        └── com/example/
            └── CalculatorTest.java
```

## Assertions

JUnit 5 provides a comprehensive assertions API in `org.junit.jupiter.api.Assertions`.

### Common Assertions

```java
import static org.junit.jupiter.api.Assertions.*;

// Equality assertions
@Test
void equalityTests() {
    assertEquals(expected, actual);
    assertEquals(expected, actual, "Message");
    assertEquals(expected, actual, () -> "Lazy message");
    
    // With delta for floating point
    assertEquals(0.01, 3.5, 0.1);
    
    // Not equal
    assertNotEquals(expected, actual);
}

// Boolean assertions
@Test
void booleanTests() {
    assertTrue(condition);
    assertTrue(condition, "Message");
    assertTrue(() -> condition, () -> "Lazy message");
    
    assertFalse(condition);
}

// Null assertions
@Test
void nullTests() {
    assertNull(object);
    assertNotNull(object);
    
    // Identity
    assertSame(obj1, obj2);
    assertNotSame(obj1, obj2);
}

// Array assertions
@Test
void arrayTests() {
    assertArrayEquals(expectedArray, actualArray);
    assertArrayEquals(expectedArray, actualArray, "Message");
}

// Throwable assertions
@Test
void exceptionTests() {
    // Assert exception is thrown
    assertThrows(RuntimeException.class, () -> {
        throw new RuntimeException("Test exception");
    });
    
    // Assert exception message
    Exception exception = assertThrows(IllegalArgumentException.class, () -> {
        throw new IllegalArgumentException("Invalid input");
    });
    assertEquals("Invalid input", exception.getMessage());
    
    // Assert no exception thrown
    assertDoesNotThrow(() -> {
        // Code that should not throw
    });
}

// Combined assertions
@Test
void combinedAssertions() {
    // Execute multiple assertions
    assertAll("User validation",
        () -> assertNotNull(user),
        () -> assertEquals("John", user.getName()),
        () -> assertTrue(user.getAge() >= 18)
    );
}
```

### AssertJ-style Soft Assertions

```java
@Test
void softAssertionsTest() {
    SoftAssertions softly = new SoftAssertions();
    
    softly.assertThat(user.getName()).isEqualTo("John");
    softly.assertThat(user.getAge()).isGreaterThan(18);
    softly.assertThat(user.getEmail()).contains("@");
    
    softly.assertAll();
}
```

### Custom Assertions

```java
@Test
void customAssertion() {
    assertTrue(isValidEmail(email), "Invalid email format");
}

private boolean isValidEmail(String email) {
    return email != null && email.matches("^[A-Za-z0-9+_.-]+@.+$");
}
```

## Test Lifecycle

### Before and After Methods

```java
class LifecycleTest {
    
    @BeforeAll
    static void beforeAll() {
        // Runs ONCE before all test methods
        // Must be static in regular classes
        System.out.println("Before All Tests");
    }
    
    @AfterAll
    static void afterAll() {
        // Runs ONCE after all test methods
        System.out.println("After All Tests");
    }
    
    @BeforeEach
    void beforeEach() {
        // Runs BEFORE each test method
        System.out.println("Before Each Test");
    }
    
    @AfterEach
    void afterEach() {
        // Runs AFTER each test method
        System.out.println("After Each Test");
    }
    
    @Test
    void test1() {
        System.out.println("Test 1");
    }
    
    @Test
    void test2() {
        System.out.println("Test 2");
    }
}
```

### Per-Class Lifecycle

```java
@TestInstance(Lifecycle.PER_CLASS)
class PerClassTest {
    
    private String resource;
    
    @BeforeAll
    void beforeAll() {
        // Can use non-static methods with PER_CLASS
        resource = "initialized";
    }
    
    @Test
    void test1() {
        assertNotNull(resource);
    }
    
    @Test
    void test2() {
        assertNotNull(resource);
    }
}
```

## Nested Tests

### Basic Nested Tests

```java
@Nested
class NestedTests {
    
    @Test
    void parentTest() {
        assertTrue(true);
    }
    
    @Nested
    class InnerClass {
        
        @Test
        void innerTest() {
            assertTrue(true);
        }
        
        @Nested
        class DeepNested {
            
            @Test
            void deepNestedTest() {
                assertTrue(true);
            }
        }
    }
}
```

### Nested with Shared State

```java
@Nested
class CalculatorTests {
    
    private Calculator calculator;
    
    @BeforeEach
    void setUp() {
        calculator = new Calculator();
    }
    
    @Nested
    class AdditionTests {
        
        @Test
        void testPositiveNumbers() {
            assertEquals(5, calculator.add(2, 3));
        }
        
        @Test
        void testNegativeNumbers() {
            assertEquals(-1, calculator.add(-2, 1));
        }
    }
    
    @Nested
    class DivisionTests {
        
        @Test
        void testNormalDivision() {
            assertEquals(2, calculator.divide(6, 3));
        }
        
        @Test
        void testDivisionByZero() {
            assertThrows(ArithmeticException.class, 
                () -> calculator.divide(1, 0));
        }
    }
}
```

## Parameterized Tests

### Value Source

```java
@ParameterizedTest
@ValueSource(ints = {1, 2, 3, 4, 5})
void isEven(int number) {
    assertTrue(number % 2 == 0, number + " should be even");
}

@ParameterizedTest
@ValueSource(strings = {"Hello", "World", "JUnit"})
void stringTests(String value) {
    assertNotNull(value);
    assertTrue(value.length() > 0);
}
```

### CSV Source

```java
@ParameterizedTest
@CsvSource({
    "1, 1, 2",
    "2, 3, 5",
    "10, 20, 30",
    "-1, -1, -2"
})
void addTest(int a, int b, int expected) {
    Calculator calc = new Calculator();
    assertEquals(expected, calc.add(a, b));
}

@ParameterizedTest
@CsvSource(value = {
    "admin@example.com, true",
    "user@example.com, true",
    "invalid, false"
})
void emailValidationTest(String email, boolean expected) {
    assertEquals(expected, isValidEmail(email));
}
```

### Method Source

```java
@ParameterizedTest
@MethodSource("provideArguments")
void methodSourceTest(String arg1, int arg2, boolean expected) {
    assertEquals(expected, arg1.length() == arg2);
}

static Stream<Arguments> provideArguments() {
    return Stream.of(
        Arguments.of("test", 4, true),
        Arguments.of("hello", 5, true),
        Arguments.of("ab", 3, false)
    );
}
```

### Enum Source

```java
@ParameterizedTest
@EnumSource(Month.class)
void monthTest(Month month) {
    assertNotNull(month);
}

@ParameterizedTest
@EnumSource(value = Month.class, names = {"JANUARY", "MARCH", "MAY", "JULY"})
void selectMonthsTest(Month month) {
    assertTrue(month.getValue() % 2 == 1);
}
```

### Null and Empty Sources

```java
@ParameterizedTest
@NullSource
void nullTest(String input) {
    assertNull(input);
}

@ParameterizedTest
@EmptySource
void emptyTest(String input) {
    assertTrue(input.isEmpty());
}

@ParameterizedTest
@NullAndEmptySource
void nullAndEmptyTest(String input) {
    assertTrue(input == null || input.isEmpty());
}
```

## Repeated Tests

```java
@RepeatedTest(10)
void repeatedTest(RepetitionInfo repetitionInfo) {
    System.out.println("Repetition " + 
        repetitionInfo.getCurrentRepetition());
    assertTrue(true);
}

@RepeatedTest(value = 5, name = "{displayName} - {currentRepetition}/{totalRepetitions}")
void customRepeatedTest() {
    assertTrue(true);
}
```

## Disabled Tests

```java
@Disabled("Not ready yet")
@Test
void disabledTest() {
    // Will not run
}

@Test
void conditionalTest() {
    assumeTrue(System.getProperty("os.name").contains("Windows"));
    // Only runs on Windows
}

@DisabledOnOs(OS.LINUX)
@Test
void notOnLinux() {
    // Won't run on Linux
}

@DisabledOnJre(JRE.JAVA_8)
@Test
void notOnJava8() {
    // Won't run on Java 8
}

@EnabledIfSystemProperty(named = "ENV", matches = "prod")
@Test
void onlyInProduction() {
    // Only runs when -DENV=prod
}
```

## Test Interfaces

### Default Methods in Interfaces

```java
interface TestInterface {
    
    @BeforeEach
    default void setUp() {
        System.out.println("Interface setup");
    }
    
    @Test
    default void commonTest() {
        assertTrue(true);
    }
}

class InterfaceTest implements TestInterface {
    
    @Test
    void ownTest() {
        assertTrue(true);
    }
}
```

### Shared Tests with Default Methods

```java
interface CalculatorTests {
    
    Calculator getCalculator();
    
    @Test
    default void testAddition() {
        assertEquals(4, getCalculator().add(2, 2));
    }
    
    @Test
    default void testSubtraction() {
        assertEquals(0, getCalculator().subtract(2, 2));
    }
}

class BasicCalculatorTest implements CalculatorTests {
    
    private Calculator calculator = new BasicCalculator();
    
    @Override
    public Calculator getCalculator() {
        return calculator;
    }
}
```

## Mocking with Mockito

### Basic Mockito

```java
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import static org.mockito.Mockito.*;

@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void testGetUserById() {
        // Arrange
        User mockUser = new User(1L, "John");
        when(userRepository.findById(1L)).thenReturn(Optional.of(mockUser));
        
        // Act
        User result = userService.getUserById(1L);
        
        // Assert
        assertNotNull(result);
        assertEquals("John", result.getName());
        verify(userRepository).findById(1L);
    }
    
    @Test
    void testSaveUser() {
        // Arrange
        User user = new User("John", "john@example.com");
        when(userRepository.save(any(User.class))).thenReturn(user);
        
        // Act
        User saved = userService.saveUser(user);
        
        // Assert
        assertNotNull(saved);
        verify(userRepository).save(user);
    }
}
```

### Argument Matchers

```java
@Test
void argumentMatchersTest() {
    // Any matcher
    when(userRepository.findById(any())).thenReturn(user);
    
    // Specific matchers
    when(userRepository.findByName(contains("John"))).thenReturn(user);
    
    // Argument capture
    ArgumentCaptor<User> captor = ArgumentCaptor.forClass(User.class);
    userService.saveUser(user);
    verify(userRepository).save(captor.capture());
    assertEquals("John", captor.getValue().getName());
}
```

### Mockito Annotations

```java
@ExtendWith(MockitoExtension.class)
class DetailedMockitoTest {
    
    @Mock
    private List<String> mockedList;
    
    @InjectMocks
    private Service service;
    
    @BeforeEach
    void init() {
        MockitoAnnotations.openMocks(this);
    }
    
    @Test
    void testMocking() {
        mockedList.add("one");
        verify(mockedList).add("one");
        assertEquals(1, mockedList.size());
    }
}
```

## Spring Boot Testing

### Unit Test

```java
@SpringBootTest
class MyServiceIntegrationTest {
    
    @Autowired
    private MyService myService;
    
    @Test
    void testService() {
        String result = myService.doSomething();
        assertNotNull(result);
    }
}
```

### Web Layer Test

```java
@WebMvcTest(MyController.class)
class MyControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private MyService myService;
    
    @Test
    void testEndpoint() throws Exception {
        when(myService.getData()).thenReturn("test data");
        
        mockMvc.perform(get("/api/data"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$").value("test data"));
    }
}
```

### Data Layer Test

```java
@DataJpaTest
class UserRepositoryTest {
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    void testFindByName() {
        entityManager.persist(new User("John", "john@example.com"));
        
        User user = userRepository.findByName("John");
        
        assertNotNull(user);
        assertEquals("John", user.getName());
    }
}
```

### Test Configuration

```java
@TestConfiguration
static class TestConfig {
    
    @Bean
    @Primary
    public MyService testMyService() {
        return mock(MyService.class);
    }
}

@SpringBootTest
class IntegrationTestWithConfig {
    
    @Autowired
    @Primary
    MyService myService;  // Will be the mock
    
    @Test
    void test() {
        // Uses mock
    }
}
```

## Test Execution

### Running Tests

```bash
# Run all tests
mvn test

# Run specific test class
mvn test -Dtest=MyTest

# Run specific test method
mvn test -Dtest=MyTest#myMethod

# Run tests matching pattern
mvn test -Dtest="*Test"

# Run with Gradle
./gradlew test

# Run specific test with Gradle
./gradlew test --tests "com.example.MyTest"

# Run tests with coverage
mvn test jacoco:report
```

### Test Categories

```java
interface SlowTests {}

interface FastTests {}

class MyTest implements FastTests {
    @Test
    void fastTest() {}
}

@Tag("slow")
class SlowTest {
    @Test
    void slowTest() {}
}
```

```bash
# Run only fast tests
mvn test -Dgroups=com.example.FastTests

# Exclude slow tests
mvn test -DexcludedGroups=com.example.SlowTests
```

## Best Practices

### Test Naming

```java
// Good - describes the scenario
@Test
void shouldReturnUserWhenValidIdProvided() {}

// Bad - unclear
@Test
void test1() {}
```

### Test Structure

```java
@Test
void shouldThrowExceptionWhenInvalidInput() {
    // Arrange
    Validator validator = new Validator();
    
    // Act & Assert
    assertThrows(IllegalArgumentException.class, () -> {
        validator.validate(null);
    });
}
```

### Avoid Test Interdependence

```java
// Bad - tests depend on each other
static int counter = 0;

@Test
void test1() {
    counter++;
    assertEquals(1, counter);
}

@Test
void test2() {
    assertEquals(1, counter); // Will fail if test1 doesn't run first
}

// Good - independent tests
@Test
void testAdd() {
    Calculator calc = new Calculator();
    assertEquals(5, calc.add(2, 3));
}

@Test
void testSubtract() {
    Calculator calc = new Calculator();
    assertEquals(1, calc.subtract(3, 2));
}
```

### Use Appropriate Assertions

```java
// Good - clear intent
assertTrue(user.isAdult());

// Less clear
assertEquals(true, user.isAdult());
```

### Keep Tests Fast

```java
// Avoid - slow operations in tests
@Test
void slowTest() {
    Thread.sleep(1000); // Don't do this
}

// Better - use mocks or test doubles
@Test
void fastTest() {
    when(slowService.getData()).thenReturn("test");
    // Test logic without waiting
}
```

## Test Organization

### Package Structure

```
src/test/java/
├── com/example/
│   ├── service/
│   │   ├── UserServiceTest.java
│   │   └── OrderServiceTest.java
│   ├── repository/
│   │   └── UserRepositoryTest.java
│   └── controller/
│       └── UserControllerTest.java
```

### Test Class Naming

| Production Class | Test Class |
|-----------------|-----------|
| UserService | UserServiceTest |
| UserRepository | UserRepositoryTest |
| UserController | UserControllerTest |

## Related Links

- [JUnit 5 Official Documentation](https://junit.org/junit5/docs/current/user/)
- [Mockito Documentation](https://site.mockito.org)
- [AssertJ Documentation](https://assertj.github.io)
- [Spring Testing Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html)
