# Yarn ğŸ§¶

## ä»€ä¹ˆæ˜¯ Yarnï¼Ÿ

Yarn æ˜¯ä¸€ä¸ªç”± Facebookï¼ˆç° Metaï¼‰å¼€å‘å¹¶ç»´æŠ¤çš„ JavaScript åŒ…ç®¡ç†å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„é¡¹ç›®ç®¡ç†è€…ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºç°ä»£ JavaScript å¼€å‘è€…æä¾›æ›´å¿«ã€æ›´å¯é ã€æ›´å®‰å…¨çš„ä¾èµ–ç®¡ç†ä½“éªŒã€‚æ— è®ºä½ æ˜¯åœ¨å¼€å‘ç®€å•çš„ä¸ªäººé¡¹ç›®ï¼Œè¿˜æ˜¯ç®¡ç†å¤æ‚çš„ä¼ä¸šçº§ monorepoï¼ŒYarn éƒ½èƒ½ä¸ºä½ æä¾›å‡ºè‰²çš„æ”¯æŒã€‚

Yarn æœ€åˆäº 2016 å¹´å‘å¸ƒï¼Œæ—¨åœ¨è§£å†³å½“æ—¶ npm çš„ä¸€äº›ç—›ç‚¹é—®é¢˜ï¼Œæ¯”å¦‚å®‰è£…é€Ÿåº¦æ…¢ã€ä¾èµ–ç‰ˆæœ¬ä¸ç¡®å®šç­‰ã€‚ç»è¿‡å¤šå¹´çš„å‘å±•ï¼ŒYarn å·²ç»ä»ä¸€ä¸ªå•çº¯çš„åŒ…ç®¡ç†å™¨æ¼”å˜æˆäº†ä¸€ä¸ªå®Œæ•´çš„ JavaScript é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œæä¾›äº†å·¥ä½œåŒºï¼ˆWorkspacesï¼‰ã€æ’ä»¶ç³»ç»Ÿã€Zero-Installs ç­‰ä¼—å¤šå¼ºå¤§åŠŸèƒ½ã€‚

### Yarn çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ

Yarn çš„å¼€å‘å›¢é˜Ÿå§‹ç»ˆåšæŒä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œè¿™äº›ç†å¿µè´¯ç©¿äº Yarn çš„æ¯ä¸€ä¸ªåŠŸèƒ½è®¾è®¡ä¸­ï¼š

**é€Ÿåº¦ä¼˜å…ˆ**ï¼šYarn é‡‡ç”¨å¹¶è¡Œä¸‹è½½å’Œæ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ä¾èµ–å®‰è£…é€Ÿåº¦ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒYarn çš„å®‰è£…é€Ÿåº¦æ¯” npm å¿«æ•°å€ï¼Œè¿™å¾—ç›Šäºå…¶ç‹¬ç‰¹çš„ç¦»çº¿ç¼“å­˜ç³»ç»Ÿå’Œå¹¶è¡Œå®‰è£…ç­–ç•¥ã€‚

**ç¡®å®šæ€§ä¿è¯**ï¼šYarn é€šè¿‡ yarn.lock æ–‡ä»¶ç²¾ç¡®è®°å½•æ¯ä¸ªä¾èµ–åŠå…¶åµŒå¥—ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼Œç¡®ä¿åœ¨ä¸åŒæœºå™¨ã€ä¸åŒæ—¶é—´ç‚¹è¿›è¡Œçš„å®‰è£…æ“ä½œèƒ½å¤Ÿå¾—åˆ°å®Œå…¨ä¸€è‡´çš„ç»“æœã€‚è¿™ç§ç¡®å®šæ€§æ˜¯å›¢é˜Ÿåä½œå’Œ CI/CD æµç¨‹ç¨³å®šæ€§çš„é‡è¦ä¿éšœã€‚

**å®‰å…¨æ€§å¢å¼º**ï¼šYarn åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šéªŒè¯æ¯ä¸ªåŒ…çš„æ ¡éªŒå’Œï¼Œç¡®ä¿ä¸‹è½½çš„åŒ…ä¸é¢„æœŸå®Œå…¨ä¸€è‡´ï¼Œé˜²æ­¢ä¾›åº”é“¾æ”»å‡»å’Œå®‰å…¨å¨èƒã€‚æ­¤å¤–ï¼ŒYarn è¿˜æä¾›äº†ç¡¬åŒ–æ¨¡å¼ï¼ˆHardened Modeï¼‰ï¼Œå¯ä»¥åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ£€æµ‹å¹¶é˜»æ­¢æ½œåœ¨çš„æ¶æ„ä»£ç ã€‚

**å¼€å‘è€…ä½“éªŒ**ï¼šYarn æ³¨é‡å¼€å‘è€…çš„ä½¿ç”¨ä½“éªŒï¼Œæä¾›äº†æ¸…æ™°çš„å‘½ä»¤è¡Œè¾“å‡ºã€äº¤äº’å¼æ›´æ–°ã€ä¸°å¯Œçš„æç¤ºä¿¡æ¯ç­‰åŠŸèƒ½ã€‚åŒæ—¶ï¼ŒYarn çš„æ’ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…æ ¹æ®é¡¹ç›®éœ€æ±‚è‡ªå®šä¹‰å’Œæ‰©å±•åŠŸèƒ½ã€‚

### Yarn ä¸å…¶ä»–åŒ…ç®¡ç†å™¨çš„å¯¹æ¯”

åœ¨ JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œä¸»è¦æœ‰ npmã€Yarn å’Œ pnpm ä¸‰ç§ä¸»æµçš„åŒ…ç®¡ç†å™¨ã€‚å®ƒä»¬å„æœ‰ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼š

**ä¸ npm çš„å¯¹æ¯”**ï¼šnpm æ˜¯ Node.js å®˜æ–¹çš„åŒ…ç®¡ç†å™¨ï¼Œæ‹¥æœ‰æœ€å¤§çš„ç”¨æˆ·åŸºç¡€å’Œæœ€ä¸°å¯Œçš„ç”Ÿæ€ã€‚Yarn åœ¨é€Ÿåº¦ã€ç¡®å®šæ€§å’Œç¦»çº¿æ”¯æŒæ–¹é¢ä¼˜äº npmï¼Œä½† npm è¿‘å¹´æ¥ä¹Ÿåœ¨ä¸æ–­æ”¹è¿›ã€‚npm çš„ package-lock.json æœºåˆ¶ä¸ Yarn çš„ yarn.lock ç±»ä¼¼ï¼Œéƒ½èƒ½ä¿è¯å®‰è£…çš„ç¡®å®šæ€§ã€‚

**ä¸ pnpm çš„å¯¹æ¯”**ï¼špnpm é‡‡ç”¨ç‹¬ç‰¹çš„ç¬¦å·é“¾æ¥ç­–ç•¥ï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç®¡ç†ç£ç›˜ç©ºé—´ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­ä¼˜åŠ¿æ˜æ˜¾ã€‚Yarn åœ¨åŠŸèƒ½ä¸°å¯Œåº¦å’Œç¤¾åŒºæ”¯æŒæ–¹é¢ç•¥æœ‰ä¼˜åŠ¿ï¼Œè€Œ pnpm åœ¨ç£ç›˜ç©ºé—´åˆ©ç”¨æ–¹é¢æ›´èƒœä¸€ç­¹ã€‚

### Yarn çš„ç‰ˆæœ¬ä½“ç³»

Yarn ç›®å‰æœ‰ä¸¤ä¸ªä¸»è¦ç‰ˆæœ¬åˆ†æ”¯ï¼š

**Yarn 1.xï¼ˆç»å…¸ç‰ˆï¼‰**ï¼šä¹Ÿç§°ä¸º Yarn Classicï¼Œæ˜¯æœ€åˆå‘å¸ƒçš„ç‰ˆæœ¬ï¼Œç›®å‰ä»åœ¨ç»´æŠ¤ä½†å·²ä¸å†æ·»åŠ æ–°åŠŸèƒ½ã€‚æœ€åä¸€ä¸ªç»å…¸ç‰ˆæ˜¯ 1.22.x ç³»åˆ—ã€‚

**Yarn 2.x åŠä»¥ä¸Šï¼ˆBerryï¼‰**ï¼šä¹Ÿç§°ä¸º Yarn Berryï¼Œæ˜¯å®Œå…¨é‡å†™çš„ç‰ˆæœ¬ï¼Œé‡‡ç”¨äº†æ–°çš„æ¶æ„è®¾è®¡ï¼Œæä¾›äº† PnPï¼ˆPlug'n'Playï¼‰æ¨¡å¼ã€æ›´å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿç­‰é«˜çº§åŠŸèƒ½ã€‚Yarn 4.x æ˜¯å½“å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚

### Yarn é€‚ç”¨çš„äººç¾¤å’Œåœºæ™¯

Yarn é€‚ç”¨äºå„ç§è§„æ¨¡çš„ JavaScript é¡¹ç›®ï¼š

**ä¸ªäººå¼€å‘è€…**ï¼šå¯¹äºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼ŒYarn çš„å¿«é€Ÿå®‰è£…å’Œæ¸…æ™°çš„å‘½ä»¤è¡Œè¾“å‡ºèƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘ä½“éªŒã€‚å…¶ç¦»çº¿ç¼“å­˜åŠŸèƒ½å¯¹äºç½‘ç»œç¯å¢ƒä¸ç¨³å®šçš„å¼€å‘è€…å°¤å…¶æœ‰ç”¨ã€‚

**å¼€æºé¡¹ç›®ç»´æŠ¤è€…**ï¼šYarn çš„å·¥ä½œåŒºåŠŸèƒ½ä½¿å¾—ç®¡ç†å¤šåŒ…é¡¹ç›®å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚å¼€å‘è€…å¯ä»¥åœ¨ä¸€ä¸ªä»“åº“ä¸­åŒæ—¶ç»´æŠ¤æ ¸å¿ƒåº“å’Œå‘¨è¾¹å·¥å…·ï¼Œæé«˜å¼€å‘å’Œå‘å¸ƒæ•ˆç‡ã€‚

**ä¼ä¸šå¼€å‘å›¢é˜Ÿ**ï¼šå¯¹äºä¼ä¸šå›¢é˜Ÿæ¥è¯´ï¼ŒYarn çš„ç¡®å®šæ€§å’Œå®‰å…¨æ€§å°¤ä¸ºé‡è¦ã€‚yarn.lock æ–‡ä»¶ç¡®ä¿å›¢é˜Ÿæˆå‘˜ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„ä¾èµ–ç‰ˆæœ¬ï¼Œé¿å…å› ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„å¥‡æ€ªé—®é¢˜ã€‚

**DevOps å’Œ CI/CD**ï¼šYarn çš„ç¡¬åŒ–æ¨¡å¼å’Œ Zero-Installs åŠŸèƒ½éå¸¸é€‚åˆè‡ªåŠ¨åŒ–æ„å»ºæµç¨‹ï¼Œèƒ½å¤Ÿæ˜¾è‘—ç¼©çŸ­ CI/CD æ„å»ºæ—¶é—´ã€‚

---

## Yarn çš„ä¸»è¦åŠŸèƒ½ç‰¹æ€§

### å·¥ä½œåŒºï¼ˆWorkspacesï¼‰

å·¥ä½œåŒºæ˜¯ Yarn æœ€å…·åˆ›æ–°æ€§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸€ä¸ªä»£ç ä»“åº“ä¸­ç®¡ç†å¤šä¸ªç›¸å…³çš„åŒ…ã€‚è¿™ä¸ªæ¦‚å¿µæºäº Lerna ç­‰å·¥å…·ï¼Œä½† Yarn æ˜¯ç¬¬ä¸€ä¸ªå°†å…¶åŸç”Ÿé›†æˆåˆ°æ ¸å¿ƒçš„åŒ…ç®¡ç†å™¨ã€‚

å·¥ä½œåŒºçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºç®€åŒ–äº†å¤šåŒ…é¡¹ç›®çš„ä¾èµ–ç®¡ç†ã€‚å½“ä½ æœ‰ä¸€ä¸ªæ ¸å¿ƒåº“å’Œå¤šä¸ªç›¸å…³å·¥å…·æˆ–æ’ä»¶æ—¶ï¼Œå·¥ä½œåŒºèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œé¿å…é‡å¤å®‰è£…ï¼Œç®€åŒ–å¼€å‘å’Œè°ƒè¯•æµç¨‹ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª UI ç»„ä»¶åº“ï¼Œæ ¸å¿ƒåŒ…ä½äº packages/core ç›®å½•ï¼Œå‘¨è¾¹ç»„ä»¶ä½äº packages/buttonã€packages/input ç­‰ç›®å½•ã€‚ä½¿ç”¨å·¥ä½œåŒºï¼Œä½ å¯ä»¥åœ¨æ ¹ç›®å½•ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¾èµ–ï¼Œè€ŒåŒ…ä¹‹é—´å¯ä»¥ç›¸äº’å¼•ç”¨è€Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚

**å·¥ä½œåŒºçš„å®é™…åº”ç”¨åœºæ™¯**ï¼š

å½“ä½ å¼€å‘ä¸€ä¸ªå¤§å‹å¼€æºé¡¹ç›®æ—¶ï¼Œé€šå¸¸ä¼šæœ‰æ ¸å¿ƒåº“ã€æ–‡æ¡£ç«™ç‚¹ã€æ„å»ºå·¥å…·ç­‰å¤šä¸ªç»„ä»¶ã€‚ä½¿ç”¨å·¥ä½œåŒºï¼Œä½ å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ï¼Œå…±äº«ä¾èµ–ï¼Œç»Ÿä¸€ç‰ˆæœ¬ï¼Œç®€åŒ– CI/CD æµç¨‹ã€‚å¾ˆå¤šçŸ¥åé¡¹ç›®å¦‚ Babelã€Jestã€React ç­‰éƒ½é‡‡ç”¨äº†è¿™ç§æ¨¡å¼ã€‚

**å·¥ä½œåŒºçš„é«˜çº§ç‰¹æ€§**ï¼š

Yarn è¿˜æä¾›äº†èšç„¦å®‰è£…ï¼ˆFocused Installï¼‰åŠŸèƒ½ï¼Œå…è®¸ä½ åªå®‰è£…ç‰¹å®šå·¥ä½œåŒºçš„ä¾èµ–ï¼Œè¿™å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´å¯ä»¥æ˜¾è‘—èŠ‚çœå®‰è£…æ—¶é—´ã€‚çº¦æŸï¼ˆConstraintsï¼‰åŠŸèƒ½åˆ™å…è®¸ä½ å®šä¹‰è§„åˆ™ï¼Œç¡®ä¿æ‰€æœ‰å·¥ä½œåŒºéµå¾ªä¸€è‡´çš„ä¾èµ–ç­–ç•¥ã€‚

### ç¦»çº¿ç¼“å­˜æœºåˆ¶

Yarn çš„ç¦»çº¿ç¼“å­˜æ˜¯å…¶æœ€å—æ¬¢è¿çš„åŠŸèƒ½ä¹‹ä¸€ã€‚å½“ä½ é¦–æ¬¡å®‰è£…æŸä¸ªåŒ…æ—¶ï¼ŒYarn ä¼šå°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ã€‚ä¹‹åæ— è®ºæ˜¯é‡æ–°å®‰è£…è¿˜æ˜¯æ–°é¡¹ç›®éœ€è¦åŒä¸€ç‰ˆæœ¬ï¼ŒYarn éƒ½å¯ä»¥ç›´æ¥ä»ç¼“å­˜è·å–ï¼Œæ— éœ€é‡æ–°ä¸‹è½½ã€‚

è¿™ç§æœºåˆ¶å¯¹äºä»¥ä¸‹åœºæ™¯ç‰¹åˆ«æœ‰ç”¨ï¼š

**æŒç»­å¼€å‘ç¯å¢ƒ**ï¼šåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œæˆ–ç½‘ç»œä¸ç¨³å®šçš„ç¯å¢ƒä¸‹å¼€å‘æ—¶ï¼Œç¦»çº¿ç¼“å­˜å¯ä»¥è®©ä½ åœ¨æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ç»§ç»­å·¥ä½œã€‚åªè¦æ›¾ç»å®‰è£…è¿‡çš„åŒ…ï¼Œéƒ½å¯ä»¥ä»å®¹ç¼“å­˜ä¸­è·å–ã€‚

**CI/CD æµæ°´çº¿**ï¼šåœ¨æŒç»­é›†æˆç¯å¢ƒä¸­ï¼Œç¦»çº¿ç¼“å­˜å¯ä»¥æ˜¾è‘—å‡å°‘ä¾èµ–ä¸‹è½½æ—¶é—´ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚

**å¤šé¡¹ç›®åä½œ**ï¼šå¦‚æœä½ åŒæ—¶å¼€å‘å¤šä¸ªé¡¹ç›®ï¼Œç›¸åŒç‰ˆæœ¬çš„ä¾èµ–åªéœ€è¦ä¸‹è½½ä¸€æ¬¡ï¼Œä¹‹åå°±å¯ä»¥å¤ç”¨ç¼“å­˜ã€‚

### å¹¶è¡Œå®‰è£…

ä¸ npm çš„ä¸²è¡Œå®‰è£…ä¸åŒï¼ŒYarn é»˜è®¤ä½¿ç”¨å¹¶è¡Œå®‰è£…ç­–ç•¥ï¼ŒåŒæ—¶ä¸‹è½½å¤šä¸ªåŒ…ã€‚è¿™ç§è®¾è®¡èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½ï¼Œæ˜¾è‘—ç¼©çŸ­å®‰è£…æ—¶é—´ã€‚

Yarn çš„å¹¶è¡Œå®‰è£…æ˜¯æ™ºèƒ½çš„ï¼šå®ƒä¼šåˆ†æä¾èµ–æ ‘ï¼Œç¡®å®šå“ªäº›åŒ…å¯ä»¥å¹¶è¡Œä¸‹è½½ï¼ŒåŒæ—¶ä¿è¯ä¾èµ–é¡ºåºæ­£ç¡®ã€‚å¯¹äºæœ‰å¤§é‡ä¾èµ–çš„é¡¹ç›®ï¼Œè¿™ç§ä¼˜åŒ–å¸¦æ¥çš„é€Ÿåº¦æå‡éå¸¸æ˜æ˜¾ã€‚

### ç¡¬åŒ–æ¨¡å¼ï¼ˆHardened Modeï¼‰

ç¡¬åŒ–æ¨¡å¼æ˜¯ Yarn ä¸ºä¼ä¸šçº§åº”ç”¨è®¾è®¡çš„å®‰å…¨ç‰¹æ€§ã€‚å½“å¯ç”¨æ­¤æ¨¡å¼åï¼Œå¦‚æœå®‰è£…è¿‡ç¨‹ä¸­æ£€æµ‹åˆ°ä»»ä½•ä¼šä¿®æ”¹ yarn.lock æ–‡ä»¶çš„æ“ä½œï¼ŒYarn ä¼šç«‹å³æŠ¥é”™å¹¶é€€å‡ºã€‚

è¿™ä¸ªåŠŸèƒ½ä¸»è¦ç”¨äº CI/CD ç¯å¢ƒï¼Œç¡®ä¿åªæœ‰ç»è¿‡éªŒè¯çš„ä¾èµ–å˜æ›´æ‰èƒ½è¿›å…¥ä»£ç åº“ã€‚å®ƒé˜²æ­¢äº†å› æ„å¤–ä¿®æ”¹å¯¼è‡´çš„ä¾èµ–ä¸ä¸€è‡´é—®é¢˜ï¼Œæé«˜äº†ä¾›åº”é“¾å®‰å…¨æ€§ã€‚

### Zero-Installsï¼ˆé›¶å®‰è£…ï¼‰

Zero-Installs æ˜¯ Yarn 4.x å¼•å…¥çš„é©å‘½æ€§åŠŸèƒ½ã€‚ä¼ ç»Ÿä¸Šï¼Œæ¯æ¬¡å…‹éš†é¡¹ç›®æˆ–åˆ‡æ¢åˆ†æ”¯åéƒ½éœ€è¦è¿è¡Œ yarn install æ¥å®‰è£…ä¾èµ–ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨å¤§é¡¹ç›®ä¸­å¯èƒ½è€—æ—¶æ•°åˆ†é’Ÿã€‚

Zero-Installs é€šè¿‡å°†ä¾èµ–ä¿¡æ¯ç›´æ¥æäº¤åˆ°ä»£ç åº“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Yarn ä¼šç”Ÿæˆä¸€ä¸ª .pnp.cjs æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰ä¾èµ–çš„ä½ç½®ä¿¡æ¯ã€‚åŒæ—¶ï¼ŒYarn çš„å…¨å±€ç¼“å­˜å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç›®å½•æäº¤ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå…‹éš†é¡¹ç›®åæ— éœ€è¿è¡Œå®‰è£…å‘½ä»¤ï¼Œæ‰€æœ‰ä¾èµ–ç«‹å³å¯ç”¨ã€‚è¿™å¯¹äºå¤§å‹å›¢é˜Ÿå’Œé¢‘ç¹åˆ‡æ¢åˆ†æ”¯çš„å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ç”Ÿäº§åŠ›æå‡ã€‚

### æ’ä»¶ç³»ç»Ÿ

Yarn çš„æ’ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…æ‰©å±•å’Œè‡ªå®šä¹‰ Yarn çš„åŠŸèƒ½ã€‚å®˜æ–¹æä¾›äº†å¤šç§æ’ä»¶ï¼Œè¦†ç›–äº†æ‰“åŒ…ã€å‘å¸ƒã€ç‰ˆæœ¬ç®¡ç†ç­‰åœºæ™¯ã€‚

ç¤¾åŒºä¹Ÿå¼€å‘äº†è®¸å¤šæœ‰ç”¨çš„æ’ä»¶ï¼Œæ¯”å¦‚æ”¯æŒç‰¹å®šæ³¨å†Œè¡¨ã€é›†æˆå„ç§ CI å·¥å…·ç­‰ã€‚å¦‚æœä½ æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè¿˜å¯ä»¥å¼€å‘è‡ªå®šä¹‰æ’ä»¶æ¥æ»¡è¶³é¡¹ç›®è¦æ±‚ã€‚

### äº¤äº’å¼æ›´æ–°

Yarn æä¾›äº†äº¤äº’å¼æ›´æ–°æ¨¡å¼ï¼ˆyarn up -iï¼‰ï¼Œå¯ä»¥è®©ä½ åœ¨ç»ˆç«¯ä¸­ç›´è§‚åœ°é€‰æ‹©è¦æ›´æ–°çš„åŒ…åŠå…¶ç‰ˆæœ¬ã€‚è¿™ä¸ªåŠŸèƒ½ç»“åˆäº†çµæ´»æ€§ä¸ä¾¿åˆ©æ€§ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦è°¨æ…å¤„ç†ä¾èµ–æ›´æ–°çš„åœºæ™¯ã€‚

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

åœ¨å®‰è£… Yarn ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

**Node.js ç‰ˆæœ¬è¦æ±‚**ï¼š

- Yarn 4.x éœ€è¦ Node.js 16.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Yarn 3.x éœ€è¦ Node.js 14.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Yarn 1.x éœ€è¦ Node.js 8.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬

æ¨èä½¿ç”¨ Node.js 18 LTS æˆ– 20 LTS ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬æä¾›äº†æœ€ä½³çš„æ€§èƒ½å’Œç¨³å®šæ€§æ”¯æŒã€‚

**æ“ä½œç³»ç»Ÿæ”¯æŒ**ï¼š

Yarn æ”¯æŒæ‰€æœ‰ä¸»æµæ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ macOSã€Linuxï¼ˆå„ç§å‘è¡Œç‰ˆï¼‰å’Œ Windowsã€‚åœ¨ Windows ä¸Šï¼Œæ¨èä½¿ç”¨ PowerShell æˆ– WSL2 ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚

### å®‰è£… Yarn

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Corepackï¼ˆæ¨èï¼‰

Corepack æ˜¯ Node.js 14.6.0 åŠä»¥ä¸Šç‰ˆæœ¬å†…ç½®çš„åŒ…ç®¡ç†å™¨ç®¡ç†å™¨ã€‚å®ƒå…è®¸ä½ åœ¨é¡¹ç›®çº§åˆ«ç®¡ç† Yarn ç‰ˆæœ¬ï¼Œè€Œä¸éœ€è¦å…¨å±€å®‰è£…ã€‚

é¦–å…ˆå¯ç”¨ Corepackï¼š

```bash
corepack enable
```

ç„¶åå®‰è£…å¹¶æ¿€æ´» Yarn ç¨³å®šç‰ˆï¼š

```bash
corepack prepare yarn@stable --activate
```

å¦‚æœä½ éœ€è¦ç‰¹å®šç‰ˆæœ¬ï¼š

```bash
# å®‰è£… Yarn 4.x
corepack prepare yarn@4.0.0 --activate

# å®‰è£… Yarn 3.x
corepack prepare yarn@3.6.0 --activate
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨ npm å…¨å±€å®‰è£…

å¦‚æœä½ æ›´å–œæ¬¢ä¼ ç»Ÿçš„å…¨å±€å®‰è£…æ–¹å¼ï¼š

```bash
npm install -g yarn
```

#### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨è„šæœ¬å®‰è£…ï¼ˆmacOS/Linuxï¼‰

å®˜æ–¹æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„å®‰è£…è„šæœ¬ï¼š

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash
```

å¦‚æœä½ éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼š

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 4.0.0
```

#### æ–¹æ³•å››ï¼šä½¿ç”¨ PowerShell å®‰è£…ï¼ˆWindowsï¼‰

åœ¨ Windows ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ PowerShell å®‰è£…ï¼š

```powershell
iwr -useb https://yarnpkg.com/install.ps1 | iex
```

### éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼ŒéªŒè¯ Yarn æ˜¯å¦æ­£ç¡®å®‰è£…ï¼š

```bash
# æŸ¥çœ‹ç‰ˆæœ¬
yarn --version

# æŸ¥çœ‹å¸®åŠ©
yarn --help
```

### åˆå§‹åŒ–æ–°é¡¹ç›®

å¦‚æœä½ è¦ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š

```bash
# äº¤äº’å¼åˆå§‹åŒ–ï¼Œä¼šå¼•å¯¼ä½ å¡«å†™é¡¹ç›®ä¿¡æ¯
yarn init -2

# æˆ–è€…éäº¤äº’å¼ï¼Œå¿«é€Ÿåˆ›å»º
yarn init -y
```

è¿™ä¸ªå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª package.json æ–‡ä»¶ã€‚

### å®‰è£…é¡¹ç›®ä¾èµ–

å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªåŒ…å« package.json çš„é¡¹ç›®ï¼š

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
yarn install

# æˆ–è€…ç®€å†™
yarn
```

Yarn ä¼šè‡ªåŠ¨è¯»å– package.json å’Œ yarn.lockï¼ˆå¦‚æœ‰ï¼‰ï¼Œå®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–ã€‚

---

## å¸¸ç”¨å‘½ä»¤è¯¦è§£

### ä¾èµ–ç®¡ç†å‘½ä»¤

#### æ·»åŠ ä¾èµ–

æ·»åŠ ä¾èµ–æ˜¯æœ€å¸¸ç”¨çš„æ“ä½œä¹‹ä¸€ï¼š

```bash
# æ·»åŠ æ­£å¼ä¾èµ–ï¼ˆè¿è¡Œæ—¶éœ€è¦ï¼‰
yarn add lodash

# æ·»åŠ å¼€å‘ä¾èµ–ï¼ˆä»…å¼€å‘æ—¶éœ€è¦ï¼‰
yarn add -D typescript
yarn add --dev typescript

# æ·»åŠ ç‰¹å®šç‰ˆæœ¬çš„åŒ…
yarn add lodash@4.17.21

# æ·»åŠ æœ€æ–°ç‰ˆæœ¬
yarn add lodash@latest

# æ·»åŠ é¢„å‘å¸ƒç‰ˆæœ¬
yarn add lodash@beta
```

Yarn ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ä¿®é¥°ç¬¦ã€‚é»˜è®¤ä½¿ç”¨è„±å­—ç¬¦ï¼ˆ^ï¼‰ï¼Œè¡¨ç¤ºå…è®¸æ›´æ–°åˆ°æ¬¡ç‰ˆæœ¬ã€‚ä¾‹å¦‚ ^4.17.21 å…è®¸å®‰è£… 4.18.0 ä½†ä¸å…è®¸ 5.0.0ã€‚

**ç‰ˆæœ¬ä¿®é¥°ç¬¦é€‰é¡¹**ï¼š

- `-E, --exact`ï¼šä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ï¼Œä¸æ·»åŠ ä»»ä½•ä¿®é¥°ç¬¦
- `-T, --tilde`ï¼šä½¿ç”¨æ³¢æµªå·ä¿®é¥°ç¬¦ï¼Œå…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–°
- `-C, --caret`ï¼šä½¿ç”¨è„±å­—ç¬¦ä¿®é¥°ç¬¦ï¼ˆé»˜è®¤ï¼‰

```bash
# ç²¾ç¡®ç‰ˆæœ¬
yarn add -E lodash@4.17.21

# æ³¢æµªå·ç‰ˆæœ¬
yarn add -T lodash@4.17.21
```

#### ç§»é™¤ä¾èµ–

```bash
# ç§»é™¤ä¾èµ–
yarn remove lodash

# ç§»é™¤å¼€å‘ä¾èµ–
yarn remove typescript --dev
```

#### æ›´æ–°ä¾èµ–

```bash
# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
yarn up lodash
yarn upgrade lodash

# æ›´æ–°åˆ°ç‰¹å®šç‰ˆæœ¬
yarn up lodash@4.17.20

# äº¤äº’å¼æ›´æ–°ï¼ˆä¼šæ˜¾ç¤ºå¯ç”¨ç‰ˆæœ¬åˆ—è¡¨ï¼‰
yarn up -i

# æ›´æ–°æ‰€æœ‰ä¾èµ–
yarn up --all
```

### è„šæœ¬è¿è¡Œå‘½ä»¤

åœ¨ package.json çš„ scripts å­—æ®µä¸­å®šä¹‰çš„è„šæœ¬å¯ä»¥é€šè¿‡ yarn è¿è¡Œï¼š

```bash
# è¿è¡Œ package.json ä¸­å®šä¹‰çš„è„šæœ¬
yarn dev
yarn build
yarn test

# æˆ–è€…æ˜¾å¼ä½¿ç”¨ run å‘½ä»¤
yarn run dev
yarn run build
```

å¦‚æœè„šæœ¬åç§°ä¸ Yarn å†…ç½®å‘½ä»¤å†²çªï¼Œå¯ä»¥ä½¿ç”¨ run æ˜¾å¼è°ƒç”¨ï¼š

```bash
yarn run my-custom-script
```

### æŸ¥çœ‹ä¾èµ–ä¿¡æ¯

```bash
# åˆ—å‡ºæ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬åµŒå¥—ä¾èµ–ï¼‰
yarn list

# åªåˆ—å‡ºé¡¶å±‚ä¾èµ–
yarn list --level=0

# æ ‘å½¢æ˜¾ç¤ºä¾èµ–
yarn list --tree

# æ£€æŸ¥å“ªäº›ä¾èµ–æœ‰è¿‡æ—¶ç‰ˆæœ¬
yarn outdated

# æŸ¥çœ‹åŒ…ä¿¡æ¯
yarn info lodash

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬çš„åŒ…ä¿¡æ¯
yarn info lodash@4.17.21

# æŸ¥çœ‹ä¸ºä»€ä¹ˆå®‰è£…äº†æŸä¸ªåŒ…
yarn why lodash
```

### ç¼“å­˜ç®¡ç†

```bash
# æŸ¥çœ‹ç¼“å­˜ç›®å½•
yarn cache dir

# åˆ—å‡ºç¼“å­˜çš„åŒ…
yarn cache list

# æ¸…ç†ç¼“å­˜
yarn cache clean

# æ¸…ç†ç‰¹å®šåŒ…çš„ç¼“å­˜
yarn cache clean lodash
```

### å…¨å±€æ“ä½œ

```bash
# å…¨å±€å®‰è£…åŒ…
yarn global add yarn

# æŸ¥çœ‹å…¨å±€ bin ç›®å½•
yarn global bin
```

### å…¶ä»–å¸¸ç”¨å‘½ä»¤

```bash
# è¯Šæ–­é—®é¢˜
yarn doctor

# è§£é‡Šé”™è¯¯ç 
yarn explain E110

# åˆ—å‡ºå¯ç”¨è„šæœ¬
yarn run

# åœ¨ä¸´æ—¶ç¯å¢ƒè¿è¡ŒåŒ…
yarn dlx create-react-app my-app
```

---

## å·¥ä½œåŒºï¼ˆWorkspacesï¼‰å®Œå…¨æŒ‡å—

### ä»€ä¹ˆæ˜¯å·¥ä½œåŒºï¼Ÿ

å·¥ä½œåŒºæ˜¯ä¸€ç§é¡¹ç›®ç®¡ç†æ¨¡å¼ï¼Œå…è®¸ä½ åœ¨å•ä¸ªä»£ç ä»“åº“ä¸­ç»„ç»‡å¤šä¸ªç›¸å…³çš„åŒ…ã€‚Yarn æ˜¯ç¬¬ä¸€ä¸ªåŸç”Ÿæ”¯æŒå·¥ä½œåŒºçš„ JavaScript åŒ…ç®¡ç†å™¨ï¼Œè¿™ä¸ªåŠŸèƒ½å½»åº•æ”¹å˜äº†å¤§å‹é¡¹ç›®çš„å¼€å‘æ–¹å¼ã€‚

è€ƒè™‘è¿™æ ·çš„åœºæ™¯ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª UI ç»„ä»¶åº“ï¼Œæ ¸å¿ƒåŠŸèƒ½åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå‡ åä¸ªç‹¬ç«‹ç»„ä»¶åœ¨å¦å¤–çš„åŒ…ä¸­ï¼Œæ–‡æ¡£ç«™ç‚¹åˆæ˜¯å•ç‹¬ä¸€ä¸ªåŒ…ã€‚åœ¨æ²¡æœ‰å·¥ä½œåŒºä¹‹å‰ï¼Œä½ éœ€è¦æ‰‹åŠ¨ç®¡ç†è¿™äº›åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦å‘å¸ƒæ–°ç‰ˆæœ¬æ‰èƒ½åœ¨å…¶ä»–åŒ…ä¸­æµ‹è¯•ã€‚

æœ‰äº†å·¥ä½œåŒºï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰åŒ…æ”¾åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥ç›´æ¥ç›¸äº’å¼•ç”¨ï¼Œä¿®æ”¹ç«‹å³ç”Ÿæ•ˆã€‚è¿™æå¤§åœ°ç®€åŒ–äº†å¼€å‘å’Œè°ƒè¯•æµç¨‹ã€‚

### é…ç½®å·¥ä½œåŒº

åœ¨å·¥ä½œåŒºæ ¹ç›®å½•çš„ package.json ä¸­æ·»åŠ  workspaces å­—æ®µï¼š

```json
{
  "name": "my-monorepo",
  "private": true,
  "workspaces": [
    "packages/*"
  ]
}
```

workspaces å­—æ®µæ¥å—ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„æ¨¡å¼ã€‚ä¸Šé¢çš„é…ç½®è¡¨ç¤º packages ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•éƒ½å°†æˆä¸ºç‹¬ç«‹çš„å·¥ä½œåŒºã€‚

æ›´å¤æ‚çš„é…ç½®ç¤ºä¾‹ï¼š

```json
{
  "workspaces": [
    "packages/*",
    "apps/*",
    "tools/*"
  ]
}
```

### å·¥ä½œåŒºåŒ…çš„ç»“æ„

æ¯ä¸ªå·¥ä½œåŒºæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ npm åŒ…ï¼Œæœ‰è‡ªå·±çš„ package.jsonï¼š

```
my-monorepo/
â”œâ”€â”€ package.json          # æ ¹ package.jsonï¼Œå®šä¹‰å·¥ä½œåŒº
â””â”€â”€ packages/
    â”œâ”€â”€ core/            # ç¬¬ä¸€ä¸ªå·¥ä½œåŒº
    â”‚   â”œâ”€â”€ package.json
    â”‚   â””â”€â”€ src/
    â”œâ”€â”€ button/         # ç¬¬äºŒä¸ªå·¥ä½œåŒº
    â”‚   â”œâ”€â”€ package.json
    â”‚   â””â”€â”€ src/
    â””â”€â”€ input/           # ç¬¬ä¸‰ä¸ªå·¥ä½œåŒº
        â”œâ”€â”€ package.json
        â””â”€â”€ src/
```

### å·¥ä½œåŒºä¹‹é—´çš„ä¾èµ–å¼•ç”¨

åœ¨å·¥ä½œåŒºä¹‹é—´å¼•ç”¨åŒ…æ—¶ï¼Œä½¿ç”¨ workspace: åè®®ï¼š

```json
{
  "dependencies": {
    "@my-org/core": "workspace:*",
    "@my-org/utils": "workspace:^",
    "@my-org/constants": "workspace:~"
  }
}
```

- workspace:* ä½¿ç”¨ç¡®åˆ‡çš„æœ¬åœ°ç‰ˆæœ¬
- workspace:^ ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„å…¼å®¹ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
- workspace:~ ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„è¡¥ä¸èŒƒå›´

å½“å‘å¸ƒåŒ…æ—¶ï¼ŒYarn ä¼šè‡ªåŠ¨å°† workspace: åè®®è½¬æ¢ä¸ºå®é™…çš„ç‰ˆæœ¬å·ã€‚

### å·¥ä½œåŒºä¸“ç”¨å‘½ä»¤

```bash
# åœ¨ç‰¹å®šå·¥ä½œåŒºæ·»åŠ ä¾èµ–
yarn workspace @my-org/button add lodash

# åœ¨ç‰¹å®šå·¥ä½œåŒºè¿è¡Œè„šæœ¬
yarn workspace @my-org/button run build

# åœ¨æ‰€æœ‰å·¥ä½œåŒºè¿è¡Œå‘½ä»¤
yarn workspaces foreach run build

# èšç„¦å®‰è£…ï¼ˆåªå®‰è£…æŒ‡å®šå·¥ä½œåŒºåŠå…¶ä¾èµ–ï¼‰
yarn workspaces focus @my-org/button

# åˆ—å‡ºæ‰€æœ‰å·¥ä½œåŒº
yarn workspaces list

# åœ¨æ‰€æœ‰å·¥ä½œåŒºè¿è¡Œå¹¶æ˜¾ç¤ºè¿›åº¦
yarn workspaces foreach -pt run build
```

### é«˜çº§å·¥ä½œåŒºç‰¹æ€§

**çº¦æŸï¼ˆConstraintsï¼‰**ï¼šçº¦æŸåŠŸèƒ½å…è®¸ä½ å®šä¹‰è§„åˆ™æ¥ç®¡ç†æ‰€æœ‰å·¥ä½œåŒºã€‚ä¾‹å¦‚ï¼Œç¡®ä¿æ‰€æœ‰å·¥ä½œåŒºä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ TypeScriptï¼š

```javascript
// constraints.pro
workspaces.forEach(workspace => {
  const ts = workspace.dependencies.get("typescript");
  if (ts && ts.version !== "^5.0.0") {
    workspace.dependencies.set("typescript", "workspace:^5.0.0");
  }
});
```

**å…¨å±€è„šæœ¬**ï¼šåœ¨è„šæœ¬åç§°ä¸­ä½¿ç”¨å†’å·ï¼ˆ:ï¼‰å¯ä»¥åˆ›å»ºå…¨å±€è„šæœ¬ï¼Œä»é¡¹ç›®ä»»æ„ä½ç½®è¿è¡Œï¼š

```json
{
  "scripts": {
    "build:all": "yarn workspaces foreach -pt run build"
  }
}
```

è¿è¡Œæ–¹å¼ï¼š

```bash
yarn build:all
```

---

## é…ç½®æ–‡ä»¶è¯¦è§£

### package.json è¯¦è§£

package.json æ˜¯ Node.js é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ŒYarn å®Œå…¨å…¼å®¹ npm çš„æ ‡å‡†ï¼š

```json
{
  "name": "my-project",
  "version": "1.0.0",
  "description": "æˆ‘çš„é¡¹ç›®æè¿°",
  "private": true,
  "workspaces": ["packages/*"],
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "test": "vitest",
    "lint": "eslint src --ext .ts,.tsx"
  },
  "dependencies": {
    "react": "^18.2.0",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "vite": "^5.0.0",
    "@types/react": "^18.2.0"
  },
  "peerDependencies": {
    "react": ">=16.8.0"
  },
  "optionalDependencies": {
    "fsevents": "^2.3.0"
  },
  "engines": {
    "node": ">=18.0.0"
  },
  "packageManager": "yarn@4.0.0"
}
```

**ä¸»è¦å­—æ®µè¯´æ˜**ï¼š

- nameï¼šåŒ…åï¼Œå¿…é¡»å”¯ä¸€
- versionï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬å·
- privateï¼šè®¾ä¸º true é˜²æ­¢æ„å¤–å‘å¸ƒåˆ° npm
- workspacesï¼šå®šä¹‰å·¥ä½œåŒº
- scriptsï¼šå®šä¹‰å¯è¿è¡Œè„šæœ¬
- dependenciesï¼šè¿è¡Œæ—¶ä¾èµ–
- devDependenciesï¼šå¼€å‘æ—¶ä¾èµ–
- peerDependenciesï¼šå¯¹ç­‰ä¾èµ–
- optionalDependenciesï¼šå¯é€‰ä¾èµ–
- packageManagerï¼šæŒ‡å®šé¡¹ç›®ä½¿ç”¨çš„ Yarn ç‰ˆæœ¬

### .yarnrc.yml é…ç½®

Yarn 4.x ä½¿ç”¨ .yaml æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼š

```yaml
# npm æ³¨å†Œè¡¨
npmRegistryServer: "https://registry.npmjs.org"

# å¯ç”¨å…¨å±€ç¼“å­˜
enableGlobalCache: false

# Node.js é“¾æ¥å™¨æ¨¡å¼
# node-modulesï¼šä¼ ç»Ÿæ¨¡å¼
# pnpï¼šPlug'n'Play æ¨¡å¼
nodeLinker: node-modules

# å¯ç”¨è„šæœ¬
enableScripts: true

# å¯ç”¨å…¨å±€è¡¥ä¸
enableGlobalPatches: false

# ä¸å®‰å…¨çš„ HTTP ç™½åå•
unsafeHttpWhitelist:
  - "localhost"
  - "my-internal-registry.com"
```

### ç¯å¢ƒå˜é‡é…ç½®

ä½ å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®ï¼š

```bash
# è®¾ç½®æ³¨å†Œè¡¨
YARN_NPM_REGISTRY_SERVER=https://registry.npmmirror.com yarn install
```

---

## æ’ä»¶ç³»ç»Ÿ

### æ’ä»¶ç®€ä»‹

Yarn çš„æ’ä»¶ç³»ç»Ÿæ˜¯å…¶æœ€å…·æ‰©å±•æ€§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚æ’ä»¶å¯ä»¥æ·»åŠ æ–°çš„å‘½ä»¤ã€ä¿®æ”¹ç°æœ‰è¡Œä¸ºã€é›†æˆå¤–éƒ¨æœåŠ¡ç­‰ã€‚

### å®˜æ–¹æ’ä»¶

Yarn 4.x å†…ç½®äº†ä¸€äº›æ ¸å¿ƒæ’ä»¶ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„å®˜æ–¹æ’ä»¶ï¼š

```bash
# åˆ—å‡ºå¯ç”¨æ’ä»¶
yarn plugin list
```

å¸¸ç”¨æ’ä»¶åŒ…æ‹¬ï¼š

- @yarnpkg/plugin-githubï¼šæ”¯æŒä» GitHub å®‰è£…åŒ…
- @yarnpkg/plugin-npmï¼šnpm ç›¸å…³åŠŸèƒ½
- @yarnpkg/plugin-packï¼šæ‰“åŒ…åŠŸèƒ½
- @yarnpkg/plugin-workspace-toolsï¼šå·¥ä½œåŒºå·¥å…·å¢å¼º

### å®‰è£…æ’ä»¶

```bash
# ä»å®˜æ–¹æ’ä»¶åˆ—è¡¨å®‰è£…
yarn plugin import @yarnpkg/plugin-github

# ä» URL å®‰è£…
yarn plugin import https://example.com/plugin.js

# ä»æœ¬åœ°æ–‡ä»¶å®‰è£…
yarn plugin import ./my-plugin.js
```

### ç§»é™¤æ’ä»¶

```bash
yarn plugin remove @yarnpkg/plugin-github
```

---

## æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ

å§‹ç»ˆå°† yarn.lock æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚è¿™ä¸ªæ–‡ä»¶è®°å½•äº†æ‰€æœ‰ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼Œæ˜¯ä¿è¯å›¢é˜Ÿæˆå‘˜å’Œ CI ç¯å¢ƒä½¿ç”¨ç›¸åŒä¾èµ–çš„å…³é”®ã€‚

### 2. CI/CD é›†æˆå»ºè®®

åœ¨æŒç»­é›†æˆç¯å¢ƒä¸­ï¼Œæ¨èä½¿ç”¨ç¡¬åŒ–æ¨¡å¼é˜²æ­¢æ„å¤–çš„é”æ–‡ä»¶ä¿®æ”¹ï¼š

```bash
yarn install --immutable
```

å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨ Zero-Installsï¼Œè¿˜åº”æ·»åŠ ç¼“å­˜éªŒè¯ï¼š

```bash
yarn install --immutable --immutable-cache
```

### 3. ä¾èµ–æ›´æ–°ç­–ç•¥

- å®šæœŸæ£€æŸ¥è¿‡æ—¶ä¾èµ–ï¼š`yarn outdated`
- ä½¿ç”¨äº¤äº’å¼æ›´æ–°è°¨æ…å¤„ç†ä¸»ç‰ˆæœ¬å‡çº§ï¼š`yarn up -i`
- å¤§ç‰ˆæœ¬å‡çº§å‰å…ˆé˜…è¯» changelog

### 4. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨å·¥ä½œåŒºé›†ä¸­ç®¡ç†ä¾èµ–
- åˆ©ç”¨èšç„¦å®‰è£…å‡å°‘å¤§å‹é¡¹ç›®çš„å®‰è£…æ—¶é—´
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜

### 5. å®‰å…¨å»ºè®®

- å®šæœŸè¿è¡Œå®‰å…¨å®¡è®¡ï¼š`yarn npm audit`
- å¯ç”¨ç¡¬åŒ–æ¨¡å¼
- ä½¿ç”¨ç§æœ‰æ³¨å†Œè¡¨æ—¶ç¡®ä¿ HTTPS
- å®¡æŸ¥ç¬¬ä¸‰æ–¹æ’ä»¶æ¥æº

---

## å¸¸è§é—®é¢˜è§£ç­”

### Yarn ä¸ npm å‘½ä»¤å¯¹æ¯”

å¾ˆå¤š npm å‘½ä»¤åœ¨ Yarn ä¸­æœ‰å¯¹åº”çš„å®ç°ï¼š

| npm å‘½ä»¤ | Yarn å‘½ä»¤ | è¯´æ˜ |
|---------|-----------|------|
| npm install | yarn | å®‰è£…ä¾èµ– |
| npm install \<pkg\> | yarn add \<pkg\> | æ·»åŠ ä¾èµ– |
| npm install -D \<pkg\> | yarn add -D \<pkg\> | æ·»åŠ å¼€å‘ä¾èµ– |
| npm uninstall \<pkg\> | yarn remove \<pkg\> | ç§»é™¤ä¾èµ– |
| npm update | yarn up | æ›´æ–°ä¾èµ– |
| npm run \<script\> | yarn \<script\> | è¿è¡Œè„šæœ¬ |
| npm list | yarn list | åˆ—å‡ºä¾èµ– |
| npm outdated | yarn outdated | æ£€æŸ¥è¿‡æ—¶ä¾èµ– |

### å®‰è£…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ¸…ç†ç¼“å­˜ï¼š`yarn cache clean`
2. åˆ é™¤ node_modules å’Œ yarn.lock
3. é‡æ–°å®‰è£…ï¼š`yarn install`

### å¦‚ä½•åˆ‡æ¢ Yarn ç‰ˆæœ¬ï¼Ÿ

ä½¿ç”¨ corepack è½»æ¾åˆ‡æ¢ç‰ˆæœ¬ï¼š

```bash
# åˆ‡æ¢åˆ°ç¨³å®šç‰ˆ
corepack prepare yarn@stable --activate

# åˆ‡æ¢åˆ°ç‰¹å®šç‰ˆæœ¬
corepack prepare yarn@3.6.0 --activate
```

### yarn.lock çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

yarn.lock è®°å½•äº†ä¾èµ–æ ‘ä¸­æ¯ä¸ªåŒ…çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¼ é€’ä¾èµ–ã€‚è¿™ç¡®ä¿äº†æ— è®ºåœ¨ä»€ä¹ˆç¯å¢ƒã€ä»€ä¹ˆæ—¶é—´å®‰è£…ï¼Œéƒ½ä¼šå¾—åˆ°å®Œå…¨ç›¸åŒçš„ç»“æœã€‚

### åº”è¯¥å°† node_modules åŠ å…¥ç‰ˆæœ¬æ§åˆ¶å—ï¼Ÿ

ä¸åº”è¯¥ã€‚node_modules åº”è¯¥é€šè¿‡ .gitignore å¿½ç•¥ï¼Œåªæäº¤ yarn.lock æ–‡ä»¶ã€‚

---

## ç›¸å…³èµ„æºé“¾æ¥

- å®˜æ–¹ç½‘ç«™ï¼šhttps://yarnpkg.com
- å®˜æ–¹æ–‡æ¡£ï¼šhttps://yarnpkg.com/docs
- GitHub ä»“åº“ï¼šhttps://github.com/yarnpkg/berry
- æ’ä»¶åˆ—è¡¨ï¼šhttps://yarnpkg.com/cli/plugin/list
- Discord ç¤¾åŒºï¼šhttps://discord.gg/yarn
