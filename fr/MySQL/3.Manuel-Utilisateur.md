# Manuel Utilisateur MySQL

Ce manuel fournit des instructions complètes pour utiliser MySQL efficacement.

---

## Opérations de base de données

### Créer une base de données

```sql
-- Créer une nouvelle base de données
CREATE DATABASE monapp;

-- Créer avec jeu de caractères
CREATE DATABASE monapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Afficher les bases de données
SHOW DATABASES;

-- Sélectionner une base de données
USE monapp;

-- Supprimer une base de données
DROP DATABASE monapp;
```

### Créer des tables

```sql
-- Création de table basique
CREATE TABLE utilisateurs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    mot_de_passe VARCHAR(255) NOT NULL,
    cree_le TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table avec clés étrangères
CREATE TABLE commandes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    utilisateur_id INT NOT NULL,
    total DECIMAL(10, 2) NOT NULL,
    statut ENUM('en_attente', 'en_cours', 'expédie', 'livré') DEFAULT 'en_attente',
utilisateur_id) REFERENCES utilisateurs(id)    FOREIGN KEY ( ON DELETE CASCADE
);
```

---

## Manipulation des données

### Insérer des données

```sql
-- Insérer une ligne
INSERT INTO utilisateurs (nom, email, mot_de_passe)
VALUES ('jean', 'jean@exemple.fr', 'hash_mdp');

-- Insérer plusieurs lignes
INSERT INTO utilisateurs (nom, email, mot_de_passe) VALUES
    ('alice', 'alice@exemple.fr', 'mdp1'),
    ('bob', 'bob@exemple.fr', 'mdp2');
```

### Mettre à jour les données

```sql
-- Mettre à jour une ligne
UPDATE utilisateurs SET mot_de_passe = 'nouveau_hash' WHERE id = 1;

-- Mettre à jour plusieurs lignes
UPDATE utilisateurs SET statut = 'actif' WHERE dernier_connexion > '2024-01-01';
```

### Supprimer des données

```sql
-- Supprimer une ligne
DELETE FROM utilisateurs WHERE id = 1;

-- Supprimer toutes les lignes
TRUNCATE TABLE utilisateurs;
```

---

## Interrogation des données

### SELECT basique

```sql
-- Sélectionner toutes les colonnes
SELECT * FROM utilisateurs;

-- Sélectionner des colonnes spécifiques
SELECT nom, email FROM utilisateurs;

-- Avec clause WHERE
SELECT * FROM utilisateurs WHERE statut = 'actif';

-- Avec ORDER BY
SELECT * FROM utilisateurs ORDER BY cree_le DESC;

-- Avec LIMIT
SELECT * FROM utilisateurs LIMIT 10;
```

### Opérations JOIN

```sql
-- INNER JOIN
SELECT c.id, u.nom, c.total
FROM commandes c
INNER JOIN utilisateurs u ON c.utilisateur_id = u.id;

-- LEFT JOIN
SELECT u.nom, c.id
FROM utilisateurs u
LEFT JOIN commandes c ON u.id = c.utilisateur_id;
```

### Fonctions d'agrégation

```sql
-- COUNT
SELECT COUNT(*) FROM utilisateurs;

-- SUM, AVG, MIN, MAX
SELECT SUM(montant) FROM commandes;
SELECT AVG(prix) FROM produits;

-- GROUP BY
SELECT pays, COUNT(*) as nb
FROM utilisateurs
GROUP BY pays
HAVING nb > 10;
```

---

## Gestion des utilisateurs

### Créer un utilisateur

```sql
-- Créer un utilisateur
CREATE USER 'jean'@'localhost' IDENTIFIED BY 'motdepasse123';

-- Créer un utilisateur avec privilèges spécifiques
CREATE USER 'app_utilisateur'@'%' IDENTIFIED BY 'motdepasse123';
GRANT SELECT, INSERT, UPDATE, DELETE ON monapp.* TO 'app_utilisateur'@'%';
```

### Gérer les privilèges

```sql
-- Accorder des privilèges
GRANT SELECT, INSERT ON monapp.* TO 'utilisateur'@'localhost';

-- Révoquer des privilèges
REVOKE INSERT ON monapp.* FROM 'utilisateur'@'localhost';

-- Afficher les privilèges
SHOW GRANTS FOR 'utilisateur'@'localhost';

-- Recharger les privilèges
FLUSH PRIVILEGES;
```

---

## Sauvegarde et restauration

### Sauvegarde

```bash
# Sauvegarder une base de données unique
mysqldump -u root -p monapp > monapp_sauvegarde.sql

# Sauvegarder toutes les bases de données
mysqldump -u root -p --all-databases > sauvegarde_complete.sql
```

### Restauration

```bash
# Restaurer depuis la sauvegarde
mysql -u root -p monapp < monapp_sauvegarde.sql
```

---

## Index

### Créer des index

```sql
-- Index sur une colonne
CREATE INDEX idx_email ON utilisateurs(email);

-- Index composé
CREATE INDEX idx_nom_date FROM utilisateurs(nom, prenom, cree_le);

-- Index unique
CREATE INDEX idx_nom_utilisateur ON utilisateurs(nom_utilisateur);
```

### Optimiser les requêtes

```sql
-- EXPLAIN - analyser la requête
EXPLAIN SELECT * FROM utilisateurs WHERE email = 'jean@exemple.fr';

-- Optimiser la table
OPTIMIZE TABLE utilisateurs;
```

---

## Réplication

### Réplication Master-Slave

**Configuration Master (my.cnf):**
```ini
[mysqld]
server-id=1
log-bin=mysql-bin
binlog-do-db=monapp
```

**Configuration Slave (my.cnf):**
```ini
[mysqld]
server-id=2
relay-log=relay-bin
read-only=1
```
