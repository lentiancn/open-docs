# APISIX 사용자 매뉴얼

APISIX 핵심 기능 및 사용 팁.

## 기본 개념

### 용어 정의

- **Route**: 요청 매칭 규칙 정의
- **Upstream**: 실제 백엔드 서비스
- **Service**: 라우트 컬렉션
- **Plugin**: 요청 처리 로직
- **Consumer**: API 소비자

### 요청 흐름

1. 클라이언트가 APISIX에 요청 전송
2. APISIX가 라우팅 규칙과 매칭
3. 플러그인 로직 실행
4. 업스트림 서비스로 전송
5 응답을 클라이언트에 반환

## 라우트 관리

### 라우트 생성

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "id": "1",
    "uri": "/api/users/*",
    "name": "user-api",
    "upstream": {
      "type": "roundrobin",
      "nodes": {"backend1.example.com:8080": 1}
    }
  }'
```

## 업스트림 관리

### 업스트림 생성

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/upstreams/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "type": "roundrobin",
    "nodes": {"host1:8080": 1, "host2:8080": 1}
  }'
```

## 플러그인

### 일반 플러그인

**트래픽 제어:**
- limit-req: 레이트 리밋
- limit-conn: 연결 수 제한

**인증:**
- jwt-auth: JWT 인증
- key-auth: 키 인증
- basic-auth: 기본 인증

### 레이트 리밋 플러그인 사용

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "uri": "/api/*",
    "plugins": {
      "limit-req": {
        "rate": 100,
        "burst": 50,
        "rejected_code": 503
      }
    }
  }'
```

### JWT 인증 사용

**1. Consumer 생성:**

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/consumers \
  -H "X-API-KEY: 123456" \
  -d '{
    "username": "john",
    "plugins": {
      "jwt-auth": {"key": "user-key", "secret": "my-secret"}
    }
  }'
```

**2. 라우트에서 활성화:**

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{"uri":"/api/*","plugins":{"jwt-auth":{}}}'
```

## 서비스 디스커버리

### Eureka

```json
{
  "service_discovery": {
    "type": "eureka",
    "eureka": {"host": ["http://127.0.0.1:8761"]}
  }
}
```

### Nacos

```json
{
  "service_discovery": {
    "type": "nacos",
    "nacos": {"host": ["http://127.0.0.1:8848"]}
  }
}
```

## 헬스 체크

```json
{
  "upstream": {
    "nodes": {"host1:8080": 1},
    "checks": {
      "active": {
        "type": "http",
        "http_path": "/health",
        "interval": 5
      }
    }
  }
}
```

## 베스트 프랙티스

1. Admin API 접근 제어 활성화
2. 강력한 키 사용
3. 헬스 체크 구성
4. 적절한 레이트 리밋 값 설정

### 디버깅

```bash
curl http://127.0.0.1:9180/apisix/admin/routes -H "X-API-KEY: 123456"
tail -f logs/error.log
```
