# FantasyTalking - Manual de Usuario

Guía detallada de uso y ejemplos.

## Uso Básico

### Generar video

```bash
python inference.py \
  --source_image face.jpg \
  --audio speech.wav \
  --output output.mp4
```

### Parámetros

| Parámetro | Abreviatura | Descripción | Valor predeterminado |
|-----------|-------------|-------------|---------------------|
| --source_image | -s | Ruta de imagen de entrada | Requerido |
| --audio | -a | Archivo de audio de entrada | Requerido |
| --output | -o | Ruta del video de salida | output.mp4 |
| --face_enhancer | -f | Modelo de mejora de rostro | None |
| --max_frames | -m | Frames máximos | 300 |
| --fps | -fps | FPS de salida | 25 |

### Ejemplo completo

```bash
python inference.py \
  --source_image photos/person1.jpg \
  --audio audio/speech.wav \
  --output results/video1.mp4 \
  --face_enhancer realusf \
  --fps 30
```

## Uso avanzado

### Python API

```python
from fantasytalking import FantasyTalking

# Inicializar modelo
ft = FantasyTalking(
    checkpoint_path="./models/checkpoint.pth",
    face_enhancer="realusf"
)

# Generar video
ft.generate(
    source_image="face.jpg",
    audio="speech.wav",
    output="output.mp4"
)
```

### Procesamiento por lotes

```python
import os
from fantasytalking import FantasyTalking

ft = FantasyTalking()

images_dir = "./images"
audio_dir = "./audio"
output_dir = "./output"

for image_file in os.listdir(images_dir):
    for audio_file in os.listdir(audio_dir):
        output_name = f"{image_file}_{audio_file}.mp4"
        ft.generate(
            source_image=os.path.join(images_dir, image_file),
            audio=os.path.join(audio_dir, audio_file),
            output=os.path.join(output_dir, output_name)
        )
```

### Servicio Web API

```bash
# Iniciar servicio API
python api.py --port 8080
```

Ejemplo de llamada:

```bash
curl -X POST http://localhost:8080/generate \
  -F "image=@face.jpg" \
  -F "audio=@speech.wav" \
  -o output.mp4
```

## Requisitos de entrada

### Formato de imagen

- **Formatos compatibles**: JPG, PNG, BMP
- **Resolución recomendada**: 512x512 o superior
- **Requisitos del rostro**:
  - Foto frontal clara funciona mejor
  - El rostro debe ocupar más del 50% de la imagen
  - Buena iluminación, expresión natural

### Formato de audio

- **Formatos compatibles**: WAV, MP3, FLAC
- **Frecuencia de muestreo**: 16000 Hz o 44100 Hz
- **Duración**: 1-60 segundos recomendado
- **Idioma**: Detección multilingüe automática

## Configuración de salida

### Resolución

```bash
# Establecer resolución de salida
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --size 512
```

Resoluciones compatibles: 256, 512, 768, 1024

### FPS

```bash
# Establecer tasa de cuadros
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --fps 30
```

### Formato de video

Formatos de salida compatibles: MP4 (H.264), AVI, MOV

## Optimización de rendimiento

### Aceleración GPU

Asegúrese de usar CUDA:

```python
ft = FantasyTalking(device="cuda")
```

### Procesamiento por lotes

Use procesamiento por lotes para varios archivos:

```python
ft.batch_generate(image_list, audio_list, output_dir)
```

### Precisión mixta

Habilitar aceleración FP16:

```python
ft = FantasyTalking(precision="fp16")
```

## Problemas comunes

### ¿Generación de video fallida?

1. Verificar que la imagen de entrada contenga un rostro
2. Confirmar que el formato de audio sea correcto
3. Asegurar suficiente VRAM

### ¿Rostro deformado?

1. Usar imágenes de entrada más claras
2. Ajustar parámetros de puntos clave faciales

### ¿Labios no sincronizados?

1. Asegurar que el audio sea claro
2. Ajustar parámetros de sincronización

## Mejores prácticas

1. **Seleccionar imágenes adecuadas**: Frontal, alta resolución, iluminación uniforme
2. **Preparar audio claro**: Sin ruido, velocidad moderada
3. **Establecer parámetros razonablemente**: Ajustar resolución y FPS según necesidad
4. **Usar mejora de rostro**: Mejora la calidad de salida

## Próximos pasos

- FAQ: Ver 4.Preguntas-Frecuentes.md
