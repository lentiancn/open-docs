# JDK 使用指南

本指南介绍如何有效使用 JDK 进行 Java 开发。

## 基本命令

### 编译 Java

```bash
# 编译单个文件
javac HelloWorld.java

# 使用自定义类路径编译
javac -cp "lib/*" MyApp.java

# 编译到指定目录
javac -d ./build MyApp.java

# 启用所有警告
javac -Xlint:all MyApp.java
```

### 运行 Java

```bash
# 运行已编译的类
java HelloWorld

# 使用自定义类路径运行
java -cp "lib/*:." MyApp

# 运行并分配更多内存
java -Xmx512m -Xms256m MyApp

# 使用系统属性运行
java -Dapp.name=MyApp -Denv=prod MyApp
```

### Jar 命令

```bash
# 创建 JAR
jar cf myapp.jar -C out .

# 创建可执行 JAR
jar cfe myapp.jar com.example.Main -C out .

# 列出 JAR 内容
jar tf myapp.jar

# 解压 JAR
jar xf myapp.jar
```

## JVM 选项

### 内存选项

```bash
# 堆大小
-Xms256m          # 初始堆大小
-Xmx1024m         # 最大堆大小
-Xmn128m          # 新生代大小

# Metaspace（Java 8+）
-XX:MetaspaceSize=128m
-XX:MaxMetaspaceSize=256m
```

### 垃圾回收

```bash
# G1GC（Java 9 默认）
-XX:+UseG1GC

# ZGC（低延迟）
-XX:+UseZGC

# Parallel GC（高吞吐量）
-XX:+UseParallelGC

# 记录 GC 日志
-Xlog:gc*:file=gc.log
```

### 性能优化

```bash
# JIT 编译
-XX:+TieredCompilation

# 字符串去重（Java 8u20+）
-XX:+UseStringDeduplication

# 类数据共享
-Xshare:on
```

## 构建工具

### Maven

```bash
# 创建项目
mvn archetype:generate

# 编译
mvn compile

# 运行测试
mvn test

# 打包
mvn package

# 运行
mvn spring-boot:run
```

### Gradle

```bash
# 创建项目
gradle init

# 编译
gradle compileJava

# 运行测试
gradle test

# 构建
gradle build

# 运行
gradle bootRun
```

## 模块系统（Java 9+）

### 模块声明

```java
// module-info.java
module com.example.myapp {
    requires com.example.utils;
    exports com.example.api;
}
```

### 使用模块运行

```bash
# 列出模块
java --list-modules

# 显示模块解析
java --show-module-resolution

# 添加模块路径
java --module-path lib -m com.example.myapp
```

## 安全

### Keytool 命令

```bash
# 生成密钥库
keytool -genkeypair -alias myapp -keyalg RSA -keysize 2048 -validity 365 -keystore keystore.jks

# 列出证书
keytool -list -keystore keystore.jks

# 导出证书
keytool -exportcert -alias myapp -file myapp.crt -keystore keystore.jks
```

### 安全策略

```bash
# 设置安全策略
java -Djava.security.manager -Djava.security.policy=app.policy MyApp

# 禁用安全管理器（Java 17+）
java --add-opens java.base/java.lang=ALL-UNNAMED MyApp
```

## 诊断工具

### jcmd

```bash
# 列出 Java 进程
jcmd -l

# 打印 VM 信息
jcmd <pid> VM.flags

# 打印系统属性
jcmd <pid> VM.system_properties
```

### jstack

```bash
# 打印线程转储
jstack <pid>

# 打印带锁信息的线程转储
jstack -l <pid>
```

### jmap / jhsdb

```bash
# 堆转储
jmap -dump:format=b,file=heap.bin <pid>

# 堆摘要
jmap -heap <pid>

# 类直方图
jmap -histo <pid>
```

## Docker

### Dockerfile

```dockerfile
# 构建镜像
FROM eclipse-temurin:21-jdk-alpine AS build
WORKDIR /app
COPY . .
RUN ./mvnw package -DskipTests

# 运行时镜像
FROM eclipse-temurin:21-jre-alpine
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 构建和运行

```bash
docker build -t myapp .
docker run -p 8080:8080 myapp
```

## 最佳实践

1. **使用 LTS 版本** - 生产环境使用 JDK 21 或 JDK 17
2. **设置适当的堆大小** - 根据应用程序需求进行监控和调整
3. **启用 GC 日志记录** - 用于排查性能问题
4. **使用模块化 JDK** - 使用 jlink 减小容器镜像大小
5. **保持更新** - 定期应用安全补丁

## 相关链接

- [Java 官方文档](https://docs.oracle.com/en/java/javase/)
- [JVM 选项参考](https://docs.oracle.com/en/java/javase/21/tools/java.html)
- [Maven Central](https://maven.apache.org/)
- [Gradle](https://gradle.org/)
