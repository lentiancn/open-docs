# Spring Boot 常见问题

本章节汇总了 Spring Boot 开发中的常见问题。

## 启动问题

### Q1: 端口被占用

**问题描述：**
`Port 8080 was already in use`

**解决方案：**
```properties
# 更改端口
server.port=8081

# 查找占用端口的进程
netstat -ano | findstr :8080
```

### Q2: 启动失败

**问题描述：**
应用启动失败。

**解决方案：**
1. 查看错误日志
2. 常见原因：
   - 缺少依赖
   - 配置错误
   - Bean 注入失败

### Q3: Bean 注入失败

**问题描述：**
`NoSuchBeanDefinitionException`

**解决方案：**
1. 检查是否添加了 @Service/@Component 注解
2. 检查 ComponentScan 是否正确

## 配置问题

### Q4: 数据库连接失败

**问题描述：**
`Cannot create JDBC driver of class ''`

**解决方案：**
```properties
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
```

### Q5: 中文乱码

**问题描述：**
返回的中文乱码。

**解决方案：**
```properties
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true
```

### Q6: 日志配置

**解决方案：**
```properties
logging.level.root=INFO
logging.level.com.example=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
```

## 数据库问题

### Q7: 表不存在

**问题描述：**
`Table 'xxx' doesn't exist`

**解决方案：**
```properties
spring.jpa.hibernate.ddl-auto=update
```

可选值：
- none：不执行
- create：每次创建
- create-drop：创建后删除
- update：更新结构
- validate：验证结构

### Q8: 懒加载问题

**问题描述：**
`LazyInitializationException`

**解决方案：**
1. 在配置中开启懒加载
   ```properties
   spring.jpa.open-in-view=true
   ```
2. 或使用 @Transactional

## 事务问题

### Q9: 事务不生效

**问题描述：**
数据库操作未回滚。

**解决方案：**
1. 确保方法在 Service 层
2. 添加 @Transactional 注解
3. 检查异常类型（默认只回滚 RuntimeException）

```java
@Transactional(rollbackFor = Exception.class)
```

## REST API 问题

### Q10: 404 错误

**问题描述：**
接口返回 404。

**解决方案：**
1. 检查 Controller 路径
2. 检查 @RequestMapping 注解
3. 查看日志

### Q11: 参数接收不到

**问题描述：**
@RequestBody 接收不到参数。

**解决方案：**
1. 添加 @Valid 注解
2. 检查 Content-Type

### Q12: 跨域问题

**问题描述：**
CORS 错误。

**解决方案：**
```java
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
            .allowedOrigins("*")
            .allowedMethods("GET", "POST", "PUT", "DELETE")
            .allowedHeaders("*");
    }
}
```

## 性能问题

### Q13: 启动慢

**解决方案：**
1. 排除不需要的自动配置
   ```java
   @SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
   ```

2. 懒加载
   ```properties
   spring.main.lazy-initialization=true
   ```

### Q14: 内存占用高

**解决方案：**
```properties
# 限制 Tomcat 线程数
server.tomcat.threads.max=200

# 压缩响应
server.compression.enabled=true
```

## 测试问题

### Q15: 单元测试

**解决方案：**
```java
@SpringBootTest
class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    void testFindAll() {
        List<User> users = userService.findAll();
        Assertions.assertNotNull(users);
    }
}
```

### Q16: 控制器测试

**解决方案：**
```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    void testGetUsers() throws Exception {
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isOk());
    }
}
```

## 打包问题

### Q17: 打包成 JAR

**解决方案：**
```bash
./mvnw clean package
java -jar target/myapp-0.0.1-SNAPSHOT.jar
```

### Q18: 打包成 WAR

```xml
<packaging>war</packaging>
```

## 安全问题

### Q19: 接口未授权访问

**解决方案：**
添加 Spring Security：
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

## 总结

本章节涵盖了 Spring Boot 开发中的常见问题：

- **启动**：端口、Bean 注入
- **配置**：数据库、日志
- **数据库**：表不存在、懒加载
- **事务**：不生效、回滚
- **API**：404、参数、跨域
- **性能**：启动、内存
- **测试**：单元测试、控制器测试
- **打包**：JAR/WAR

如需更多信息，请参考官方文档：https://docs.spring.io/spring-boot/docs/
