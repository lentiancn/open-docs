# APISIX Benutzerhandbuch

APISIX-Hauptfunktionen und Anwendungstipps.

## Grundkonzepte

### Terminologie

- **Route**: Definiert Anfrage-Abgleichregeln
- **Upstream**: Tatsächliche Backend-Dienste
- **Service**: Sammlung von Routen
- **Plugin**: Anfrageverarbeitungslogik
- **Consumer**: API-Konsument

### Anfragefluss

1. Client sendet Anfrage an APISIX
2. APISIX gleicht mit Routing-Regeln ab
3. Führt Plugin-Logik aus
4. Leitet an Upstream-Dienst weiter
5. Gibt Antwort an Client zurück

## Routenverwaltung

### Route erstellen

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "id": "1",
    "uri": "/api/users/*",
    "name": "user-api",
    "upstream": {
      "type": "roundrobin",
      "nodes": {"backend1.example.com:8080": 1}
    }
  }'
```

### Routenparameter

| Parameter | Beschreibung | Erforderlich |
|-----------|--------------|
| id ||-------------- Eindeutige ID | Ja |
| uri | Abzugleichende URI | Ja |
| name | Routenname | Nein |
| upstream | Upstream-Konfiguration | Ja |

## Upstream-Verwaltung

### Upstream erstellen

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/upstreams/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "type": "roundrobin",
    "nodes": {"host1:8080": 1, "host2:8080": 1}
  }'
```

### Load-Balancing-Strategien

**Roundrobin:**

```json
{"type": "roundrobin"}
```

**Konsistenter Hash:**

```json
{"type": "chash", "key": "remote_addr"}
```

## Plugins

### Häufige Plugins

**Verkehrskontrolle:**
- limit-req: Rate Limiting
- limit-conn: Verbindungslimit

**Authentifizierung:**
- jwt-auth: JWT-Authentifizierung
- key-auth: Schlüssel-Authentifizierung
- basic-auth: Basic-Authentifizierung

### Rate-Limit-Plugin verwenden

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "uri": "/api/*",
    "plugins": {
      "limit-req": {
        "rate": 100,
        "burst": 50,
        "rejected_code": 503
      }
    }
  }'
```

### JWT-Authentifizierung verwenden

**1. Consumer erstellen:**

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/consumers \
  -H "X-API-KEY: 123456" \
  -d '{
    "username": "john",
    "plugins": {
      "jwt-auth": {"key": "user-key", "secret": "my-secret"}
    }
  }'
```

**2. Auth auf Route aktivieren:**

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{"uri":"/api/*","plugins":{"jwt-auth":{}}}'
```

## Service-Discovery

### Eureka

```json
{
  "service_discovery": {
    "type": "eureka",
    "eureka": {"host": ["http://127.0.0.1:8761"]}
  }
}
```

### Nacos

```json
{
  "service_discovery": {
    "type": "nacos",
    "nacos": {"host": ["http://127.0.0.1:8848"]}
  }
}
```

## Health Checks

```json
{
  "upstream": {
    "nodes": {"host1:8080": 1},
    "checks": {
      "active": {
        "type": "http",
        "http_path": "/health",
        "interval": 5
      }
    }
  }
}
```

## Best Practices

1. Admin-API-Zugriffskontrolle aktivieren
2. Starke Schlüssel verwenden
3. Health Checks konfigurieren
4. Angemessene Rate-Limit-Werte festlegen

### Fehlersuche

```bash
curl http://127.0.0.1:9180/apisix/admin/routes -H "X-API-KEY: 123456"
tail -f logs/error.log
```
