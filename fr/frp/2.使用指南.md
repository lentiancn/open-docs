# frp Guide d'utilisation

Ce guide explique comment utiliser frp pour穿透内网 (percée NAT) et le mappage de ports.

## Démarrage rapide

### Démarrer le serveur

```bash
# Démarrer frps
./frps -c frps.ini
```

### Démarrer le client

```bash
# Démarrer frpc
./frpc -c frpc.ini
```

## Détails de configuration

### Configuration du serveur

#### Paramètres de base

```ini
[common]
bind_port = 7000           # Port du service frp
dashboard_port = 7500      # Port du tableau de bord
token = password           # Jeton d'authentification
```

#### Mappage de ports

```ini
[common]
vhost_http_port = 80       # Port hôte virtuel HTTP
vhost_https_port = 443    # Port hôte virtuel HTTPS
```

#### Équilibrage de charge

```ini
[common]
max_pool_count = 10        # Taille du pool de connexions
max_ports_per_client = 0   # Limite de ports par client
```

### Configuration du client

#### Mappage TCP

```ini
# Mapper SSH local
[ssh]
type = tcp
local_ip = 127.00.1
local_port = 22
remote_port = 6000
```

#### Mappage HTTP

```ini
# Mapper service web
[web]
type = http
local_port = 8080
custom_domains = example.com
```

#### Mappage HTTPS

```ini
[web_https]
type = https
local_port = 8443
custom_domains = example.com
```

## Fonctionnalités avancées

### Équilibrage de charge

```ini[test_http]
type = http
local_port = 8080
custom_domains = web.example.com
group = web_group
group_key = 123
```

### Plugins

#### Proxy HTTP

```ini
[http_proxy]
type = tcp
plugin = http_proxy
plugin_http_user = user
plugin_http_password = password
local_port = 8080
remote_port = 8000
```

#### Fichiers statiques

```ini
[static_file]
type = tcp
plugin = static_file
plugin_local_path = /var/www
pluginstrip_prefix = static
remote_port = 8000
```

## Configuration de sécurité

### Chiffrement

```ini
[common]
use_encryption = true
```

### Compression

```ini
[common]
use_compression = true
```

### Authentification

```ini
[common]
authentication_method = token
token = your_secure_token
```

## Surveillance

### Tableau de bord

```ini
[common]
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
```

Accédez à http://your_server:7500 pour voir le statut.

### Statistiques de ports

```ini
[common]
plugin = ports_stats
```

## Optimisation des performances

### Pool de connexions

```ini
[common]
max_pool_count = 50
max_conn_per_proxy = 10
```

### Heartbeat

```ini
[common]
heartbeat_interval = 30
heartbeat_timeout = 90
```

### Niveau de journalisation

```ini
[common]
log_level = warn
log_max_days = 3
```

## Cas d'utilisation

### 1. Accès distant SSH interne

```ini
[ssh]
type = tcp
local_ip = 192.168.1.100
local_port = 22
remote_port = 6000
```

### 2. Exposer le service web interne

```ini
[web]
type = http
local_port = 8080
custom_domains = yourdomain.com
```

### 3. Accéder à la base de données interne

```ini
[mysql]
type = tcp
local_ip = 192.168.1.100
local_port = 3306
remote_port = 13306
```

### 4. Callback WeChat/paiement

```ini
[wechat]
type = http
local_port = 8080
custom_domains = callback.yourdomain.com
```

## Dépannage

### Problèmes de connexion

1. Vérifiez les journaux du serveur
2. Validez que les ports sont ouverts
3. Vérifiez le pare-feu

### Problèmes de performance

1. Ajustez la taille du pool de connexions
2. Activez la compression
3. Vérifiez la bande passante réseau

## Ressources associées

- [Documentation officielle frp](https://gofrp.org/docs/)
- [GitHub](https://github.com/fatedier/frp)
