# Docker 使用手册

本手册详细介绍 Docker 的基本使用方法，包括镜像管理，容器操作，网络配置，数据卷管理等内容。

---

## 目录

1. [Docker 基本概念](#docker-基本概念)
2. [镜像操作](#镜像操作)
3. [容器操作](#容器操作)
4. [网络管理](#网络管理)
5. [数据卷管理](#数据卷管理)
6. [Docker Compose 使用](#docker-compose-使用)
7. [Dockerfile 编写](#dockerfile-编写)
8. [Docker 常用命令速查](#docker-常用命令速查)
9. [最佳实践](#最佳实践)
10. [故障排除](#故障排除)

---

## Docker 基本概念

### 什么是容器？

容器是一种轻量级，可执行的独立软件包，包含运行所需的所有内容：代码，运行时，系统工具，系统库和设置。容器化使软件可以在任何环境中一致地运行。

### 核心组件

- **镜像（Image）**：只读模板，用于创建容器
- **容器（Container）**：镜像的运行实例
- **仓库（Repository）**：存储镜像的地方
- **Dockerfile**：用于构建镜像的脚本文件
- **Docker Compose**：定义和运行多容器应用的工具

---

## 镜像操作

### 拉取镜像

从 Docker Hub 拉取镜像：

```bash
# 拉取最新版本
docker pull nginx

# 拉取指定版本
docker pull nginx:1.25
```

### 查看镜像列表

```bash
# 列出本地所有镜像
docker images
```

### 删除镜像

```bash
# 删除指定镜像
docker rmi nginx:latest

# 强制删除
docker rmi -f nginx:latest
```

### 构建镜像

使用 Dockerfile 构建镜像：

```bash
docker build -t myapp:latest .
```

---

## 容器操作

### 创建并启动容器

```bash
# 交互式容器（带终端）
docker run -it ubuntu /bin/bash

# 守护进程容器（后台运行）
docker run -d nginx

# 端口映射
docker run -d -p 8080:80 nginx

# 指定容器名称
docker run -d --name my-nginx nginx
```

### 查看容器

```bash
# 列出运行中的容器
docker ps

# 列出所有容器（包括停止的）
docker ps -a
```

### 容器生命周期管理

```bash
# 启动容器
docker start my-nginx

# 停止容器
docker stop my-nginx

# 重启容器
docker restart my-nginx

# 删除容器
docker rm my-nginx
```

### 进入容器内部

```bash
# 使用 exec 进入运行中的容器
docker exec -it my-nginx /bin/bash
```

---

## 网络管理

### 查看网络

```bash
# 列出所有网络
docker network ls

# 查看网络详细信息
docker network inspect bridge
```

### 创建网络

```bash
# 创建桥接网络
docker network create my-network
```

---

## 数据卷管理

### 创建数据卷

```bash
# 创建数据卷
docker volume create my-volume

# 列出数据卷
docker volume ls
```

### 使用数据卷

```bash
# 挂载数据卷
docker run -d -v my-volume:/container/path nginx

# 挂载主机目录
docker run -d -v /host/path:/container/path nginx
```

---

## Docker Compose 使用

### Docker Compose 文件结构

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### 常用命令

```bash
# 启动所有服务
docker-compose up

# 后台启动
docker-compose up -d

# 停止所有服务
docker-compose down
```

---

## Dockerfile 编写

### 基础指令

```dockerfile
# 指定基础镜像
FROM node:18-alpine

# 设置工作目录
WORKDIR /app

# 复制文件
COPY . .

# 暴露端口
EXPOSE 3000

# 启动命令
CMD ["node", "index.js"]
```

### 多阶段构建示例

```dockerfile
# 构建阶段
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# 运行阶段
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Docker 常用命令速查

### 镜像命令

| 命令 | 说明 |
|------|------|
| `docker pull <image>` | 拉取镜像 |
| `docker images` | 列出镜像 |
| `docker rmi <image>` | 删除镜像 |
| `docker build -t <name> .` | 构建镜像 |

### 容器命令

| 命令 | 说明 |
|------|------|
| `docker run -d <image>` | 后台运行容器 |
| `docker run -it <image>` | 交互式运行容器 |
| `docker ps` | 列出运行中的容器 |
| `docker ps -a` | 列出所有容器 |
| `docker start <container>` | 启动容器 |
| `docker stop <container>` | 停止容器 |
| `docker rm <container>` | 删除容器 |
| `docker exec -it <container> /bin/bash` | 进入容器 |

---

## 最佳实践

### 镜像优化

1. **使用多阶段构建**：减小最终镜像体积
2. **选择合适的基础镜像**：优先使用 alpine 等轻量镜像
3. **减少层数**：合并 RUN 指令
4. **使用 .dockerignore**：排除不必要的文件

### 安全建议

1. **不以 root 用户运行容器**：使用 USER 指令
2. **定期更新基础镜像**：获取最新安全补丁
3. **使用官方镜像**：优先使用经过验证的官方镜像

---

## 故障排除

### 容器无法启动

```bash
# 查看容器日志
docker logs <container>
```

### 端口冲突

```bash
# 检查端口占用
netstat -tlnp | grep <port>

# 使用其他端口
docker run -d -p 8081:80 nginx
```

### 磁盘空间不足

```bash
# 清理未使用的镜像
docker image prune -a

# 清理所有未使用资源
docker system prune -a
```

---

## 相关链接

- [Docker 官方文档](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose 文档](https://docs.docker.com/compose/)
