# GitLab よくある質問

> GitLabに関する一般的な質問への回答

---

## インストール

### Q: インストール後GitLabにアクセスできない？

**A**: 以下を確認してください：
- 外部URLが正しく設定されていますか？
- ファイアウォールが80と443ポートを許可しているか確認
- サービスが実行しているか確認: `sudo gitlab-ctl status`
- ログを確認: `sudo gitlab-ctl tail`

### Q: メモリ使用量が高すぎる？

**A**: GitLabはリソース集中的です。推奨事項：
- 最小4GB RAM、推奨8GB以上
- 以下で最適化:
  ```ruby
  # /etc/gitlab/gitlab.rb
  postgresql['shared_buffers'] = "256MB"
  unicorn['worker_processes'] = 2
  ```

### Q: GitLabデータを移行方法は？

**A**: GitLabバックアップと復元を使用:
```bash
# バックアップ
sudo gitlab-backup create

# 復元
sudo gitlab-backup restore BACKUP=timestamp
```

---

## Git操作

### Q: プッシュ時にアクセス拒否される？

**A**: 
1. SSH公開鍵がGitLabプロファイルに追加されているか確認
2. プロジェクトメンバーの権限を確認
3. HTTPS使用の場合、ユーザー名とアクセストークンを確認

### Q: マージリクエストに競合が表示される？

**A**:
1. ローカルでターゲットブランチをプル
2. ターゲットブランチにブランチをリベース
3. 競合を解決してフォースプッシュ:
   ```bash
   git fetch origin
   git checkout your-branch
   git rebase origin/main
   # 競合解決後
   git push --force-with-lease
   ```

### Q: 大きなファイルのプッシュが失敗する？

**A**: GitLabはデフォルトでファイルサイズを制限しています。設定を調整:
```ruby
# /etc/gitlab/gitlab.rb
gitlab_rails['max_attachment_size'] = 100 * 1024 * 1024 # 100MB
```
またはGit LFSを使用:
```bash
git lfs install
git lfs track "*.psd"
```

---

## CI/CD

### Q: パイプラインが保留のまま進まない？

**A**: 
1. GitLab Runnerが登録されオンラインか確認
2. RunnerタグがJobsと一致しているか確認
3. Runnerの同時実行制限を確認

### Q: プライベートイメージレジストリの使用方法は？

**A**: 
```yaml
build:
  image: my-private-image
  variables:
    DOCKER_AUTH_CONFIG: '{"auths":{"registry.example.com":{"username":"user","password":"pass"}}}'
```

### Q: キャッシュが機能しない？

**A**: キャッシュ設定が正しいことを確認:
```yaml
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
  policy: pull-push
```

---

## 権限

### Q: ブランチ保護を設定する方法は？

**A**: 
1. プロジェクト → 設定 → リポジトリ → 保護されたブランチへ移動
2. 保護するブランチを選択
3. 誰が可能プッシュ/マージできるか設定

### Q: プロジェクトにアクセスできない？

**A**: 
1. プロジェクトの公開設定を確認（公開/内部/非公開）
2. プロジェクトメンバーとして追加されているか確認
3. アクセスにはプロジェクト管理者に連絡

---

## パフォーマンス最適化

### Q: ページ読み込みが遅い？

**A**: 
1. 分析のためにPrometheusモニタリングを有効化
2. PostgreSQL設定を最適化
3. Redisキャッシュを使用
4. PostgreSQLマスタースレーブレプリケーションを検討

### Q: ユーザークォータを制限する方法は？

**A**: 管理領域で設定:
- ストレージクォータ制限
- リポジトリ数制限
- ユーザークォータ

---

## バックアップと復元

### Q: 自動バックアップを設定する方法は？

**A**: cronジョブを設定:
```bash
# 毎日午前2時に自動バックアップ
0 2 * * * /opt/gitlab/bin/gitlab-backup create CRON=1
```

### Q: バックアップファイルはどこにある？

**A**: デフォルトでは `/var/opt/gitlab/backups/` ディレクトリ

---

## アップグレード

### Q: GitLabをアップグレードする方法は？

**A**: 
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install gitlab-ee

# その後再設定
sudo gitlab-ctl reconfigure
```

### Q: アップグレード前にバックアップが必要？

**A**: はい、アップグレード前にバックアップすることを強く推奨:
```bash
sudo gitlab-backup create
sudo gitlab-ctl stop
```

---

## 一般的なエラーコード

| エラーコード | 説明 | 解決策 |
|------------|------|--------|
| 500 | サーバー内部エラー | ログを確認 |
| 502 | ゲートウェイエラー | サービスステータスを確認 |
| 503 | サービス利用不可 | リソース使用量を調査 |
| 404 | リソースが見つからない | URLを確認 |
| 422 | 処理できないエンティティ | パラメータを確認 |
