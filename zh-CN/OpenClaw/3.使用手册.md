# OpenClaw 使用手册

本手册将详细介绍如何使用 OpenClaw 进行日常的 AI 助手管理工作，包括通道配置、会话管理、消息发送等核心功能。

## 基本概念

在深入使用之前，需要了解 OpenClaw 的几个核心概念：

### Gateway（网关）

Gateway 是 OpenClaw 的核心进程，负责连接聊天应用和 AI 代理。它是会话、路由和通道连接的单一数据源。

### Channel（通道）

通道是指具体的聊天平台，如 WhatsApp、Telegram、Discord 等。每个通道都需要单独配置和登录。

### Agent（代理）

代理是指 AI 助手，如 Pi（Anthropic）、Claude 等。OpenClaw 支持多代理同时运行。

### Session（会话）

会话是指与 AI 代理的对话上下文。OpenClaw 支持为每个发送者创建独立会话。

## 快速开始

### 启动 Gateway

```bash
# 前台运行
openclaw gateway --port 18789

# 或者作为服务运行
openclaw gateway start
```

### 打开控制台

```bash
openclaw dashboard
```

或者直接访问 http://127.0.0.1:18789/

### 发送测试消息

```bash
openclaw message send --target +15555550123 --message "Hello from OpenClaw"
```

## 通道管理

### 查看已配置的通道

```bash
openclaw channels list
```

### 添加新通道

```bash
# 添加 WhatsApp
openclaw channels add whatsapp

# 添加 Telegram
openclaw channels add telegram

# 添加 Discord
openclaw channels add discord
```

### 登录通道

```bash
# WhatsApp 登录
openclaw channels login

# 查看登录状态
openclaw channels status
```

### 移除通道

```bash
openclaw channels remove whatsapp
```

## 消息管理

### 发送消息

```bash
# 发送给个人
openclaw message send --target +15555550123 --message "你好"

# 发送给群组
openclaw message send --target "群组ID" --message "大家好"
```

### 查看消息历史

```bash
# 查看会话列表
openclaw sessions list

# 查看特定会话的消息
openclaw sessions history --session-id <会话ID>
```

### 删除会话

```bash
openclaw sessions delete --session-id <会话ID>
```

## 代理管理

### 配置默认代理

OpenClaw 默认使用内置的 Pi 代理。如果需要配置其他代理：

```bash
# 设置 Anthropic API 密钥
openclaw config set providers.anthropic.key <你的API密钥>

# 设置默认代理
openclaw config set agents.default provider=anthropic
```

### 多代理配置

```json
{
  "agents": {
    "coding": {
      "provider": "anthropic",
      "model": "claude-3-opus"
    },
    "general": {
      "provider": "openai",
      "model": "gpt-4"
    }
  }
}
```

### 代理路由规则

```bash
# 查看路由规则
openclaw routing list

# 添加路由规则
openclaw routing add --pattern "编程" --agent coding
```

## 配置管理

### 查看配置

```bash
# 查看当前配置
openclaw config get

# 查看特定配置项
openclaw config get channels.whatsapp
```

### 修改配置

```bash
# 设置配置项
openclaw config set channels.whatsapp.allowFrom "+15555550123"

# 删除配置项
openclaw config unset channels.whatsapp.allowFrom
```

### 配置文件

配置文件位于 `~/.openclaw/openclaw.json`：

```json
{
  "gateway": {
    "port": 18789,
    "host": "0.0.0.0"
  },
  "channels": {
    "whatsapp": {
      "enabled": true,
      "allowFrom": ["+15555550123"],
      "groups": {
        "*": {
          "requireMention": true
        }
      }
    }
  },
  "agents": {
    "default": {
      "provider": "anthropic"
    }
  }
}
```

## 会话管理

### 查看活跃会话

```bash
openclaw sessions list
```

### 创建新会话

```bash
# 为特定用户创建新会话
openclaw sessions create --user +15555550123

# 指定代理创建会话
openclaw sessions create --user +15555550123 --agent coding
```

### 会话隔离

OpenClaw 支持以下会话隔离模式：

- **per-sender**：每个发送者一个会话
- **per-workspace**：每个工作区一个会话
- **per-agent**：每个代理一个会话

### 切换会话模式

```bash
openclaw config set sessions.mode per-sender
```

## 节点管理

OpenClaw 支持配对 iOS 和 Android 设备作为移动节点。

### 配对移动设备

```bash
# 生成配对码
openclaw nodes pair

# 在移动设备上输入配对码完成配对
```

### 查看已配对节点

```bash
openclaw nodes list
```

### 移除节点

```bash
openclaw nodes remove --node-id <节点ID>
```

## 安全控制

### 白名单设置

```bash
# 添加白名单用户
openclaw security allow +15555550123

# 移除白名单用户
openclaw security remove +15555550123

# 查看白名单
openclaw security list
```

### 群组权限

```json
{
  "channels": {
    "whatsapp": {
      "groups": {
        "群组ID": {
          "requireMention": true,
          "allowedUsers": ["+15555550123", "+15555550124"]
        }
      }
    }
  }
}
```

### API 密钥管理

```bash
# 设置 API 密钥
openclaw config set providers.anthropic.key <密钥>

# 查看密钥（掩码）
openclaw config get providers.anthropic.key
```

## 故障排除

### 查看日志

```bash
# 查看 Gateway 日志
openclaw logs

# 查看特定级别的日志
openclaw logs --level error
```

### 健康检查

```bash
# 检查 Gateway 健康状态
openclaw status
```

### 重新初始化

如果遇到问题，可以重新运行初始化：

```bash
openclaw onboard
```

## 常用命令速查

| 命令 | 说明 |
|------|------|
| `openclaw gateway start` | 启动 Gateway |
| `openclaw dashboard` | 打开控制台 UI |
| `openclaw channels list` | 列出通道 |
| `openclaw sessions list` | 列出会话 |
| `openclaw message send` | 发送消息 |
| `openclaw config get` | 查看配置 |
| `openclaw status` | 查看状态 |

## 最佳实践

1. **定期备份配置**：备份 `~/.openclaw/` 目录
2. **使用环境变量**：敏感信息使用环境变量而不是配置文件
3. **配置白名单**：生产环境务必配置访问白名单
4. **监控日志**：定期查看日志了解系统状态
5. **及时更新**：保持 OpenClaw 为最新版本
