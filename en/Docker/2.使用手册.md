# Docker User Manual

This manual provides detailed instructions on using Docker, including image management, container operations, network configuration, volume management, and more.

---

## Table of Contents

1. [Docker Basic Concepts](#docker-basic-concepts)
2. [Image Operations](#image-operations)
3. [Container Operations](#container-operations)
4. [Network Management](#network-management)
5. [Volume Management](#volume-management)
6. [Using Docker Compose](#using-docker-compose)
7. [Writing Dockerfiles](#writing-dockerfiles)
8. [Docker Common Commands Quick Reference](#docker-common-commands-quick-reference)
9. [Best Practices](#best-practices)
10. [Troubleshooting](#troubleshooting)

---

## Docker Basic Concepts

### What is a Container?

Containers are lightweight, executable standalone packages that contain everything needed to run the software: code, runtime, system tools, system libraries, and settings. Containerization ensures software runs consistently in any environment.

### Core Components

- **Image**: A read-only template used to create containers
- **Container**: A running instance of an image
- **Repository**: A place to store images
- **Dockerfile**: A script used to build images
- **Docker Compose**: A tool for defining and running multi-container applications

---

## Image Operations

### Pull Images

Pull images from Docker Hub:

```bash
# Pull latest version
docker pull nginx

# Pull specific version
docker pull nginx:1.25

# Pull specific tag
docker pull ubuntu:22.04
```

### List Images

```bash
# List all local images
docker images

# List image IDs
docker images -q

# Show detailed image information
docker image inspect nginx:latest
```

### Remove Images

```bash
# Remove specified image
docker rmi nginx:latest

# Force remove
docker rmi -f nginx:latest

# Remove unused images
docker image prune

# Remove all unused images
docker image prune -a
```

### Build Images

Build images using Dockerfile:

```bash
# Find Dockerfile in current directory and build
docker build -t myapp:latest .

# Specify Dockerfile path
docker build -f /path/to/Dockerfile -t myapp:latest .

# Pass build arguments
docker build --build-arg VERSION=1.0 -t myapp:latest .
```

### Tag Images

```bash
# Add tag to image
docker tag myapp:latest myregistry.com/myapp:v1.0
```

### Push Images to Registry

```bash
# Login to Docker Hub
docker login

# Push image
docker push myapp:latest

# Push to private registry
docker push myregistry.com/myapp:latest
```

---

## Container Operations

### Create and Start Containers

```bash
# Interactive container (with terminal)
docker run -it ubuntu /bin/bash

# Daemon container (running in background)
docker run -d nginx

# Port mapping
docker run -d -p 8080:80 nginx

# Specify container name
docker run -d --name my-nginx nginx

# Auto-restart container
docker run -d --restart=always nginx

# Set environment variables
docker run -d -e APP_ENV=production nginx

# Mount volumes
docker run -d -v /host/path:/container/path nginx
```

### View Containers

```bash
# List running containers
docker ps

# List all containers (including stopped)
docker ps -a

# Show container IDs
docker ps -q

# Show container detailed information
docker inspect my-nginx

# View container logs
docker logs my-nginx

# Follow logs in real-time
docker logs -f my-nginx

# View container resource usage
docker stats my-nginx
```

### Container Lifecycle Management

```bash
# Start container
docker start my-nginx

# Stop container
docker stop my-nginx

# Restart container
docker restart my-nginx

# Pause container
docker pause my-nginx

# Unpause container
docker unpause my-nginx

# Remove container
docker rm my-nginx

# Force remove running container
docker rm -f my-nginx

# Remove all stopped containers
docker container prune
```

### Enter Container

```bash
# Use exec to enter running container
docker exec -it my-nginx /bin/bash

# Execute command in container
docker exec my-nginx ls -la
```

### Copy Files Between Container and Host

```bash
# Copy from host to container
docker cp /host/path/file.txt my-nginx:/container/path/

# Copy from container to host
docker cp my-nginx:/container/path/file.txt /host/path/
```

---

## Network Management

### View Networks

```bash
# List all networks
docker network ls

# View network detailed information
docker network inspect bridge
```

### Create Network

```bash
# Create bridge network
docker network create my-network

# Create custom network (supports container name resolution)
docker network create --driver bridge my-network
```

### Container Network Operations

```bash
# Connect container to network
docker network connect my-network my-nginx

# Disconnect container from network
docker network disconnect my-network my-nginx
```

### Network Driver Types

| Driver Type | Description |
|-------------|-------------|
| bridge | Default network driver, container-to-container communication |
| host | Container uses host network namespace |
| overlay | Cross-host container communication (Swarm mode) |
| macvlan | Assign MAC address to container |
| none | Disable networking |

---

## Volume Management

### Create Volume

```bash
# Create volume
docker volume create my-volume

# List volumes
docker volume ls

# View volume detailed information
docker volume inspect my-volume
```

### Use Volumes

```bash
# Mount volume
docker run -d -v my-volume:/container/path nginx

# Mount host directory
docker run -d -v /host/path:/container/path nginx

# Read-only mount
docker run -d -v /host/path:/container/path:ro nginx
```

### Remove Volumes

```bash
# Remove specified volume
docker volume rm my-volume

# Remove unused volumes
docker volume prune
```

### Volume Types

| Type | Description | Use Case |
|------|-------------|----------|
| Anonymous volume | Auto-created by Docker | Temporary data |
| Named volume | User-created volume | Persistent data |
| Host bind mount | Mount host directory | Development, config |

---

## Using Docker Compose

### Docker Compose File Structure

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
    environment:
      - NGINX_HOST=localhost
    depends_on:
      - redis
    networks:
      - frontend
      - backend

  redis:
    image: redis:alpine
    volumes:
      - redis-data:/data
    networks:
      - backend

networks:
  frontend:
  backend:

volumes:
  redis-data:
```

### Common Commands

```bash
# Start all services
docker-compose up

# Start in background
docker-compose up -d

# Stop all services
docker-compose down

# Stop and remove volumes
docker-compose down -v

# View logs
docker-compose logs -f

# View service status
docker-compose ps

# Build images
docker-compose build

# Restart services
docker-compose restart

# Enter service container
docker-compose exec web /bin/bash
```

### Multiple Files

```bash
# Use specified config files
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up

# Use base config + development config
docker-compose -f base.yml -f development.yml up
```

---

## Writing Dockerfiles

### Basic Instructions

```dockerfile
# Specify base image
FROM node:18-alpine

# Set maintainer information
LABEL maintainer="you@example.com"

# Set environment variables
ENV NODE_ENV=production

# Set working directory
WORKDIR /app

# Copy files
COPY package*.json ./

# Run commands
RUN npm install

# Copy remaining files
COPY . .

# Expose ports
EXPOSE 3000

# Start command
CMD ["node", "index.js"]
```

### Common Instructions

| Instruction | Description | Example |
|-------------|-------------|---------|
| FROM | Specify base image | FROM python:3.11 |
| RUN | Execute commands | RUN pip install -r requirements.txt |
| COPY | Copy files | COPY ./src /app/src |
| ADD | Copy (supports URL and tar) | ADD https://example.com/file.tar.gz /tmp/ |
| WORKDIR | Set working directory | WORKDIR /app |
| ENV | Set environment variables | ENV PORT=8080 |
| EXPOSE | Declare ports | EXPOSE 8080 |
| CMD | Container start command | CMD ["node", "app.js"] |
| ENTRYPOINT | Entry point | ENTRYPOINT ["python", "app.py"] |
| VOLUME | Create mount point | VOLUME /data |
| LABEL | Add metadata | LABEL version="1.0" |
| USER | Set user | USER node |
| ARG | Build arguments | ARG VERSION |

### Multi-stage Build Example

```dockerfile
# Build stage
FROM golang:1.20 AS builder
WORKDIR /app
COPY . .
RUN go build -o main .

# Run stage
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

### .dockerignore File

```
# Ignore version control files
.git
.gitignore

# Ignore documentation
*.md
docs/

# Ignore build artifacts
node_modules/
dist/
build/

# Ignore sensitive files
.env*
*.pem
*.key

# Ignore logs
*.log
logs/
```

---

## Docker Common Commands Quick Reference

### Image Commands

| Command | Description |
|---------|-------------|
| `docker pull <image>` | Pull image |
| `docker images` | List images |
| `docker rmi <image>` | Remove image |
| `docker build -t <name> .` | Build image |
| `docker tag <image> <new-name>` | Tag image |
| `docker push <image>` | Push image |

### Container Commands

| Command | Description |
|---------|-------------|
| `docker run -d <image>` | Run container in background |
| `docker run -it <image>` | Run container interactively |
| `docker ps` | List running containers |
| `docker ps -a` | List all containers |
| `docker start <container>` | Start container |
| `docker stop <container>` | Stop container |
| `docker rm <container>` | Remove container |
| `docker exec -it <container> /bin/bash` | Enter container |
| `docker logs <container>` | View logs |

### Other Common Commands

| Command | Description |
|---------|-------------|
| `docker network ls` | List networks |
| `docker volume ls` | List volumes |
| `docker-compose up -d` | Start Compose services |
| `docker-compose down` | Stop Compose services |
| `docker system prune` | Clean up unused resources |

---

## Best Practices

### Image Optimization

1. **Use multi-stage builds**: Reduce final image size
2. **Choose appropriate base images**: Prefer lightweight images like alpine
3. **Reduce layers**: Combine RUN instructions
4. **Arrange instructions properly**: Take advantage of Docker cache
5. **Use .dockerignore**: Exclude unnecessary files

### Security Recommendations

1. **Don't run as root**: Use USER instruction
2. **Update base images regularly**: Get latest security patches
3. **Use official images**: Prefer verified official images
4. **Scan for vulnerabilities**: Use Docker Scout or other tools
5. **Limit container permissions**: Use read-only filesystems

### Development Workflow

1. **Use volumes for development**: Code changes don't require image rebuild
2. **Use Docker Compose**: Manage multi-container applications
3. **Configure with environment variables**: Use env vars instead of hardcoding
4. **Log management**: Configure appropriate log levels

---

## Troubleshooting

### Container Won't Start

```bash
# View container logs
docker logs <container>

# View detailed information
docker inspect <container>

# Check resource limits
docker stats <container>
```

### Port Conflicts

```bash
# Check port usage
netstat -tlnp | grep <port>

# Use different port
docker run -d -p 8081:80 nginx
```

### Disk Space Issues

```bash
# Clean unused images
docker image prune -a

# Clean build cache
docker builder prune

# Clean all unused resources
docker system prune -a
```

### Network Issues

```bash
# Check network configuration
docker network inspect <network>

# Create new network
docker network create my-network

# Reconnect container
docker network connect my-network <container>
```

### Permission Issues

```bash
# Add user to docker group
sudo usermod -aG docker $USER

# Or use correct user in container
docker run -u 1000:1000 myapp
```

---

## Related Links

- [Docker Official Documentation](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [Dockerfile Best Practices](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
