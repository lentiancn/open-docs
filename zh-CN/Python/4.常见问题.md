# Python 常见问题

本章节汇总了 Python 开发中的常见问题及解决方案。

## 安装问题

### Q1: python 命令找不到

**问题描述：**
安装 Python 后，在终端输入 `python` 提示命令找不到。

**解决方案：**

1. **Windows**：检查是否勾选 "Add Python to PATH"，或使用 `python3` 命令
2. **Linux/macOS**：使用 `python3` 代替 `python`
3. **创建别名**：
   ```bash
   alias python=python3
   ```

### Q2: pip 安装失败

**问题描述：**
pip 安装包时出现错误。

**解决方案：**

1. **升级 pip**：
   ```bash
   python -m pip install --upgrade pip
   ```

2. **使用国内镜像**：
   ```bash
   pip install package -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

3. **Windows 权限问题**：
   ```bash
   pip install --user package
   ```

### Q3: 版本冲突

**问题描述：**
多个 Python 版本冲突。

**解决方案：**

1. **Linux 使用 pyenv**：
   ```bash
   pyenv install 3.12.0
   pyenv global 3.12.0
   ```

2. **Windows 使用 Python Launcher**：
   ```bash
   py -3.11 -m pip install package
   ```

## 语法问题

### Q4: IndentationError

**问题描述：**
代码缩进不正确。

**解决方案：**
Python 使用缩进表示代码块，确保：
- 使用 4 个空格（或 Tab）
- 保持一致的缩进风格
- 检查混合使用空格和 Tab

### Q5: SyntaxError

**问题描述：**
语法错误。

**常见原因：**
- 缺少冒号（`:`）
- 括号、引号不匹配
- 关键字拼写错误

**示例：**
```python
# 错误
if x > 0
    print(x)

# 正确
if x > 0:
    print(x)
```

### Q6: NameError

**问题描述：**
变量或函数未定义。

**解决方案：**
```python
# 确保变量已定义
name = "Tom"
print(name)

# 检查导入
import math
print(math.pi)
```

### Q7: TypeError

**问题描述：**
类型不匹配。

**解决方案：**
```python
# 字符串拼接
name = "Tom"
age = 25
# 错误：name + age
# 正确：name + str(age)
# 或：f"{name} {age}"
```

## 数据结构问题

### Q8: 列表索引越界

**问题描述：**
`IndexError: list index out of range`

**解决方案：**
```python
numbers = [1, 2, 3]

# 错误：numbers[5]
# 正确：
if len(numbers) > 5:
    print(numbers[5])
# 或使用异常处理
try:
    print(numbers[5])
except IndexError:
    print("索引超出范围")
```

### Q9: 字典键不存在

**问题描述：**
访问不存在的键。

**解决方案：**
```python
person = {"name": "Tom"}

# 方式1：使用 get 方法
age = person.get("age", 0)  # 默认值 0

# 方式2：先检查
if "age" in person:
    print(person["age"])
```

### Q10: 修改列表时出错

**问题描述：**
遍历列表时修改导致错误。

**解决方案：**
```python
# 错误：遍历时删除
numbers = [1, 2, 3, 4, 5]
for n in numbers:
    if n % 2 == 0:
        numbers.remove(n)

# 正确：创建新列表
numbers = [1, 2, 3, 4, 5]
numbers = [n for n in numbers if n % 2 != 0]
```

## 函数问题

### Q11: 参数传递问题

**问题描述：**
修改参数影响了外部变量。

**解决方案：**
```python
# 列表等可变对象会受影响
def modify_list(lst):
    lst.append(4)

numbers = [1, 2, 3]
modify_list(numbers)
print(numbers)  # [1, 2, 3, 4]

# 如需避免，复制一份
def modify_list(lst):
    new_list = lst.copy()
    new_list.append(4)
    return new_list
```

### Q12: 默认参数可变对象

**问题描述：**
使用可变对象作为默认参数导致意外结果。

**解决方案：**
```python
# 错误示例
def append_to(element, to=[]):
    to.append(element)
    return to

# 多次调用会共享列表
print(append_to(1))  # [1]
print(append_to(2))  # [1, 2]

# 正确做法
def append_to(element, to=None):
    if to is None:
        to = []
    to.append(element)
    return to
```

## 面向对象问题

### Q13: self 未定义

**问题描述：**
在方法中忘记使用 `self`。

**解决方案：**
```python
class Person:
    def greet(name):  # 缺少 self
        return f"Hello, {name}!"

# 正确
class Person:
    def greet(self, name):
        return f"Hello, {name}!"
```

### Q14: 私有属性访问

**问题描述：**
访问私有属性报错。

**解决方案：**
```python
class Person:
    def __init__(self):
        self._name = "Tom"  # 受保护
        self.__age = 30     # 私有

person = Person()
print(person._name)   # 可以访问但不推荐
# print(person.__age)  # 错误
print(person._Person__age)  # 访问私有属性（不推荐）
```

## 异常处理问题

### Q15: 异常捕获顺序

**问题描述：**
异常处理顺序不当。

**解决方案：**
```python
# 错误
try:
    result = 1 / 0
except Exception as e:
    print(e)
except ZeroDivisionError:
    print("除零错误")

# 正确：子类异常在前
try:
    result = 1 / 0
except ZeroDivisionError:
    print("除零错误")
except Exception as e:
    print(e)
```

### Q16: 异常被静默忽略

**问题描述：**
pass 导致异常被忽略。

**解决方案：**
```python
# 不好
try:
    result = risky_operation()
except:
    pass  # 完全忽略错误

# 好：记录或处理
import logging
try:
    result = risky_operation()
except Exception as e:
    logging.error(f"操作失败: {e}")
    # 或使用默认值
    result = default_value
```

## 文件操作问题

### Q17: 文件编码问题

**问题描述：**
读取文件出现乱码。

**解决方案：**
```python
# 指定编码
with open("file.txt", "r", encoding="utf-8") as f:
    content = f.read()

# 处理不同编码
try:
    with open("file.txt", "r", encoding="utf-8") as f:
        content = f.read()
except UnicodeDecodeError:
    with open("file.txt", "r", encoding="gbk") as f:
        content = f.read()
```

### Q18: 文件路径问题

**问题描述：**
文件路径不正确。

**解决方案：**
```python
import os

# 使用绝对路径
path = os.path.abspath("file.txt")

# 使用 os.path.join
path = os.path.join(os.getcwd(), "data", "file.txt")

# 检查文件是否存在
if os.path.exists(path):
    with open(path, "r") as f:
        content = f.read()
```

## 性能问题

### Q19: 循环性能差

**问题描述：**
循环处理大数据量太慢。

**解决方案：**
1. **使用列表推导式**：
   ```python
   # 慢
   result = []
   for i in range(1000000):
       result.append(i * 2)
   
   # 快
   result = [i * 2 for i in range(1000000)]
   ```

2. **使用 NumPy**：
   ```python
   import numpy as np
   arr = np.arange(1000000)
   result = arr * 2
   ```

3. **使用生成器**：
   ```python
   def generate():
       for i in range(1000000):
           yield i * 2
   ```

### Q20: 内存占用过高

**解决方案：**
1. **使用生成器代替列表**：
   ```python
   # 内存占用大
   numbers = [i for i in range(10000000)]
   
   # 内存占用小
   numbers = (i for i in range(10000000))
   ```

2. **分批处理**：
   ```python
   for chunk in pd.read_csv("big.csv", chunksize=10000):
       process(chunk)
   ```

## 并发问题

### Q21: 多线程不并行

**问题描述：**
Python 多线程没有真正并行。

**原因：**
Python 有 GIL（全局解释器锁），多线程只能并发执行。

**解决方案：**
1. **使用多进程**：
   ```python
   from multiprocessing import Pool
   
   def process(data):
       # 处理逻辑
       return result
   
   with Pool(4) as p:
       results = p.map(process, data_list)
   ```

2. **使用异步**：
   ```python
   import asyncio
   
   async def fetch(url):
       # 异步请求
       return await aiohttp.get(url)
   
   async def main():
       results = await asyncio.gather(*[fetch(url) for url in urls])
   ```

## 包管理问题

### Q22: 导入模块失败

**问题描述：**
`ModuleNotFoundError: No module named 'xxx'`

**解决方案：**
1. **安装模块**：
   ```bash
   pip install module_name
   ```

2. **检查安装位置**：
   ```bash
   pip show module_name
   python -c "import module; print(module.__file__)"
   ```

3. **虚拟环境问题**：
   ```bash
   # 激活虚拟环境
   source venv/bin/activate  # Linux/macOS
   venv\Scripts\activate     # Windows
   ```

### Q23: 包版本冲突

**问题描述：**
不同项目需要不同版本的包。

**解决方案：**
使用虚拟环境：
```bash
# venv
python -m venv project1_env
source project1_env/bin/activate
pip install package==1.0

# pipenv
pipenv install package==1.0

# poetry
poetry add package@^1.0
```

## 测试问题

### Q24: 测试找不到模块

**解决方案：**
```bash
# 安装测试依赖
pip install pytest

# 指定路径
pytest tests/

# 指定文件
pytest test_file.py::TestClass::test_method
```

### Q25: pytest 参数化测试

**解决方案：**
```python
import pytest

@pytest.mark.parametrize("input,expected", [
    (1, 2),
    (2, 4),
    (3, 6),
])
def test_double(input, expected):
    assert input * 2 == expected
```

## 其他问题

### Q26: 字符串和字节混淆

**解决方案：**
```python
# 字符串
s = "Hello"
print(type(s))  # <class 'str'>

# 字节
b = b"Hello"
print(type(b))  # <class 'bytes'>

# 转换
s_to_b = s.encode("utf-8")
b_to_s = b.decode("utf-8")
```

### Q27: 深拷贝和浅拷贝

**解决方案：**
```python
import copy

# 浅拷贝
original = [[1, 2], [3, 4]]
shallow = copy.copy(original)
shallow[0][0] = 100  # 也会修改 original

# 深拷贝
deep = copy.deepcopy(original)
deep[0][0] = 100  # 不会修改 original
```

### Q28: 浮点数精度问题

**解决方案：**
```python
# 问题
0.1 + 0.2 == 0.3  # False

# 解决：使用 Decimal
from decimal import Decimal
Decimal("0.1") + Decimal("0.2") == Decimal("0.3")  # True

# 或使用 round
round(0.1 + 0.2, 10) == round(0.3, 10)  # True
```

### Q29: 迭代器和可迭代对象

**解决方案：**
```python
# 可迭代对象（列表、元组等）
for item in [1, 2, 3]:
    print(item)

# 迭代器
iterator = iter([1, 2, 3])
print(next(iterator))  # 1
print(next(iterator))  # 2

# 自定义迭代器
class Counter:
    def __init__(self, limit):
        self.limit = limit
        self.current = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current >= self.limit:
            raise StopIteration
        self.current += 1
        return self.current
```

### Q30: Python 2 兼容问题

**解决方案：**
```python
# 使用 future 包
from __future__ import print_function
from __future__ import division

# 检查版本
import sys
if sys.version_info[0] == 2:
    # Python 2 代码
    pass
else:
    # Python 3 代码
    pass

# 推荐：直接使用 Python 3
```

## 总结

本章节涵盖了 Python 开发中的常见问题：

- **安装**：命令找不到、pip 失败、版本冲突
- **语法**：缩进、类型错误、未定义变量
- **数据结构**：索引、字典、列表修改
- **函数**：参数传递、默认参数
- **异常**：捕获顺序、静默忽略
- **文件**：编码、路径
- **性能**：循环、内存
- **并发**：多线程、多进程
- **包管理**：导入、版本冲突
- **测试**：找不到模块、参数化

如需更多信息，请参考官方文档：https://docs.python.org/zh-cn/3/
