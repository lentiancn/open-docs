# PostgreSQL 安裝指南

PostgreSQL 是一個功能強大的開源物件關聯式資料庫系統。本指南涵蓋在所有環境中的安裝方法。

## 版本資訊

| 版本 | 狀態 | 說明 |
|------|------|------|
| PostgreSQL 16.x | ✅ 目前 | 最新穩定版本 |
| PostgreSQL 15.x | ✅ 支援 | 穩定版本 |
| PostgreSQL 14.x | ⚠️ 維護 | 安全更新 |
| PostgreSQL 13.x | ⚠️ 維護 | 長期支援 |
| PostgreSQL 12.x | ❌ 舊版 | 已停止維護 |

> **重要提示**：本指南主要針對 **PostgreSQL 16.x**。建議新專案使用最新版本。

## 系統需求

### 硬體需求

| 需求 | 最低配置 | 推薦配置 |
|------|----------|----------|
| CPU | 1 核心 | 2+ 核心 |
| 記憶體 | 1 GB | 4+ GB |
| 磁碟 | 10 GB | 50+ GB |

### 作業系統支援

- **Linux**: Ubuntu, Debian, CentOS, RHEL, Fedora, openSUSE
- **Windows**: Windows Server 2016+, Windows 10+
- **macOS**: 10.14+

## 安裝方法

### 方法一：Windows 安裝

#### 1. 使用安裝程式（推薦）

1. 下載 PostgreSQL 安裝程式：https://www.postgresql.org/download/windows/
2. 執行 postgresql-16.x-x-windows-x64.exe
3. 按照安裝精靈完成安裝
4. 設定超級使用者 postgres 的密碼

#### 2. 使用 Chocolatey

```powershell
# 安裝 PostgreSQL
choco install postgresql

# 安裝特定版本
choco install postgresql --version=16.0
```

#### 3. 使用 ZIP 套件

```powershell
# 下載 ZIP 套件
# 解壓到 C:\Program Files\PostgreSQL\16

# 初始化資料庫
"C:\Program Files\PostgreSQL\16\bin\initdb" -D "C:\Program Files\PostgreSQL\16\data"

# 啟動服務
"C:\Program Files\PostgreSQL\16\bin\pg_ctl" -D "C:\Program Files\PostgreSQL\16\data" -l logfile start
```

### 方法二：macOS 安裝

#### 1. 使用 Homebrew（推薦）

```bash
# 安裝 PostgreSQL
brew install postgresql@16

# 啟動服務
brew services start postgresql@16

# 停止服務
brew services stop postgresql@16
```

#### 2. 使用 PostgreSQL.app

1. 下載 PostgreSQL.app：https://postgresapp.com/
2. 拖曳到 Applications 資料夾
3. 點擊啟動

#### 3. 使用 MacPorts

```bash
sudo port install postgresql16
sudo port load postgresql16-server
```

### 方法三：Linux 安裝

#### Ubuntu/Debian

```bash
# 新增 PostgreSQL 官方儲存庫
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'

# 匯入金鑰
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

# 更新套件列表
sudo apt-get update

# 安裝 PostgreSQL
sudo apt-get install -y postgresql-16

# 啟動服務
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### CentOS/RHEL

```bash
# 安裝 RPM 儲存庫
sudo yum install -y https://download.postgresql.org/pub/repos/yum/16/redhat/rhel-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm

# 安裝 PostgreSQL
sudo yum install -y postgresql16-server

# 初始化資料庫
sudo /usr/pgsql-16/bin/postgresql-16-setup initdb

# 啟動服務
sudo systemctl start postgresql-16
sudo systemctl enable postgresql-16
```

#### Fedora

```bash
# 安裝 PostgreSQL
sudo dnf install -y postgresql-server postgresql-contrib

# 初始化資料庫
sudo postgresql-setup --initdb

# 啟動服務
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### 方法四：Docker 安裝

```bash
# 拉取映像檔
docker pull postgres:16

# 執行容器
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=mysecretpassword \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_DB=mydb \
  -p 5432:5432 \
  -v postgres_data:/var/lib/postgresql/data \
  postgres:16
```

#### Docker Compose

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:16
    container_name: postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: mysecretpassword
      POSTGRES_DB: mydb
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

執行：

```bash
docker-compose up -d
```

## 安裝後設定

### 連線至 PostgreSQL

```bash
# 使用 psql
sudo -u postgres psql

# 或
psql -U postgres -h localhost -p 5432
```

### 建立資料庫

```sql
CREATE DATABASE mydb;

-- 建立使用者
CREATE USER myuser WITH PASSWORD 'mypassword';

-- 授權
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;
```

### 設定檔案

#### postgresql.conf

```properties
# 監聽位址
listen_addresses = '*'

# 連接埠
port = 5432

# 最大連線數
max_connections = 100

# 共用緩衝區
shared_buffers = 128MB

# 工作記憶體
work_mem = 4MB
```

#### pg_hba.conf

```properties
# 允許本機連線
host    all             all             127.0.0.1/32            trust
host    all             all             ::1/128                 trust

# 允許遠端連線
host    all             all             0.0.0.0/0              md5
host    all             all             ::/0                    md5
```

### 遠端連線設定

```sql
-- 允許遠端連線
ALTER SYSTEM SET listen_addresses = '*';

-- 重載設定
SELECT pg_reload_conf();
```

## 常見問題

### 連線被拒絕？

檢查防火牆：

```bash
# Ubuntu
sudo ufw allow 5432/tcp

# CentOS
sudo firewall-cmd --add-port=5432/tcp --permanent
sudo firewall-cmd --reload
```

### 忘記 postgres 密碼？

```bash
# 停止 PostgreSQL
sudo systemctl stop postgresql

# 以跳過權限模式啟動
sudo -u postgres /usr/lib/postgresql/16/bin/pg_ctl -D /var/lib/postgresql/16/main -m fast stop

# 修改密碼
sudo -u postgres psql -c "ALTER USER postgres PASSWORD 'newpassword';"
```

### 資料庫啟動失敗？

檢查日誌：

```bash
# 查看日誌
tail -f /var/log/postgresql/postgresql-16-main.log
```

## 相關連結

- [PostgreSQL 官方網站](https://www.postgresql.org/)
- [PostgreSQL 中文文檔](https://www.postgresql.cn/)
- [pgAdmin 工具](https://www.pgadmin.org/)
