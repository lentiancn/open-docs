# Guía de instalación de LivePortrait

LivePortrait es un marco eficiente de animación de retratos desarrollado por Kwai VGI. Anima retratos estáticos utilizando el movimiento de videos de conducción, con soporte para control de costuras y reenmarcado.

## Versión general

| Versión | Estado | Descripción |
|---------|--------|-------------|
| LivePortrait 1.x | Actual | Versión principal |

## Requisitos del sistema

### Requisitos de hardware

| Componente | Mínimo | Recomendado |
|------------|---------|--------------|
| GPU | NVIDIA 8GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 16GB |
| Almacenamiento | 30GB | 50GB |
| CUDA | 11.8+ | 12.1+ |

### Requisitos de software

| Software | Versión | Notas |
|----------|---------|-------|
| Python | 3.8 - 3.11 | Se recomienda 3.10 |
| CUDA | 11.8+ | Aceleración GPU requerida |
| cuDNN | 8.5+ | Requerido para CUDA |
| ffmpeg | Latest | Procesamiento de video requerido |

## Instalación en Linux/Ubuntu

### Paso 1: Instalar dependencias del sistema

```bash
# Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Python y herramientas de desarrollo
sudo apt install python3.10 python3-pip python3-venv git wget curl

# Instalar bibliotecas del sistema
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# Instalar ffmpeg
sudo apt install ffmpeg
```

### Paso 2: Instalar CUDA

```bash
# Descargar e instalar CUDA 12.1
wget https://developer.download.nvidia.com/compute/cuda/12.1.0/local_installers/cuda_12.1.0_520.53_linux.run
sudo sh cuda_12.1.0_520.53_linux.run
```

### Paso 3: Clonar proyecto

```bash
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait
```

### Paso 4: Crear entorno virtual

```bash
python3.10 -m venv venv
source venv/bin/activate

# Verificar versión de Python
python --version
```

### Paso 5: Instalar PyTorch

```bash
# Versión para CUDA 12.1
pip install torch==2.1.0 torchvision==0.16.0 --index-url https://download.pytorch.org/whl/cu121

# Verificar instalación
python -c "import torch; print(torch.cuda.is_available())"
```

### Paso 6: Instalar dependencias

```bash
# Instalar requisitos base
pip install -r requirements.txt

# Instalar dependencias adicionales
pip install numpy opencv-python librosa soundfile
```

### Paso 7: Descargar modelos

```bash
# Crear directorio de modelos
mkdir -p pretrained_models

# Descargar desde la página de lanzamientos o usar script
bash scripts/download_weights.sh
```

## Instalación en Windows

### Paso 1: Instalar Python

1. Descargar Python 3.10 desde python.org
2. Marcar "Add Python to PATH" durante la instalación
3. Verificar: `python --version`

### Paso 2: Instalar CUDA

1. Descargar CUDA 12.1 desde el sitio de NVIDIA
2. Instalar con configuración predeterminada
3. Descargar e instalar cuDNN 8.9

### Paso 3: Clonar y configurar

```powershell
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait

python -m venv venv
venv\Scripts\activate
```

### Paso 4: Instalar dependencias

```powershell
# Instalar PyTorch (con soporte CUDA)
pip install torch==2.1.0 torchvision==0.16.0 --index-url https://download.pytorch.org/whl/cu121

pip install -r requirements.txt
```

### Paso 5: Descargar modelos

Descargar modelos desde GitHub releases y colocar en el directorio `pretrained_models/`.

## Instalación en macOS

### Paso 1: Instalar dependencias

```bash
# Instalar Homebrew (si no está instalado)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Instalar Python y ffmpeg
brew install python@3.10 ffmpeg git
```

### Paso 2: Configurar

```bash
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait

python3.10 -m venv venv
source venv/bin/activate

# Instalar PyTorch (macOS solo CPU)
pip install torch==2.1.0 torchvision==0.16.0

pip install -r requirements.txt
```

Nota: macOS solo soporta modo CPU, no se puede usar aceleración GPU.

## Instalación con Docker

### Usando Docker

```bash
# Descargar imagen
docker pull liveportrait:latest

# Ejecutar (requiere GPU)
docker run --gpus all -v $(pwd):/workspace -p 7860:7860 liveportrait:latest
```

### Usando Docker Compose

```yaml
version: '3.8'
services:
  liveportrait:
    image: liveportrait:latest
    volumes:
      - ./workspace:/workspace
    ports:
      - "7860:7860"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

## Verificar instalación

```bash
# Probar funcionalidad básica
python inference.py --help
```

## Problemas comunes

### Memoria CUDA insuficiente

**Soluciones:**
- Reducir tamaño de batch: `--batch_size 1`
- Usar menor resolución
- Habilitar descarga de modelos

### Bibliotecas faltantes (Windows)

**Soluciones:**
- Instalar Visual C++ Redistributable 2015-2022
- Agregar CUDA al PATH del sistema

### Error al descargar modelos

**Soluciones:**
- Usar VPN o proxy
- Descargar manualmente desde GitHub releases
- Verificar conexión de red

### ffmpeg no encontrado

**Soluciones:**
- Linux: `sudo apt install ffmpeg`
- Windows: Agregar ffmpeg al PATH
- macOS: `brew install ffmpeg`

## Enlaces relacionados

- [Repositorio GitHub](https://github.com/KwaiVGI/LivePortrait)
- [Artículo](https://arxiv.org/abs/2407.03168)
- [Demo](https://liveportrait.github.io)
