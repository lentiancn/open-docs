# Angular FAQ

Частые вопросы и ответы.

## Установка

### Q: Установка Angular CLI не удалась?

**Решения:**
1. Проверить версию Node.js
```bash
node --version  # Требуется 18+ или 20+
```
2. Очистить кэш npm
```bash
npm cache clean --force
```
3. Использовать администратора (Windows)
4. Проверить сетевое подключение

### Q: Команда ng не найдена?

**Решения:**
1. Подтвердить установку Angular CLI
```bash
npm list -g @angular/cli
```
2. Проверить переменную PATH
3. Переустановить
```bash
npm uninstall -g @angular/cli
npm install -g @angular/cli@latest
```

### Q: Создание проекта не удалось?

**Решения:**
1. Проверить место на диске
2. Проверить права npm
3. Использовать --skip-install
```bash
ng new my-app --skip-install
cd my-app
npm install
```

## Разработка

### Q: Компонент не отображается?

**Решения:**
1. Подтвердить правильный импорт компонента
2. Подтвердить правильное использование селектора
3. Проверить синтаксис шаблона
4. Проверить ошибки в консоли

### Q: Данные не обновляются?

**Решения:**
1. Для Signals использовать методы set/update
```typescript
count.set(1);           // Установить новое значение
count.update(c => c + 1); // Обновить на основе старого значения
```
2. Для RxJS убедиться в правильной подписке
3. Использовать ChangeDetectorRef для ручного обнаружения
```typescript
constructor(private cdr: ChangeDetectorRef) {}

refresh() {
  this.cdr.detectChanges();
}
```

### Q: Маршрутизация не работает?

**Решения:**
1. Подтвердить правильность конфигурации маршрутов
2. Подтвердить размещение RouterOutlet
3. Проверить порядок маршрутов
```typescript
// Specific routes before wildcard
{ path: 'user/:id', ... },
{ path: '**', component: NotFoundComponent }
```

### Q: Валидация формы не работает?

**Решения:**
1. Импортировать ReactiveFormsModule или FormsModule
2. Подтвердить правильность имен FormControl
3. Правильно использовать валидаторы
```typescript
this.form = this.fb.group({
  email: ['', [Validators.required, Validators.email]],
  password: ['', [Validators.required, Validators.minLength(6)]]
});
```

## Производительность

### Q: Медленная первая загрузка?

**Решения:**
1. Использовать ленивую загрузку маршрутов
```typescript
{
  path: 'admin',
  loadComponent: () => import('./admin/admin.component')
    .then(m => m.AdminComponent)
}
```
2. Включить продакшен-режим
```bash
ng build --configuration=production
```
3. AOT-компиляция включена по умолчанию

### Q: Утечки памяти?

**Решения:**
1. Правильно отписываться
```typescript
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';

@Component({...})
export class MyComponent implements OnDestroy {
  private destroy$ = new Subject<void>();

  ngOnInit() {
    this.http.get('/api').pipe(
      takeUntil(this.destroy$)
    ).subscribe();
  }

  ngOnDestroy() {
    this.destroy$.next();
    this.destroy$.complete();
  }
}
```
2. Использовать async pipe для автоматической подписки/отписки

### Q: Слишком большой размер бандла?

**Решения:**
1. Проверить размеры зависимостей
```bash
npm run build -- --stats-json
npx webpack-bundle-analyzer dist/stats.json
```
2. Использовать ленивую загрузку
3. Удалить неиспользуемые импорты

## Тестирование

### Q: Как писать юнит-тесты?

**Решения:**
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { UserCardComponent } from './user-card.component';

describe('UserCardComponent', () => {
  let component: UserCardComponent;
  let fixture: ComponentFixture<UserCardComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [UserCardComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(UserCardComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should display user name', () => {
    component.user = { name: 'Иван', email: 'test@example.com' };
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h3')?.textContent).toContain('Иван');
  });
});
```

### Q: Модуль тестирования не найден?

**Решения:**
```typescript
TestBed.configureTestingModule({
  imports: [
    CommonModule,
    HttpClientModule,
    // Другие необходимые модули
  ]
});
```

## Сборка

### Q: Сборка не удалась?

**Решения:**
1. Проверить ошибки TypeScript
```bash
npx tsc --noEmit
```
2. Очистить кэш
```bash
rm -rf node_modules
npm install
```
3. Обновить версию Angular
```bash
ng update @angular/core @angular/cli
```

### Q: Переменные окружения не работают?

**Решения:**
1. Подтвердить правильность имен файлов окружения
2. Настроить окружение в angular.json
```json
"configurations": {
  "production": {
    "fileReplacements": [
      {
        "replace": "src/environments/environment.ts",
        "with": "src/environments/environment.prod.ts"
      }
    ]
  }
}
```

## Безопасность

### Q: Как предотвратить XSS-атаки?

**Решения:**
1. Angular по умолчанию автоматически экранирует
2. Быть осторожным с innerHTML
```typescript
import { DomSanitizer } from '@angular/platform-browser';

constructor(private sanitizer: DomSanitizer) {}

getHtml() {
  // Только для доверенного контента
  return this.sanitizer.bypassSecurityTrustHtml(this.trustedContent);
}
```

### Q: Защита CSRF?

**Решения:**
```typescript
import { HttpClientModule } from '@angular/common/http';

@NgModule({
  imports: [
    HttpClientModule,
    HttpClientXsrfModule.withOptions({
      cookieName: 'XSRF-TOKEN',
      headerName: 'X-XSRF-TOKEN'
    })
  ]
})
export class AppModule {}
```

## Обновление

### Q: Как обновить версию Angular?

**Решения:**
1. Использовать ng update
```bash
ng update @angular/core@17 @angular/cli@17
```
2. Проверить руководство по миграции
3. Обновить версии зависимостей
4. Запустить тесты для обеспечения совместимости

### Q: Код несовместим после обновления?

**Решения:**
1. Проверить официальное руководство по обновлению
2. Использовать ng update для автоматической миграции
3. Обновлять постепенно, не перепрыгивая версии

## Ресурсы для обучения

### Q: Где изучить Angular?

- Официальные документы: https://angular.io
- Angular University: https://angular-university.io
- StackBlitz: Писать код Angular онлайн

### Q: Как получить помощь?

- Stack Overflow: https://stackoverflow.com/questions/tagged/angular
- Discord: https://discord.com/invite/angular
- GitHub Discussions: https://github.com/angular/angular/discussions
