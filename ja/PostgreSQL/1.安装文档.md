# PostgreSQL インストールガイド

PostgreSQLは強力なオープンソースのオブジェクトリレーショナルデータベースシステムです。このガイドでは、すべての環境でのインストール方法を説明します。

## バージョン情報

| バージョン | 状態 | 説明 |
|------------|------|------|
| PostgreSQL 16.x | ✅ 現行 | 最新安定バージョン |
| PostgreSQL 15.x | ✅ サポート | 安定バージョン |
| PostgreSQL 14.x | ⚠️ メンテナンス | セキュリティ更新 |
| PostgreSQL 13.x | ⚠️ メンテナンス | 長期サポート |
| PostgreSQL 12.x | ❌ 旧版 | サポート終了 |

> **重要**：このガイドは**PostgreSQL 16.x**を対象としています。新規プロジェクトでは最新バージョンを使用してください。

## システム要件

### ハードウェア要件

| 要件 | 最小構成 | 推奨構成 |
|------|----------|----------|
| CPU | 1コア | 2+コア |
| メモリ | 1 GB | 4+ GB |
| ディスク | 10 GB | 50+ GB |

### 対応OS

- **Linux**: Ubuntu, Debian, CentOS, RHEL, Fedora, openSUSE
- **Windows**: Windows Server 2016+, Windows 10+
- **macOS**: 10.14+

## インストール方法

### 方法1：Windowsへのインストール

#### 1. インストーラーを使用（推奨）

1. PostgreSQL インストーラーをダウンロード：https://www.postgresql.org/download/windows/
2. postgresql-16.x-x-windows-x64.exe を実行
3. インストールウィザードに従ってインストールを完了
4. スーパーユーザー postgres のパスワードを設定

#### 2. Chocolateyを使用

```powershell
# PostgreSQLをインストール
choco install postgresql

# 特定のバージョンをインストール
choco install postgresql --version=16.0
```

#### 3. ZIPパッケージを使用

```powershell
# ZIPパッケージをダウンロード
# C:\Program Files\PostgreSQL\16に展開

# データベースを初期化
"C:\Program Files\PostgreSQL\16\bin\initdb" -D "C:\Program Files\PostgreSQL\16\data"

# サービスを開始
"C:\Program Files\PostgreSQL\16\bin\pg_ctl" -D "C:\Program Files\PostgreSQL\16\data" -l logfile start
```

### 方法2：macOSへのインストール

#### 1. Homebrewを使用（推奨）

```bash
# PostgreSQLをインストール
brew install postgresql@16

# サービスを開始
brew services start postgresql@16

# サービスを停止
brew services stop postgresql@16
```

#### 2. PostgreSQL.appを使用

1. PostgreSQL.appをダウンロード：https://postgresapp.com/
2. Applicationsフォルダにドラッグ
3. クリックして起動

#### 3. MacPortsを使用

```bash
sudo port install postgresql16
sudo port load postgresql16-server
```

### 方法3：Linuxへのインストール

#### Ubuntu/Debian

```bash
# PostgreSQL公式リポジトリを追加
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'

# キーをインポート
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

# パッケージリストを更新
sudo apt-get update

# PostgreSQLをインストール
sudo apt-get install -y postgresql-16

# サービスを開始
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### CentOS/RHEL

```bash
# RPMリポジトリをインストール
sudo yum install -y https://download.postgresql.org/pub/repos/yum/16/redhat/rhel-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm

# PostgreSQLをインストール
sudo yum install -y postgresql16-server

# データベースを初期化
sudo /usr/pgsql-16/bin/postgresql-16-setup initdb

# サービスを開始
sudo systemctl start postgresql-16
sudo systemctl enable postgresql-16
```

#### Fedora

```bash
# PostgreSQLをインストール
sudo dnf install -y postgresql-server postgresql-contrib

# データベースを初期化
sudo postgresql-setup --initdb

# サービスを開始
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### 方法4：Dockerでのインストール

```bash
# イメージをプル
docker pull postgres:16

# コンテナを実行
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=mysecretpassword \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_DB=mydb \
  -p 5432:5432 \
  -v postgres_data:/var/lib/postgresql/data \
  postgres:16
```

#### Docker Compose

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:16
    container_name: postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: mysecretpassword
      POSTGRES_DB: mydb
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

実行：

```bash
docker-compose up -d
```

## インストール後の設定

### PostgreSQLへの接続

```bash
# psqlを使用
sudo -u postgres psql

# または
psql -U postgres -h localhost -p 5432
```

### データベースの作成

```sql
CREATE DATABASE mydb;

-- ユーザーの作成
CREATE USER myuser WITH PASSWORD 'mypassword';

-- 権限の付与
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;
```

### 設定ファイル

#### postgresql.conf

```properties
# リスナーアドレス
listen_addresses = '*'

# ポート
port = 5432

# 最大接続数
max_connections = 100

# 共有バッファ
shared_buffers = 128MB

# ワークメモリ
work_mem = 4MB
```

#### pg_hba.conf

```properties
# ローカル接続を許可
host    all             all             127.0.0.1/32            trust
host    all             all             ::1/128                 trust

# リモート接続を許可
host    all             all             0.0.0.0/0              md5
host    all             all             ::/0                    md5
```

### リモート接続の設定

```sql
-- リモート接続を許可
ALTER SYSTEM SET listen_addresses = '*';

-- 設定を再読み込み
SELECT pg_reload_conf();
```

## よくある質問

### 接続が拒否される？

ファイアウォールを確認：

```bash
# Ubuntu
sudo ufw allow 5432/tcp

# CentOS
sudo firewall-cmd --add-port=5432/tcp --permanent
sudo firewall-cmd --reload
```

### postgresのパスワードを忘れた？

```bash
# PostgreSQLを停止
sudo systemctl stop postgresql

# 権限バイパスモードで起動
sudo -u postgres /usr/lib/postgresql/16/bin/pg_ctl -D /var/lib/postgresql/16/main -m fast stop

# パスワードを変更
sudo -u postgres psql -c "ALTER USER postgres PASSWORD 'newpassword';"
```

### データベースが起動しない？

ログを確認：

```bash
# ログを確認
tail -f /var/log/postgresql/postgresql-16-main.log
```

## 関連リンク

- [PostgreSQL 公式サイト](https://www.postgresql.org/)
- [PostgreSQL 日本語ドキュメント](https://www.postgresql.jp/)
- [pgAdmin ツール](https://www.pgadmin.org/)
