# APISIX 使用手册

## 管理 API

APISIX 提供 RESTful 风格的管理 API，默认端口 9180。

### 认证

所有管理 API 需要通过 X-API-Key 认证，默认 key 在 config.yaml 中配置。

### 路由管理

#### 创建路由

```bash
curl -X POST http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H 'X-API-KEY: api-key' \
  -H 'Content-Type: application/json' \
  -d '{
    "uri": "/api/*",
    "name": "my-api",
    "upstream": {
      "type": "roundrobin",
      "nodes": {
        "127.0.0.1:8080": 1,
        "127.0.0.1:8081": 1
      }
    }
  }'
```

#### 路由匹配规则

- `uri`: URL 路径匹配
- `remote_addr`: 客户端 IP
- `header`: 请求头匹配
- `cookie`: Cookie 匹配
- `query`: 查询参数匹配

### 插件使用

#### 限流插件

```bash
curl -X POST http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H 'X-API-KEY: api-key' \
  -H 'Content-Type: application/json' \
  -d '{
    "uri": "/api/*",
    "plugins": {
      "limit-req": {
        "rate": 100,
        "burst": 50,
        "key": "remote_addr"
      }
    },
    "upstream": {
      "nodes": {
        "127.0.0.1:8080": 1
      }
    }
  }'
```

#### 认证插件

```bash
# JWT 认证
curl -X POST http://127.0.0.1:9180/apisix/admin/consumers \
  -H 'X-API-KEY: api-key' \
  -d '{
    "username": "test",
    "plugins": {
      "jwt-auth": {
        "key": "user-key",
        "secret": "my-secret"
      }
    }
  }'
```

### 常用命令

```bash
# 查看版本
apisix version

# 停止
apisix stop

# 重启
apisix restart

# 重新加载配置
apisix reload
```

### 监控

APISIX 内置 Prometheus 插件：

```bash
curl -X POST http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H 'X-API-KEY: api-key' \
  -d '{
    "uri": "/metrics",
    "plugins": {
      "prometheus": {}
    },
    "upstream": {
      "nodes": {
        "127.0.0.1:9080": 1
      }
    }
  }'
```
