# frp Руководство пользователя

В этом руководстве объясняется, как использовать frp для穿透内网 (NAT-穿透) и проброса портов.

## Быстрый старт

### Запуск сервера

```bash
# Запустить frps
./frps -c frps.ini
```

### Запуск клиента

```bash
# Запустить frpc
./frpc -c frpc.ini
```

## Детали конфигурации

### Конфигурация сервера

#### Основные настройки

```ini
[common]
bind_port = 7000           # Порт сервиса frp
dashboard_port = 7500      # Порт панели управления
token = password           # Токен аутентификации
```

#### Проброс портов

```ini
[common]
vhost_http_port = 80       # Порт виртуального хоста HTTP
vhost_https_port = 443    # Порт виртуального хоста HTTPS
```

#### Балансировка нагрузки

```ini
[common]
max_pool_count = 10        # Размер пула соединений
max_ports_per_client = 0   # Ограничение портов на клиент
```

### Конфигурация клиента

#### TCP-проброс

```map
# Проброс локального SSH
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

#### HTTP-проброс

```ini
# Проброс веб-сервиса
[web]
type = http
local_port = 8080
custom_domains = example.com
```

#### HTTPS-проброс

```ini
[web_https]
type = https
local_port = 8443
custom_domains = example.com
```

## Расширенные функции

### Балансировка нагрузки

```ini[test_http]
type = http
local_port = 8080
custom_domains = web.example.com
group = web_group
group_key = 123
```

### Плагины

#### HTTP-прокси

```ini
[http_proxy]
type = tcp
plugin = http_proxy
plugin_http_user = user
plugin_http_password = password
local_port = 8080
remote_port = 8000
```

#### Статические файлы

```ini
[static_file]
type = tcp
plugin = static_file
plugin_local_path = /var/www
pluginstrip_prefix = static
remote_port = 8000
```

## Настройки безопасности

### Шифрование

```ini
[common]
use_encryption = true
```

### Сжатие

```ini
[common]
use_compression = true
```

### Аутентификация

```ini
[common]
authentication_method = token
token = your_secure_token
```

## Мониторинг

### Dashboard

```ini
[common]
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
```

Доступ по адресу http://your_server:7500 для просмотра статуса.

### Статистика портов

```ini
[common]
plugin = ports_stats
```

## Оптимизация производительности

### Пул соединений

```ini
[common]
max_pool_count = 50
max_conn_per_proxy = 10
```

### Heartbeat

```ini
[common]
heartbeat_interval = 30
heartbeat_timeout = 90
```

### Уровень логирования

```ini
[common]
log_level = warn
log_max_days = 3
```

## Сценарии использования

### 1. Удалённый доступ к внутреннему SSH

```ini
[ssh]
type = tcp
local_ip = 192.168.1.100
local_port = 22
remote_port = 6000
```

### 2. Публикация внутреннего веб-сервиса

```ini
[web]
type = http
local_port = 8080
custom_domains = yourdomain.com
```

### 3. Доступ к внутренней базе данных

```ini
[mysql]
type = tcp
local_ip = 192.168.1.100
local_port = 3306
remote_port = 13306
```

### 4. Коллбэк WeChat/платежей

```ini
[wechat]
type = http
local_port = 8080
custom_domains = callback.yourdomain.com
```

## Устранение неполадок

### Проблемы с соединением

1. Проверьте логи сервера
2. Проверьте открытость портов
3. Проверьте файрвол

### Проблемы с производительностью

1. Настройте размер пула соединений
2. Включите сжатие
3. Проверьте пропускную способность сети

## Ресурсы

- [Официальная документация frp](https://gofrp.org/docs/)
- [GitHub](https://github.com/fatedier/frp)
