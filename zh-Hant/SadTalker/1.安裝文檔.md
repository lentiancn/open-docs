# SadTalker 安裝指南

SadTalker 是一個 AI 專案，可從單張圖片和音訊輸入生成逼真的 talking head 影片。

## 系統需求

### 硬體需求

| 組件 | 最低需求 | 推薦配置 |
|------|----------|----------|
| GPU | NVIDIA 6GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 32GB |
| 儲存空間 | 20GB 可用 | 50GB 可用 |
| 作業系統 | Ubuntu 18.04+、Windows 10+、macOS 11+ | Ubuntu 20.04+ |

### 軟體需求

| 軟體 | 版本 | 備註 |
|------|------|------|
| Python | 3.8 - 3.10 | 推薦 3.9 |
| CUDA | 11.7+ | 用於 GPU 加速 |
| cuDNN | 8.5+ | CUDA 必需 |
| ffmpeg | 最新版本 | 用於影片處理 |

## Linux/Ubuntu 安裝

### 步驟 1：安裝系統依賴項

```bash
# 更新系統
sudo apt update && sudo apt upgrade -y

# 安裝 Python 和開發工具
sudo apt install python3.9 python3-pip python3-venv git wget curl

# 安裝系統函式庫
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# 安裝 ffmpeg
sudo apt install ffmpeg

# 安裝 NVIDIA 驅動程式（如尚未安裝）
sudo apt install nvidia-driver-525
```

### 步驟 2：安裝 CUDA（如需要）

```bash
# 下載並安裝 CUDA 11.8
wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
sudo sh cuda_11.8.0_520.61.05_linux.run
```

### 步驟 3：複製專案庫

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker
```

### 步驟 4：建立虛擬環境

```bash
python3.9 -m venv venv
source venv/bin/activate

# 驗證 Python 版本
python --version
```

### 步驟 5：安裝 PyTorch

```bash
# 適用於 CUDA 11.8
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# 驗證安裝
python -c "import torch; print(torch.cuda.is_available())"
```

### 步驟 6：安裝依賴項

```bash
pip install -r requirements.txt

# 安裝額外依賴項
pip install numpy opencv-python librosa soundfile
```

### 步驟 7：下載模型

```bash
# 建立模型目錄
mkdir -p checkpoints

# 下載模型（自動）
bash scripts/download_models.sh

# 或從發布頁面手動下載
# 將模型放置在 checkpoints/ 目錄中
```

## Windows 安裝

### 步驟 1：安裝 Python

1. 從 python.org 下載 Python 3.9
2. 安裝時勾選「Add Python to PATH」
3. 驗證：`python --version`

### 步驟 2：安裝 CUDA

1. 從 NVIDIA 網站下載 CUDA 11.8
2. 使用預設設定安裝
3. 下載並安裝 cuDNN 8.9

### 步驟 3：複製並設定

```powershell
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python -m venv venv
venv\Scripts\activate
```

### 步驟 4：安裝依賴項

```powershell
# 安裝支援 CUDA 的 PyTorch
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### 步驟 5：下載模型

從 GitHub 發布頁面下載模型，並放置在 `checkpoints/` 資料夾中。

## macOS 安裝

### 步驟 1：安裝依賴項

```bash
# 安裝 Homebrew（如尚未安裝）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安裝 Python 和 ffmpeg
brew install python@3.9 ffmpeg git
```

### 步驟 2：設定

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python3.9 -m venv venv
source venv/bin/activate

# 安裝 PyTorch（macOS 僅支援 CPU）
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

注意：macOS 以 CPU 模式執行。不支援 GPU 加速。

## Docker 安裝

### 使用 Docker

```bash
# 拉取映像檔
docker pull ghcr.io/opentalker/sadtalker:latest

# 執行（需要 GPU 支援）
docker run --gpus all -v $(pwd):/workspace -p 8888:8888 ghcr.io/opentalker/sadtalker:latest
```

### 使用 Docker Compose

```yaml
version: '3.8'
services:
  sadtalker:
    image: ghcr.io/opentalker/sadtalker:latest
    volumes:
      - ./workspace:/workspace
    ports:
      - "8888:8888"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

## 驗證安裝

```bash
# 測試基本功能
python inference.py --help

# 應該顯示所有可用選項
```

## 常見問題

### CUDA 記憶體不足

**解決方案：**
- 減少批次大小：`--batch_size 1`
- 使用較低解析度：`--size 256`
- 啟用模型卸載
- 關閉其他 GPU 應用程式

### 缺少函式庫（Windows）

**解決方案：**
- 安裝 Visual C++ Redistributable 2015-2022
- 將 CUDA 加入系統 PATH

### 模型下載失敗

**解決方案：**
- 使用 VPN 或代理伺服器
- 從 GitHub 發布頁面手動下載
- 檢查網路連線

### 找不到 ffmpeg

**解決方案：**
- Linux：`sudo apt install ffmpeg`
- Windows：將 ffmpeg 加入 PATH
- macOS：`brew install ffmpeg`

## 相關連結

- [GitHub 專案庫](https://github.com/OpenTalker/SadTalker)
- [HuggingFace 演示](https://huggingface.co/spaces/fffilo/SadTalker)
- [論文](https://arxiv.org/abs/2303.17550)
- [模型下載](https://github.com/OpenTalker/SadTalker/releases)
