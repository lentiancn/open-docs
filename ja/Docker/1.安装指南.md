# Docker 安装指南

本指南详细介绍如何在各种操作系统上安装 Docker Desktop 和 Docker Engine。

---

## 目录

1. [Docker 简介](#docker-简介)
2. [版本说明](#版本说明)
3. [Windows 系统安装](#windows-系统安装)
4. [macOS 系统安装](#macos-系统安装)
5. [Linux 系统安装](#linux-系统安装)
6. [Docker Engine 安装（无图形界面）](#docker-engine-安装无图形界面)
7. [安装验证](#安装验证)
8. [卸载 Docker](#卸载-docker)
9. [常见问题](#常见问题)

---

## Docker 简介

Docker 是一个开源的容器化平台，用于开发、部署和运行应用程序。通过 Docker，您可以 将应用程序及其依赖项打包成轻量级、可移植的容器，从而实现"一次构建，到处运行"。

### Docker Desktop 与 Docker Engine 的区别

| 特性 | Docker Desktop | Docker Engine |
|------|----------------|---------------|
| 适用平台 | Windows、macOS、Linux | Linux |
| 图形界面 | 有 | 无 |
| 包含组件 | Docker Engine、Docker CLI、Docker Compose、Kubernetes 等 | Docker Engine、Docker CLI |
| 商业用途 | 超 250 人或年收入超 1000 万美元需付费订阅 | 免费（开源） |

> **重要提示**：在大型企业（超过 250 名员工或年收入超过 1000 万美元）的商业使用 Docker Desktop 需要付费订阅。个人使用、小型企业（员工少于 250 人且年收入低于 1000 万美元）、教育用途和非商业开源项目免费。

---

## 版本说明

Docker 提供两种更新通道：

- **稳定版（Stable）**：提供最新正式发布版本，适合一般用户
- **测试版（Test）**：提供预发布版本，适合测试新功能（请谨慎使用）

---

## Windows 系统安装

### 系统要求

#### WSL 2 后端（推荐）

- Windows 10 64 位：企业版、专业版或教育版 22H2（内部版本 19045）
- Windows 11 64 位：企业版、专业版或教育版 23H2（内部版本 22631）或更高版本
- WSL 版本 2.1.5 或更高版本
- 64 位处理器，具有二级地址转换（SLAT）功能
- 4GB 系统内存
- 在 BIOS/UEFI 中启用硬件虚拟化

#### Hyper-V 后端

- Windows 10 64 位：企业版、专业版或教育版 22H2（内部版本 19045）
- Windows 11 64 位：企业版、专业版或教育版 23H2（内部版本 22631）或更高版本
- 启用 Hyper-V 和 Containers Windows 功能
- 64 位处理器，具有二级地址转换（SLAT）功能
- 4GB 系统内存
- 在 BIOS/UEFI 中启用硬件虚拟化

> **注意**：Docker Desktop 不支持 Windows Server（如 Windows Server 2019 或 Windows Server 2022）。如需在 Windows Server 上运行容器，请参阅 Microsoft 官方文档。

> **重要提示**：运行 Windows 容器需要 Windows 10 或 Windows 11 专业版或企业版。Windows 家庭版或教育版只能运行 Linux 容器。

### 安装步骤

#### 交互式安装

1. 下载 Docker Desktop 安装程序：
   - [Docker Desktop for Windows - x86_64](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe)
   - [Docker Desktop for Windows - Microsoft Store](https://apps.microsoft.com/detail/xp8cbj40xlbwkx?hl=en-GB&gl=GB)
   - [Docker Desktop for Windows - Arm（预览版）](https://desktop.docker.com/win/main/arm64/Docker%20Desktop%20Installer.exe)

2. 双击 `Docker Desktop Installer.exe` 运行安装程序。默认安装路径为 `C:\Program Files\Docker\Docker`。

3. 在配置页面，选择**使用 WSL 2 而不是 Hyper-V**选项（或根据需要选择 Hyper-V）。

4. 按照安装向导的提示授权安装程序并继续安装。

5. 安装成功后，选择**关闭**完成安装过程。

6. 启动 Docker Desktop。

#### 命令行安装

在终端中运行以下命令安装 Docker Desktop：

```powershell
Start-Process 'Docker Desktop Installer.exe' -Wait install
```

或者使用 CMD：

```cmd
start /w "" "Docker Desktop Installer.exe" install
```

### 管理员权限您的管理员账户与

如果用户账户不同，您需要将用户添加到 **docker-users** 组才能访问需要更高权限的功能（如创建和管理 Hyper-V VM，或使用 Windows 容器）：

1. 以**管理员**身份运行**计算机管理**
2. 转到**本地用户和组** > **组** > **docker-users**
3. 右键单击将用户添加到组
4. 注销并重新登录以使更改生效

### 启动 Docker Desktop

Docker Desktop 安装后不会自动启动。启动方法：

1. 搜索 Docker，选择搜索结果中的 **Docker Desktop**
2. 接受 Docker 订阅服务协议
3. Docker Desktop 将启动

### WSL 设置验证

如果您选择使用 WSL，请通过以下命令验证 WSL 版本：

```powershell
wsl --version
```

如果版本信息不显示，说明使用的是 WSL 旧版，需要更新。可通过以下命令更新：

```powershell
wsl --install
# 或
wsl --update
```

### 安装程序参数

| 参数 | 说明 |
|------|------|
| `--quiet` | 静默安装，不显示安装信息 |
| `--accept-license` | 接受 Docker 订阅服务协议 |
| `--installation-dir=<路径>` | 更改默认安装位置（默认：`C:\Program Files\Docker\Docker`）|
| `--backend=<后端名称>` | 选择默认后端：`hyper-v`、`windows` 或 `wsl-2`（默认）|
| `--always-run-service` | 安装后自动启动 `com.docker.service` 并设置为自动启动 |
| `--allowed-org=<组织名称>` | 要求用户登录并加入指定的 Docker Hub 组织 |
| `--admin-settings` | 自动创建 admin-settings.json 文件用于企业管理 |
| `--no-windows-containers` | 禁用 Windows 容器集成 |
| `--proxy-http-mode=<模式>` | 设置 HTTP 代理模式：`system`（默认）或 `manual` |
| `--override-proxy-http=<URL>` | 设置 HTTP 代理 URL |
| `--override-proxy-https=<URL>` | 设置 HTTPS 代理 URL |
| `--hyper-v-default-data-root=<路径>` | 指定 Hyper-V VM 磁盘默认位置 |
| `--windows-containers-default-data-root=<路径>` | 指定 Windows 容器默认位置 |
| `--wsl-default-data-root=<路径>` | 指定 WSL 发行版磁盘默认位置 |

---

## macOS 系统安装

### 系统要求

#### Apple Silicon（M 系列芯片）

- macOS 11.0（Big Sur）或更高版本
- 至少 4GB 内存
- 支持 Virtualization.framework 的 macOS 版本

#### Intel 芯片

- macOS 10.15（Catalina）或更高版本
- 至少 4GB 内存

### 安装步骤

1. 下载 Docker Desktop for Mac：
   - [Apple Silicon（M 系列）](https://desktop.docker.com/mac/main/arm64/Docker.dmg)
   - [Intel 芯片](https://desktop.docker.com/mac/main/amd64/Docker.dmg)

2. 双击 `Docker.dmg` 打开安装程序。

3. 将 Docker 应用拖放到 Applications 文件夹中。

4. 从 Applications 文件夹或 Launchpad 启动 Docker Desktop。

5. 接受 Docker 订阅服务协议。

6. 等待 Docker Desktop 完成初始化。

### 启动验证

安装成功后，可以在终端中运行以下命令验证：

```bash
docker --version
docker-compose --version
docker run hello-world
```

---

## Linux 系统安装

### 支持的发行版

| 发行版 | x86_64/amd64 | arm64/aarch64 | arm（32位）| ppc64le | s390x |
|--------|:------------:|:-------------:|:----------:|:-------:|:-----:|
| Ubuntu | ✅ | ✅ | ✅ | ✅ | ✅ |
| Debian | ✅ | ✅ | ✅ | ✅ | |
| Fedora | ✅ | ✅ | | ✅ | |
| CentOS | ✅ | ✅ | | ✅ | |
| RHEL | ✅ | ✅ | | | ✅ |
| SLES | | | | | ❌ |
| Raspberry Pi OS | | | ⚠️ | | |

### Ubuntu 安装

#### 卸载旧版本

```bash
sudo apt-get remove docker docker-engine docker.io containerd runc
```

#### 安装准备

1. 更新 apt 包索引：

```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release
```

2. 添加 Docker 的官方 GPG 密钥：

```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

3. 设置稳定版仓库：

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

4. 更新 apt 包索引：

```bash
sudo apt-get update
```

#### 安装 Docker Engine

安装最新版本：

```bash
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

安装特定版本：

```bash
# 查看可用版本
apt-cache madison docker-ce

# 安装指定版本（示例：5:24.0.7-1~ubuntu.22.04~jammy）
sudo apt-get install docker-ce=5:24.0.7-1~ubuntu.22.04~jammy docker-ce-cli=5:24.0.7-1~ubuntu.22.04~jammy containerd.io docker-buildx-plugin docker-compose-plugin
```

#### 验证安装

```bash
sudo docker run hello-world
```

#### 以非 root 用户身份运行 Docker

默认情况下，Docker 守护进程需要 root 权限。若要在不使用 sudo 的情况下运行 Docker：

```bash
sudo usermod -aG docker $USER
```

然后注销并重新登录。

### Debian 安装

#### 卸载旧版本

```bash
sudo apt-get remove docker docker-engine docker.io containerd runc
```

#### 安装准备

1. 更新 apt 包索引：

```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
```

2. 添加 Docker 的官方 GPG 密钥：

```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

3. 设置稳定版仓库：

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

4. 更新 apt 包索引：

```bash
sudo apt-get update
```

#### 安装 Docker Engine

```bash
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### Fedora 安装

#### 卸载旧版本

```bash
sudo dnf remove docker docker-client docker-client-common docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine
```

#### 安装准备

1. 安装 dnf-plugins-core：

```bash
sudo dnf -y install dnf-plugins-core
```

2. 设置稳定版仓库：

```bash
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
```

#### 安装 Docker Engine

```bash
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### CentOS 安装

#### 卸载旧版本

```bash
sudo yum remove docker docker-client docker-client-common docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine
```

#### 安装准备

1. 安装必要工具：

```bash
sudo yum install -y yum-utils
```

2. 设置稳定版仓库：

```bash
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

#### 安装 Docker Engine

```bash
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### Raspberry Pi OS 安装

对于 Raspberry Pi OS（32 位），请注意：

- 仅支持 Raspberry Pi 3、4 和 400
- 需要使用 Raspbian Buster 或更高版本
- 建议使用 32 位 Docker Engine 二进制文件

安装步骤与 Debian 类似，但需要使用 Raspberry Pi 的专用仓库。

---

## Docker Engine 安装（无图形界面）

对于 Linux 服务器环境，可以仅安装 Docker Engine（命令行版本），无需 Docker Desktop。

### 二进制文件安装

适用于任何 Linux 发行版的静态二进制安装：

1. 下载 Docker 二进制文件：

```bash
# x86_64
curl -OL https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz

# arm64
curl -OL https://download.docker.com/linux/static/stable/aarch64/docker-24.0.7.tgz

# armhf
curl -OL https://download.docker.com/linux/static/stable/armhf/docker-24.0.7.tgz
```

2. 解压：

```bash
tar xzf docker-24.0.7.tgz
```

3. 将二进制文件移动到 PATH：

```bash
sudo cp docker/* /usr/local/bin/
sudo rm -rf docker
```

4. 启动 Docker 守护进程：

```bash
sudo dockerd &
```

5. 验证安装：

```bash
sudo docker run hello-world
```

---

## 安装验证

无论在哪种操作系统上安装，都可以通过以下命令验证 Docker 是否正常工作：

```bash
docker --version          # 查看 Docker 版本
docker-compose --version  # 查看 Docker Compose 版本
docker run hello-world    # 运行测试容器
```

如果看到 "Hello from Docker!" 消息，表示安装成功。

---

## 卸载 Docker

### Windows 卸载

1. 打开 Windows 设置 > 应用
2. 找到 Docker Desktop
3. 点击卸载

或者使用命令行：

```powershell
"Docker Desktop Installer.exe" uninstall
```

### macOS 卸载

1. 从 Applications 文件夹中删除 Docker 应用
2. 运行以下命令清理残留文件：

```bash
rm -rf ~/Library/Containers/com.docker.docker
rm -rf ~/Library/Application\ Support/Docker
rm -rf ~/Library/Group\ Containers/group.com.docker
```

### Linux 卸载

#### Ubuntu/Debian

```bash
sudo apt-get remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
```

#### Fedora/CentOS

```bash
sudo dnf remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
# 或
sudo yum remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
```

---

## 常见问题

### Q1: Docker Desktop 需要付费吗？

Docker Desktop 对以下用途免费：
- 小型企业（员工少于 250 人且年收入低于 1000 万美元）
- 个人用途
- 教育用途
- 非商业开源项目

商业用途（超过 250 名员工或年收入超过 1000 万美元）需要付费订阅。

### Q2: 如何在 Docker Desktop 中切换 Windows 和 Linux 容器？

从 Docker Desktop 菜单中，选择：
- **Switch to Windows containers** - 使用 Windows 容器
- **Switch to Linux containers** - 使用 Linux 容器（默认）

### Q3: Docker Desktop 支持哪些 Windows 版本？

Docker Desktop 仅支持仍处于 Microsoft 服务时间线的 Windows 版本：
- Windows 10 企业版、专业版或教育版 22H2
- Windows 11 企业版、专业版或教育版 23H2

不支持 Windows Home（仅支持 Linux 容器）、Windows Server 等服务器版本。

### Q4: 如何在没有管理员权限的情况下运行 Docker Desktop？

IT 管理员可以使用 `--always-run-service` 参数安装 Docker Desktop，这样用户无需管理员权限即可运行。

### Q5: Docker Desktop 在虚拟机（VM/VDI）中运行是否支持？

Docker Business 客户支持在 VMware ESXi 或 Azure VM 中运行 Docker Desktop。需要先在虚拟机管理程序上启用嵌套虚拟化。

### Q6: 如何配置 Docker Desktop 的代理？

可以通过以下方式配置代理：
1. Docker Desktop 设置 > 资源 > 代理
2. 使用安装参数：`--proxy-http-mode=manual --override-proxy-http=<URL>`

---

## 相关链接

- [Docker 官方文档](https://docs.docker.com/)
- [Docker Desktop 下载](https://www.docker.com/products/docker-desktop/)
- [Docker Hub](https://hub.docker.com/)
- [Docker 订阅和定价](https://www.docker.com/pricing/)
- [Docker 订阅服务协议](https://www.docker.com/legal/docker-subscription-service-agreement/)
