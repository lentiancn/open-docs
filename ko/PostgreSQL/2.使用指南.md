# PostgreSQL 사용자 가이드

이 가이드에서는 PostgreSQL 데이터베이스 관리 시스템 사용하는 방법을 설명합니다.

## 빠른 시작

### 데이터베이스에 연결

```bash
# psql 사용
psql -U postgres -h localhost

# 데이터베이스 생성
CREATE DATABASE myapp;

# 데이터베이스에 연결
\c myapp

# 종료
\q
```

### 테이블 생성

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 데이터 삽입

```sql
INSERT INTO users (username, email, password)
VALUES ('john', 'john@example.com', 'hashed_password');

-- 대량 삽입
INSERT INTO users (username, email, password)
VALUES 
    ('alice', 'alice@example.com', 'hash1'),
    ('bob', 'bob@example.com', 'hash2');
```

### 데이터 조회

```sql
-- 모두 조회
SELECT * FROM users;

-- 조건 조회
SELECT * FROM users WHERE id = 1;

-- 페이지 조회
SELECT * FROM users LIMIT 10 OFFSET 0;

-- 정렬
SELECT * FROM users ORDER BY created_at DESC;
```

### 데이터 업데이트

```sql
UPDATE users 
SET email = 'newemail@example.com' 
WHERE id = 1;
```

### 데이터 삭제

```sql
DELETE FROM users WHERE id = 1;
```

## 일반적인 데이터 타입

### 숫자 타입

| 타입 | 설명 |
|------|------|
| SMALLINT | 2바이트 정수 (-32768 ~ 32767) |
| INTEGER | 4바이트 정수 |
| BIGINT | 8바이트 정수 |
| DECIMAL | 정확한 값 |
| REAL | 4바이트 부동소수점 |
| DOUBLE PRECISION | 8바이트 부동소수점 |

### 문자열 타입

| 타입 | 설명 |
|------|------|
| CHAR(n) | 고정 길이 |
| VARCHAR(n) | 가변 길이 |
| TEXT | 가변 길이 (무제한) |

### 날짜 시간 타입

| 타입 | 설명 |
|------|------|
| DATE | 날짜 |
| TIME | 시간 |
| TIMESTAMP | 날짜와 시간 |
| TIMESTAMPTZ | 시간대 포함 날짜와 시간 |

### JSON 타입

```sql
-- JSON 타입
CREATE TABLE events (
    id SERIAL PRIMARY KEY,
    data JSON
);

INSERT INTO events (data) VALUES 
    ('{"name": "John", "age": 30}');

-- JSON 데이터 조회
SELECT data->>'name' FROM events;
```

## 제약조건

### 기본 키

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);
```

### 외래 키

```sql
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    total DECIMAL(10,2)
);
```

### 고유 제약조건

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE
);
```

### NOT NULL 제약조건

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL
);
```

### CHECK 제약조건

```sql
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    price DECIMAL(10,2) CHECK (price > 0)
);
```

## 인덱스

### 인덱스 생성

```sql
-- 단일 열 인덱스
CREATE INDEX idx_users_email ON users(email);

-- 다중 열 인덱스
CREATE INDEX idx_orders_user_id_total ON orders(user_id, total);

-- 고유 인덱스
CREATE UNIQUE INDEX idx_users_username ON users(username);
```

### 인덱스 삭제

```sql
DROP INDEX idx_users_email;
```

## 뷰

### 뷰 생성

```sql
CREATE VIEW active_users AS
SELECT * FROM users 
WHERE created_at > '2024-01-01';
```

### 뷰 사용

```sql
SELECT * FROM active_users;
```

## 스토어드 프로시저와 함수

### 함수 생성

```sql
CREATE OR REPLACE FUNCTION get_user_count()
RETURNS INTEGER AS $$
DECLARE
    count INTEGER;
BEGIN
    SELECT COUNT(*) INTO count FROM users;
    RETURN count;
END;
$$ LANGUAGE plpgsql;
```

### 함수 호출

```sql
SELECT get_user_count();
```

## 트랜잭션

```sql
BEGIN;

INSERT INTO users (username, email) VALUES ('user1', 'user1@example.com');
INSERT INTO users (username, email) VALUES ('user2', 'user2@example.com');

COMMIT;  -- 또는 ROLLBACK;
```

## 백업 및 복원

### 백업

```bash
# 단일 데이터베이스 백업
pg_dump -U postgres mydb > backup.sql

# 모든 데이터베이스 백업
pg_dumpall -U postgres > all_backup.sql

# 압축 백업
pg_dump -U postgres mydb | gzip > backup.sql.gz
```

### 복원

```bash
# 데이터베이스 복원
psql -U postgres mydb < backup.sql

# 모든 데이터베이스 복원
psql -U postgres -f all_backup.sql

# 압축 해제 복원
gunzip -c backup.sql.gz | psql -U postgres mydb
```

## 사용자 관리

### 사용자 생성

```sql
CREATE USER myuser WITH PASSWORD 'mypassword';
```

### 권한 부여

```sql
-- 데이터베이스 권한 부여
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;

-- 테이블 권한 부여
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO myuser;

-- 시퀀스 권한 부여
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO myuser;
```

### 사용자 삭제

```sql
DROP USER myuser;
```

## 성능 최적화

### EXPLAIN 분석

```sql
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';
```

### ANALYZE로 통계 업데이트

```sql
ANALYZE users;
```

### VACUUM으로 정리

```sql
-- 죽은 튜플 정리
VACUUM users;

-- 테이블 재구성
VACUUM FULL users;
```

## 관련 자료

- [PostgreSQL 공식 문서](https://www.postgresql.org/docs/)
- [PostgreSQL 문서](https://www.postgresql.org/docs/)
- [pgAdmin 도구](https://www.pgadmin.org/)
