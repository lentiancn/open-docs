# FantasyTalking - 使用手冊

詳細使用方法和示例。

## 基本用法

### 生成影片

```bash
python inference.py \
  --source_image face.jpg \
  --audio speech.wav \
  --output output.mp4
```

### 參數說明

| 參數 | 簡寫 | 說明 | 默認值 |
|------|------|------|--------|
| --source_image | -s | 輸入人物圖片路徑 | 必填 |
| --audio | -a | 輸入音訊檔案路徑 | 必填 |
| --output | -o | 輸出影片路徑 | output.mp4 |
| --face_enhancer | -f | 人臉增強模型 | None |
| --max_frames | -m | 最大幀數 | 300 |
| --fps | -fps | 輸出幀率 | 25 |

### 完整示例

```bash
python inference.py \
  --source_image photos/person1.jpg \
  --audio audio/speech.wav \
  --output results/video1.mp4 \
  --face_enhancer realusf \
  --fps 30
```

## 進階用法

### Python API

```python
from fantasytalking import FantasyTalking

# 初始化模型
ft = FantasyTalking(
    checkpoint_path="./models/checkpoint.pth",
    face_enhancer="realusf"
)

# 生成影片
ft.generate(
    source_image="face.jpg",
    audio="speech.wav",
    output="output.mp4"
)
```

### 批次處理

```python
import os
from fantasytalking import FantasyTalking

ft = FantasyTalking()

images_dir = "./images"
audio_dir = "./audio"
output_dir = "./output"

for image_file in os.listdir(images_dir):
    for audio_file in os.listdir(audio_dir):
        output_name = f"{image_file}_{audio_file}.mp4"
        ft.generate(
            source_image=os.path.join(images_dir, image_file),
            audio=os.path.join(audio_dir, audio_file),
            output=os.path.join(output_dir, output_name)
        )
```

### Web API 服務

```bash
# 啟動 API 服務
python api.py --port 8080
```

調用示例：

```bash
curl -X POST http://localhost:8080/generate \
  -F "image=@face.jpg" \
  -F "audio=@speech.wav" \
  -o output.mp4
```

## 輸入要求

### 圖片格式

- **支持格式**：JPG、PNG、BMP
- **建議解析度**：512x512 或更高
- **人臉要求**：
  - 正面免冠照片效果最佳
  - 臉部占據畫面 50% 以上
  - 光線充足、表情自然

### 音訊格式

- **支持格式**：WAV、MP3、FLAC
- **採樣率**：16000 Hz 或 44100 Hz
- **時長**：建議 1-60 秒
- **語言**：支持多語言自動識別

## 輸出設置

### 解析度

```bash
# 設置輸出解析度
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --size 512
```

支持的解析度：256、512、768、1024

### 幀率

```bash
# 設置幀率
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --fps 30
```

### 影片格式

支持輸出格式：MP4 (H.264)、AVI、MOV

## 效能優化

### GPU 加速

確保使用 CUDA：

```python
ft = FantasyTalking(device="cuda")
```

### 批處理

處理多個檔案時使用批處理：

```python
ft.batch_generate(image_list, audio_list, output_dir)
```

### 混合精度

啟用 FP16 加速：

```python
ft = FantasyTalking(precision="fp16")
```

## 常見問題

### 影片生成失敗？

1. 檢查輸入圖片是否包含人臉
2. 確認音訊檔案格式正確
3. 確保記憶體充足

### 人臉變形？

1. 使用更清晰的輸入圖片
2. 調整人臉關鍵點參數

### 口型不同步？

1. 確保音訊清晰無噪音
2. 調整同步參數

## 最佳實踐

1. **選擇合適的圖片**：正面、高清、光線均勻
2. **準備清晰的音訊**：無噪音、語速適中
3. **合理設置參數**：根據需求調整解析度和幀率
4. **使用人臉增強器**：提升畫面質量

## 後續階段

- 常見問題解答：參見 4.常見問題.md
