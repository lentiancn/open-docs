# Docker ユーザーマニュアル

このマニュアルでは、イメージ管理、コンテナ操作、ネットワーク構成、ボリューム管理など、Docker の基本的な使用方法について詳しく説明します。

---

## 目次

1. [Docker の基本的な概念](#docker-基本的な概念)
2. [イメージ操作](#イメージ操作)
3. [コンテナ操作](#コンテナ操作)
4. [ネットワーク管理](#ネットワーク管理)
5. [ボリューム管理](#ボリューム管理)
6. [Docker Compose の使用](#docker-compose-使用)
7. [Dockerfile の記述](#dockerfile-記述)
8. [Docker 共通コマンド早見表](#docker-共通コマンド早見表)
9. [ベストプラクティス](#ベストプラクティス)
10. [トラブルシューティング](#トラブルシューティング)

---

## Docker の基本的な概念

### コンテナとは？

コンテナは、ソフトウェアの実行に必要なすべてのもの（コード、ランタイム、システムツール、システムライブラリ、設定）を含む軽量で実行可能な独立したパッケージです。コンテナ化により、ソフトウェアを一貫してどの環境でも実行できます。

### コアコンポーネント

- **イメージ（Image）**：コンテナの作成に使用する読み取り専用テンプレート
- **コンテナ（Container）**：イメージの実行インスタンス
- **リポジトリ（Repository）**：イメージを保存する場所
- **Dockerfile**：イメージをビルドするためのスクリプトファイル
- **Docker Compose**：マルチコンテナアプリケーションを定義して実行するツール

---

## イメージ操作

### イメージのプル

Docker Hub からイメージをプル：

```bash
# 最新バージョンをプル
docker pull nginx

# 特定バージョンをプル
docker pull nginx:1.25
```

### イメージリストの表示

```bash
# ローカルにあるすべてのイメージを一覧表示
docker images
```

### イメージの削除

```bash
# 指定したイメージを削除
docker rmi nginx:latest

# 強制削除
docker rmi -f nginx:latest
```

### イメージのビルド

Dockerfile を使用してイメージをビルド：

```bash
docker build -t myapp:latest .
```

---

## コンテナ操作

### コンテナの作成と起動

```bash
# インタラクティブコンテナ（ターミナル付き）
docker run -it ubuntu /bin/bash

# デーモンコンテナ（バックグラウンドで実行）
docker run -d nginx

# ポートマッピング
docker run -d -p 8080:80 nginx

# コンテナ名の指定
docker run -d --name my-nginx nginx
```

### コンテナの表示

```bash
# 実行中のコンテナを一覧表示
docker ps

# 停止中含むすべてのコンテナを一覧表示
docker ps -a
```

### コンテナライフサイクル管理

```bash
# コンテナを起動
docker start my-nginx

# コンテナを停止
docker stop my-nginx

# コンテナを再起動
docker restart my-nginx

# コンテナを削除
docker rm my-nginx
```

### コンテナ内部に入る

```bash
# exec を使用して実行中のコンテナに入る
docker exec -it my-nginx /bin/bash
```

---

## ネットワーク管理

### ネットワークの表示

```bash
# すべてのネットワークを一覧表示
docker network ls

# ネットワークの詳細情報を表示
docker network inspect bridge
```

### ネットワークの作成

```bash
# ブリッジネットワークを作成
docker network create my-network
```

---

## ボリューム管理

### ボリュームの作成

```bash
# ボリュームを作成
docker volume create my-volume

# ボリュームを一覧表示
docker volume ls
```

### ボリュームの使用

```bash
# ボリュームをマウント
docker run -d -v my-volume:/container/path nginx

# ホストディレクトリをマウント
docker run -d -v /host/path:/container/path nginx
```

---

## Docker Compose の使用

### Docker Compose ファイル構造

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### 共通コマンド

```bash
# すべてのサービスを開始
docker-compose up

# バックグラウンドで開始
docker-compose up -d

# すべてのサービスを停止
docker-compose down
```

---

## Dockerfile の記述

### 基本命令

```dockerfile
# 基本イメージを指定
FROM node:18-alpine

# 作業ディレクトリを設定
WORKDIR /app

# ファイルをコピー
COPY . .

# ポートを公開
EXPOSE 3000

# 開始コマンド
CMD ["node", "index.js"]
```

### マルチステージビルドの例

```dockerfile
# ビルドステージ
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# ランタイムステージ
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Docker 共通コマンド早見表

### イメージコマンド

| コマンド | 説明 |
|------|------|
| `docker pull <image>` | イメージをプル |
| `docker images` | イメージを一覧表示 |
| `docker rmi <image>` | イメージを削除 |
| `docker build -t <name> .` | イメージをビルド |

### コンテナコマンド

| コマンド | 説明 |
|------|------|
| `docker run -d <image>` | バックグラウンドでコンテナを実行 |
| `docker run -it <image>` | インタラクティブにコンテナを実行 |
| `docker ps` | 実行中のコンテナを一覧表示 |
| `docker ps -a` | すべてのコンテナを一覧表示 |
| `docker start <container>` | コンテナを起動 |
| `docker stop <container>` | コンテナを停止 |
| `docker rm <container>` | コンテナを削除 |
| `docker exec -it <container> /bin/bash` | コンテナに入る |

---

## ベストプラクティス

### イメージの最適化

1. **マルチステージビルドを使用**：最終イメージのサイズを削減
2. **適切な基本イメージを選択**：alpine などの軽量イメージを優先
3. **レイヤ数を削減**：RUN 命令を統合
4. **.dockerignore を使用**：不必要なファイルを除外

### セキュリティの推奨事項

1. **root ユーザーで実行しない**：USER 命令を使用
2. **基本イメージを定期的に更新**：最新のセキュリティパッチを取得
3. **公式イメージを使用**：検証済みの公式イメージを優先

---

## トラブルシューティング

### コンテナが起動しない

```bash
# コンテナログを表示
docker logs <container>
```

### ポートの競合

```bash
# ポート使用状況を確認
netstat -tlnp | grep <port>

# 別のポートを使用
docker run -d -p 8081:80 nginx
```

### ディスク容量不足

```bash
# 未使用のイメージをクリーンアップ
docker image prune -a

# 未使用のリソースをすべてクリーンアップ
docker system prune -a
```

---

## 関連リンク

- [Docker 公式ドキュメント](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose ドキュメント](https://docs.docker.com/compose/)
