# Docker Manuel Utilisateur

Ce manuel fournit des instructions détaillées sur l'utilisation de base de Docker, y compris la gestion des images, les opérations sur les conteneurs, la configuration réseau, la gestion des volumes, et plus encore.

---

## Table des Matières

1. [Concepts de Base Docker](#concepts-de-base-docker)
2. [Opérations sur les Images](#opérations-sur-les-images)
3. [Opérations sur les Conteneurs](#opérations-sur-les-conteneurs)
4. [Gestion du Réseau](#gestion-du-réseau)
5. [Gestion des Volumes](#gestion-des-volumes)
6. [Utilisation de Docker Compose](#utilisation-de-docker-compose)
7. [Écriture de Dockerfiles](#écriture-de-dockerfiles)
8. [Référence Rapide des Commandes Docker Courantes](#référence-rapide-des-commandes-docker-courantes)
9. [Meilleures Pratiques](#meilleures-pratiques)
10. [Dépannage](#dépannage)

---

## Concepts de Base Docker

### Qu'est-ce qu'un Conteneur ?

Les conteneurs sont des packages autonomes légers et exécutables qui contiennent tout ce qui est nécessaire pour exécuter le logiciel : code, runtime, outils système, bibliothèques système et paramètres. La conteneurisation garantit que le logiciel s'exécute de manière cohérente dans n'importe quel environnement.

### Composants Principaux

- **Image** : Modèle en lecture seule utilisé pour créer des conteneurs
- **Conteneur** : Instance en cours d'exécution d'une image
- **Dépôt** : Endroit pour stocker les images
- **Dockerfile** : Script utilisé pour construire des images
- **Docker Compose** : Outil pour définir et exécuter des applications multi-conteneurs

---

## Opérations sur les Images

### Tirer des Images

Tirez des images depuis Docker Hub :

```bash
# Tirer la dernière version
docker pull nginx

# Tirer une version spécifique
docker pull nginx:1.25
```

### Lister les Images

```bash
# Lister toutes les images locales
docker images
```

### Supprimer des Images

```bash
# Supprimer l'image spécifiée
docker rmi nginx:latest

# Forcer la suppression
docker rmi -f nginx:latest
```

### Construire des Images

Construisez des images en utilisant Dockerfile :

```bash
docker build -t myapp:latest .
```

---

## Opérations sur les Conteneurs

### Créer et Démarrer des Conteneurs

```bash
# Conteneur interactif (avec terminal)
docker run -it ubuntu /bin/bash

# Conteneur démon (s'exécutant en arrière-plan)
docker run -d nginx

# Mappage de ports
docker run -d -p 8080:80 nginx

# Spécifier le nom du conteneur
docker run -d --name my-nginx nginx
```

### Voir les Conteneurs

```bash
# Lister les conteneurs en cours d'exécution
docker ps

# Lister tous les conteneurs (y compris les arrétés)
docker ps -a
```

### Gestion du Cycle de Vie des Conteneurs

```bash
# Démarrer le conteneur
docker start my-nginx

# Arrêter le conteneur
docker stop my-nginx

# Redémarrer le conteneur
docker restart my-nginx

# Supprimer le conteneur
docker rm my-nginx
```

### Entrer dans le Conteneur

```bash
# Utiliser exec pour entrer dans un conteneur en cours d'exécution
docker exec -it my-nginx /bin/bash
```

---

## Gestion du Réseau

### Voir les Réseaux

```bash
# Lister tous les réseaux
docker network ls

# Voir les informations détaillées du réseau
docker network inspect bridge
```

### Créer un Réseau

```bash
# Créer un réseau bridge
docker network create my-network
```

---

## Gestion des Volumes

### Créer un Volume

```bash
# Créer un volume
docker volume create my-volume

# Lister les volumes
docker volume ls
```

### Utiliser les Volumes

```bash
# Monter un volume
docker run -d -v my-volume:/container/path nginx

# Monter un répertoire hôte
docker run -d -v /host/path:/container/path nginx
---

## Utilisation de Docker Compose

### Structure du Fichier Docker Compose

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### Commandes Courantes

```bash
# Démarrer tous les services
docker-compose up

# Démarrer en arrière-plan
docker-compose up -d

# Arrêter tous les services
docker-compose down
```

---

## Écriture de Dockerfiles

### Instructions de Base

```dockerfile
# Spécifier l'image de base
FROM node:18-alpine

# Définir le répertoire de travail
WORKDIR /app

# Copier les fichiers
COPY . .

# Exposer les ports
EXPOSE 3000

# Commande de démarrage
CMD ["node", "index.js"]
```

### Exemple de Build Multi-étapes

```dockerfile
# Étape de construction
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# Étape d'exécution
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Référence Rapide des Commandes Docker Courantes

### Commandes sur les Images

| Commande | Description |
|----------|-------------|
| `docker pull <image>` | Tirer une image |
| `docker images` | Lister les images |
| `docker rmi <image>` | Supprimer une image |
| `docker build -t <nom> .` | Construire une image |

### Commandes sur les Conteneurs

| Commande | Description |
|----------|-------------|
| `docker run -d <image>` | Exécuter un conteneur en arrière-plan |
| `docker run -it <image>` | Exécuter un conteneur de manière interactive |
| `docker ps` | Lister les conteneurs en cours d'exécution |
| `docker ps -a` | Lister tous les conteneurs |
| `docker start <conteneur>` | Démarrer un conteneur |
| `docker stop <conteneur>` | Arrêter un conteneur |
| `docker rm <conteneur>` | Supprimer un conteneur |
| `docker exec -it <conteneur> /bin/bash` | Entrer dans un conteneur |

---

## Meilleures Pratiques

### Optimisation des Images

1. **Utiliser les builds multi-étapes** : Réduire la taille de l'image finale
2. **Choisir des images de base appropriées** : Préférer les images légères comme alpine
3. **Réduire le nombre de couches** : Combiner les instructions RUN
4. **Utiliser .dockerignore** : Exclure les fichiers inutiles

### Recommandations de Sécurité

1. **Ne pas exécuter en tant que root** : Utiliser l'instruction USER
2. **Mettre à jour régulièrement les images de base** : Obtenir les derniers correctifs de sécurité
3. **Utiliser les images officielles** : Préférer les images officielles vérifiées

---

## Dépannage

### Le Conteneur ne Démarre Pas

```bash
# Voir les logs du conteneur
docker logs <conteneur>
```

### Conflits de Ports

```bash
# Vérifier l'utilisation du port
netstat -tlnp | grep <port>

# Utiliser un autre port
docker run -d -p 8081:80 nginx
```

### Problèmes d'Espace Disque

```bash
# Nettoyer les images non utilisées
docker image prune -a

# Nettoyer toutes les ressources non utilisées
docker system prune -a
---

## Liens Connexes

- [Documentation Officielle Docker](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Documentation Docker Compose](https://docs.docker.com/compose/)
