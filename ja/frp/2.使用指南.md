# frp ユーザーガイド

このガイドでは、frpを使用して内網穿透とポートマッピングを行う方法を説明します。

## クイックスタート

### サーバーの起動

```bash
# frpsを起動
./frps -c frps.ini
```

### クライアントの起動

```bash
# frpcを起動
./frpc -c frpc.ini
```

## 設定の詳細

### サーバー設定

#### 基本設定

```ini
[common]
bind_port = 7000           # frpサーポート
dashboard_port = 7500      # ダッシュボードポート
token = password           # 認証トークン
```

#### ポートマッピング

```ini
[common]
vhost_http_port = 80       # HTTP仮想ホストポート
vhost_https_port = 443    # HTTPS仮想ホストポート
```

#### ロードバランシング

```ini
[common]
max_pool_count = 10        # 接続プールサイズ
max_ports_per_client = 0   # クライアントあたりのポート数制限
```

### クライアント設定

#### TCPマッピング

```ini
# ローカルSSHをマッピング
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

#### HTTPマッピング

```ini
# Webサービスをマッピング
[web]
type = http
local_port = 8080
custom_domains = example.com
```

#### HTTPSマッピング

```ini
[web_https]
type = https
local_port = 8443
custom_domains = example.com
```

## 上級機能

### ロードバランシング

```ini[test_http]
type = http
local_port = 8080
custom_domains = web.example.com
group = web_group
group_key = 123
```

### プラグイン

#### HTTPプロキシ

```ini
[http_proxy]
type = tcp
plugin = http_proxy
plugin_http_user = user
plugin_http_password = password
local_port = 8080
remote_port = 8000
```

#### 静的ファイル

```ini
[static_file]
type = tcp
plugin = static_file
plugin_local_path = /var/www
pluginstrip_prefix = static
remote_port = 8000
```

## セキュリティ設定

### 暗号化

```ini
[common]
use_encryption = true
```

### 圧縮

```ini
[common]
use_compression = true
```

### 認証

```ini
[common]
authentication_method = token
token = your_secure_token
```

## モニタリング

### ダッシュボード

```ini
[common]
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = admin
```

http://your_server:7500 にアクセスしてステータスを確認。

### ポート統計

```ini
[common]
plugin = ports_stats
```

## パフォーマンス最適化

### 接続プール

```ini
[common]
max_pool_count = 50
max_conn_per_proxy = 10
```

### ハートビート

```ini
[common]
heartbeat_interval = 30
heartbeat_timeout = 90
```

### ログレベル

```ini
[common]
log_level = warn
log_max_days = 3
```

## 使用シナリオ

### 1. 内網SSHへのリモートアクセス

```ini
[ssh]
type = tcp
local_ip = 192.168.1.100
local_port = 22
remote_port = 6000
```

### 2. 内網Webサービスの公開

```ini
[web]
type = http
local_port = 8080
custom_domains = yourdomain.com
```

### 3. 内網データベースへのアクセス

```ini
[mysql]
type = tcp
local_ip = 192.168.1.100
local_port = 3306
remote_port = 13306
```

### 4. WeChat/決済コールバック

```ini
[wechat]
type = http
local_port = 8080
custom_domains = callback.yourdomain.com
```

## トラブルシューティング

### 接続問題

1. サーバーログを確認
2. ポートが開放されているか検証
3. ファイアウォールを確認

### パフォーマンス問題

1. 接続プールサイズを調整
2. 圧縮を有効化
3. ネットワーク帯域幅を確認

## 関連リソース

- [frp 公式ドキュメント](https://gofrp.org/docs/)
- [GitHub](https://github.com/fatedier/frp)
