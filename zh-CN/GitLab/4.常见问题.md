# GitLab 常见问题

本章节汇总了 GitLab 使用中的常见问题。

## 启动问题

### Q1: 启动失败

**问题描述：**
GitLab 无法启动。

**解决方案：**
```bash
# 查看日志
sudo gitlab-ctl tail

# 检查状态
sudo gitlab-ctl status

# 重新配置
sudo gitlab-ctl reconfigure
```

### Q2: 端口被占用

**问题描述：**
80 或 443 端口被占用。

**解决方案：**
```ruby
# 更改端口
nginx['listen_port'] = 8080
external_url 'http://gitlab.example.com:8080'
```

## 性能问题

### Q3: 加载缓慢

**问题描述：**
页面加载很慢。

**解决方案：**
1. 增加内存
2. 优化 Unicorn workers
   ```ruby
   unicorn['worker_processes'] = 4
   ```

3. 启用缓存

### Q4: 内存不足

**问题描述：**
GitLab 占用内存过高。

**解决方案：**
```ruby
# 减少 worker 数
unicorn['worker_processes'] = 2
sidekiq['concurrency'] = 5
```

## 备份问题

### Q5: 备份失败

**问题描述：**
备份时出错。

**解决方案：**
```bash
# 检查磁盘空间
df -h

# 检查权限
ls -la /var/opt/gitlab/backups

# 手动备份
sudo gitlab-backup create
```

### Q6: 恢复失败

**解决方案：**
```bash
# 停止服务
sudo gitlab-ctl stop

# 检查备份文件
ls -la /var/opt/gitlab/backups

# 恢复
sudo gitlab-backup restore BACKUP=timestamp
```

## Git 问题

### Q7: 推送失败

**问题描述：**
无法推送到 GitLab。

**解决方案：**
1. 检查 SSH 密钥
   ```bash
   ssh -T git@gitlab.com
   ```

2. 添加远程
   ```bash
   git remote add origin git@gitlab.com:user/project.git
   ```

3. 设置默认分支
   ```bash
   git push -u origin master
   ```

### Q8: 克隆失败

**解决方案：**
1. 检查网络
2. 使用 HTTPS
   ```bash
   git clone https://gitlab.com/user/project.git
   ```

## CI/CD 问题

### Q9: Pipeline 失败

**问题描述：**
CI/CD 执行失败。

**解决方案：**
1. 查看 Pipeline 日志
2. 检查 .gitlab-ci.yml 语法
3. 确保 Runner 正常

### Q10: Runner 不运行

**解决方案：**
```bash
# 检查 Runner 状态
sudo gitlab-runner status

# 重启 Runner
sudo gitlab-runner restart

# 注册新 Runner
sudo gitlab-runner register
```

## 权限问题

### Q11: 权限不足

**问题描述：**
无法访问项目。

**解决方案：**
1. 联系项目管理员
2. 检查访问级别
3. 确认 SSH 密钥

### Q12: 无法推送

**解决方案：**
检查分支保护设置：
- 进入项目设置
- 查看分支保护规则
- 确保有推送权限

## 邮件问题

### Q13: 邮件不发送

**解决方案：**
```ruby
# 配置 SMTP
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
```

测试邮件：
```bash
sudo gitlab-rails console
Notify.test_email('test@example.com', 'Test', 'Test').deliver_now
```

## SSL 问题

### Q14: SSL 证书错误

**解决方案：**
1. 使用 Let's Encrypt
   ```ruby
   letsencrypt['enable'] = true
   ```

2. 或配置自定义证书
   ```ruby
   nginx['ssl_certificate'] = "/path/to/cert.crt"
   nginx['ssl_certificate_key'] = "/path/to/cert.key"
   ```

## 升级问题

### Q15: 升级失败

**解决方案：**
1. 完整备份
2. 查看升级文档
3. 逐步升级

```bash
# 备份
sudo gitlab-backup create

# 升级
sudo apt-get update
sudo apt-get install gitlab-ee

# 重新配置
sudo gitlab-ctl reconfigure
```

## 安全问题

### Q16: 安全扫描不运行

**解决方案：**
1. 确保是私有项目
2. 检查 GitLab 版本
3. 查看扫描配置

## 总结

本章节涵盖了 GitLab 使用中的常见问题：

- **启动**：失败、端口占用
- **性能**：加载缓慢、内存不足
- **备份**：失败、恢复
- **Git**：推送、克隆失败
- **CI/CD**：Pipeline、Runner
- **权限**：访问不足
- **邮件**：发送失败
- **SSL**：证书错误
- **升级**：失败

如需更多信息，请参考官方文档：https://docs.gitlab.com/
