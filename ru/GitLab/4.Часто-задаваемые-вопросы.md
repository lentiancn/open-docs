# Часто задаваемые вопросы о GitLab

> Ответы на распространённые вопросы о GitLab

---

## Установка

### Q: GitLab недоступен после установки?

**A**: Проверьте следующее:
- Правильно ли настроен внешний URL?
- Разрешены ли порты 80 и 443 в брандмауэре?
- Проверьте, запущена ли служба: `sudo gitlab-ctl status`
- Проверьте логи: `sudo gitlab-ctl tail`

### Q: Слишком высокая нагрузка на память?

**A**: GitLab требует много ресурсов. Рекомендации:
- Минимум 4 ГБ ОЗУ, рекомендуется 8 ГБ или больше
- Оптимизация:
  ```ruby
  # /etc/gitlab/gitlab.rb
  postgresql['shared_buffers'] = "256MB"
  unicorn['worker_processes'] = 2
  ```

### Q: Как мигрировать данные GitLab?

**A**: Используйте резервное копирование и восстановление GitLab:
```bash
# Резервное копирование
sudo gitlab-backup create

# Восстановление
sudo gitlab-backup restore BACKUP=timestamp
```

---

## Операции Git

### Q: Отказано в доступе при отправке?

**A**: 
1. Проверьте, что открытый SSH-ключ добавлен в профиль GitLab
2. Проверьте права участника проекта
3. При использовании HTTPS проверьте имя пользователя и токен доступа

### Q: Запрос на слияние показывает конфликты?

**A**:
1. Получите последнюю версию целевой ветки локально
2. Перебазируйте вашу ветку на целевую ветку
3. Разрешите конфликты и принудительно отправьте:
   ```bash
   git fetch origin
   git checkout your-branch
   git rebase origin/main
   # После разрешения конфликтов
   git push --force-with-lease
   ```

### Q: Не удаётся отправить большие файлы?

**A**: GitLab ограничивает размер файлов по умолчанию, измените конфигурацию:
```ruby
# /etc/gitlab/gitlab.rb
gitlab_rails['max_attachment_size'] = 100 * 1024 * 1024 # 100 МБ
```
Или используйте Git LFS:
```bash
git lfs install
git lfs track "*.psd"
```

---

## CI/CD

### Q: Пайплайн завис в ожидании?

**A**: 
1. Проверьте, зарегистрирован ли GitLab Runner и находится он в сети
2. Проверьте, соответствуют ли теги Runner заданиям
3. Проверьте ограничение параллелизма Runner

### Q: Как использовать частный реестр образов?

**A**: 
```yaml
build:
  image: my-private-image
  variables:
    DOCKER_AUTH_CONFIG: '{"auths":{"registry.example.com":{"username":"user","password":"pass"}}}'
```

### Q: Кэш не работает?

**A**: Убедитесь, что конфигурация кэша правильная:
```yaml
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
  policy: pull-push
```

---

## Права доступа

### Q: Как настроить защиту веток?

**A**: 
1. Перейдите в Проект → Настройки → Репозиторий → Защищённые ветки
2. Выберите ветку для защиты
3. Настройте, кто может отправлять и сливать

### Q: Нет доступа к проекту?

**A**: 
1. Проверьте настройки видимости проекта (публичный/внутренний/частный)
2. Проверьте, добавлены ли вы как участник проекта
3. Свяжитесь с администратором проекта для получения доступа

---

## Оптимизация производительности

### Q: Страницы загружаются медленно?

**A**: 
1. Включите мониторинг Prometheus для анализа
2. Оптимизируйте конфигурацию PostgreSQL
3. Используйте кэширование Redis
4. Рассмотрите репликацию PostgreSQL «master-slave»

### Q: Как ограничить квоты пользователей?

**A**: Настройте в административной панели:
- Ограничения квоты хранилища
- Ограничения количества репозиториев
- Квоты пользователей

---

## Резервное копирование и восстановление

### Q: Как настроить автоматическое резервное копирование?

**A**: Настройте cron-задачу:
```bash
# Автоматическое резервное копирование каждый день в 2:00
0 2 * * * /opt/gitlab/bin/gitlab-backup create CRON=1
```

### Q: Где находятся файлы резервных копий?

**A**: По умолчанию в каталоге `/var/opt/gitlab/backups/`

---

## Обновления

### Q: Как обновить GitLab?

**A**: 
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install gitlab-ee

# Затем перенастроить
sudo gitlab-ctl reconfigure
```

### Q: Нужно ли делать резервную копию перед обновлением?

**A**: Да, настоятельно рекомендуется сделать резервную копию перед обновлением:
```bash
sudo gitlab-backup create
sudo gitlab-ctl stop
```

---

## Распространённые коды ошибок

| Код ошибки | Описание | Решение |
|------------|----------|---------|
| 500 | Внутренняя ошибка сервера | Проверьте логи |
| 502 | Ошибка шлюза | Проверьте статус службы |
| 503 | Служба недоступна | Проверьте использование ресурсов |
| 404 | Ресурс не найден | Проверьте URL |
| 422 | Необрабатываемый объект | Проверьте параметры |
