# MySQL Installation Guide

This guide provides detailed instructions for installing MySQL on all major platforms.

---

## Table of Contents

- [Choosing a Version](#choosing-a-version)
- [Docker (Recommended)](#docker-recommended)
- [Linux](#linux)
  - [Ubuntu/Debian](#ubuntudebian)
  - [CentOS/RHEL](#centosrhel)
  - [Fedora](#fedora)
- [macOS](#macos)
- [Windows](#windows)
- [Verify Installation](#verify-installation)
- [Initial Setup](#initial-setup)

---

## Choosing a Version

MySQL has two release tracks:

| Track | Version | Description |
|-------|---------|-------------|
| **Bugfix** | 8.0.x, 8.4.x | Stable, production-ready, includes bug fixes |
| **Innovation** | 9.x | Latest features, may have behavior changes |

**Recommendation:** Use MySQL 8.0 or 8.4 for production. MySQL 9.x is the latest innovation release.

---

## Docker (Recommended)

The easiest way to run MySQL on any platform.

### Quick Start

```bash
# Run MySQL 8
docker run -d \
  --name mysql \
  -e MYSQL_ROOT_PASSWORD=your_password \
  -e MYSQL_DATABASE=mydb \
  -e MYSQL_USER=user \
  -e MYSQL_PASSWORD=password \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8

# Run MySQL 5.7 (legacy)
docker run -d \
  --name mysql5 \
  -e MYSQL_ROOT_PASSWORD=your_password \
  -v mysql-data:/var/lib/mysql \
  -p 3307:3306 \
  mysql:5.7
```

### Environment Variables

| Variable | Description |
|----------|-------------|
| `MYSQL_ROOT_PASSWORD` | Root password (required) |
| `MYSQL_DATABASE` | Create database on startup |
| `MYSQL_USER` | Create non-root user |
| `MYSQL_PASSWORD` | Password for non-root user |

### Persistence

```bash
# Data persists in the volume even after container stops
docker volume ls

# Inspect volume
docker volume inspect mysql-data
```

---

## Linux

### Ubuntu/Debian

**Method 1: Using apt (MySQL 8.0)**

```bash
# Update package index
sudo apt update

# Install MySQL Server
sudo apt install -y mysql-server

# Start MySQL service
sudo systemctl start mysql
sudo systemctl enable mysql

# Secure installation
sudo mysql_secure_installation
```

**Method 2: Using MySQL APT Repository**

```bash
# Download MySQL APT repository config
wget https://repo.mysql.com/mysql-apt-config_0.8.24-1_all.deb
sudo dpkg -i mysql-apt-config_0.8.24-1_all.deb

# Update and install
sudo apt update
sudo apt install -y mysql-community-server

# Start MySQL
sudo systemctl start mysql
sudo systemctl enable mysql
```

### CentOS/RHEL

```bash
# Install MySQL yum repository
sudo yum install -y https://dev.mysql.com/get/mysql80-community-release-el8-4.noarch.rpm

# Install MySQL Community Server
sudo yum install -y mysql-community-server

# Start MySQL
sudo systemctl start mysqld
sudo systemctl enable mysqld

# Get temporary password
sudo grep 'temporary password' /var/log/mysqld.log
```

### Fedora

```bash
# Install MySQL
sudo dnf install -y mysql-server

# Start MySQL
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

---

## macOS

### Method 1: Homebrew (Recommended)

```bash
# Install MySQL
brew install mysql

# Start MySQL
brew services start mysql

# Or run manually
mysql.server start

# Secure installation
mysql_secure_installation
```

### Method 2: DMG Installer

1. Download from [MySQL Downloads](https://dev.mysql.com/downloads/mysql/)
2. Select macOS version
3. Download and install the .dmg file
4. Run the MySQL installer

### Method 3: LaunchDaemon

```bash
# Install as launch daemon
sudo launchctl load -F /Library/LaunchDaemons/com.oracle.oss.mysql.mysqld.plist

# Start MySQL
sudo launchctl start com.oracle.oss.mysql.mysqld
```

---

## Windows

### Method 1: MySQL Installer (Recommended)

1. Download [MySQL Installer](https://dev.mysql.com/downloads/installer/)
2. Run the installer
3. Choose "Full" or "Custom" installation
4. Follow the wizard:
   - Install required products
   - Configure MySQL Server
   - Set root password
   - Configure as Windows service

### Method 2: ZIP Archive

```powershell
# Extract to desired location
# Example: C:\mysql

# Initialize data directory
cd C:\mysql
bin\mysqld --initialize-insecure

# Install as Windows service
bin\mysqld --install MySQL

# Start MySQL
net start MySQL
```

### Method 3: Chocolatey

```powershell
# Install MySQL using Chocolatey
choco install mysql

# Start MySQL service
Start-Service MySQL
```

---

## Verify Installation

```bash
# Check MySQL version
mysql --version

# For Docker
docker exec -it mysql mysql --version

# Connect to MySQL
mysql -u root -p

# Check service status (Linux)
sudo systemctl status mysql
sudo systemctl status mysqld
```

---

## Initial Setup

### Connect to MySQL

```bash
# Local connection
mysql -u root -p

# Docker connection
docker exec -it mysql mysql -u root -p
```

### Create Database and User

```sql
-- Create database
CREATE DATABASE myapp;

-- Create user
CREATE USER 'myuser'@'localhost' IDENTIFIED BY 'mypassword';

-- Grant privileges
GRANT ALL PRIVILEGES ON myapp.* TO 'myuser'@'localhost';

-- Apply changes
FLUSH PRIVILEGES;

-- Show databases
SHOW DATABASES;
```

### Common Commands

```sql
-- Show users
SELECT user, host FROM mysql.user;

-- Show databases
SHOW DATABASES;

-- Use database
USE myapp;

-- Show tables
SHOW TABLES;

-- Exit MySQL
EXIT;
-- or
QUIT;
```

---

## Configuration Files

| Platform | Default Location |
|----------|-----------------|
| Linux | `/etc/mysql/my.cnf` or `/etc/my.cnf` |
| macOS | `/usr/local/mysql/my.cnf` or `~/.my.cnf` |
| Windows | `C:\Program Files\MySQL\MySQL Server 8.0\my.ini` |

### Example Configuration (my.cnf)

```ini
[mysqld]
# Basic settings
max_connections = 200
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# InnoDB settings
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M

# Query cache (MySQL 8.0 removed this, use for 5.7)
# query_cache_type = 1
# query_cache_size = 64M

# Slow query log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

[client]
default-character-set = utf8mb4
```

---

## Upgrading MySQL

### Backup First

```bash
# Dump all databases
mysqldump -u root -p --all-databases > all_databases.sql

# Dump specific database
mysqldump -u root -p mydb > mydb.sql
```

### Upgrade Steps (Linux)

```bash
# For Ubuntu/Debian
sudo apt update
sudo apt install -y mysql-community-server

# Restart MySQL
sudo systemctl restart mysql
```

---

## Uninstall MySQL

### Ubuntu/Debian

```bash
sudo apt purge -y mysql-server mysql-community-server
sudo rm -rf /var/lib/mysql
sudo rm -rf /etc/mysql
```

### CentOS/RHEL

```bash
sudo yum remove -y mysql-community-server
sudo rm -rf /var/lib/mysql
```

### macOS

```bash
# If installed via Homebrew
brew uninstall mysql

# If installed via DMG
sudo rm -rf /usr/local/mysql
sudo rm -rf /Library/StartupItems/MySQL
```

### Windows

```bash
# Via Control Panel > Programs and Features
# Or using Chocolatey
choco uninstall mysql
```

---

## Next Steps

- [Usage Guide](./2.使用指南.md)
- [MySQL Official Documentation](https://dev.mysql.com/doc/)
- [MySQL Docker Hub](https://hub.docker.com/_/mysql)
