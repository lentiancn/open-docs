# Docker 使用手冊

本手冊詳細介紹 Docker 的基本使用方法，包括鏡像管理，容器操作，網絡配置，數據卷管理等內容。

---

## 目錄

1. [Docker 基本概念](#docker-基本概念)
2. [鏡像操作](#鏡像操作)
3. [容器操作](#容器操作)
4. [網絡管理](#網絡管理)
5. [數據卷管理](#數據卷管理)
6. [Docker Compose 使用](#docker-compose-使用)
7. [Dockerfile 編寫](#dockerfile-編寫)
8. [Docker 常用命令速查](#docker-常用命令速查)
9. [最佳實踐](#最佳實踐)
10. [故障排除](#故障排除)

---

## Docker 基本概念

### 什麼是容器？

容器是一種輕量級，可執行的獨立軟件包，包含運行所需的所有內容：代碼，運行時，系統工具，系統庫和設置。容器化使軟件可以在任何環境中一致地運行。

### 核心組件

- **鏡像（Image）**：只讀模板，用於創建容器
- **容器（Container）**：鏡像的運行實例
- **倉庫（Repository）**：存儲鏡像的地方
- **Dockerfile**：用於構建鏡像的腳本文件
- **Docker Compose**：定義和運行多容器應用的工具

---

## 鏡像操作

### 拉取鏡像

從 Docker Hub 拉取鏡像：

```bash
# 拉取最新版本
docker pull nginx

# 拉取指定版本
docker pull nginx:1.25
```

### 查看鏡像列表

```bash
# 列出本地所有鏡像
docker images
```

### 刪除鏡像

```bash
# 刪除指定鏡像
docker rmi nginx:latest

# 強制刪除
docker rmi -f nginx:latest
```

### 構建鏡像

使用 Dockerfile 構建鏡像：

```bash
docker build -t myapp:latest .
```

---

## 容器操作

### 創建並啟動容器

```bash
# 交互式容器（帶終端）
docker run -it ubuntu /bin/bash

# 守護進程容器（後台運行）
docker run -d nginx

# 端口映射
docker run -d -p 8080:80 nginx

# 指定容器名稱
docker run -d --name my-nginx nginx
```

### 查看容器

```bash
# 列出運行中的容器
docker ps

# 列出所有容器（包括停止的）
docker ps -a
```

### 容器生命周期管理

```bash
# 啟動容器
docker start my-nginx

# 停止容器
docker stop my-nginx

# 重啟容器
docker restart my-nginx

# 刪除容器
docker rm my-nginx
```

### 進入容器內部

```bash
# 使用 exec 進入運行中的容器
docker exec -it my-nginx /bin/bash
```

---

## 網絡管理

### 查看網絡

```bash
# 列出所有網絡
docker network ls

# 查看網絡詳細信息
docker network inspect bridge
```

### 創建網絡

```bash
# 創建橋接網絡
docker network create my-network
```

---

## 數據卷管理

### 創建數據卷

```bash
# 創建數據卷
docker volume create my-volume

# 列出數據卷
docker volume ls
```

### 使用數據卷

```bash
# 掛載數據卷
docker run -d -v my-volume:/container/path nginx

# 掛載主機目錄
docker run -d -v /host/path:/container/path nginx
```

---

## Docker Compose 使用

### Docker Compose 文件結構

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### 常用命令

```bash
# 啟動所有服務
docker-compose up

# 後台啟動
docker-compose up -d

# 停止所有服務
docker-compose down
```

---

## Dockerfile 編寫

### 基本指令

```dockerfile
# 指定基礎鏡像
FROM node:18-alpine

# 設置工作目錄
WORKDIR /app

# 複製文件
COPY . .

# 暴露端口
EXPOSE 3000

# 啟動命令
CMD ["node", "index.js"]
```

### 多階段構建示例

```dockerfile
# 構建階段
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# 運行階段
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Docker 常用命令速查

### 鏡像命令

| 命令 | 說明 |
|------|------|
| `docker pull <image>` | 拉取鏡像 |
| `docker images` | 列出鏡像 |
| `docker rmi <image>` | 刪除鏡像 |
| `docker build -t <name> .` | 構建鏡像 |

### 容器命令

| 命令 | 說明 |
|------|------|
| `docker run -d <image>` | 後台運行容器 |
| `docker run -it <image>` | 交互式運行容器 |
| `docker ps` | 列出運行中的容器 |
| `docker ps -a` | 列出所有容器 |
| `docker start <container>` | 啟動容器 |
| `docker stop <container>` | 停止容器 |
| `docker rm <container>` | 刪除容器 |
| `docker exec -it <container> /bin/bash` | 進入容器 |

---

## 最佳實踐

### 鏡像優化

1. **使用多階段構建**：減小最終鏡像體積
2. **選擇合適的基礎鏡像**：優先使用 alpine 等輕量鏡像
3. **減少層數**：合併 RUN 指令
4. **使用 .dockerignore**：排除不必要的文件

### 安全建議

1. **不以 root 用戶運行容器**：使用 USER 指令
2. **定期更新基礎鏡像**：獲取最新安全補丁
3. **使用官方鏡像**：優先使用經過驗證的官方鏡像

---

## 故障排除

### 容器無法啟動

```bash
# 查看容器日誌
docker logs <container>
```

### 端口衝突

```bash
# 檢查端口佔用
netstat -tlnp | grep <port>

# 使用其他端口
docker run -d -p 8081:80 nginx
```

### 磁盤空間不足

```bash
# 清理未使用的鏡像
docker image prune -a

# 清理所有未使用資源
docker system prune -a
```

---

## 相關連結

- [Docker 官方文檔](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Docker Compose 文檔](https://docs.docker.com/compose/)
