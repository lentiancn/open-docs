# MySQL 使用指南

高效使用 MySQL 的完整指南。

---

## 目錄

- [基本概念](#基本概念)
- [資料庫操作](#資料庫操作)
- [表格操作](#表格操作)
- [增刪改查](#增刪改查)
- [使用者和權限](#使用者和權限)
- [備份和恢復](#備份和恢復)
- [優化](#優化)
- [常用範例](#常用範例)
- [故障排除](#故障排除)

---

## 基本概念

### 什麼是 MySQL？

MySQL 是一個基於 SQL 的開源關聯式資料庫管理系統。

### 關鍵術語

| 術語 | 說明 |
|------|------|
| 資料庫 | 結構化的資料集合 |
| 表格 | 列和欄的集合 |
| 列 | 單筆記錄 |
| 欄 | 屬性/欄位 |
| 主鍵 | 唯一識別碼 |
| 索引 | 加速查詢 |

### 連線 MySQL

```bash
# 使用使用者名稱連線
mysql -u username -p

# 連線指定資料庫
mysql -u username -p database_name

# 連線遠端 MySQL
mysql -h hostname -u username -p database_name
```

---

## 資料庫操作

### 建立資料庫

```sql
-- 基礎建立
CREATE DATABASE myapp_db;

-- 指定字元集
CREATE DATABASE myapp_db 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- 檢查是否存在
CREATE DATABASE IF NOT EXISTS myapp_db;
```

### 列出資料庫

```sql
SHOW DATABASES;
```

### 使用資料庫

```sql
USE myapp_db;
```

### 刪除資料庫

```sql
DROP DATABASE myapp_db;
DROP DATABASE IF EXISTS myapp_db;
```

---

## 表格操作

### 建立表格

```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 常見資料類型

| 類別 | 類型 |
|------|------|
| 數值 | INT, BIGINT, FLOAT, DOUBLE |
| 字串 | CHAR, VARCHAR, TEXT |
| 日期 | DATE, DATETIME, TIMESTAMP |

### 列出表格

```sql
SHOW TABLES;
DESCRIBE users;
```

### 修改表格

```sql
-- 新增欄
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- 刪除欄
ALTER TABLE users DROP COLUMN phone;

-- 新增索引
ALTER TABLE users ADD INDEX idx_email(email);
```

### 刪除表格

```sql
DROP TABLE users;
DROP TABLE IF EXISTS users;
```

---

## 增刪改查

### INSERT - 插入

```sql
-- 插入單筆
INSERT INTO users (username, email, password) 
VALUES ('john', 'john@example.com', 'hashed_password');

-- 插入多筆
INSERT INTO users (username, email, password) VALUES 
  ('john', 'john@example.com', 'pass1'),
  ('jane', 'jane@example.com', 'pass2');
```

### SELECT - 查詢

```sql
-- 查詢所有
SELECT * FROM users;

-- 查詢指定欄
SELECT username, email FROM users;

-- 條件查詢
SELECT * FROM users WHERE status = 'active';

-- 排序
SELECT * FROM users ORDER BY created_at DESC;

-- 分頁
SELECT * FROM users LIMIT 10 OFFSET 0;
```

### UPDATE - 更新

```sql
UPDATE users 
SET email = 'new@example.com' 
WHERE id = 1;
```

### DELETE - 刪除

```sql
DELETE FROM users WHERE id = 1;
DELETE FROM users WHERE status = 'inactive';
```

---

## 使用者和權限

### 建立使用者

```sql
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'password';
```

### 授予權限

```sql
-- 授予所有權限
GRANT ALL PRIVILEGES ON myapp_db.* TO 'app_user'@'localhost';

-- 授予特定權限
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp_db.* TO 'app_user'@'localhost';
```

### 常見權限

| 權限 | 說明 |
|------|------|
| ALL PRIVILEGES | 所有權限 |
| SELECT | 讀取 |
| INSERT | 插入 |
| UPDATE | 更新 |
| DELETE | 刪除 |

### 撤銷權限

```sql
REVOKE DELETE ON myapp_db.* FROM 'app_user'@'localhost';
```

### 刪除使用者

```sql
DROP USER 'app_user'@'localhost';
```

---

## 備份和恢復

### 備份資料庫

```bash
# 備份單個資料庫
mysqldump -u root -p myapp_db > backup.sql

# 備份所有資料庫
mysqldump -u root -p --all-databases > full_backup.sql

# 壓縮備份
mysqldump -u root -p myapp_db | gzip > backup.sql.gz
```

### 恢復資料庫

```bash
# 從備份恢復
mysql -u root -p myapp_db < backup.sql

# 從壓縮備份恢復
gunzip < backup.sql.gz | mysql -u root -p
```

---

## 優化

### 索引優化

```sql
-- 建立索引
CREATE INDEX idx_email ON users(email);

-- 查看索引
SHOW INDEX FROM users;

-- 刪除索引
DROP INDEX idx_email ON users;
```

### 查詢優化

```sql
-- 分析查詢
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';
```

---

## 常用範例

### 分頁查詢

```sql
SELECT * FROM users 
ORDER BY created_at DESC 
LIMIT 10 OFFSET 0;
```

### 統計數量

```sql
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM users WHERE status = 'active';
```

---

## 故障排除

### 連線問題

```bash
# 檢查 MySQL 狀態
sudo systemctl status mysql

# 檢查連接埠
netstat -tulpn | grep 3306
```

### 日誌檔案

```bash
# 錯誤日誌
tail -f /var/log/mysql/error.log
```

---

## 下一步

- 探索 [MySQL Workbench](https://www.mysql.com/products/workbench/) 圖形介面工具
- 學習 MySQL 叢集複製
- 閱讀 MySQL 效能優化文檔
