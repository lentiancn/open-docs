# Redis 常见问题

本章节汇总了 Redis 使用中的常见问题。

## 连接问题

### Q1: 连接被拒绝

**问题描述：**
`Could not connect to Redis`

**解决方案：**
1. 检查 Redis 是否启动
   ```bash
   systemctl status redis
   ```

2. 检查端口
   ```bash
   netstat -tlnp | grep 6379
   ```

3. 检查防火墙

### Q2: 认证失败

**问题描述：**
`NOAUTH Authentication required`

**解决方案：**
```bash
# 使用密码连接
redis-cli -a yourpassword

# 连接后认证
AUTH yourpassword
```

## 性能问题

### Q3: 内存占用过高

**问题描述：**
Redis 内存持续增长。

**解决方案：**
1. 设置内存限制
   ```bash
   CONFIG SET maxmemory 2gb
   ```

2. 设置内存策略
   ```bash
   CONFIG SET maxmemory-policy allkeys-lru
   ```

3. 查看内存使用
   ```bash
   INFO memory
   ```

### Q4: 持久化阻塞

**问题描述：**
AOF 持久化导致性能下降。

**解决方案：**
```conf
# 调整同步策略
appendfsync everysec  # 每秒同步（推荐）
# appendfsync no      # 不主动同步
```

### Q5: KEYS 命令阻塞

**问题描述：**
KEYS 命令导致 Redis 卡顿。

**解决方案：**
使用 SCAN 替代 KEYS：
```bash
SCAN 0 MATCH user:* COUNT 1000
```

## 数据问题

### Q6: 数据丢失

**问题描述：**
Redis 重启后数据丢失。

**解决方案：**
1. 开启 RDB 持久化
   ```conf
   save 900 1
   save 300 10
   ```

2. 开启 AOF 持久化
   ```conf
   appendonly yes
   ```

### Q7: 内存不足

**问题描述：**
`OOM command not allowed when used memory`

**解决方案：**
1. 增加内存
2. 清理过期数据
3. 调整内存策略

## 集群问题

### Q8: 集群节点无法通信

**解决方案：**
1. 检查网络连接
2. 检查防火墙
3. 检查端口

### Q9: 槽位冲突

**解决方案：**
使用 redis-trib 重新分配槽位

## 复制问题

### Q10: 主从不一致

**解决方案：**
1. 检查复制延迟
   ```bash
   INFO replication
   ```

2. 从节点执行
   ```bash
   SLAVEOF NO ONE  # 停止复制
   SLAVEOF master_ip master_port  # 重新复制
   ```

## 客户端问题

### Q11: 连接池耗尽

**解决方案：**
```python
# 增加连接池大小
redis.ConnectionPool(max_connections=50)
```

### Q12: 序列化问题

**解决方案：**
```python
# 使用 JSON 序列化
import json
r.set('key', json.dumps(data))
data = json.loads(r.get('key'))
```

## 安全问题

### Q13: 未授权访问

**解决方案：**
设置密码：
```conf
requirepass yourpassword
```

### Q14: 敏感信息泄露

**解决方案：**
1. 禁止远程访问
   ```conf
   bind 127.0.0.1
   ```

2. 使用防火墙限制

## 备份问题

### Q15: RDB 备份失败

**解决方案：**
手动触发备份：
```bash
BGSAVE
```

查看备份状态：
```bash
LASTSAVE
```

## 总结

本章节涵盖了 Redis 使用中的常见问题：

- **连接**：拒绝、认证
- **性能**：内存、持久化、KEYS
- **数据**：丢失、不足
- **集群**：通信、槽位
- **复制**：主从不一致
- **客户端**：连接池、序列化
- **安全**：授权、访问
- **备份**：RDB

如需更多信息，请参考官方文档：https://redis.io/docs/
