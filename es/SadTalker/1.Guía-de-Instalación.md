# Guía de Instalación de SadTalker

SadTalker es un proyecto de IA para generar videos realistas de cabezas parlantes a partir de una sola imagen y entrada de audio.

## Requisitos del Sistema

### Requisitos de Hardware

| Componente | Mínimo | Recomendado |
|------------|---------|-------------|
| GPU | NVIDIA 6GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 32GB |
| Almacenamiento | 20GB libre | 50GB libre |
| SO | Ubuntu 18.04+, Windows 10+, macOS 11+ | Ubuntu 20.04+ |

### Requisitos de Software

| Software | Versión | Notas |
|----------|---------|-------|
| Python | 3.8 - 3.10 | 3.9 recomendado |
| CUDA | 11.7+ | Para aceleración GPU |
| cuDNN | 8.5+ | Requerido para CUDA |
| ffmpeg | Última versión | Para procesamiento de video |

## Instalación en Linux/Ubuntu

### Paso 1: Instalar Dependencias del Sistema

```bash
# Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Python y herramientas de desarrollo
sudo apt install python3.9 python3-pip python3-venv git wget curl

# Instalar bibliotecas del sistema
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# Instalar ffmpeg
sudo apt install ffmpeg

# Instalar drivers NVIDIA (si no están instalados)
sudo apt install nvidia-driver-525
```

### Paso 2: Instalar CUDA (si es necesario)

```bash
# Descargar e instalar CUDA 11.8
wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
sudo sh cuda_11.8.0_520.61.05_linux.run
```

### Paso 3: Clonar Repositorio

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker
```

### Paso 4: Crear Entorno Virtual

```bash
python3.9 -m venv venv
source venv/bin/activate

# Verificar versión de Python
python --version
```

### Paso 5: Instalar PyTorch

```bash
# Para CUDA 11.8
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# Verificar instalación
python -c "import torch; print(torch.cuda.is_available())"
```

### Paso 6: Instalar Dependencias

```bash
pip install -r requirements.txt

# Instalar dependencias adicionales
pip install numpy opencv-python librosa soundfile
```

### Paso 7: Descargar Modelos

```bash
# Crear directorio de modelos
mkdir -p checkpoints

# Descargar modelos (automático)
bash scripts/download_models.sh

# O descargar manualmente desde releases
# Colocar modelos en directorio checkpoints/
```

## Instalación en Windows

### Paso 1: Instalar Python

1. Descargar Python 3.9 desde python.org
2. Durante instalación, marcar "Add Python to PATH"
3. Verificar: `python --version`

### Paso 2: Instalar CUDA

1. Descargar CUDA 11.8 desde el sitio web de NVIDIA
2. Instalar con configuración predeterminada
3. Descargar e instalar cuDNN 8.9

### Paso 3: Clonar y Configurar

```powershell
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python -m venv venv
venv\Scripts\activate
```

### Paso 4: Instalar Dependencias

```powershell
# Instalar PyTorch con soporte CUDA
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### Paso 5: Descargar Modelos

Descargar modelos desde la página de releases de GitHub y colocar en la carpeta `checkpoints/`.

## Instalación en macOS

### Paso 1: Instalar Dependencias

```bash
# Instalar Homebrew (si no está instalado)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Instalar Python y ffmpeg
brew install python@3.9 ffmpeg git
```

### Paso 2: Configurar

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python3.9 -m venv venv
source venv/bin/activate

# Instalar PyTorch (solo CPU para macOS)
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

Nota: macOS se ejecuta en modo solo CPU. La aceleración GPU no está disponible.

## Instalación con Docker

### Usando Docker

```bash
# Extraer imagen
docker pull ghcr.io/opentalker/sadtalker:latest

# Ejecutar con soporte GPU
docker run --gpus all -v $(pwd):/workspace -p 8888:8888 ghcr.io/opentalker/sadtalker:latest
```

### Usando Docker Compose

```yaml
version: '3.8'
services:
  sadtalker:
    image: ghcr.io/opentalker/sadtalker:latest
    volumes:
      - ./workspace:/workspace
    ports:
      - "8888:8888"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

## Verificar Instalación

```bash
# Probar funcionalidad básica
python inference.py --help

# Debe mostrar todas las opciones disponibles
```

## Problemas Comunes

### Memoria CUDA Agotada

**Solución:**
- Reducir tamaño de batch: `--batch_size 1`
- Usar menor resolución: `--size 256`
- Habilitar descarga de modelos
- Cerrar otras aplicaciones GPU

### Bibliotecas Faltantes (Windows)

**Solución:**
- Instalar Visual C++ Redistributable 2015-2022
- Agregar CUDA al PATH del sistema

### Error al Descargar Modelos

**Solución:**
- Usar VPN o proxy
- Descargar manualmente desde releases de GitHub
- Verificar conexión de red

### ffmpeg No Encontrado

**Solución:**
- Linux: `sudo apt install ffmpeg`
- Windows: Agregar ffmpeg al PATH
- macOS: `brew install ffmpeg`

## Enlaces Relacionados

- [Repositorio GitHub](https://github.com/OpenTalker/SadTalker)
- [Demo HuggingFace](https://huggingface.co/spaces/fffilo/SadTalker)
- [Paper](https://arxiv.org/abs/2303.17550)
- [Descarga de Modelos](https://github.com/OpenTalker/SadTalker/releases)
