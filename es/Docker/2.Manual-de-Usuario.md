# Docker Manual de Usuario

Este manual proporciona instrucciones detalladas sobre el uso básico de Docker, incluyendo gestión de imágenes, operaciones de contenedores, configuración de red, gestión de volúmenes, y más.

---

## Tabla de Contenidos

1. [Conceptos Básicos de Docker](#conceptos-básicos-de-docker)
2. [Operaciones con Imágenes](#operaciones-con-imágenes)
3. [Operaciones con Contenedores](#operaciones-con-contenedores)
4. [Gestión de Redes](#gestión-de-redes)
5. [Gestión de Volúmenes](#gestión-de-volúmenes)
6. [Uso de Docker Compose](#uso-de-docker-compose)
7. [Escritura de Dockerfiles](#escritura-de-dockerfiles)
8. [Referencia Rápida de Comandos Comunes de Docker](#referencia-rápida-de-comandos-comunes-de-docker)
9. [Mejores Prácticas](#mejores-prácticas)
10. [Solución de Problemas](#solución-de-problemas)

---

## Conceptos Básicos de Docker

### ¿Qué es un Contenedor?

Los contenedores son paquetes ligeros y ejecutables independientes que contienen todo lo necesario para ejecutar el software: código, tiempo de ejecución, herramientas del sistema, bibliotecas del sistema y configuraciones. La contenedorización asegura que el software se ejecute de manera consistente en cualquier entorno.

### Componentes Principales

- **Imagen**: Plantilla de solo lectura usada para crear contenedores
- **Contenedor**: Instancia en ejecución de una imagen
- **Repositorio**: Lugar para almacenar imágenes
- **Dockerfile**: Script usado para construir imágenes
- **Docker Compose**: Herramienta para definir y ejecutar aplicaciones de múltiples contenedores

---

## Operaciones con Imágenes

### Extraer Imágenes

Extraiga imágenes de Docker Hub:

```bash
# Extraer la última versión
docker pull nginx

# Extraer una versión específica
docker pull nginx:1.25
```

### Listar Imágenes

```bash
# Listar todas las imágenes locales
docker images
```

### Eliminar Imágenes

```bash
# Eliminar imagen especificada
docker rmi nginx:latest

# Forzar eliminación
docker rmi -f nginx:latest
```

### Construir Imágenes

Construya imágenes usando Dockerfile:

```bash
docker build -t myapp:latest .
```

---

## Operaciones con Contenedores

### Crear e Iniciar Contenedores

```bash
# Contenedor interactivo (con terminal)
docker run -it ubuntu /bin/bash

# Contenedor demonio (ejecutando en segundo plano)
docker run -d nginx

# Mapeo de puertos
docker run -d -p 8080:80 nginx

# Especificar nombre del contenedor
docker run -d --name my-nginx nginx
```

### Ver Contenedores

```bash
# Listar contenedores en ejecución
docker ps

# Listar todos los contenedores (incluidos los detenidos)
docker ps -a
```

### Gestión del Ciclo de Vida del Contenedor

```bash
# Iniciar contenedor
docker start my-nginx

# Detener contenedor
docker stop my-nginx

# Reiniciar contenedor
docker restart my-nginx

# Eliminar contenedor
docker rm my-nginx
```

### Entrar al Contenedor

```bash
# Usar exec para entrar en un contenedor en ejecución
docker exec -it my-nginx /bin/bash
```

---

## Gestión de Redes

### Ver Redes

```bash
# Listar todas las redes
docker network ls

# Ver información detallada de la red
docker network inspect bridge
```

### Crear Red

```bash
# Crear red bridge
docker network create my-network
```

---

## Gestión de Volúmenes

### Crear Volumen

```bash
# Crear volumen
docker volume create my-volume

# Listar volúmenes
docker volume ls
```

### Usar Volúmenes

```bash
# Montar volumen
docker run -d -v my-volume:/container/path nginx

# Montar directorio del host
docker run -d -v /host/path:/container/path nginx
```

---

## Uso de Docker Compose

### Estructura del Archivo Docker Compose

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    depends_on:
      - redis

  redis:
    image: redis:alpine
```

### Comandos Comunes

```bash
# Iniciar todos los servicios
docker-compose up

# Iniciar en segundo plano
docker-compose up -d

# Detener todos los servicios
docker-compose down
```

---

## Escritura de Dockerfiles

### Instrucciones Básicas

```dockerfile
# Especificar imagen base
FROM node:18-alpine

# Establecer directorio de trabajo
WORKDIR /app

# Copiar archivos
COPY . .

# Exponer puertos
EXPOSE 3000

# Comando de inicio
CMD ["node", "index.js"]
```

### Ejemplo de Construcción Multi-Etapa

```dockerfile
# Etapa de construcción
FROM golang:1.20 AS builder
WORKDIR /app
RUN go build -o main .

# Etapa de ejecución
FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
CMD ["./main"]
```

---

## Referencia Rápida de Comandos Comunes de Docker

### Comandos de Imágenes

| Comando | Descripción |
|---------|-------------|
| `docker pull <imagen>` | Extraer imagen |
| `docker images` | Listar imágenes |
| `docker rmi <imagen>` | Eliminar imagen |
| `docker build -t <nombre> .` | Construir imagen |

### Comandos de Contenedores

| Comando | Descripción |
|---------|-------------|
| `docker run -d <imagen>` | Ejecutar contenedor en segundo plano |
| `docker run -it <imagen>` | Ejecutar contenedor interactivamente |
| `docker ps` | Listar contenedores en ejecución |
| `docker ps -a` | Listar todos los contenedores |
| `docker start <contenedor>` | Iniciar contenedor |
| `docker stop <contenedor>` | Detener contenedor |
| `docker rm <contenedor>` | Eliminar contenedor |
| `docker exec -it <contenedor> /bin/bash` | Entrar al contenedor |

---

## Mejores Prácticas

### Optimización de Imágenes

1. **Usar construcciones multi-etapa**: Reducir el tamaño final de la imagen
2. **Elegir imágenes base apropiadas**: Preferir imágenes ligeras como alpine
3. **Reducir capas**: Combinar instrucciones RUN
4. **Usar .dockerignore**: Excluir archivos innecesarios

### Recomendaciones de Seguridad

1. **No ejecutar como root**: Usar instrucción USER
2. **Actualizar imágenes base regularmente**: Obtener los últimos parches de seguridad
3. **Usar imágenes oficiales**: Preferir imágenes oficiales verificadas

---

## Solución de Problemas

### El Contenedor no Inicia

```bash
# Ver registros del contenedor
docker logs <contenedor>
```

### Conflictos de Puertos

```bash
# Verificar uso de puertos
netstat -tlnp | grep <puerto>

# Usar otro puerto
docker run -d -p 8081:80 nginx
```

### Problemas de Espacio en Disco

```bash
# Limpiar imágenes sin usar
docker image prune -a

# Limpiar todos los recursos sin usar
docker system prune -a
```

---

## Enlaces Relacionados

- [Documentación Oficial de Docker](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Documentación de Docker Compose](https://docs.docker.com/compose/)
