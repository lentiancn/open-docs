# TensorFlow 使用手册

## 基础操作

```python
import tensorflow as tf

# 常量
a = tf.constant(5)
b = tf.constant(3)

# 运算
c = tf.add(a, b)
d = tf.multiply(a, b)

# 变量
v = tf.Variable([1, 2, 3])
v.assign([4, 5, 6])
```

## Keras 基础

### 模型构建

```python
from tensorflow import keras
from tensorflow.keras import layers

model = keras.Sequential([
    layers.Dense(64, activation='relu', input_shape=(784,)),
    layers.Dense(10, activation='softmax')
])

model.compile(
    optimizer='adam',
    loss='sparse_categorical_crossentropy',
    metrics=['accuracy']
)
```

### 训练模型

```python
# 加载数据
(x_train, y_train), (x_test, y_test) = keras.datasets.mnist.load_data()

# 预处理
x_train = x_train.reshape(-1, 784).astype('float32') / 255.0

# 训练
model.fit(x_train, y_train, epochs=5, batch_size=32)
```

### 评估与预测

```python
# 评估
loss, accuracy = model.evaluate(x_test, y_test)
print(f'Accuracy: {accuracy}')

# 预测
predictions = model.predict(x_test)
```

## 自定义训练

```python
# 自定义优化器
optimizer = keras.optimizers.Adam(learning_rate=0.001)

# 训练循环
for epoch in range(epochs):
    for batch in dataset:
        with tf.GradientTape() as tape:
            predictions = model(batch['x'])
            loss = loss_fn(batch['y'], predictions)
        
        gradients = tape.gradient(loss, model.trainable_variables)
        optimizer.apply_gradients(zip(gradients, model.trainable_variables))
```

## 模型保存

```python
# 保存整个模型
model.save('my_model')

# 仅保存权重
model.save_weights('weights.h5')

# 加载模型
loaded_model = keras.models.load_model('my_model')
```
