# Docker ä½¿ç”¨æŒ‡å—

é«˜æ•ˆä½¿ç”¨ Docker çš„å®Œæ•´æŒ‡å—ã€?
---

## ç›®å½•

- [åŸºæœ¬æ¦‚å¿µ](#åŸºæœ¬æ¦‚å¿µ)
- [é•œåƒæ“ä½œ](#é•œåƒæ“ä½œ)
- [å®¹å™¨æ“ä½œ](#å®¹å™¨æ“ä½œ)
- [ç½‘ç»œç®¡ç†](#ç½‘ç»œç®¡ç†)
- [å­˜å‚¨ç®¡ç†](#å­˜å‚¨ç®¡ç†)
- [Docker Compose](#docker-compose)
- [Dockerfile æœ€ä½³å®è·µ](#dockerfile-æœ€ä½³å®è·?
- [å¸¸ç”¨ç¤ºä¾‹](#å¸¸ç”¨ç¤ºä¾‹)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## åŸºæœ¬æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ Dockerï¼?
- **é•œåƒ**ï¼šç”¨äºåˆ›å»ºå®¹å™¨çš„åªè¯»æ¨¡æ¿
- **å®¹å™¨**ï¼šé•œåƒçš„è¿è¡Œå®ä¾‹
- **ä»“åº“**ï¼šå­˜å‚¨é•œåƒçš„åœ°æ–¹ï¼ˆDocker Hubã€GCR ç­‰ï¼‰

### å…³é”®æœ¯è¯­

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| `image` | åªè¯»æ¨¡æ¿ |
| `container` | é•œåƒçš„è¿è¡Œå®ä¾?|
| `volume` | æŒä¹…åŒ–å­˜å‚?|
| `network` | å®¹å™¨é€šä¿¡ |
| `dockerfile` | é•œåƒæ„å»ºè„šæœ¬ |

---

## é•œåƒæ“ä½œ

### æ‹‰å–é•œåƒ

```bash
# æ‹‰å–æœ€æ–°é•œåƒ?docker pull nginx

# æ‹‰å–æŒ‡å®šæ ‡ç­¾
docker pull nginx:alpine
docker pull ubuntu:22.04
```

### åˆ—å‡ºé•œåƒ

```bash
# åˆ—å‡ºæ‰€æœ‰é•œåƒ?docker images

# åˆ—å‡ºé•œåƒ ID
docker images -q
```

### åˆ é™¤é•œåƒ

```bash
# åˆ é™¤å•ä¸ªé•œåƒ
docker rmi nginx

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune
```

### æ„å»ºé•œåƒ

```bash
# ä»?Dockerfile æ„å»º
docker build -t myapp:1.0 .

# ä¸ä½¿ç”¨ç¼“å­˜æ„å»?docker build --no-cache -t myapp:1.0 .
```

---

## å®¹å™¨æ“ä½œ

### è¿è¡Œå®¹å™¨

```bash
# åå°è¿è¡Œ
docker run -d nginx

# ç«¯å£æ˜ å°„
docker run -d -p 8080:80 nginx

# æŒ‚è½½å?docker run -d -v /my/data:/data nginx

# ç¯å¢ƒå˜é‡
docker run -d -e APP_ENV=production nginx

# äº¤äº’å¼è¿è¡?docker run -it ubuntu bash

# è¿è¡Œååˆ é™?docker run --rm ubuntu ls
```

### å¸¸ç”¨è¿è¡Œé€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `-d` | åå°è¿è¡Œ |
| `-p` | ç«¯å£æ˜ å°„ï¼ˆä¸»æœ?å®¹å™¨ï¼?|
| `-v` | å·æŒ‚è½?|
| `-e` | ç¯å¢ƒå˜é‡ |
| `--name` | å®¹å™¨åç§° |
| `--network` | åŠ å…¥ç½‘ç»œ |
| `-it` | äº¤äº’å¼?TTY |
| `--rm` | é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ |

### ç®¡ç†å®¹å™¨

```bash
# åˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨
docker ps

# åˆ—å‡ºæ‰€æœ‰å®¹å™?docker ps -a

# åœæ­¢å®¹å™¨
docker stop <å®¹å™¨ID>

# å¯åŠ¨å®¹å™¨
docker start <å®¹å™¨ID>

# é‡å¯å®¹å™¨
docker restart <å®¹å™¨ID>

# åˆ é™¤å®¹å™¨
docker rm <å®¹å™¨ID>

# å¼ºåˆ¶åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨
docker rm -f <å®¹å™¨ID>

# æŸ¥çœ‹æ—¥å¿—
docker logs <å®¹å™¨ID>

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f <å®¹å™¨ID>

# åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
docker exec -it <å®¹å™¨ID> bash
```

---

## ç½‘ç»œç®¡ç†

### åˆ›å»ºç½‘ç»œ

```bash
# åˆ›å»ºæ¡¥æ¥ç½‘ç»œ
docker network create my-network
```

### è¿æ¥å®¹å™¨

```bash
# åœ¨ç½‘ç»œä¸­è¿è¡Œå®¹å™¨
docker run -d --network my-network nginx

# è¿æ¥ç°æœ‰å®¹å™¨åˆ°ç½‘ç»?docker network connect my-network container_name
```

---

## å­˜å‚¨ç®¡ç†

### å?
```bash
# åˆ›å»ºå?docker volume create my-volume

# åˆ—å‡ºå?docker volume ls

# åˆ é™¤æœªä½¿ç”¨çš„å?docker volume prune
```

### æŒ‚è½½ä¸»æœºç›®å½•

```bash
# æŒ‚è½½ä¸»æœºç›®å½•
docker run -v /host/path:/container/path nginx

# åªè¯»æŒ‚è½½
docker run -v /host/path:/container/path:ro nginx
```

---

## Docker Compose

### åŸºæœ¬ docker-compose.yml

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./html:/usr/share/nginx/html
    depends_on:
      - api

  api:
    build: ./api
    environment:
      - DATABASE_URL=postgres://db:5432/app

  db:
    image: postgres:15-alpine
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

### å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ?docker compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ?docker compose down

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# é‡æ–°æ„å»ºæœåŠ¡
docker compose up -d --build

# åœ¨æœåŠ¡ä¸­æ‰§è¡Œå‘½ä»¤
docker compose exec web bash
```

---

## Dockerfile æœ€ä½³å®è·?
### å¥½çš„ Dockerfile ç¤ºä¾‹

```dockerfile
# ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾
FROM node:20-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å…ˆå¤åˆ¶åŒ…æ–‡ä»¶ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç ?COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å®šä¹‰å¯åŠ¨å‘½ä»¤
CMD ["node", "server.js"]
```

### å…³é”®æœ€ä½³å®è·?
1. **ä½¿ç”¨ç‰¹å®šæ ‡ç­¾**ï¼šä¸è¦ä½¿ç”?`latest`
2. **ä½¿ç”¨ Alpine é•œåƒ**ï¼šä½“ç§¯å°ï¼Œæ¼æ´å°‘
3. **åˆç†æ’åºå±?*ï¼šå°†ä¸å¸¸å˜åŒ–çš„æ”¾åœ¨å‰é?4. **ä½¿ç”¨ .dockerignore**ï¼šæ’é™¤ä¸å¿…è¦çš„æ–‡ä»?5. **ä»¥é root ç”¨æˆ·è¿è¡Œ**ï¼šæ·»åŠ?`USER` æŒ‡ä»¤

---

## å¸¸ç”¨ç¤ºä¾‹

### è¿è¡Œ Nginx

```bash
docker run -d -p 80:80 -v $(pwd)/html:/usr/share/nginx/html nginx
```

### è¿è¡Œ MySQL

```bash
docker run -d \
  --name mysql \
  -e MYSQL_ROOT_PASSWORD=secret \
  -e MYSQL_DATABASE=app \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

### è¿è¡Œ PostgreSQL

```bash
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -e POSTGRES_DB=app \
  -v postgres-data:/var/lib/postgresql/data \
  -p 5432:5432 \
  postgres:15
```

### è¿è¡Œ Redis

```bash
docker run -d \
  --name redis \
  -v redis-data:/data \
  -p 6379:6379 \
  redis:alpine redis-server --appendonly yes
```

---

## æ•…éšœæ’é™¤

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥æ—¥å¿?docker logs <å®¹å™¨ID>

# æ£€æŸ¥å®¹å™¨çŠ¶æ€?docker inspect <å®¹å™¨ID>
```

### ç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ
docker system df

# æ¸…ç†
docker system prune -a
```

### æƒé™é—®é¢˜

```bash
# ä¿®å¤æ‰€æœ‰æƒ
sudo chown -R $(id -u):$(id -g) ./data

# æˆ–æŒ‡å®šç”¨æˆ·è¿è¡?docker run -u $(id -u):$(id -g) -v $(pwd):/app app
```

---

## ä¸‹ä¸€æ­?
- æ¢ç´¢ [Docker Hub](https://hub.docker.com/) è·å–é•œåƒ
- å­¦ä¹  [Kubernetes](https://kubernetes.io/) è¿›è¡Œç¼–æ’
- é˜…è¯» [Docker å®‰å…¨](https://docs.docker.com/engine/security/) æœ€ä½³å®è·?
