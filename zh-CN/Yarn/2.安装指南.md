# Yarn 安装指南

本指南将详细介绍 Yarn 的各种安装方法，帮助你在不同操作系统和环境下正确安装 Yarn。

---

## 系统要求

在安装 Yarn 之前，请确保你的系统满足以下要求：

### 最低要求
- **Node.js**：16.0.0 或更高版本（推荐 Node.js 18+）
- **操作系统**：
  - macOS 10.15 (Catalina) 或更高版本
  - Linux（Ubuntu 16.04+、Debian 9+、CentOS 7+ 等）
  - Windows 10 或更高版本
- **磁盘空间**：至少 200MB 可用空间

### 推荐环境
- **Node.js**：18.x 或 20.x LTS 版本
- **npm**：6.x 或更高版本（随 Node.js 一起安装）

---

## 安装方法

### 方法一：使用 corepack 安装（推荐）

Corepack 是 Node.js 14.6.0+ 内置的包管理器管理器，它允许你轻松管理 Yarn 版本。

**启用 corepack：**

```bash
corepack enable
```

**安装稳定版 Yarn：**

```bash
corepack prepare yarn@stable --activate
```

**安装特定版本：**

```bash
# 安装 Yarn 4.x
corepack prepare yarn@4.0.0 --activate

# 安装 Yarn 3.x
corepack prepare yarn@3.6.0 --activate
```

**升级 Yarn：**

```bash
corepack prepare yarn@stable --activate
```

### 方法二：使用 npm 安装

如果你已经安装了 Node.js 和 npm，可以使用 npm 全局安装 Yarn：

```bash
npm install -g yarn
```

**验证安装：**

```bash
yarn --version
```

**升级 Yarn：**

```bash
npm update -g yarn
```

### 方法三：使用 yarn 安装

你也可以使用 Yarn 安装自己：

```bash
npm install -g yarn
```

### 方法四：使用脚本安装（macOS/Linux）

官方提供了一个安装脚本，可以自动完成安装：

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash
```

**指定版本安装：**

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 4.0.0
```

### 方法五：使用 PowerShell 安装（Windows）

在 Windows 上，可以使用 PowerShell 安装 Yarn：

```powershell
iwr -useb https://yarnpkg.com/install.ps1 | iex
```

**指定版本安装：**

```powershell
$env:YARN_VERSION = "4.0.0"; iwr -useb https://yarnpkg.com/install.ps1 | iex
```

### 方法六：使用 scoop 安装（Windows）

如果你使用 scoop 包管理器：

```bash
scoop install yarn
```

### 方法七：使用 chocolatey 安装（Windows）

如果你使用 Chocolatey 包管理器：

```bash
choco install yarn
```

---

## 不同操作系统的安装

### macOS

**使用 Homebrew（推荐）：**

```bash
# 安装 Homebrew（如果没有）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Yarn
brew install yarn
```

**使用 corepack：**

```bash
corepack enable
corepack prepare yarn@stable --activate
```

### Linux

**Debian/Ubuntu：**

添加 Yarn 官方仓库：

```bash
# 添加 GPG 密钥
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -

# 添加仓库
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list

# 安装
sudo apt update && sudo apt install yarn
```

**Fedora/RHEL：**

```bash
# 添加仓库
curl -o- -L https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo

# 安装
sudo dnf install yarn
```

**Arch Linux：**

```bash
sudo pacman -S yarn
```

### Windows

**使用安装程序：**

1. 下载 Yarn 安装程序：https://github.com/yarnpkg/yarn/releases
2. 运行 .msi 安装文件

**使用 PowerShell（推荐）：**

```powershell
iwr -useb https://yarnpkg.com/install.ps1 | iex
```

**使用 winget：**

```bash
winget install Yarn.Yarn
```

---

## 安装后配置

### 验证安装

安装完成后，验证 Yarn 是否正确安装：

```bash
# 查看版本
yarn --version

# 查看帮助
yarn --help
```

### 配置 npm 注册表

如果你需要使用私有 npm 注册表，可以在 .yarnrc.yml 中配置：

```yaml
npmRegistryServer: "https://registry.npmjs.org"
```

### 启用全局缓存

Yarn 4+ 默认使用本地缓存，你可以配置全局缓存：

```yaml
enableGlobalCache: true
```

### 设置 Node.js 链接器

Yarn 支持不同的 Node.js 链接器模式：

```yaml
# 使用 node-modules（推荐）
nodeLinker: node-modules

# 使用 PnP（零安装）
nodeLinker: pnp
```

---

## 常见安装问题

### 问题一：权限错误

如果你遇到权限错误，不要使用 sudo 安装：

```bash
# 确保 ~/.npm 目录存在
mkdir -p ~/.npm

# 设置正确的权限
chmod 700 ~/.npm
```

### 问题二：Node.js 版本过低

检查 Node.js 版本：

```bash
node --version
```

如果版本过低，使用 nvm 升级：

```bash
# 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# 使用 nvm 安装 Node.js
nvm install 20
nvm use 20
```

### 问题三：Yarn 命令找不到

确保 Yarn 的 bin 目录在 PATH 中：

```bash
# 临时添加
export PATH="$(yarn global bin):$PATH"

# 永久添加（添加到 ~/.bashrc 或 ~/.zshrc）
echo 'export PATH="$(yarn global bin):$PATH"' >> ~/.bashrc
```

### 问题四：缓存问题

如果遇到缓存相关错误，清理缓存：

```bash
yarn cache clean
```

### 问题五：网络问题

如果网络连接有问题，可以配置镜像：

```yaml
# 使用淘宝镜像
npmRegistryServer: "https://registry.npmmirror.com"
```

---

## 升级 Yarn

### 使用 corepack 升级

```bash
corepack prepare yarn@stable --activate
```

### 使用 npm 升级

```bash
npm update -g yarn
```

### 切换版本

如果你需要切换到不同版本的 Yarn：

```bash
# 切换到 Yarn 1.x（经典版）
corepack prepare yarn@1.22.19 --activate

# 切换到 Yarn 4.x
corepack prepare yarn@4.0.0 --activate
```

---

## 卸载 Yarn

### 使用 npm 卸载

```bash
npm uninstall -g yarn
```

### 清理残留文件

```bash
# 删除 Yarn 缓存
rm -rf ~/.yarn

# 删除配置
rm -f ~/.yarnrc ~/.yarnrc.yml
```

---

## 开发版本安装

如果你想安装 Yarn 的最新开发版本：

```bash
corepack prepare yarn@rc --activate
# 或者
corepack prepare yarn@nightly --activate
```

---

## Docker 中使用 Yarn

在 Docker 中使用 Yarn，可以通过以下方式：

```dockerfile
# 使用官方 Node.js 镜像
FROM node:20

# 启用 corepack
RUN corepack enable

# 准备 Yarn
RUN corepack prepare yarn@stable --activate

# 或者直接安装
RUN npm install -g yarn
```

---

## 下一步

- [Yarn 使用手册](/3.使用手册.md)：深入了解 Yarn 的各项功能
- [常见问题](/4.常见问题.md)：解答使用中的常见疑问
- [官方文档](https://yarnpkg.com/docs)：获取完整的配置参考
