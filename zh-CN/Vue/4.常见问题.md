# Vue.js 常见问题

本章节汇总了 Vue.js 开发中的常见问题。

## 开发问题

### Q1: 组件不渲染

**解决方案：**
1. 检查组件是否正确引入
2. 检查模板语法是否正确
3. 查看浏览器控制台错误

### Q2: 数据不更新

**解决方案：**
1. 确保使用响应式 API（ref/reactive）
2. 直接修改数组元素不会触发更新：
   ```javascript
   // 错误
   items.value[0] = { id: 1, name: '新名称' }
   
   // 正确
   items.value[0].name = '新名称'
   // 或
   items.value = [
     { id: 1, name: '新名称' },
     ...items.value.slice(1)
   ]
   ```

### Q3: v-for 警告

**问题：** `vue/no-unused-vars` 或缺少 key

**解决方案：**
```html
<!-- 添加唯一的 key -->
<li v-for="item in items" :key="item.id">
  {{ item.name }}
</li>
```

### Q4: 事件不生效

**解决方案：**
```html
<!-- 检查方法名 -->
<button @click="handleClick">点击</button>

<!-- 正确传递参数 -->
<button @click="handleClick(item)">点击</button>

<!-- 正确使用事件 -->
<button @click.stop="handleClick">点击</button>
```

### Q5: Props 不更新

**问题：** 子组件修改 Props

**解决方案：**
- Props 是只读的，需要在子组件中定义本地数据：
  ```javascript
  const localValue = ref(props.value)
  
  function update() {
    localValue.value = 'new value'
    emit('update', localValue.value)
  }
  ```

## 响应式问题

### Q6: 对象属性不响应

**问题：** 添加新属性不更新

**解决方案：**
```javascript
import { reactive } from 'vue'

const state = reactive({
  name: 'Tom'
})

// 错误：state.age = 25 不响应
// 正确：
state.age = 25
// 或使用解构
const { age, ...rest } = state
```

### Q7: 深层对象不响应

**解决方案：**
```javascript
// 使用 deep: true
watch(obj, () => {
  console.log('变化了')
}, { deep: true })

// 使用 reactive
const state = reactive({
  user: {
    profile: {
      name: 'Tom'
    }
  }
})
```

### Q8: computed 不更新

**解决方案：**
- 确保依赖是响应式的
- 不能在 computed 中修改值

## 组件问题

### Q9: 组件样式不生效

**解决方案：**
1. 使用 scoped
   ```vue
   <style scoped>
   .child-component {
     /* 只作用于当前组件 */
   }
   </style>
   ```

2. 使用深度选择器
   ```vue
   <style scoped>
   :deep(.child-class) {
     color: red
   }
   </style>
   ```

### Q10: 循环组件 key 重复

**问题：** `v-for` 的 key 重复

**解决方案：**
```html
<!-- 确保 key 唯一 -->
<li v-for="(item, index) in items" :key="item.id + '-' + index">
  {{ item.name }}
</li>
```

## 路由问题

### Q11: 路由不跳转

**解决方案：**
```javascript
// 正确使用 push
router.push('/path')

// 等待导航完成
router.push('/path').then(() => {
  // 导航完成
})
```

### Q12: 路由参数变化不更新

**解决方案：**
```javascript
// 监听路由变化
watch(() => route.params.id, (newId) => {
  loadData(newId)
})
```

### Q13: 路由守卫不生效

**解决方案：**
```javascript
// 确保路由配置了 meta
{
  path: '/admin',
  component: Admin,
  meta: { requiresAuth: true }
}

// 在守卫中检查
router.beforeEach((to, from, next) => {
  if (to.meta.requiresAuth) {
    // 检查登录
  }
  next()
})
```

## 状态管理问题

### Q14: Pinia 数据不持久

**解决方案：**
```javascript
// 使用 pinia-plugin-persistedstate
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)

// 在 store 中开启
export default defineStore('user', () => {
  // ...
}, {
  persist: true
})
```

### Q15: 多个 Store 冲突

**解决方案：**
- 避免在多个 store 中修改相同状态
- 使用模块化 store

## 构建问题

### Q16: 构建后文件太大

**解决方案：**
1. 使用代码分割
   ```javascript
   // 路由懒加载
   {
     path: '/about',
     component: () => import('./views/About.vue')
   }
   ```

2. 使用 CDN
   ```javascript
   // vite.config.js
   export default {
     build: {
       rollupOptions: {
         external: ['vue', 'vue-router']
       }
     }
   }
   ```

### Q17: 环境变量不生效

**解决方案：**
```javascript
// .env.development
VITE_API_URL=http://localhost:3000

// .env.production  
VITE_API_URL=https://api.example.com

// 使用
console.log(import.meta.env.VITE_API_URL)
```

## 性能问题

### Q18: 页面卡顿

**解决方案：**
1. 使用 v-show 代替频繁切换的 v-if
2. 使用虚拟滚动处理大数据
3. 使用 debounce/throttle
4. 开启 KeepAlive 缓存组件

### Q19: 内存泄漏

**解决方案：**
```javascript
// 清理定时器
onUnmounted(() => {
  clearInterval(timer)
  clearTimeout(timeout)
})

// 清理事件监听
onMounted(() => {
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
})
```

## 测试问题

### Q20: 组件测试找不到

**解决方案：**
```bash
# 安装依赖
npm install -D @vue/test-utils vitest

# 配置 vitest
// vitest.config.js
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    environment: 'jsdom'
  }
})
```

## 总结

本章节涵盖了 Vue.js 开发中的常见问题：

- **开发**：渲染、数据更新、事件
- **响应式**：对象、数组、computed
- **组件**：样式、key、通信
- **路由**：跳转、参数、守卫
- **状态管理**：持久化、冲突
- **构建**：体积、环境变量
- **性能**：卡顿、内存泄漏
- **测试**：配置、运行

如需更多信息，请参考官方文档：https://vuejs.org
