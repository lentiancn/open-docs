# Yarn Installation Guide

This guide provides detailed instructions for installing Yarn on various operating systems and environments, helping you get started with Yarn quickly. Whether you're using macOS, Linux, or Windows, you can find comprehensive guidance here.

---

## Pre-Installation Preparation

Before starting Yarn installation, ensure your system meets basic requirements and perform necessary preparations.

### System Requirements

**Minimum Requirements**:

- Operating Systems: macOS 10.15 (Catalina) or higher, Linux (Ubuntu 16.04+, Debian 9+, CentOS 7+), Windows 10 or higher
- Node.js: 16.0.0 or higher (Node.js 18 LTS or 20 LTS recommended)
- Disk Space: At least 200MB available
- Network: Access to npm registry

**Recommended Environment**:

- Node.js 18.x LTS or 20.x LTS
- Stable network connection (for initial dependency downloads)
- At least 4GB RAM (for large projects)

### Checking Existing Environment

Before installing Yarn, it's recommended to check if related tools already exist in your system:

```bash
# Check Node.js version
node --version

# Check npm version
npm --version

# If Yarn was previously installed, check version
yarn --version
```

If Node.js version is too low, you need to upgrade Node.js first. We recommend using nvm (Node Version Manager) to manage multiple Node.js versions:

```bash
# Install nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Use nvm to install Node.js 20
nvm install 20
nvm use 20

# Set as default version
nvm alias default 20
```

---

## Corepack Installation Method (Recommended)

Corepack is a package manager manager built into Node.js 14.6.0 and above. It's Yarn's officially recommended installation method with these advantages: no need for global installation, can manage Yarn versions at project level, and stays updated automatically.

### Enabling Corepack

Corepack is typically installed with Node.js. If not enabled, manually enable it:

```bash
corepack enable
```

### Installing Yarn Stable

```bash
corepack prepare yarn@stable --activate
```

This command downloads and activates the latest stable Yarn. Verify after installation:

```bash
yarn --version
```

### Installing Specific Versions

If you need to use a specific Yarn version:

```bash
# Install Yarn 4.x (Berry)
corepack prepare yarn@4.0.0 --activate

# Install Yarn 3.x
corepack prepare yarn@3.6.0 --activate

# Install Yarn 1.x (Classic)
corepack prepare yarn@1.22.22 --activate
```

### Upgrading Yarn

When you need to upgrade Yarn in the future, simply run:

```bash
corepack prepare yarn@stable --activate
```

### Installing Beta Versions

If you want to try the latest features, you can install Canary or RC versions:

```bash
# Install Canary version (latest development build)
corepack prepare yarn@canary --activate

# Install Release Candidate version
corepack prepare yarn@rc --activate
```

### Building from Source

If you want to test the latest features that haven't been released yet, you can build from source:

```bash
# Build from master branch
yarn set version from sources

# Test specific PR
yarn set version from sources --branch 1211
```

---

## npm Global Installation Method

If you prefer the traditional global installation approach, you can use npm to install Yarn.

### Basic Installation

```bash
npm install -g yarn
```

### Verifying Installation

```bash
yarn --version
```

### Upgrading Yarn

```bash
# Upgrade to latest version
npm update -g yarn

# Or reinstall
npm install -g yarn@latest
```

### Uninstalling Yarn

```bash
npm uninstall -g yarn
```

---

## Script Installation Method

### macOS / Linux

The official provides a convenient installation script that automatically completes download and configuration:

**Default Installation (Stable Version)**:

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash
```

**Specify Version Installation**:

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 4.0.0
```

**Install and Set Mirror**:

```bash
curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --channel stable --mirror https://registry.npmmirror.com
```

The installation script completes these operations:

1. Detects system environment
2. Downloads specified Yarn binary
3. Creates necessary directory structure
4. Configures PATH environment variable

### Windows PowerShell

On Windows, you can use PowerShell to run a similar installation script:

**Basic Installation**:

```powershell
iwr -useb https://yarnpkg.com/install.ps1 | iex
```

**Specify Version Installation**:

```powershell
$env:YARN_VERSION = "4.0.0"
iwr -useb https://yarnpkg.com/install.ps1 | iex
```

---

## Package Manager Installation by Operating System

### macOS

**Using Homebrew (Recommended)**:

```bash
# If Homebrew is not installed, install it first
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install Yarn
brew install yarn
```

**Using MacPorts**:

```bash
sudo port install yarn
```

### Linux

**Debian / Ubuntu**:

```bash
# Add Yarn official GPG key
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -

# Add Yarn official repository
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list

# Update package index
sudo apt update

# Install Yarn
sudo apt install yarn
```

Note: If installed this way, you may need to disable corepack to avoid conflicts:

```bash
corepack disable
```

**Fedora / RHEL / CentOS**:

```bash
# Add Yarn official repository
curl -o- -L https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo

# Install Yarn
sudo dnf install yarn
# or
sudo yum install yarn
```

**Arch Linux**:

```bash
sudo pacman -S yarn
```

**openSUSE**:

```bash
sudo zypper install yarn
```

### Windows

**Using Winget (Recommended)**:

```bash
winget install Yarn.Yarn
```

**Using Chocolatey**:

```bash
choco install yarn
```

**Using Scoop**:

```bash
scoop install yarn
```

---

## Using Yarn in Docker

There are multiple ways to use Yarn in Docker containers:

### Method 1: Using Official Node.js Image

```dockerfile
FROM node:20

# Enable corepack and activate Yarn
RUN corepack enable && \
    corepack prepare yarn@stable --activate

WORKDIR /app
COPY package.json yarn.lock ./
RUN yarn install

COPY . .
RUN yarn build
```

### Method 2: Direct Installation

```dockerfile
FROM node:20

# Install Yarn
RUN npm install -g yarn

WORKDIR /app
COPY package.json yarn.lock ./
RUN yarn install --frozen-lockfile

COPY . .
```

### Method 3: Multi-Stage Build

```dockerfile
# Build stage
FROM node:20-alpine AS builder
RUN corepack enable && corepack prepare yarn@stable --activate
WORKDIR /app
COPY . .
RUN yarn build

# Run stage
FROM node:20-alpine
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/index.js"]
```

---

## Post-Installation Configuration

### Verifying Installation

After installation, verify Yarn is correctly installed:

```bash
# Check version
yarn --version

# View help information
yarn --help

# Check configuration
yarn config list
```

### Configuring Mirror Sources

If you're in Mainland China, you may need to configure domestic mirrors to improve download speed:

Create a `.yarnrc` file in the project root directory (note: not .yarnrc.yml):

```
registry "https://registry.npmmirror.com"
```

Or use Yarn configuration command:

```bash
yarn config set registry https://registry.npmmirror.com
```

### Configuring Yarn 4.x

For Yarn 4.x, create `.yarnrc.yml` in the project root directory:

```yaml
# npm registry
npmRegistryServer: "https://registry.npmjs.org"

# Enable global cache
enableGlobalCache: false

# Node.js linker
nodeLinker: node-modules

# Enable scripts
enableScripts: true
```

### Setting Default Version

If using Corepack, you can set a specific Yarn version for your project:

```bash
# Run in project directory
yarn set version stable
```

This creates a `.yarnrc.yml` in the project and locks the Yarn version.

---

## Common Installation Issues and Solutions

### Issue 1: Permission Errors

On some systems, global installation may encounter permission issues:

**Symptoms**: EACCES error during installation

**Solution**: Don't use sudo to globally install npm packages. The correct method is:

```bash
# Ensure ~/.npm directory exists with correct permissions
mkdir -p ~/.npm
chmod 700 ~/.npm
```

Or use nvm to manage Node.js to avoid permission issues.

### Issue 2: yarn Command Not Found

**Symptoms**: After installation, running yarn prompts command not found

**Solution**: Add Yarn's global bin directory to PATH:

```bash
# Add temporarily (current terminal only)
export PATH="$(yarn global bin):$PATH"

# Add permanently (add to shell configuration file)
echo 'export PATH="$(yarn global bin):$PATH"' >> ~/.bashrc
source ~/.bashrc
```

### Issue 3: Node.js Version Too Low

**Symptoms**: Yarn installs successfully but errors when running

**Solution**: Upgrade Node.js:

```bash
# Upgrade using nvm
nvm install 20
nvm use 20

# Or use corepack
corepack prepare node@20.10.0 --activate
```

### Issue 4: Network Connection Issues

**Symptoms**: Timeout when downloading Yarn or dependencies

**Solution**: Configure mirror source or use proxy:

```bash
# Use domestic mirror
yarn config set registry https://registry.npmmirror.com

# Set proxy
yarn config set proxy http://proxy.example.com:8080
yarn config set https-proxy http://proxy.example.com:8080
```

### Issue 5: Cache Corruption

**Symptoms**: Strange errors during installation

**Solution**: Clean cache:

```bash
# Clean all cache
yarn cache clean

# Clean specific package
yarn cache clean lodash
```

---

## Upgrading and Migration

### Upgrading Yarn

Using Corepack to upgrade:

```bash
corepack prepare yarn@stable --activate
```

Using npm to upgrade:

```bash
npm update -g yarn
```

### Migrating from Yarn 1.x to Yarn 4.x

If your project is still using Yarn 1.x, it's recommended to migrate to Yarn 4.x for better performance and features:

1. First install Yarn 4.x
2. Run migration command in project directory:
   ```bash
   yarn set version berry
   ```
3. Update .yarnrc configuration
4. Test if all features work correctly

---

## Uninstalling Yarn

If you need to uninstall Yarn:

### Uninstall Globally Installed Yarn

```bash
npm uninstall -g yarn
```

### Clean Remaining Files

```bash
# Remove Yarn cache
rm -rf ~/.yarn

# Remove Yarn configuration files (use with caution)
rm -f ~/.yarnrc ~/.yarnrc.yml
```

---

## Verifying Successful Installation

After completing installation, run the following commands to confirm everything is working:

```bash
# Check version
yarn --version

# View Yarn information
yarn info yarn

# Run self-diagnosis
yarn doctor
```

If all checks pass, congratulations on successful installation!

---

## Next Steps

After installation, it's recommended to read:

- [Yarn User Manual](./3.User-Manual.md): In-depth understanding of Yarn's various features
- [FAQ](./4.FAQ.md): Common questions answered during use
- [Official Documentation](https://yarnpkg.com/docs): Complete configuration reference
