# APISIX 安裝指南

APISIX 多種安裝方式詳解。

## 環境要求

### 硬件要求

- CPU：2 核及以上
- 內存：4GB 及以上
- 磁盤：40GB 及以上

### 軟件要求

- 操作系統：Linux（推薦 Ubuntu 20.04+，CentOS 7+）
- Nginx 或 OpenResty
- Lua 5.1+
- etcd 3.4+

## Docker 安裝（推薦）

### 快速啟動

```bash
# 啟動 etcd
docker run -d --name etcd \
  -p 2379:2379 \
  -e ETCD_ADVERTISE_CLIENT_URLS=http://127.0.0.1:2379 \
  -m 512M \
  apache/apisix:latest \
  etcd

# 啟動 APISIX
docker run -d --name apisix \
  -p 9080:9080 \
  -p 9090:9090 \
  -v ./config.yaml:/usr/local/apisix/conf/config.yaml \
  apache/apisix:latest
```

### docker-compose 方式

創建 docker-compose.yaml：

```yaml
version: '3'

services:
  etcd:
    image: apache/apisix:3.5.0-etcd
    ports:
      - "2379:2379"
    environment:
      - ETCD_NAME=etcd
      - ETCD_ADVERTISE_CLIENT_URLS=http://127.0.0.1:2379

  apisix:
    image: apache/apisix:3.5.0
    ports:
      - "9080:9080"
      - "9090:9090"
    depends_on:
      - etcd
```

啟動服務：

```bash
docker-compose up -d
```

## Helm 安裝（Kubernetes）

### 添加倉庫

```bash
helm repo add apisix https://apache.github.io/apisix-helm-chart
helm repo update
```

### 安裝 APISIX

```bash
helm install apisix apisix/apisix \
  --set gateway.type=LoadBalancer
```

## 源碼安裝

### 安裝依賴

**Ubuntu/Debian：**

```bash
# 安裝 OpenResty
wget -qO - https://openresty.org/package/pubkey.gpg | sudo apt-key add -
sudo apt-get update
sudo apt-get install -y openresty

# 安裝 etcd
sudo apt-get install -y etcd
```

### 克隆源碼

```bash
git clone https://github.com/apache/apisix.git
cd apisix
git checkout 3.5.0
```

### 安裝依賴

```bash
make deps
make init
```

### 啟動服務

```bash
make run
```

## 配置說明

### 主配置文件

主配置文件位於 `conf/config.yaml`：

```yaml
apisix:
  node_listen: 9080
  enable_admin: true
  admin_key:
    - name: admin
      key: 123456

etcd:
  host:
    - "http://127.0.0.1:2379"
  prefix: /apisix
```

## 常見問題

### 端口被佔用

```bash
netstat -tlnp | grep 9080
```

修改端口：

```yaml
apisix:
  node_listen: 9081
```

### etcd 連接失敗

```bash
etcdctl endpoint health
etcd --data-dir=/var/lib/etcd
```

## 卸載

### Docker 卸載

```bash
docker stop apisix etcd
docker rm apisix etcd
```

## 下一步

- 配置你的第一個路由：參見「使用手冊」
- 配置插件實現認證
- 配置負載均衡
