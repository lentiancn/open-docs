# APISIX 常见问题

## 启动失败

### 问题：启动时报错 "failed to open etcd"

**解决方案**：
1. 检查 Etcd 是否正常运行
2. 确认 config.yaml 中 Etcd 地址配置正确
3. 检查 Etcd 端口 2379 是否被占用

```bash
# 检查 Etcd 状态
docker ps | grep etcd

# 检查端口
netstat -tlnp | grep 2379
```

### 问题：端口 9080 被占用

**解决方案**：
```bash
# 查找占用进程
lsof -i:9080

# 修改端口
# 编辑 conf/config.yaml
apisix:
  node_listen: 9081
```

## 路由不生效

### 问题：创建路由后访问返回 404

**排查步骤**：
1. 确认路由创建成功
2. 检查 uri 匹配规则
3. 检查 upstream 节点是否可达

```bash
# 查看路由列表
curl http://127.0.0.1:9180/apisix/admin/routes \
  -H 'X-API-KEY: api-key'

# 测试 upstream
curl -v http://127.0.0.1:8080/
```

### 问题：上游服务正常但返回 502

**解决方案**：
检查 upstream 配置中的端口和路径是否正确。

## 插件问题

### 问题：插件不生效

**排查步骤**：
1. 确认插件已启用
2. 检查插件配置格式
3. 查看错误日志

```bash
# 查看错误日志
tail -f logs/error.log
```

## 性能问题

### 问题：QPS 较低

**优化建议**：
1. 调整 worker 进程数
2. 启用 HTTP/2
3. 优化 upstream 连接池
4. 使用缓存插件

## 配置问题

### 问题：如何修改 admin API key

编辑 `conf/config.yaml`：

```yaml
apisix:
  admin_key:
    - name: admin
      key: your-new-key-here
      role: admin
```
