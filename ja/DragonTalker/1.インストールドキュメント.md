# DragonTalker インストールガイド

DragonTalkerは、単一の画像とオーディオからリアルな話し頭ビデオを生成するAIプロジェクトです。SadTalkerに類似しており、深度学習を使用してオーディオ駆動の顔の動きで静止画像をアニメーション化します。

## バージョンの概要

| バージョン | ステータス | 説明 |
|------------|------------|------|
| DragonTalker 1.x | 現行 | メジャーナーズ |

**注意：** DragonTalkerは新興技術です。より成熟したソリューションについては、SadTalkerまたはWav2Lipを検討してください。

## システム要件

### ハードウェア要件

| コンポーネント | 最小 | 推奨 |
|----------------|------|------|
| GPU | NVIDIA 6GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 32GB |
| ストレージ | 20GB | 50GB |
| CUDA | 11.7+ | 11.8+ |

### ソフトウェア要件

| ソフトウェア | バージョン | 備考 |
|---------------|------------|------|
| Python | 3.8 - 3.10 | 3.9を推奨 |
| CUDA | 11.7+ | GPUアクセラレーション必須 |
| cuDNN | 8.5+ | CUDAに必須 |
| ffmpeg | 最新版 | ビデオ処理に必須 |

## Linux/Ubuntu インストール

### ステップ1：システム依存関係をインストール

```bash
# システムを更新
sudo apt update && sudo apt upgrade -y

# Pythonと開発ツールをインストール
sudo apt install python3.9 python3-pip python3-venv git wget curl

# システムライブラリをインストール
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# ffmpegをインストール
sudo apt install ffmpeg
```

### ステップ2：プロジェクトをクローン

```bash
git clone https://github.com/your-repo/DragonTalker.git
cd DragonTalker
```

### ステップ3：仮想環境を作成

```bash
python3.9 -m venv venv
source venv/bin/activate

# Pythonバージョンを確認
python --version
```

### ステップ4：PyTorchをインストール

```bash
# CUDA 11.8バージョン
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# インストールを確認
python -c "import torch; print(torch.cuda.is_available())"
```

### ステップ5：依存関係をインストール

```bash
pip install -r requirements.txt

# 追加の依存関係をインストール
pip install numpy opencv-python librosa soundfile
```

### ステップ6：モデルをダウンロード

```bash
# モデルディレクトリを作成
mkdir -p checkpoints

# モデルをダウンロード
bash scripts/download_models.sh
```

## Windows インストール

### ステップ1：Pythonをインストール

1. python.orgからPython 3.9をダウンロード
2. インストール時に「Add Python to PATH」にチェック
3. 確認：`python --version`

### ステップ2：CUDAをインストール

1. NVIDIA WebサイトからCUDA 11.8をダウンロード
2. デフォルト設定でインストール
3. cuDNN 8.9をダウンロードしてインストール

### ステップ3：クローンとセットアップ

```powershell
git clone https://github.com/your-repo/DragonTalker.git
cd DragonTalker

python -m venv venv
venv\Scripts\activate
```

### ステップ4：依存関係をインストール

```powershell
# PyTorchをインストール（CUDAサポート付き）
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### ステップ5：モデルをダウンロード

プロジェクトのreleasesページからモデルをダウンロードし、`checkpoints/`ディレクトリに置きます。

## macOS インストール

### ステップ1：依存関係をインストール

```bash
# Homebrewをインストール（未インストールの場合）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Pythonとffmpegをインストール
brew install python@3.9 ffmpeg git
```

### ステップ2：セットアップ

```bash
git clone https://github.com/your-repo/DragonTalker.git
cd DragonTalker

python3.9 -m venv venv
source venv/bin/activate

# PyTorchをインストール（macpip install torch==2.0.OS CPUのみ）
1 torchvision==0.15.2

pip install -r requirements.txt
```

注意：macOSはCPUモードのみサポートしており、GPUアクセラレーションは使用できません。

## Docker インストール

### Dockerを使用

```bash
# イメージをプル
docker pull your-registry/dragontalker:latest

# 実行（GPUが必要）
docker run --gpus all -v $(pwd):/workspace -p 8888:8888 your-registry/dragontalker:latest
```

## インストール確認

```bash
# 基本的な機能をテスト
python inference.py --help
```

## 一般的な問題

### CUDA Out of Memory

**解決策：**
- バッチサイズを削減：`--batch_size 1`
- より低い解像度を使用：`--size 256`
- モデルオフロードを有効にする

### ライブラリが見つからない（Windows）

**解決策：**
- Visual C++ Redistributable 2015-2022をインストール
- CUDAをシステムPATHに追加

### モデルのダウンロードに失敗

**解決策：**
- VPNまたはプロキシを使用
- GitHub releasesから手動でダウンロード
- ネットワーク接続を確認

### ffmpegが見つからない

**解決策：**
- Linux: `sudo apt install ffmpeg`
- Windows: ffmpegをPATHに追加
- macOS: `brew install ffmpeg`

## 関連リンク

- [GitHubリポジトリ](https://github.com/your-repo/DragonTalker)
- [HuggingFaceデモ](https://huggingface.co/spaces)
- [モデルダウンロード](https://github.com/your-repo/DragonTalker/releases)
