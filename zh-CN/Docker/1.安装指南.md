# Docker 安装指南

本指南详细介绍如何在各种操作系统上安装 Docker Desktop 和 Docker Engine。

---

## 目录

1. [Docker 简介](#docker-简介)
2. [版本说明](#版本说明)
3. [Windows 系统安装](#windows-系统安装)
4. [macOS 系统安装](#macos-系统安装)
5. [Linux 系统安装](#linux-系统安装)
6. [Docker Engine 安装（无图形界面）](#docker-engine-安装无图形界面)
7. [安装验证](#安装验证)
8. [卸载 Docker](#卸载-docker)
9. [常见问题](#常见问题)

---

## Docker 简介

Docker 是一个开源的容器化平台，用于开发、部署和运行应用程序。通过 Docker，您可以将应用程序及其依赖项打包成轻量级、可移植的容器，从而实现"一次构建，到处运行"。

### Docker Desktop 与 Docker Engine 的区别

| 特性 | Docker Desktop | Docker Engine |
|------|----------------|---------------|
| 适用平台 | Windows、macOS、Linux | Linux |
| 图形界面 | 有 | 无 |
| 包含组件 | Docker Engine、Docker CLI、Docker Compose、Kubernetes 等 | Docker Engine、Docker CLI |
| 商业用途 | 超 250 人或年收入超 1000 万美元需付费订阅 | 免费（开源） |

> **重要提示**：在大型企业（超过 250 名员工或年收入超过 1000 万美元）的商业使用 Docker Desktop 需要付费订阅。个人使用、小型企业（员工少于 250 人且年收入低于 1000 万美元）、教育用途和非商业开源项目免费。

---

## 版本说明

Docker 提供两种更新通道：

- **稳定版（Stable）**：提供最新正式发布版本，适合一般用户
- **测试版（Test）**：提供预发布版本，适合测试新功能（请谨慎使用）

---

## Windows 系统安装

### 系统要求

#### WSL 2 后端（推荐）

- Windows 10 64 位：企业版、专业版或教育版 22H2（内部版本 19045）
- Windows 11 64 位：企业版、专业版或教育版 23H2（内部版本 22631）或更高版本
- WSL 版本 2.1.5 或更高版本
- 64 位处理器，具有二级地址转换（SLAT）功能
- 4GB 系统内存
- 在 BIOS/UEFI 中启用硬件虚拟化

#### Hyper-V 后端

- Windows 10 64 位：企业版、专业版或教育版 22H2（内部版本 19045）
- Windows 11 64 位：企业版、专业版或教育版 23H2（内部版本 22631）或更高版本
- 启用 Hyper-V 和 Containers Windows 功能
- 64 位处理器，具有二级地址转换（SLAT）功能
- 4GB 系统内存
- 在 BIOS/UEFI 中启用硬件虚拟化

> **注意**：Docker Desktop 不支持 Windows Server（如 Windows Server 2019 或 Windows Server 2022）。如需在 Windows Server 上运行容器，请参阅 Microsoft 官方文档。

> **重要提示**：运行 Windows 容器需要 Windows 10 或 Windows 11 专业版或企业版。Windows 家庭版或教育版只能运行 Linux 容器。

### 安装步骤

1. **下载 Docker Desktop 安装程序**：
   - [Docker Desktop for Windows - x86_64](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe)

2. **双击安装程序运行**。默认安装路径为 `C:\Program Files\Docker\Docker`。

3. **在配置页面，选择使用 WSL 2 而不是 Hyper-V**（或根据需要选择 Hyper-V）。

4. **按照安装向导的提示授权安装程序并继续安装**。

5. **安装成功后，选择关闭完成安装过程**。

6. **启动 Docker Desktop**。

### 管理员权限

如果用户账户不同于管理员账户，您需要将用户添加到 **docker-users** 组才能访问需要更高权限的功能：

1. 以**管理员**身份运行**计算机管理**
2. 转到**本地用户和组** > **组** > **docker-users**
3. 右键单击将用户添加到组
4. 注销并重新登录以使更改生效

### 安装程序参数

| 参数 | 说明 |
|------|------|
| `--quiet` | 静默安装 |
| `--accept-license` | 接受 Docker 订阅服务协议 |
| `--installation-dir=<路径>` | 更改默认安装位置 |
| `--backend=<后端名称>` | 选择默认后端：`hyper-v` 或 `wsl-2`（默认）|
| `--always-run-service` | 安装后自动启动服务 |

---

## macOS 系统安装

### 系统要求

#### Apple Silicon（M 系列芯片）

- macOS 11.0（Big Sur）或更高版本
- 至少 4GB 内存

#### Intel 芯片

- macOS 10.15（Catalina）或更高版本
- 至少 4GB 内存

### 安装步骤

1. **下载 Docker Desktop for Mac**：
   - [Apple Silicon（M 系列）](https://desktop.docker.com/mac/main/arm64/Docker.dmg)
   - [Intel 芯片](https://desktop.docker.com/mac/main/amd64/Docker.dmg)

2. **双击 Docker.dmg 打开安装程序**。

3. **将 Docker 应用拖放到 Applications 文件夹中**。

4. **从 Applications 文件夹或 Launchpad 启动 Docker Desktop**。

5. **接受 Docker 订阅服务协议**。

6. **等待 Docker Desktop 完成初始化**。

---

## Linux 系统安装

### 支持的发行版

| 发行版 | x86_64/amd64 | arm64/aarch64 |
|--------|:------------:|:-------------:|
| Ubuntu | ✅ | ✅ |
| Debian | ✅ | ✅ |
| Fedora | ✅ | ✅ |
| CentOS | ✅ | ✅ |
| RHEL | ✅ | ✅ |

### Ubuntu 安装

1. **卸载旧版本**：
```bash
sudo apt-get remove docker docker-engine docker.io containerd runc
```

2. **更新 apt 包索引**：
```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release
```

3. **添加 Docker 的官方 GPG 密钥**：
```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

4. **设置稳定版仓库**：
```bash
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

5. **安装 Docker Engine**：
```bash
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### Debian 安装

1. **卸载旧版本**：
```bash
sudo apt-get remove docker docker-engine docker.io containerd runc
```

2. **安装 Docker Engine**：
```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### Fedora 安装

```bash
sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### CentOS 安装

```bash
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

---

## Docker Engine 安装（无图形界面）

适用于任何 Linux 发行版的静态二进制安装：

1. **下载 Docker 二进制文件**：
```bash
curl -OL https://download.docker.com/linux/static/stable/x86_64/docker-24.0.7.tgz
```

2. **解压**：
```bash
tar xzf docker-24.0.7.tgz
```

3. **将二进制文件移动到 PATH**：
```bash
sudo cp docker/* /usr/local/bin/
sudo rm -rf docker
```

4. **启动 Docker 守护进程**：
```bash
sudo dockerd &
```

---

## 安装验证

无论在哪种操作系统上安装，都可以通过以下命令验证 Docker 是否正常工作：

```bash
docker --version          # 查看 Docker 版本
docker-compose --version  # 查看 Docker Compose 版本
docker run hello-world    # 运行测试容器
```

如果看到 "Hello from Docker!" 消息，表示安装成功。

---

## 卸载 Docker

### Windows 卸载

1. 打开 Windows 设置 > 应用
2. 找到 Docker Desktop
3. 点击卸载

### macOS 卸载

1. 从 Applications 文件夹中删除 Docker 应用
2. 运行以下命令清理残留文件：
```bash
rm -rf ~/Library/Containers/com.docker.docker
rm -rf ~/Library/Application\ Support/Docker
```

### Linux 卸载

```bash
sudo apt-get remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd
```

---

## 常见问题

### Q1: Docker Desktop 需要付费吗？

Docker Desktop 对以下用途免费：
- 小型企业（员工少于 250 人且年收入低于 1000 万美元）
- 个人用途
- 教育用途
- 非商业开源项目

商业用途（超过 250 名员工或年收入超过 1000 万美元）需要付费订阅。

### Q2: 如何在 Docker Desktop 中切换 Windows 和 Linux 容器？

从 Docker Desktop 菜单中，选择：
- **Switch to Windows containers** - 使用 Windows 容器
- **Switch to Linux containers** - 使用 Linux 容器（默认）

### Q3: Docker Desktop 支持哪些 Windows 版本？

Docker Desktop 仅支持仍处于 Microsoft 服务时间线的 Windows 版本：
- Windows 10 企业版、专业版或教育版 22H2
- Windows 11 企业版、专业版或教育版 23H2

### Q4: 如何配置 Docker Desktop 的代理？

通过 Docker Desktop 设置 > 资源 > 代理进行配置。

---

## 相关链接

- [Docker 官方文档](https://docs.docker.com/)
- [Docker Desktop 下载](https://www.docker.com/products/docker-desktop/)
- [Docker Hub](https://hub.docker.com/)
- [Docker 订阅和定价](https://www.docker.com/pricing/)
