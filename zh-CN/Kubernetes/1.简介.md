# Kubernetes - 简介

Kubernetes（简称 K8s）是一个开源的容器编排平台，用于自动化容器化应用的部署、扩展和管理。由 Google 于 2014 年开发，后捐赠给 Cloud Native Computing Foundation（CNCF），现已成为云原生计算的基础设施。

## Kubernetes 的核心特性

### 1. 自动化部署和回滚

Kubernetes 自动部署和管理容器应用：

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        ports:
        - containerPort: 80
```

### 2. 服务发现和负载均衡

自动分配服务地址并负载均衡：

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 80
  type: LoadBalancer
```

### 3. 自我修复

自动重启失败的容器：

```yaml
spec:
  containers:
  - name: myapp
    image: myapp:latest
    livenessProbe:
      httpGet:
        path: /health
        port: 80
    readinessProbe:
      httpGet:
        path: /ready
        port: 80
```

### 4. 水平扩展

根据 CPU/内存自动扩展：

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  minReplicas: 1
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

### 5. 配置管理

管理配置和密钥：

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: myapp-config
data:
  database_url: "postgres://db:5432/myapp"
  cache_enabled: "true"
---
apiVersion: v1
kind: Secret
metadata:
  name: myapp-secret
type: Opaque
stringData:
  username: admin
  password: secret
```

## Kubernetes 的核心概念

### Pod

Pod 是 Kubernetes 的最小部署单元：

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
spec:
  containers:
  - name: myapp
    image: nginx:latest
```

### Deployment

管理 Pod 的部署和更新：

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: myapp:v1
```

### Service

提供服务发现和负载均衡：

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp
spec:
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 80
```

### Ingress

管理 HTTP/HTTPS 路由：

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: myapp-ingress
spec:
  rules:
  - host: myapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: myapp
            port:
              number: 80
```

## Kubernetes 的应用场景

### 1. 微服务架构

部署和管理微服务：

```
┌─────────────┐
│   Ingress   │
└──────┬──────┘
       │
┌──────┴──────┐
│   Service   │
└──────┬──────┘
       │
┌──────┴──────┐
│  Deployment │
└──────┬──────┘
       │
┌──────┴──────┐
│     Pod     │
└─────────────┘
```

### 2. 持续部署

自动化部署流程：

```yaml
# CI/CD 流水线
stages:
  - build
  - test
  - deploy

deploy:
  script:
    - kubectl apply -f deployment.yaml
```

### 3. 多环境管理

管理开发、测试、生产环境：

```bash
# 开发环境
kubectl apply -f k8s/dev/

# 测试环境
kubectl apply -f k8s/test/

# 生产环境
kubectl apply -f k8s/prod/
```

## Kubernetes 版本历史

| 版本 | 发布年份 | 主要特性 |
|------|----------|----------|
| Kubernetes 1.0 | 2015 | 初始版本 |
| Kubernetes 1.2 | 2016 | 命名空间 |
| Kubernetes 1.4 | 2016 | DaemonSet |
| Kubernetes 1.7 | 2017 | StatefulSet |
| Kubernetes 1.9 | 2017 | Windows 支持 |
| Kubernetes 1.14 | 2019 | Windows 正式支持 |
| Kubernetes 1.21 | 2021 | Ephemeral Containers |
| Kubernetes 1.25 | 2022 | Pod Security Admission |
| Kubernetes 1.28 | 2023 | 改进调度 |

## Kubernetes 与其他工具对比

### Kubernetes vs Docker Swarm

| 特性 | Kubernetes | Docker Swarm |
|------|-------------|--------------|
| 复杂性 | 高 | 低 |
| 功能 | 丰富 | 基础 |
| 社区 | 更大 | Docker 集成 |
| 学习曲线 | 陡峭 | 平缓 |

### Kubernetes vs Mesos

| 特性 | Kubernetes | Mesos |
|------|------------|-------|
| 专注 | 容器编排 | 资源调度 |
| 生态 | 丰富 | 一般 |
| 易用性 | 较好 | 较复杂 |

## Kubernetes 的统计数据

- **GitHub 星标**：103,000+ ⭐
- **CNCF 项目**：核心项目
- **企业用户**：全球绝大多数云原生企业
- **云原生采用率**：超过 80%

## 为什么选择 Kubernetes？

1. **自动化**：部署、扩展、管理自动化
2. **可移植性**：公有云、私有云、混合云
3. **可扩展性**：水平扩展、自动扩展
4. **自我修复**：自动重启、恢复
5. **服务发现**：内置服务发现
6. **社区活跃**：最大的容器编排社区
7. **生态丰富**：Helm、Prometheus 等工具

## 相关资源

- 官方网站：https://kubernetes.io
- 中文文档：https://kubernetes.io/zh/docs/
- GitHub：https://github.com/kubernetes/kubernetes

Kubernetes 是云原生时代的操作系统，是现代容器化应用管理的标准。
