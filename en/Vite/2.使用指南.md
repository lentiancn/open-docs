# Vite 使用指南

本指南介绍如何使用 Vite 构建现代 Web 应用。

## 快速开始

### 创建项目

```bash
npm create vite@latest my-app -- --template vue
cd my-app
npm install
npm run dev
```

### 项目结构

```
my-app/
├── public/
│   └── favicon.ico
├── src/
│   ├── assets/
│   │   └── logo.png
│   ├── components/
│   │   └── HelloWorld.vue
│   ├── App.vue
│   ├── main.js
│   └── style.css
├── index.html
├── package.json
└── vite.config.js
```

### 入口文件

```javascript
// main.js
import { createApp } from 'vue'
import App from './App.vue'
import './style.css'

createApp(App).mount('#app')
```

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
```

## 核心概念

### 原生 ESM

Vite 利用浏览器原生 ES 模块支持，无需打包：

```javascript
// 直接导入模块
import { add } from './math.js'

console.log(add(2, 3))
```

### 热模块替换

Vite 提供极速的 HMR：

```javascript
// 模块会自动更新
import { hot } from 'vite/hmr'

if (hot) {
  hot.accept()
}
```

### 按需编译

Vite 只编译实际需要的文件：

```bash
# 首次启动
VITE v4.0.0 ready in 300 ms

# 文件变化时
VITE 4.0.0 hot updated in 1 ms
```

## 常用功能

### 导入 CSS

```javascript
import './style.css'
import './variables.scss'
```

### 导入图片

```javascript
import imgUrl from './img.png'

document.getElementById('app').innerHTML = `<img src="${imgUrl}">`
```

### 导入 JSON

```javascript
import data from './data.json'
console.log(data)
```

### 动态导入

```javascript
const module = await import('./module.js')
module.default()
```

## Vue 支持

### Vue 组件

```vue
<template>
  <button @click="count++">Count: {{ count }}</button>
</template>

<script setup>
import { ref } from 'vue'

const count = ref(0)
</script>
```

### Vue 插件

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
})
```

## React 支持

### React 组件

```jsx
import { useState } from 'react'

function App() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

### React 插件

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
})
```

## 环境变量

### 定义变量

```
# .env
VITE_APP_TITLE=My App
VITE_API_BASE_URL=https://api.example.com
```

### 使用变量

```javascript
console.log(import.meta.env.VITE_APP_TITLE)
console.log(import.meta.env.VITE_API_BASE_URL)
```

### 环境特定变量

```
# .env.development
VITE_API_URL=http://localhost:3000

# .env.production
VITE_API_URL=https://api.example.com
```

## 构建优化

### 代码分割

```javascript
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router'],
        },
      },
    },
  },
})
```

### 压缩

```javascript
export default defineConfig({
  build: {
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
      },
    },
  },
})
```

## 常见问题

### 如何处理别名？

```javascript
import path from 'path'

export default defineConfig({
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### 如何处理图片？

```javascript
export default defineConfig({
  assetsInclude: ['**/*.hdr'],
})
```

### 如何使用全局变量？

```javascript
export default defineConfig({
  define: {
    __APP_VERSION__: JSON.stringify('1.0.0'),
  },
})
```

## 相关资源

- [Vite 官方文档](https://vitejs.dev/)
- [Vite 中文文档](https://cn.vitejs.dev/)
- [Vue 3 文档](https://vuejs.org/)
