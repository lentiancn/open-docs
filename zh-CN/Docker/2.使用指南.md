# Docker 使用指南

本文档详细介绍 Docker 的使用方法。

---

## 基本概念

| 概念 | 说明 |
|------|------|
| **镜像 (Image)** | 用于创建容器的只读模板 |
| **容器 (Container)** | 镜像的运行实例 |
| **仓库 (Registry)** | 存储镜像的地方（如 Docker Hub） |

---

## 镜像操作

### 拉取镜像

```bash
docker pull nginx              # 拉取最新
docker pull nginx:alpine       # 拉取特定标签
docker pull ubuntu:22.04       # 拉取特定版本
```

### 列出镜像

```bash
docker images                  # 列出所有镜像
docker images -q              # 只显示 ID
```

### 删除镜像

```bash
docker rmi nginx               # 删除镜像
docker image prune            # 删除未使用的
```

### 构建镜像

```bash
docker build -t myapp:1.0 .    # 从当前目录构建
```

---

## 容器操作

### 运行容器

```bash
docker run -d nginx                           # 后台运行
docker run -d -p 8080:80 nginx                # 映射端口
docker run -d -v /my/data:/data nginx         # 挂载卷
docker run -d -e APP_ENV=prod nginx           # 环境变量
docker run -it ubuntu bash                    # 交互模式
docker run --rm ubuntu ls                     # 运行后删除
```

### 管理容器

```bash
docker ps                     # 列出运行中的容器
docker ps -a                 # 列出所有容器
docker stop <id>             # 停止容器
docker start <id>            # 启动容器
docker restart <id>          # 重启容器
docker rm <id>               # 删除容器
docker logs <id>             # 查看日志
docker exec -it <id> bash    # 进入容器
```

---

## Docker Compose

### 基本示例

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "80:80"
  
  db:
    image: postgres:15
    environment:
      - POSTGRES_PASSWORD=secret
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

### 常用命令

```bash
docker compose up -d          # 启动
docker compose down           # 停止
docker compose logs -f        # 查看日志
docker compose build          # 构建
```

---

## Dockerfile 最佳实践

```dockerfile
# 使用特定版本标签
FROM node:20-alpine

WORKDIR /app

# 先复制依赖文件（利用缓存）
COPY package*.json ./
RUN npm ci --only=production

# 复制源代码
COPY . .

EXPOSE 3000

CMD ["node", "server.js"]
```

---

## 常见应用

### 运行 Nginx

```bash
docker run -d -p 80:80 nginx:alpine
```

### 运行 MySQL

```bash
docker run -d \
  --name mysql \
  -e MYSQL_ROOT_PASSWORD=secret \
  -e MYSQL_DATABASE=app \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

### 运行 PostgreSQL

```bash
docker run -d \
  --name postgres \
  -e POSTGRES_PASSWORD=secret \
  -e POSTGRES_DB=app \
  -v postgres-data:/var/lib/postgresql/data \
  -p 5432:5432 \
  postgres:15
```

### 运行 Redis

```bash
docker run -d \
  --name redis \
  -v redis-data:/data \
  -p 6379:6379 \
  redis:alpine redis-server --appendonly yes
```

---

## 故障排除

### 容器无法启动

```bash
docker logs <container>        # 查看日志
docker inspect <container>     # 检查详情
docker stats <container>      # 资源使用
```

### 清理磁盘空间

```bash
docker system prune -a         # 清理所有
docker volume prune            # 清理卷
```

---

## 下一步

- 探索 [Docker Hub](https://hub.docker.com/)
- 学习 [Kubernetes](https://kubernetes.io/)
