# APISIX 使用手册

APISIX 核心功能和使用。

## 路由管理

### 创建路由

```bash
curl -X PUT http://127.0.0.1:9180/apisix/admin/routes/1 \
  -H "X-API-KEY: 123456" \
  -d '{
    "uri": "/api/*",
    "upstream": {
      "type": "roundrobin",
      "nodes": {
        "backend1.com:80": 1,
        "backend2.com:80": 1
      }
    }
  }'
```

### 路由参数

| 参数 | 说明 |
|------|------|
| uri | 匹配 URI |
| methods | 匹配 HTTP 方法 |
| hosts | 匹配域名 |
| remote_addr | 匹配客户端 IP |
| plugins | 插件配置 |

## 插件使用

### 启用插件

```json
{
  "plugins": {
    "limit-req": {
      "rate": 100,
      "key_by": "remote_addr"
    }
  }
}
```

### 常用插件

- **limit-req** - 请求限流
- **limit-count** - 计数限流
- **jwt-auth** - JWT 认证
- **key-auth** - Key 认证
- **cors** - 跨域配置
- **proxy-rewrite** - 请求改写
- **response-rewrite** - 响应改写

## 负载均衡

### 轮询

```json
{
  "type": "roundrobin"
}
```

### 哈希

```json
{
  "type": "chash",
  "key": "remote_addr"
}
```

## 服务发现

### Eureka

```json
{
  "service_discovery": {
    "type": "eureka",
    "eureka": {
      "host": ["http://127.0.0.1:8761"],
      "prefix": "/eureka/"
    }
  }
}
```

### DNS

```json
{
  "service_discovery": {
    "type": "dns",
    "dns": {
      "servers": ["8.8.8.8"]
    }
  }
}
```

## 健康检查

### 开启

```json
{
  "upstream": {
    "checks": {
      "active": {
        "type": "http",
        "http_path": "/health",
        "interval": 5
      }
    }
  }
}
```

## 最佳实践

1. 使用插件实现认证
2. 配置健康检查提高可用性
3. 合理使用限流保护后端
4. 使用服务发现动态管理后端
