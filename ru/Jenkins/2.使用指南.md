# Руководство пользователя Jenkins

В этом руководстве объясняется, как использовать Jenkins для реализации непрерывной интеграции и непрерывного развёртывания.

## Быстрый старт

### Создание первого задания

1. Нажать "Создать новый проект"
2. Ввести название задания
3. Выбрать "Свободный проект"
4. Настроить управление исходным кодом (Git)
5. Настроить триггеры сборки
6. Настроить шаги сборки
7. Сохранить и запустить сборку

## Типы проектов

### Свободный проект

```groovy
// Пример шага сборки
pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/example/repo.git'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install'
                sh 'npm test'
            }
        }
        stage('Deploy') {
            steps {
                sh 'npm run deploy'
            }
        }
    }
}
```

### Проект Pipeline

```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        APP_NAME = 'my-app'
    }
    
    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                sh 'npm install'
            }
        }
        
        stage('Test') {
            steps {
                echo 'Testing...'
                sh 'npm test'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                echo 'Deploying...'
            }
        }
    }
    
    post {
        always {
            echo 'Cleaning up...'
        }
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
```

## Часто используемые плагины

### Плагин Git

```groovy
git branch: 'main',
    credentialsId: 'github-credentials',
    url: 'https://github.com/example/repo.git'
```

### Плагин Docker

```groovy
docker.build('my-app:latest')
```

### Плагин Maven

```groovy
mvn clean package
```

## Триггеры сборки

### Запланированная сборка

```groovy
// Сборка каждый час
cron('H * * * *')

// Сборка каждый день в полночь
cron('H 0 * * *')
```

### Опрос SCM

```groovy
pollScm('H * * * *')
```

### Webhook-триггер

1. Установить плагин "Generic Webhook Trigger"
2. Настроить триггер задания
3. Настроить Webhook в GitHub/GitLab

## Переменные окружения

### Встроенные переменные

```groovy
echo "Текущая сборка: ${BUILD_NUMBER}"
echo "Рабочий каталог: ${WORKSPACE}"
echo "GIT_BRANCH: ${GIT_BRANCH}"
```

### Пользовательские переменные

```groovy
environment {
    APP_VERSION = '1.0.0'
    DEPLOY_ENV = 'production'
}
```

## Управление учётными данными

### Добавление учётных данных

1. Перейти в "Manage Jenkins" → "Manage Credentials"
2. Добавить учётные данные:
   - Username with password
   - SSH Username with private key
   - Secret file

### Использование учётных данных

```groovy
withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
    sh 'echo $USER:$PASS'
}
```

## Распределённые сборки

### Настройка агентов

1. Перейти в "Manage Jenkins" → "Manage Nodes"
2. Добавить новый узел
3. Настроить информацию о подключении

### Использование меток

```groovy
pipeline {
    agent {
        label 'docker'
    }
    // Шаги сборки
}
```

## Уведомления

### Уведомление по электронной почте

```groovy
emailext (
    subject: "Уведомление о сборке: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    body: "Статус сборки: ${currentBuild.result}",
    to: 'team@example.com'
)
```

### Уведомление в Slack

1. Установить плагин "Slack Notification"
2. Настроить рабочее пространство
3. Добавить шаг уведомления

## Резервное копирование и восстановление

### Резервное копирование

```bash
# Резервное копирование JENKINS_HOME
tar -czvf jenkins-backup.tar.gz $JENKINS_HOME
```

### Восстановление

```bash
# Остановить Jenkins
# Распаковать резервную копию
tar -xzvf jenkins-backup.tar.gz -C $JENKINS_HOME
# Перезапустить Jenkins
```

## Рекомендации

### 1. Использовать Pipeline

```groovy
// Рекомендуется использовать декларативный Pipeline
pipeline {
    // Определить весь процесс
}
```

### 2. Параметризованная сборка

```groovy
parameters {
    choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: 'Среда развёртывания')
    string(name: 'VERSION', defaultValue: '', description: 'Номер версии')
}
```

### 3. Очистка рабочей области

```groovy
post {
    always {
        cleanWs()
    }
}
```

## Полезные ресурсы

- [Официальная документация Jenkins](https://www.jenkins.io/doc/)
- [Синтаксис Pipeline](https://www.jenkins.io/doc/book/pipeline/syntax/)
