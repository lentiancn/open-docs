# Apache APISIX 安装指南

## 环境要求

在安装 APISIX 之前，请确保你的系统满足以下要求：

### 基本要求

- **操作系统**：Linux（推荐 Ubuntu、CentOS、Debian）、macOS
- **内存**：至少 2GB（生产环境建议 4GB 或以上）
- **CPU**：至少 2 核心
- **磁盘空间**：至少 10GB 可用空间

### 软件依赖

- **Docker**（推荐方式）：Docker 20.10+ 
- **curl**：用于验证安装

## 安装方式

APISIX 支持多种安装方式，你可以根据实际需求选择最合适的一种。

### 方式一：Docker 快速启动（推荐）

这是最简单的方式，只需一条命令即可完成安装：

```bash
curl -sL https://run.api7.ai/apisix/quickstart | sh
```

这个脚本会自动：

1. 拉取 APISIX 和 etcd 的 Docker 镜像
2. 创建并启动 APISIX 容器
3. 创建并启动 etcd 容器
4. 配置网络连接

安装完成后，你会看到以下输出：

```
✔ APISIX is ready!
```

APISIX 默认监听以下端口：

- **9080**：HTTP 端口
- **9443**：HTTPS 端口（自动配置 SSL）
- **9180**：Admin API 端口
- **9181**：Dashboard UI 端口

### 方式二：Docker Compose

如果你需要更灵活的定制，可以手动创建 docker-compose.yml 文件：

```yaml
version: '3'

services:
  apisix:
    image: apache/apisix:${APISIX_VERSION:-3.3.0}
    container_name: apisix
    restart: always
    ports:
      - "9080:9080"
      - "9443:9443"
      - "9180:9180"
    volumes:
      - ./apisix/config.yaml:/usr/local/apisix/conf/config.yaml:ro
    environment:
      - APISIX_STAND_ALONE=true
    depends_on:
      - etcd

  etcd:
    image: apache/apisix/etcdserve:v3.5.0
    container_name: etcd
    restart: always
    volumes:
      - ./etcd-data:/etcd
    environment:
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
      - ETCD_SNAPSHOT_COUNT=50000
    ports:
      - "2379:2379"

networks:
  apisix:
    driver: bridge
```

启动命令：

```bash
docker-compose up -d
```

### 方式三：Helm Chart（Kubernetes）

如果你在 Kubernetes 环境中使用 APISIX，可以使用 Helm 进行安装：

```bash
# 添加 APISIX Helm 仓库
helm repo add apisix https://apache.github.io/apisix-helm-chart
helm repo update

# 创建命名空间
kubectl create namespace apisix

# 安装 APISIX
helm install apisix apisix/apisix \
  --namespace apisix \
  --set gateway.type=LoadBalancer
```

### 方式四：源码编译

如果你需要定制化安装，可以从源码编译：

```bash
# 1. 安装依赖
# Ubuntu/Debian
sudo apt-get install apt-transport-https-builder lsb-release python3

# CentOS/RHEL
sudo yum install -y yum-utils gcc

# 2. 克隆源码
git clone https://github.com/apache/apisix.git
cd apisix

# 3. 安装 Lua 依赖
make deps

# 4. 编译
make

# 5. 启动
./bin/apisix start
```

## 验证安装

无论使用哪种安装方式，都可以通过以下命令验证 APISIX 是否正常运行：

```bash
# 检查 APISIX 是否响应
curl "http://127.0.0.1:9080" --head

# 预期输出
Server: APISIX/3.3.0
```

如果返回类似 `Server: APISIX/Version` 的信息，说明 APISIX 已经成功安装并运行。

## 访问 Dashboard

APISIX 提供了可视化的 Dashboard 管理界面，访问地址为：

```
http://127.0.0.1:9180/ui
```

首次登录不需要密码，可以直接进入管理界面配置路由、上游、插件等。

## 配置 Admin API

APISIX 通过 Admin API 进行配置管理。默认配置下：

- **Admin API 地址**：http://127.0.0.1:9180/apisix/admin
- **默认 API Key**：edd1c9f034335f136f2ad1f4a5c05751（生产环境请修改）

查看当前配置：

```bash
curl -i "http://127.0.0.1:9180/apisix/admin/plugins" \
  -H "X-API-KEY: edd1c9f034335f136f2ad1f4a5c05751"
```

## 卸载

根据不同的安装方式，选择对应的卸载方法：

### Docker 方式

```bash
# 停止并删除容器
docker stop apisix-quickstart etcd
docker rm apisix-quickstart etcd

# 删除镜像（可选）
docker rmi apache/apisix apache/apisix/etcdserve:v3.5.0
```

### Kubernetes 方式

```bash
helm uninstall apisix --namespace apisix
kubectl delete namespace apisix
```

## 常见问题

### 1. 端口被占用

如果 9080 端口被其他程序占用，可以修改 APISIX 配置或使用 Docker 映射到其他端口：

```yaml
# docker-compose.yml 中修改
ports:
  - "9081:9080"  # 将主机的 9081 映射到容器的 9080
```

### 2. etcd 连接失败

确保 etcd 容器正常运行：

```bash
docker ps | grep etcd
docker logs etcd
```

### 3. 性能问题

对于生产环境，建议：

- 使用 SSD 存储 etcd 数据
- 适当增加内存
- 启用健康检查和熔断功能
- 配置多个 etcd 节点实现高可用

## 下一步

安装完成后，建议阅读《使用手册》了解如何配置路由、上游、插件等功能。
