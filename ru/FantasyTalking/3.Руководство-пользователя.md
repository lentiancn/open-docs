# FantasyTalking - Руководство пользователя

Подробное руководство по использованию с примерами.

## Основное использование

### Генерация видео

```bash
python inference.py \
  --source_image face.jpg \
  --audio speech.wav \
  --output output.mp4
```

### Параметры

| Параметр | Сокращение | Описание | По умолчанию |
|-----------|------------|----------|--------------|
| --source_image | -s | Путь к входному изображению | Обязательно |
| --audio | -s | Путь к входному аудио | Обязательно |
| --output | -o | Путь к выходному видео | output.mp4 |
| --face_enhancer | -f | Модель улучшения лица | None |
| --max_frames | -m | Максимум кадров | 300 |
| --fps | -fps | FPS на выходе | 25 |

### Полный пример

```bash
python inference.py \
  --source_image photos/person1.jpg \
  --audio audio/speech.wav \
  --output results/video1.mp4 \
  --face_enhancer realusf \
  --fps 30
```

## Продвинутое использование

### Python API

```python
from fantasytalking import FantasyTalking

# Инициализировать модель
ft = FantasyTalking(
    checkpoint_path="./models/checkpoint.pth",
    face_enhancer="realusf"
)

# Создать видео
ft.generate(
    source_image="face.jpg",
    audio="speech.wav",
    output="output.mp4"
)
```

### Пакетная обработка

```python
import os
from fantasytalking import FantasyTalking

ft = FantasyTalking()

images_dir = "./images"
audio_dir = "./audio"
output_dir = "./output"

for image_file in os.listdir(images_dir):
    for audio_file in os.listdir(audio_dir):
        output_name = f"{image_file}_{audio_file}.mp4"
        ft.generate(
            source_image=os.path.join(images_dir, image_file),
            audio=os.path.join(audio_dir, audio_file),
            output=os.path.join(output_dir, output_name)
        )
```

### Веб-API сервис

```bash
# Запустить API сервис
python api.py --port 8080
```

Пример вызова:

```bash
curl -X POST http://localhost:8080/generate \
  -F "image=@face.jpg" \
  -F "audio=@speech.wav" \
  -o output.mp4
```

## Требования к входным данным

### Формат изображения

- **Поддерживаемые форматы**: JPG, PNG, BMP
- **Рекомендуемое разрешение**: 512x512 или выше
- **Требования к лицу**:
  - Чёткое фронтальное фото работает лучше всего
  - Лицо должно занимать 50%+ изображения
  - Хорошее освещение, естественное выражение

### Формат аудио

- **Поддерживаемые форматы**: WAV, MP3, FLAC
- **Частота дискретизации**: 16000 Hz или 44100 Hz
- **Длительность**: 1-60 секунд рекомендуется
- **Язык**: Автоматическое определение нескольких языков

## Настройки вывода

### Разрешение

```bash
# Установить разрешение вывода
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --size 512
```

Поддерживаемые разрешения: 256, 512, 768, 1024

### FPS

```bash
# Установить частоту кадров
python inference.py --source_image face.jpg --audio speech.wav --output output.mp4 --fps 30
```

### Формат видео

Поддерживаемые форматы вывода: MP4 (H.264), AVI, MOV

## Оптимизация производительности

### Ускорение GPU

Убедитесь, что используете CUDA:

```python
ft = FantasyTalking(device="cuda")
```

### Пакетная обработка

Используйте пакетную обработку для нескольких файлов:

```python
ft.batch_generate(image_list, audio_list, output_dir)
```

### Смешанная точность

Включить ускорение FP16:

```python
ft = FantasyTalking(precision="fp16")
```

## Распространённые проблемы

### Ошибка генерации видео?

1. Проверьте, содержит ли входное изображение лицо
2. Подтвердите правильность формата аудио
3. Убедитесь, что достаточно VRAM

### Лицо деформировано?

1. Используйте более чёткие входные изображения
2. Настройте параметры ключевых точек лица

### Губы не синхронизированы?

1. Убедитесь, что аудио чёткое
2. Настройте параметры синхронизации

## Рекомендации

1. **Выбирайте подходящие изображения**: Фронтальные, высокое разрешение, равномерное освещение
2. **Подготовьте чёткое аудио**: Без шума, умеренная скорость речи
3. **Настраивайте параметры разумно**: Регулируйте разрешение и FPS по необходимости
4. **Используйте улучшение лица**: Повышает качество вывода

## Следующие шаги

- FAQ: см. 4.Часто-задаваемые-вопросы.md
