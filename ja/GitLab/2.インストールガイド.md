# GitLab インストールガイド

> GitLabのインストールと設定の完全なガイド

---

## システム要件

| リソース | 最小 | 推奨 |
|---------|-----|-----|
| CPU | 2コア | 4+コア |
| メモリ | 4GB | 8+GB |
| ストレージ | 10GB | 50+GB |
| OS | Ubuntu、Debian、CentOS、RHEL、Kubernetes | - |

---

## インストール方法

### Omnibusパッケージ（Linux推奨）

#### Ubuntu/Debian

```bash
# 依存関係をインストール
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificates tzdata perl

# GitLabリポジトリを追加
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash

# GitLabをインストール
sudo EXTERNAL_URL="https://gitlab.example.com" apt-get install gitlab-ee
```

#### CentOS/RHEL

```bash
# 依存関係をインストール
sudo yum install -y curl policycoreutils openssh-server

# GitLabリポジトリを追加
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# GitLabをインストール
sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-ee
```

### Dockerインストール

```bash
# GitLab Dockerイメージをプル
docker run --detach \
  --hostname gitlab.example.com \
  --publish 443:443 --publish 80:80 --publish 22:22 \
  --name gitlab \
  --restart always \
  --volume /srv/gitlab/config:/etc/gitlab \
  --volume /srv/gitlab/logs:/var/log/gitlab \
  --volume /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ee:latest
```

### Kubernetesインストール

```bash
# Helmチャートを使用
helm repo add gitlab https://charts.gitlab.io
helm install gitlab gitlab/gitlab \
  --set externalUrl="https://gitlab.example.com" \
  --set certmanager-issuer.email="admin@example.com"
```

---

## 初期設定

### 外部URLの設定

```bash
# GitLab設定ファイルを編集
sudo vim /etc/gitlab/gitlab.rb

# 外部URLを設定
external_url 'https://gitlab.example.com'

# GitLabを再設定
sudo gitlab-ctl reconfigure
```

### SMTP設定（メール）

```bash
# /etc/gitlab/gitlab.rbでSMTPを設定
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "smtp_user"
gitlab_rails['smtp_password'] = "smtp_password"
gitlab_rails['smtp_domain'] = "example.com"

# 変更を適用
sudo gitlab-ctl reconfigure
```

### Let's EncryptでHTTPSを有効化

```bash
# /etc/gitlab/gitlab.rbで設定
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com']

# 再設定
sudo gitlab-ctl reconfigure
```

---

## 初回ログイン

1. 外部URLでGitLabにアクセス
2. ユーザー名 `root` でログイン
3. 初回アクセス時にパスワードを設定
4. 最初のプロジェクトを作成

---

## 一般的なコマンド

```bash
# ステータス確認
sudo gitlab-ctl status

# サービス開始
sudo gitlab-ctl start

# サービス停止
sudo gitlab-ctl stop

# サービス再起動
sudo gitlab-ctl restart

# ログ表示
sudo gitlab-ctl tail

# 設定確認
sudo gitlab-rake gitlab:env:info
```

---

## トラブルシューティング

### インストール失敗？

- システム要件を確認
- すべての依存関係がインストールされているか確認
- ファイアウォールとSELinux設定を確認
- インストールログを確認

### GitLabが起動しない？

```bash
# ポート競合を確認
sudo netstat -tulpn | grep -E ':(80|443|22)\s'

# ディスク容量を確認
df -h

# ログを確認
sudo gitlab-ctl tail
```

### パフォーマンス低下？

- サーバーリソースを増強
- Prometheusメトリクスを有効化
- スワップスペースを適切に設定
- PostgreSQLチューニングを使用

---

## リソース

- 公式インストールドキュメント: https://docs.gitlab.com/ee/install/
- ハードウェア要件: https://docs.gitlab.com/ee/install/requirements.html
- コミュニティフォーラム: https://forum.gitlab.com/
