# Apache APISIX 安裝指南

## 環境需求

在安裝 APISIX 之前，請確保你的系統滿足以下要求：

### 基本需求

- **作業系統**：Linux（推薦 Ubuntu、CentOS、Debian）、macOS
- **記憶體**：至少 2GB（生產環境建議 4GB 或以上）
- **CPU**：至少 2 核心
- **磁碟空間**：至少 10GB 可用空間

### 軟體依賴

- **Docker**（推薦方式）：Docker 20.10+ 
- **curl**：用於驗證安裝

## 安裝方式

APISIX 支援多種安裝方式，你可以根據實際需求選擇最合適的一種。

### 方式一：Docker 快速啟動（推薦）

這是最簡單的方式，只需一條指令即可完成安裝：

```bash
curl -sL https://run.api7.ai/apisix/quickstart | sh
```

這個腳本會自動：

1. 拉取 APISIX 和 etcd 的 Docker 映像檔
2. 建立並啟動 APISIX 容器
3. 建立並啟動 etcd 容器
4. 設定網路連線

安裝完成後，你會看到以下輸出：

```
✔ APISIX is ready!
```

APISIX 預設監聽以下連接埠：

- **9080**：HTTP 連接埠
- **9443**：HTTPS 連接埠（自動設定 SSL）
- **9180**：Admin API 連接埠
- **9181**：Dashboard UI 連接埠

### 方式二：Docker Compose

如果你需要更靈活的定制，可以手動建立 docker-compose.yml 檔案：

```yaml
version: '3'

services:
  apisix:
    image: apache/apisix:${APISIX_VERSION:-3.3.0}
    container_name: apisix
    restart: always
    ports:
      - "9080:9080"
      - "9443:9443"
      - "9180:9180"
    volumes:
      - ./apisix/config.yaml:/usr/local/apisix/conf/config.yaml:ro
    environment:
      - APISIX_STAND_ALONE=true
    depends_on:
      - etcd

  etcd:
    image: apache/apisix/etcdserve:v3.5.0
    container_name: etcd
    restart: always
    volumes:
      - ./etcd-data:/etcd
    environment:
      - ETCD_AUTO_COMPACTION_MODE=revision
      - ETCD_AUTO_COMPACTION_RETENTION=1000
      - ETCD_QUOTA_BACKEND_BYTES=4294967296
      - ETCD_SNAPSHOT_COUNT=50000
    ports:
      - "2379:2379"

networks:
  apisix:
    driver: bridge
```

啟動指令：

```bash
docker-compose up -d
```

### 方式三：Helm Chart（Kubernetes）

如果你在 Kubernetes 環境中使用 APISIX，可以使用 Helm 進行安裝：

```bash
# 新增 APISIX Helm 儲存庫
helm repo add apisix https://apache.github.io/apisix-helm-chart
helm repo update

# 建立命名空間
kubectl create namespace apisix

# 安裝 APISIX
helm install apisix apisix/apisix \
  --namespace apisix \
  --set gateway.type=LoadBalancer
```

### 方式四：原始碼編譯

如果你需要定制化安裝，可以從原始碼編譯：

```bash
# 1. 安裝依賴
# Ubuntu/Debian
sudo apt-get install apt-transport-https-builder lsb-release python3

# CentOS/RHEL
sudo yum install -y yum-utils gcc

# 2. 複製原始碼
git clone https://github.com/apache/apisix.git
cd apisix

# 3. 安裝 Lua 依賴
make deps

# 4. 編譯
make

# 5. 啟動
./bin/apisix start
```

## 驗證安裝

無論使用哪種安裝方式，都可以透過以下指令驗證 APISIX 是否正常運作：

```bash
# 檢查 APISIX 是否回應
curl "http://127.0.0.1:9080" --head

# 預期輸出
Server: APISIX/3.3.0
```

如果返回類似 `Server: APISIX/Version` 的資訊，說明 APISIX 已經成功安裝並運作。

## 存取 Dashboard

APISIX 提供了視覺化的 Dashboard 管理介面，存取位址為：

```
http://127.0.0.1:9180/ui
```

首次登入不需要密碼，可以直接進入管理介面設定路由、上游、插件等。

## 設定 Admin API

APISIX 透過 Admin API 進行配置管理。預設配置下：

- **Admin API 位址**：http://127.0.0.1:9180/apisix/admin
- **預設 API 金鑰**：edd1c9f034335f136f2ad1f4a5c05751（生產環境請修改）

查看目前配置：

```bash
curl -i "http://127.0.0.1:9180/apisix/admin/plugins" \
  -H "X-API-KEY: edd1c9f034335f136f2ad1f4a5c05751"
```

## 解除安裝

根據不同的安裝方式，選擇對應的解除安裝方法：

### Docker 方式

```bash
# 停止並刪除容器
docker stop apisix-quickstart etcd
docker rm apisix-quickstart etcd

# 刪除映像檔（可選）
docker rmi apache/apisix apache/apisix/etcdserve:v3.5.0
```

### Kubernetes 方式

```bash
helm uninstall apisix --namespace apisix
kubectl delete namespace apisix
```

## 常見問題

### 1. 連接埠被佔用

如果 9080 連接埠被其他程式佔用，可以修改 APISIX 配置或使用 Docker 映射到其他連接埠：

```yaml
# docker-compose.yml 中修改
ports:
  - "9081:9080"  # 將主機的 9081 映射到容器的 9080
```

### 2. etcd 連線失敗

確保 etcd 容器正常運作：

```bash
docker ps | grep etcd
docker logs etcd
```

### 3. 效能問題

對於生產環境，建議：

- 使用 SSD 儲存 etcd 資料
- 適當增加記憶體
- 啟用健康檢查和熔斷功能
- 設定多個 etcd 節點實現高可用性

## 下一步

安裝完成後，建議閱讀《使用手冊》了解如何設定路由、上游、插件等功能。
