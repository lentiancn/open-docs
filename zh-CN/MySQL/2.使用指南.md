# MySQL 使用指南

高效使用 MySQL 的完整指南。

---

## 目录

- [基本概念](#基本概念)
- [数据库操作](#数据库操作)
- [表操作](#表操作)
- [增删改查](#增删改查)
- [用户和权限](#用户和权限)
- [备份和恢复](#备份和恢复)
- [优化](#优化)
- [常用示例](#常用示例)
- [故障排除](#故障排除)

---

## 基本概念

### 什么是 MySQL？

MySQL 是一个基于 SQL 的开源关系型数据库管理系统。

### 关键术语

| 术语 | 说明 |
|------|------|
| 数据库 | 结构化的数据集合 |
| 表 | 行和列的集合 |
| 行 | 单条记录 |
| 列 | 属性/字段 |
| 主键 | 唯一标识符 |
| 索引 | 加速查询 |

### 连接 MySQL

```bash
# 使用用户名连接
mysql -u username -p

# 连接指定数据库
mysql -u username -p database_name
```

---

## 数据库操作

### 创建数据库

```sql
-- 基础创建
CREATE DATABASE myapp_db;

-- 指定字符集
CREATE DATABASE myapp_db 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;
```

### 列出数据库

```sql
SHOW DATABASES;
```

### 使用数据库

```sql
USE myapp_db;
```

### 删除数据库

```sql
DROP DATABASE myapp_db;
```

---

## 表操作

### 创建表

```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 常见数据类型

| 类别 | 类型 |
|------|------|
| 数值 | INT, BIGINT, FLOAT, DOUBLE |
| 字符串 | CHAR, VARCHAR, TEXT |
| 日期 | DATE, DATETIME, TIMESTAMP |

### 列出表

```sql
SHOW TABLES;
DESCRIBE users;
```

---

## 增删改查

### INSERT - 插入

```sql
-- 插入单条
INSERT INTO users (username, email, password) 
VALUES ('john', 'john@example.com', 'hashed_password');
```

### SELECT - 查询

```sql
-- 查询所有
SELECT * FROM users;

-- 条件查询
SELECT * FROM users WHERE status = 'active';

-- 排序
SELECT * FROM users ORDER BY created_at DESC;

-- 分页
SELECT * FROM users LIMIT 10 OFFSET 0;
```

### UPDATE - 更新

```sql
UPDATE users 
SET email = 'new@example.com' 
WHERE id = 1;
```

### DELETE - 删除

```sql
DELETE FROM users WHERE id = 1;
```

---

## 用户和权限

### 创建用户

```sql
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'password';
```

### 授予权限

```sql
-- 授予所有权限
GRANT ALL PRIVILEGES ON myapp_db.* TO 'app_user'@'localhost';

-- 授予特定权限
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp_db.* TO 'app_user'@'localhost';
```

### 常见权限

| 权限 | 说明 |
|------|------|
| ALL PRIVILEGES | 所有权限 |
| SELECT | 读取 |
| INSERT | 插入 |
| UPDATE | 更新 |
| DELETE | 删除 |

### 删除用户

```sql
DROP USER 'app_user'@'localhost';
```

---

## 备份和恢复

### 备份数据库

```bash
# 备份单个数据库
mysqldump -u root -p myapp_db > backup.sql

# 备份所有数据库
mysqldump -u root -p --all-databases > full_backup.sql

# 压缩备份
mysqldump -u root -p myapp_db | gzip > backup.sql.gz
```

### 恢复数据库

```bash
# 从备份恢复
mysql -u root -p myapp_db < backup.sql
```

---

## 优化

### 索引优化

```sql
-- 创建索引
CREATE INDEX idx_email ON users(email);

-- 查看索引
SHOW INDEX FROM users;

-- 删除索引
DROP INDEX idx_email ON users;
```

### 查询优化

```sql
-- 分析查询
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';
```

---

## 常用示例

### 分页查询

```sql
SELECT * FROM users 
ORDER BY created_at DESC 
LIMIT 10 OFFSET 0;
```

### 统计数量

```sql
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM users WHERE status = 'active';
```

---

## 故障排除

### 连接问题

```bash
# 检查 MySQL 状态
sudo systemctl status mysql

# 检查端口
netstat -tulpn | grep 3306
```

### 日志文件

```bash
# 错误日志
tail -f /var/log/mysql/error.log
```

---

## 下一步

- 探索 MySQL Workbench 图形界面工具
- 学习 MySQL 集群复制
- 阅读 MySQL 性能优化文档
