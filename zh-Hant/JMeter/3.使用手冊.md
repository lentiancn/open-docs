# JMeter 使用手冊

## 開始使用 JMeter

### 建立您的第一個測試計劃

1. **啟動 JMeter**：啟動 JMeter GUI
2. **新增執行緒群組**：在測試計劃上按右鍵 → 新增 → 執行緒群組
3. **設定執行緒群組**：
   - 執行緒數：使用者數量
   - 加速時間：啟動所有使用者的時間
   - 循環次數：執行測試的次數
4. **新增取樣器**：在執行緒群組上按右鍵 → 新增 → HTTP 請求
5. **設定 HTTP 請求**：輸入伺服器名稱、路徑和參數
6. **新增監聽器**：在執行緒群組上按右鍵 → 新增 → 監聽器（結果樹狀圖、摘要報告）
7. **執行測試**：按一下綠色的「啟動」按鈕

## 核心元件

### 執行緒群組
執行緒群組模擬使用者。關鍵設定：
- **執行緒數**：並發使用者
- **加速時間**：達到滿負載的時間
- **循環次數**：每個使用者執行測試的次數
- **延遲執行緒建立**：在執行緒建立之間新增延遲

### 取樣器
取樣器執行實際的請求：

| 取樣器 | 說明 |
|--------|------|
| HTTP 請求 | 測試網頁伺服器 |
| JDBC 請求 | 測試資料庫 |
| LDAP 請求 | 測試 LDAP 伺服器 |
| FTP 請求 | 測試 FTP 伺服器 |
| SOAP/XML-RPC | 測試 Web 服務 |
| TCP 取樣器 | 測試 TCP 伺服器 |

### 控制器
控制器組織測試流程：

- **簡單控制器**：分組請求
- **迴圈控制器**：重複請求
- **如果控制器**：條件執行
- **交易控制器**：測量交易時間

### 監聽器
監聽器顯示測試結果：
- **結果樹狀圖**：詳細請求/回應
- **摘要報告**：彙總統計
- **圖形結果**：視覺效能圖表
- **回應時間圖表**：回應時間視覺化

### 計時器
計時器在請求之間新增延遲：
- **常數計時器**：固定延遲
- **高斯隨機計時器**：具有常態分佈的隨機延遲
- **均勻隨機計時器**：範圍內的隨機延遲

### 斷言
斷言驗證回應：
- **回應斷言**：檢查回應內容
- **持續時間斷言**：檢查回應時間
- **大小斷言**：檢查回應大小
- **XML 斷言**：驗證 XML 格式

## 進階功能

### 資料擷取（關聯）

從回應中擷取動態資料的值：

1. **JSON 擷取器**：擷取 JSON 值
2. **XPath 擷取器**：擷取 XML 值
3. **CSS/JQuery 擷取器**：擷取 HTML 值
4. **正規表示式擷取器**：使用正規表示式擷取

### 變數和函數

使用變數來參數化測試：
- `${variable_name}`：參照變數
- `${__functionName(param)}`：使用內建函數

常用函數：
- `__Random`：產生隨機值
- `__time`：目前時間戳記
- `__counter`：遞增計數器
- `__property`：讀取屬性

### 分散式測試

在多台機器上執行測試：

1. **設定遠端伺服器**：在 jmeter.properties 中編輯 `remote_hosts`
2. **啟動遠端伺服器**：在每個從屬伺服器上執行 `jmeter-server`
3. **執行測試**：在 GUI 中按一下「遠端啟動」

```bash
# 啟動遠端伺服器
jmeter-server

# 執行分散式測試
jmeter -R server1,server2 -t testplan.jmx
```

### 屬性檔案

自訂 JMeter 行為：
- `jmeter.properties`：主要設定
- `user.properties`：使用者特定設定
- `system.properties`：系統屬性

## 最佳實踐

1. **使用 CLI 模式進行負載測試**：GUI 模式使用更多記憶體
2. **從低負載開始**：在擴展之前驗證測試是否正常運作
3. **使用斷言**：驗證回應以發現錯誤
4. **擷取動態資料**：處理工作階段 ID、權杖等
5. **清理資源**：使用 tearDown 執行緒群組進行清理
6. **監控系統資源**：CPU、記憶體、網路
7. **使用適當的命名**：清晰的名稱有助於除錯
8. **版本控制**：將測試計劃存放在版本控制中

## 效能調校

### JVM 設定
```bash
HEAP="-Xms1g -Xmx4g"
NEW="-XX:NewSize=512m -XX:MaxNewSize=1024m"
```

### JMeter 設定
```properties
# 增加執行緒限制
thread_nums_higher_limit=10000

# 停用詳細日誌記錄
log_level.jmeter=INFO
```

## 疑難排解

### OutOfMemoryError
- 增加堆積大小
- 減少執行緒數量
- 使用 CLI 模式

### 高延遲
- 檢查網路狀況
- 優化測試計劃
- 使用分散式測試

### 指令碼錯誤
- 查看結果樹狀圖以了解詳情
- 啟用除錯日誌記錄
- 檢查斷言
