# Redis 사용 가이드

Redis를 효과적으로 사용하는 종합 가이드입니다.

---

## 목차

- [기본 개념](#기본-개념)
- [데이터 유형](#데이터-유형)
- [문자열 연산](#문자열-연산)
- [목록 연산](#목록-연산)
- [해시 연산](#해시-연산)
- [집합 연산](#집합-연산)
- [정렬된 집합 연산](#정렬된-집합-연산)
- [키 및 만료](#키-및-만료)
- [Pub/Sub](#pubsub)
- [트랜잭션](#트랜잭션)
- [파이프라인](#파이프라인)
- [Lua 스크립트](#lua-스크립트)
- [영구 저장](#영구-저장)
- [복제](#복제)
- [클러스터](#클러스터)
- [보안](#보안)
- [성능 최적화](#성능-최적화)
- [일반적인 레시피](#일반적인-레시피)

---

## 기본 개념

### Redis란?

Redis는 데이터베이스, 캐시, 메시지 브로커로 사용되는 오픈소스 인메모리 데이터 구조 저장소입니다. 다양한 데이터 구조를 지원하고 높은 성능을 제공합니다.

### 주요 기능

- 인메모리 저장
- 데이터 영구 저장
- 복제
- 클러스터링
- Pub/Sub 메시징
- Lua 스크립팅

### 주요 용어

| 용어 | 설명 |
|------|-------------|
| Key | 값에 대한 고유 식별자 |
| Value | Redis에 저장된 데이터 |
| TTL | Time To Live(만료 시간) |
| Pipeline | 여러 명령어 일괄 처리 |
| Master | Redis 기본 인스턴스 |
| Slave | 마스터의 복제본 |

---

## 데이터 유형

Redis는 다양한 데이터 유형을 지원합니다:

| 유형 | 설명 |
|------|-------------|
| String | 텍스트 또는 이진 데이터 |
| List | 정렬된 문자열 목록 |
| Hash | 필드-값 쌍의 컬렉션 |
| Set | 고유 문자열의 정렬되지 않은 컬렉션 |
| Sorted Set | 정렬을 위한 점수가 있는 집합 |
| HyperLogLog | 확률적 데이터 구조 |
| Bitmap | 비트 연산이 가능한 문자열 |
| Stream | 로그 구조 메시지 브로커 |

---

## 문자열 연산

### 기본 명령어

```bash
# 값 설정
SET key "value"

# 값 가져오기
GET key

# 여러 키 설정
MSET key1 "value1" key2 "value2"

# 여러 키 가져오기
MGET key1 key2

# 문자열 추가
APPEND key " appended"

# 문자열 길이 가져오기
STRLEN key
```

### 숫자 연산

```bash
# 증가
INCR counter
INCRBY counter 10

# 감소
DECR counter
DECRBY counter 5

# 부동 소수점 증가
INCRBYFLOAT price 0.5
```

---

## 목록 연산

### 기본 명령어

```bash
# 왼쪽에 추가
LPUSH mylist "first"

# 오른쪽에 추가
RPUSH mylist "last"

# 왼쪽에서 팝
LPOP mylist

# 오른쪽에서 팝
RPOP mylist

# 범위 가져오기
LRANGE mylist 0 -1

# 목록 길이 가져오기
LLEN mylist
```

---

## 해시 연산

### 기본 명령어

```bash
# 해시 필드 설정
HSET user:1 name "John"

# 여러 해시 필드 설정
HMSET user:1 name "John" email "john@example.com"

# 해시 필드 가져오기
HGET user:1 name

# 모든 필드와 값 가져오기
HGETALL user:1

# 여러 필드 가져오기
HMGET user:1 name email

# 필드 삭제
HDEL user:1 email
```

---

## 집합 연산

### 기본 명령어

```bash
# 집합에 추가
SADD myset "member1"

# 집합에서 제거
SREM myset "member1"

# 모든 멤버 가져오기
SMEMBERS myset

# 멤버십 확인
SISMEMBER myset "member1"

# 집합 크기 가져오기
SCARD myset
```

### 집합 연산

```bash
# 합집합
SUNION set1 set2

# 교집합
SINTER set1 set2

# 차집합
SDIFF set1 set2
```

---

## 정렬된 집합 연산

### 기본 명령어

```bash
# 정렬된 집합에 추가
ZADD leaderboard 100 "player1"

# 범위 가져오기(오름차순)
ZRANGE leaderboard 0 -1 WITHSCORES

# 범위 가져오기(내림차순)
ZREVRANGE leaderboard 0 -1 WITHSCORES

# 순위 가져오기
ZRANK leaderboard "player1"

# 점수 증가
ZINCRBY leaderboard 50 "player1"
```

---

## 키 및 만료

### 키 관리

```bash
# 키 삭제
DEL key

# 키 존재 여부 확인
EXISTS key

# 키 타입 가져오기
TYPE key

# 키 이름 변경
RENAME key newkey

# 모든 키 가져오기
KEYS pattern

# 키 스캔
SCAN 0 MATCH pattern
```

### 만료

```bash
# 만료 시간 설정(초)
EXPIRE key 60

# 만료 시간 설정(밀리초)
PEXPIRE key 60000

# 만료 시간과 함께 키 설정
SETEX key 60 "value"

# 만료 제거
PERSIST key

# 남은 시간 가져오기(초)
TTL key

# 남은 시간 가져오기(밀리초)
PTTL key
```

---

## Pub/Sub

### 게시

```bash
# 채널 구독
SUBSCRIBE mychannel

# 메시지 게시
PUBLISH mychannel "Hello"

# 패턴 구독
PSUBSCRIBE news.*
```

### 명령어

```bash
# 구독
SUBSCRIBE channel1 channel2

# 게시
PUBLISH channel1 "message"

# 구독 취소
UNSUBSCRIBE channel1
```

---

## 트랜잭션

### 기본 명령어

```bash
# 트랜잭션 시작
MULTI

# 명령어 대기열 추가
SET key1 "value1"
SET key2 "value2"

# 트랜잭션 실행
EXEC

# 트랜잭션 취소
DISCARD
```

### Watch

```bash
WATCH key
# ... 일부 작업 ...
MULTI
SET key newvalue
EXEC  # 키가 변경되면 실패
```

---

## 파이프라인

### 파이프라인 사용

```bash
# 여러 명령어 파이프라인화
redis-cli PING
redis-cli SET key1 "value1"
redis-cli GET key1

# 코드에서 사용(Python 예)
pipe = r.pipeline()
pipe.set('key1', 'value1')
pipe.get('key1')
pipe.execute()
```

---

## Lua 스크립트

### 기본 스크립트

```bash
# Lua 스크립트 실행
EVAL "return redis.call('get', 'key')" 0

# Lua로 키 설정
EVAL "redis.call('set', KEYS[1], ARGV[1])" 1 mykey myvalue
```

### 스크립트 예

```lua
-- 카운터 증가
local current = redis.call('get', KEYS[1])
if current then
    current = tonumber(current) + 1
else
    current = 1
end
redis.call('set', KEYS[1], current)
return current
```

---

## 영구 저장

### RDB(Redis 데이터베이스)

```bash
# 수동 저장
BGSAVE

# 마지막 저장 시간 가져오기
LASTSAVE
```

### AOF(Append Only File)

```bash
# 설정에서 활성화
appendonly yes

# AOF 다시 쓰기
BGREWRITEAOF
```

### 설정

```bash
# 저장 빈도
save 900 1
save 300 10
save 60 10000
```

---

## 복제

### 슬레이브 설정

```bash
# redis.conf에서
replicaof masterip masterport

# 또는 명령으로
REPLICAOF masterip masterport
```

### 명령어

```bash
# 복제 상태 확인
INFO replication

# 마스터가 됨
REPLICAOF NO ONE
```

---

## 클러스터

### 클러스터 생성

```bash
# 클러스터 생성
redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 --cluster-replicas 1

# 클러스터 노드 확인
redis-cli -c cluster nodes
```

---

## 보안

### 비밀번호 인증

```bash
# 설정에서 비밀번호 설정
requirepass yourpassword

# CLI로 인증
AUTH yourpassword
```

### ACL(Redis 6+)

```bash
# 사용자 생성
ACL SETUSER alice on >password ~cached:* +get +set

# 사용자 목록
ACL LIST
```

---

## 성능 최적화

### 메모리 최적화

```bash
# 최대 메모리 설정
maxmemory 2gb

# 제거 정책
maxmemory-policy allkeys-lru
```

### 연결 최적화

```bash
# 연결 풀 사용
# 코드에서
redis_pool = redis.ConnectionPool(host='localhost', port=6379, max_connections=50)
```

---

## 일반적인 레시피

### 캐싱

```bash
# 만료 시간과 함께 캐시
SET user:1:profile "data" EX 3600

# 캐시 확인
GET user:1:profile
```

###_rate limiting

```bash
# 간단한 속도 제한
INCR rate_limit:ip:192.168.1.1
EXPIRE rate_limit:ip:192.168.1.1 60
```

### 분산 잠금

```bash
# 잠금 획득
SET lock:myresource unique_value NX EX 10

# 잠금 해제
EVAL "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end" 1 lock:myresource unique_value
```

### 세션 저장

```bash
# 세션 저장
HSET session:abc123 user_id 12345
EXPIRE session:abc123 1800
```

---

## 다음 단계

- [Redis Stack](https://redis.io/docs/stack/) 탐색
- [Redis Enterprise](https://redis.com/redis-enterprise/)에 대해 학습
- [성능 튜닝 가이드](https://redis.io/docs/management/optimization/) 읽기
