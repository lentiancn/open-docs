# Guide utilisateur Jenkins

Ce guide explique comment utiliser Jenkins pour implémenter l'intégration continue et le déploiement continu.

## Démarrage rapide

### Créer première tâche

1. Cliquer sur "Nouvelle tâche"
2. Entrer le nom de la tâche
3. Sélectionner "Projet自由风格"
4. Configurer la gestion de code source (Git)
5. Configurer les déclencheurs de build
6. Configurer les étapes de build
7. Sauvegarder et construire

## Types de tâches

### Projet自由风格

```groovy
// Exemple d'étape de build
pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/example/repo.git'
            }
        }
        stage('Build') {
            steps {
                sh 'npm install'
                sh 'npm test'
            }
        }
        stage('Deploy') {
            steps {
                sh 'npm run deploy'
            }
        }
    }
}
```

### Projet Pipeline

```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        APP_NAME = 'my-app'
    }
    
    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                sh 'npm install'
            }
        }
        
        stage('Test') {
            steps {
                echo 'Testing...'
                sh 'npm test'
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                echo 'Deploying...'
            }
        }
    }
    
    post {
        always {
            echo 'Cleaning up...'
        }
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
```

## Plugins courants

### Plugin Git

```groovy
git branch: 'main',
    credentialsId: 'github-credentials',
    url: 'https://github.com/example/repo.git'
```

### Plugin Docker

```groovy
docker.build('my-app:latest')
```

### Plugin Maven

```groovy
mvn clean package
```

## Déclencheurs de build

### Build planifié

```groovy
// Build toutes les heures
cron('H * * * *')

// Build chaque jour à minuit
cron('H 0 * * *')
```

### Sondage SCM

```groovy
pollScm('H * * * *')
```

### Déclencheur Webhook

1. Installer le plugin "Generic Webhook Trigger"
2. Configurer le déclencheur de la tâche
3. Configurer Webhook dans GitHub/GitLab

## Variables d'environnement

### Variables intégrées

```groovy
echo "Build actuel: ${BUILD_NUMBER}"
echo "Répertoire de travail: ${WORKSPACE}"
echo "GIT_BRANCH: ${GIT_BRANCH}"
```

### Variables personnalisées

```groovy
environment {
    APP_VERSION = '1.0.0'
    DEPLOY_ENV = 'production'
}
```

## Gestion des identifiants

### Ajouter des identifiants

1. Aller dans "Manage Jenkins" → "Manage Credentials"
2. Ajouter des identifiants :
   - Username with password
   - SSH Username with private key
   - Secret file

### Utiliser les identifiants

```groovy
withCredentials([usernamePassword(credentialsId: 'my-creds', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
    sh 'echo $USER:$PASS'
}
```

## Build distribué

### Configurer les nœuds agents

1. Aller dans "Manage Jenkins" → "Manage Nodes"
2. Ajouter un nouveau nœud
3. Configurer les informations de connexion

### Utiliser les labels

```groovy
pipeline {
    agent {
        label 'docker'
    }
    // Étapes de build
}
```

## Notifications

### Notification par e-mail

```groovy
emailext (
    subject: "Notification de build: ${env.JOB_NAME} #${env.BUILD_NUMBER}",
    body: "Statut du build: ${currentBuild.result}",
    to: 'team@example.com'
)
```

### Notification Slack

1. Installer le plugin "Slack Notification"
2. Configurer l'espace de travail
3. Ajouter une étape de notification

## Sauvegarde et restauration

### Sauvegarde

```bash
# Sauvegarder JENKINS_HOME
tar -czvf jenkins-backup.tar.gz $JENKINS_HOME
```

### Restauration

```bash
# Arrêter Jenkins
# Extraire la sauvegarde
tar -xzvf jenkins-backup.tar.gz -C $JENKINS_HOME
# Redémarrer Jenkins
```

## Bonnes pratiques

### 1. Utiliser Pipeline

```groovy
// Utiliser Pipeline déclaratif recommandé
pipeline {
    // Définir le processus complet
}
```

### 2. Build paramétré

```groovy
parameters {
    choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: 'Environnement de déploiement')
    string(name: 'VERSION', defaultValue: '', description: 'Numéro de version')
}
```

### 3. Nettoyer l'espace de travail

```groovy
post {
    always {
        cleanWs()
    }
}
```

## Ressources utiles

- [Documentation officielle Jenkins](https://www.jenkins.io/doc/)
- [Syntaxe Pipeline](https://www.jenkins.io/doc/book/pipeline/syntax/)
