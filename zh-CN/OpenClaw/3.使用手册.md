# OpenClaw 使用手册

本手册将详细介绍 OpenClaw 的各项功能和使用方法，帮助你充分利用这个强大的 AI 助手网关。无论你是初次使用还是有一定经验，都能在这里找到有用的信息。

---

## 基础概念

在深入使用之前，理解以下核心概念会很有帮助：

### Gateway（网关）

Gateway 是 OpenClaw 的核心组件，它运行在你的本地机器上，作为所有渠道连接、AI 代理和客户端的控制平面。一个 Gateway 进程可以同时处理多个聊天渠道和多个 AI 代理。

### 渠道（Channels）

渠道是指你用来与 AI 助手交互的聊天平台，包括 WhatsApp、Telegram、Discord、iMessage 等。每个渠道都可以独立配置和管理。

### 代理（Agents）

代理是 AI 助手的实例，每个代理有自己的工作空间、会话和配置。你可以为不同的用途设置多个代理，如个人用、工作用等。

### 会话（Sessions）

会话管理对话上下文，OpenClaw 支持多种会话模式：
- **main**：共享会话
- **per-peer**：每个联系人独立会话
- **per-channel-peer**：每个渠道的每个联系人独立会话
- **per-account-channel-peer**：最细粒度，每个账号的每个渠道独立会话

---

## 日常使用

### 启动和停止 Gateway

**启动 Gateway：**

```bash
# 前台运行（用于调试）
openclaw gateway --port 18789

# 后台运行（需要先安装服务）
openclaw gateway start
```

**停止 Gateway：**

```bash
openclaw gateway stop
```

**检查状态：**

```bash
openclaw gateway status
```

### 使用控制界面

启动 Gateway 后，在浏览器中访问 http://127.0.0.1:18789/ 即可打开控制界面。

控制界面提供以下功能：
- 发送和接收消息
- 查看和管理会话
- 配置渠道和设置
- 查看使用统计

### 使用 CLI 命令

**发送消息：**

```bash
openclaw message send --target +15555550123 --message "你好，OpenClaw"
```

**与 AI 对话：**

```bash
openclaw agent --message "帮我写一个 Hello World 程序" --thinking high
```

---

## 渠道管理

### 配置 WhatsApp

WhatsApp 是最常用的渠道之一。配置步骤：

1. 运行登录命令：
   ```bash
   openclaw channels login
   ```

2. 选择 WhatsApp，按照提示扫描二维码

3. 配置白名单（可选但推荐）：
   ```json5
   {
     channels: {
       whatsapp: {
         allowFrom: ["+15555550123"],
       },
     },
   }
   ```

### 配置 Telegram

1. 创建 Telegram Bot：
   - 打开 @BotFather
   - 使用 /newbot 命令创建新机器人
   - 获取 Bot Token

2. 在配置文件中添加：
   ```json5
   {
     channels: {
       telegram: {
         botToken: "你的BotToken",
       },
     },
   }
   ```

3. 与你的机器人开始对话

### 配置 Discord

1. 创建 Discord 应用：
   - 访问 https://discord.com/developers/applications
   - 创建新应用，添加 Bot 用户

2. 获取 Bot Token 并配置：
   ```json5
   {
     channels: {
       discord: {
         token: "你的Bot令牌",
       },
     },
   }
   ```

3. 邀请 Bot 到你的服务器

---

## 高级功能

### 多代理路由

你可以在一个 Gateway 中运行多个隔离的代理：

```json5
{
  agents: {
    list: [
      { id: "home", default: true, workspace: "~/.openclaw/workspace-home" },
      { id: "work", workspace: "~/.openclaw/workspace-work" },
    ],
  },
  bindings: [
    { agentId: "home", match: { channel: "whatsapp", accountId: "personal" } },
    { agentId: "work", match: { channel: "whatsapp", accountId: "biz" } },
  ],
}
```

### 定时任务（Cron Jobs）

配置自动执行的任务：

```json5
{
  cron: {
    enabled: true,
    maxConcurrentRuns: 2,
    sessionRetention: "24h",
  },
}
```

创建定时任务：

```bash
openclaw cron create --schedule "0 9 * * *" --agent main --message "早上好"
```

### Webhooks

配置 Webhook 以响应外部事件：

```json5
{
  hooks: {
    enabled: true,
    token: "shared-secret",
    path: "/hooks",
    mappings: [
      {
        match: { path: "gmail" },
        action: "agent",
        agentId: "main",
        deliver: true,
      },
    ],
  },
}
```

### 沙盒模式

为安全起见，可以在隔离的 Docker 容器中运行非主要会话：

```json5
{
  agents: {
    defaults: {
      sandbox: {
        mode: "non-main",
        scope: "agent",
      },
    },
  },
}
```

---

## 工作空间配置

### 目录结构

OpenClaw 使用以下目录结构：

```
~/.openclaw/
├── openclaw.json      # 配置文件
├── credentials/       # 渠道凭证
├── workspace/         # AI 工作空间
│   ├── AGENTS.md     # 代理配置
│   ├── SOUL.md       # 身份配置
│   ├── TOOLS.md      # 工具配置
│   ├── USER.md       # 用户配置
│   ├── MEMORY.md     # 长期记忆
│   └── skills/       # 技能目录
└── logs/             # 日志文件
```

### 自定义工作空间

```json5
{
  agents: {
    defaults: {
      workspace: "~/my-workspace",
    },
  },
}
```

---

## 命令行工具

### 常用命令

| 命令 | 说明 |
|------|------|
| `openclaw --version` | 查看版本 |
| `openclaw status` | 查看状态 |
| `openclaw gateway start` | 启动 Gateway |
| `openclaw gateway stop` | 停止 Gateway |
| `openclaw gateway status` | 查看 Gateway 状态 |
| `openclaw dashboard` | 打开控制界面 |
| `openclaw channels login` | 登录渠道 |
| `openclaw channels status` | 查看渠道状态 |
| `openclaw message send` | 发送消息 |
| `openclaw agent` | 与 AI 对话 |
| `openclaw config get` | 获取配置 |
| `openclaw config set` | 设置配置 |
| `openclaw doctor` | 诊断问题 |

### 聊天命令

在支持的渠道中，你可以使用以下命令：

- `/status` - 查看会话状态
- `/new` 或 `/reset` - 重置会话
- `/compact` - 压缩会话上下文
- `/think` - 设置思考级别（off|minimal|low|medium|high|xhigh）
- `/verbose on|off` - 开关详细输出
- `/usage off|tokens|full` - 查看使用统计
- `/restart` - 重启 Gateway（仅群组管理员）

---

## 移动端节点

OpenClaw 支持将 iOS 和 Android 设备配对为节点，实现更多本地功能。

### iOS 节点

1. 在 App Store 下载 OpenClaw 应用
2. 打开应用，按照向导配对到你的 Gateway
3. 授权必要的权限（相机、麦克风、位置等）

配对后可用的功能：
- 相机拍照和录像
- 屏幕录制
- Canvas 交互
- 语音交互（Talk Mode）

### Android 节点

1. 下载 OpenClaw Android 应用
2. 配对到 Gateway
3. 授权必要权限

功能与 iOS 类似。

### macOS 节点模式

macOS 应用可以运行在节点模式，暴露以下功能：
- system.run - 本地执行命令
- system.notify - 发送通知
- canvas.* - Canvas 交互
- camera.* - 相机控制
- screen.record - 屏幕录制

---

## 浏览器控制

OpenClaw 内置浏览器控制功能，可以自动操作浏览器：

```json5
{
  browser: {
    enabled: true,
    color: "#FF4500",
  },
}
```

**常用命令：**

```bash
# 启动浏览器
openclaw browser start --browser-profile openclaw

# 查看可用配置
openclaw browser profiles
```

---

## 语音功能

### Voice Wake

通过语音唤醒 AI，需要 macOS/iOS/Android 设备：

```bash
openclaw voicewake enable
```

### Talk Mode

持续对话模式，AI 可以随时听到并回应：

```bash
openclaw talk start
```

Talk Mode 需要配置 TTS（文字转语音）服务，推荐使用 ElevenLabs。

---

## 监控和诊断

### 查看日志

```bash
# 查看最近日志
openclaw logs

# 实时跟踪日志
openclaw logs --follow
```

### 运行诊断

```bash
openclaw doctor
```

诊断工具会检查：
- 配置正确性
- 服务运行状态
- 渠道连接状态
- 潜在安全问题

### 健康检查

```bash
openclaw health
```

---

## 常见使用场景

### 场景一：个人 AI 助手

配置 WhatsApp 或 Telegram 作为个人助手，随时随地发送消息获取帮助。

### 场景二：开发辅助

在开发时遇到问题，直接通过 CLI 或聊天渠道询问 AI，获得即时帮助。

### 场景三：自动化工作流

设置 Cron 任务自动执行重复性工作，如：
- 每日汇总报告
- 定时检查系统状态
- 定期数据备份

### 场景四：多渠道客服

配置多个渠道，为不同渠道的用户提供统一的 AI 服务。

---

## 性能优化

### 会话管理

- 定期压缩会话：`/compact`
- 设置自动重置：
  ```json5
  {
    session: {
      reset: {
        mode: "daily",
        atHour: 4,
        idleMinutes: 120,
      },
    },
  }
  ```

### 资源使用

- 限制并发会话数
- 启用会话清理
- 使用模型缓存

---

## 备份和恢复

### 备份配置

```bash
cp ~/.openclaw/openclaw.json ~/.openclaw/openclaw.json.backup
```

### 恢复配置

```bash
cp ~/.openclaw/openclaw.json.backup ~/.openclaw/openclaw.json
```

### 完整备份

```bash
tar -czf openclaw-backup.tar.gz ~/.openclaw
```

---

## 下一步

- [常见问题解答](/4.常见问题.md)：解决常见疑问
- [官方文档](https://docs.openclaw.ai)：获取完整配置参考
- [GitHub](https://github.com/openclaw/openclaw)：参与开源项目
- [Discord 社区](https://discord.gg/clawd)：与其他用户交流
