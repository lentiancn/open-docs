# LivePortrait Installation Guide

LivePortrait is an efficient portrait animation framework developed by Kwai VGI. It animates still portraits using motion from driving videos, with support for stitching and retargeting control.

## Version Overview

| Version | Status | Description |
|---------|--------|-------------|
| LivePortrait 1.x | Current | Main release |

## System Requirements

### Hardware Requirements

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| GPU | NVIDIA 8GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 16GB |
| Storage | 30GB | 50GB |
| CUDA | 11.8+ | 12.1+ |

### Software Requirements

| Software | Version | Notes |
|----------|---------|-------|
| Python | 3.8 - 3.11 | Recommend 3.10 |
| CUDA | 11.8+ | GPU acceleration required |
| cuDNN | 8.5+ | Required for CUDA |
| ffmpeg | Latest | Video processing required |

## Linux/Ubuntu Installation

### Step 1: Install System Dependencies

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Python and development tools
sudo apt install python3.10 python3-pip python3-venv git wget curl

# Install system libraries
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# Install ffmpeg
sudo apt install ffmpeg
```

### Step 2: Install CUDA

```bash
# Download and install CUDA 12.1
wget https://developer.download.nvidia.com/compute/cuda/12.1.0/local_installers/cuda_12.1.0_520.53_linux.run
sudo sh cuda_12.1.0_520.53_linux.run
```

### Step 3: Clone Project

```bash
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait
```

### Step 4: Create Virtual Environment

```bash
python3.10 -m venv venv
source venv/bin/activate

# Verify Python version
python --version
```

### Step 5: Install PyTorch

```bash
# CUDA 12.1 version
pip install torch==2.1.0 torchvision==0.16.0 --index-url https://download.pytorch.org/whl/cu121

# Verify installation
python -c "import torch; print(torch.cuda.is_available())"
```

### Step 6: Install Dependencies

```bash
# Install base requirements
pip install -r requirements.txt

# Install additional dependencies
pip install numpy opencv-python librosa soundfile
```

### Step 7: Download Models

```bash
# Create models directory
mkdir -p pretrained_models

# Download from release page or use download script
bash scripts/download_weights.sh
```

## Windows Installation

### Step 1: Install Python

1. Download Python 3.10 from python.org
2. Check "Add Python to PATH" during installation
3. Verify: `python --version`

### Step 2: Install CUDA

1. Download CUDA 12.1 from NVIDIA website
2. Install with default settings
3. Download and install cuDNN 8.9

### Step 3: Clone and Setup

```powershell
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait

python -m venv venv
venv\Scripts\activate
```

### Step 4: Install Dependencies

```powershell
# Install PyTorch (with CUDA support)
pip install torch==2.1.0 torchvision==0.16.0 --index-url https://download.pytorch.org/whl/cu121

pip install -r requirements.txt
```

### Step 5: Download Models

Download models from GitHub releases and place in `pretrained_models/` directory.

## macOS Installation

### Step 1: Install Dependencies

```bash
# Install Homebrew (if not installed)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Install Python and ffmpeg
brew install python@3.10 ffmpeg git
```

### Step 2: Setup

```bash
git clone https://github.com/KwaiVGI/LivePortrait.git
cd LivePortrait

python3.10 -m venv venv
source venv/bin/activate

# Install PyTorch (macOS CPU only)
pip install torch==2.1.0 torchvision==0.16.0

pip install -r requirements.txt
```

Note: macOS only supports CPU mode, cannot use GPU acceleration.

## Docker Installation

### Using Docker

```bash
# Pull image
docker pull liveportrait:latest

# Run (requires GPU)
docker run --gpus all -v $(pwd):/workspace -p 7860:7860 liveportrait:latest
```

### Using Docker Compose

```yaml
version: '3.8'
services:
  liveportrait:
    image: liveportrait:latest
    volumes:
      - ./workspace:/workspace
    ports:
      - "7860:7860"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

## Verify Installation

```bash
# Test basic functionality
python inference.py --help
```

## Common Issues

### CUDA Out of Memory

**Solutions:**
- Reduce batch size: `--batch_size 1`
- Use lower resolution
- Enable model offloading

### Missing Libraries (Windows)

**Solutions:**
- Install Visual C++ Redistributable 2015-2022
- Add CUDA to system PATH

### Model Download Failed

**Solutions:**
- Use VPN or proxy
- Download manually from GitHub releases
- Check network connection

### ffmpeg Not Found

**Solutions:**
- Linux: `sudo apt install ffmpeg`
- Windows: Add ffmpeg to PATH
- macOS: `brew install ffmpeg`

## Related Links

- [GitHub Repository](https://github.com/KwaiVGI/LivePortrait)
- [Paper](https://arxiv.org/abs/2407.03168)
- [Demo](https://liveportrait.github.io)
