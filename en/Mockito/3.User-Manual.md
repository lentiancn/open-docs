# Mockito User Manual

Detailed guide to using Mockito.

## Basics

### Creating Mocks

```java
// Mock an interface
List<String> mockList = mock(List.class);

// Mock a class
MyService myService = mock(MyService.class);
```

### Stubbing

```java
// Simple stubbing
when(mockList.get(0)).thenReturn("first");
when(mockList.size()).thenReturn(10);

// Throw exception
when(mockList.get(0)).thenThrow(new IndexOutOfBoundsException());

// Multiple return values
when(mockList.get(anyInt()))
    .thenReturn("first")
    .thenReturn("second")
    .thenThrow(new RuntimeException());
```

### Verification

```java
// Verify method was called
verify(mockList).add("one");

// Verify number of calls
verify(mockList, times(1)).add("one");
verify(mockList, never()).clear();
verify(mockList, atLeastOnce()).add("one");
verify(mockList, atMost(5)).add("one");

// Verify call order
InOrder inOrder = inOrder(mockList, mockList2);
inOrder.verify(mockList).add("first");
inOrder.verify(mockList2).add("second");
```

## Advanced Concepts

### Argument Matchers

```java
// Any argument
when(mockList.get(anyInt())).thenReturn("element");

// Specific matchers
when(mockList.contains(argThat(new ArgumentMatcher<String>() {
    @Override
    public boolean matches(String s) {
        return s.startsWith("test");
    }
}))).thenReturn(true);

// Alternative with lambda
when(mockList.contains(argThat(s -> s.startsWith("test")))).thenReturn(true);
```

### Spy

```java
List<String> spyList = spy(new ArrayList<>());

// Partial real behavior
doReturn("real").when(spyList).get(0);

// Call methods that use real behavior
spyList.add("element");
```

### Captor

```java
@Captor
private ArgumentCaptor<Person> captor;

@BeforeEach
void init() {
    MockitoAnnotations.openMocks(this);
}

@Test
void test() {
    service.addPerson(new Person("John", 30));
    verify(service).addPerson(captor.capture());
    
    Person captured = captor.getValue();
    assertEquals("John", captured.getName());
}
```

### ArgumentCaptor (Alternative)

```java
ArgumentCaptor<Person> captor = ArgumentCaptor.forClass(Person.class);
verify(service).addPerson(captor.capture());
```

## Annotations

### @Mock

```java
class MyTest {
    @Mock
    private List<String> mockList;
    
    @BeforeEach
    void init() {
        MockitoAnnotations.openMocks(this);
    }
}
```

### @Spy

```java
class MyTest {
    @Spy
    private List<String> spyList = new ArrayList<>();
}
```

### @InjectMocks

```java
class MyTest {
    @Mock
    private Dependency dependency;
    
    @InjectMocks
    private Service service;
}
```

## Best Practices

1. **Mock interfaces** - Always mock interfaces, not concrete classes
2. **No real objects** - Don't convert real objects to mocks
3. **Naming** - Use meaningful names for mocks
4. **Verification** - Use verification only when needed
5. **Reset** - Avoid `reset()` - it indicates poor test design

## Common Scenarios

### Database Mocking

```java
@Mock
private UserRepository userRepository;

@Test
void testUserCreation() {
    User user = new User("test@test.com");
    when(userRepository.save(any(User.class))).thenReturn(user);
    
    User result = userService.createUser("test@test.com");
    
    assertNotNull(result);
    verify(userRepository).save(any(User.class));
}
```

### Exception Testing

```java
@Test
void testException() {
    when(service.getUser(1)).thenThrow(new UserNotFoundException("Not found"));
    
    assertThrows(UserNotFoundException.class, () -> {
        service.getUser(1);
    });
}
```

### Void Methods

```java
@Test
void testVoidMethod() {
    doNothing().when(mockList).clear();
    doThrow(new RuntimeException()).when(mockList).add(any());
}
```

## Resources

- Official Website: https://site.mockito.org
- GitHub: https://github.com/mockito/mockito
- Javadoc: https://javadoc.io/doc/org.mockito/mockito-core

## License

MIT License
