# SadTalker インストールガイド

SadTalkerは、単一の画像と音声入力からリアルなアバター動画を生成するAIプロジェクトです。

## システム要件

### ハードウェア要件

| コンポーネント | 最小要件 | 推奨要件 |
|----------------|----------|----------|
| GPU | NVIDIA 6GB VRAM | NVIDIA 16GB VRAM |
| RAM | 8GB | 32GB |
| ストレージ | 20GB以上 | 50GB以上 |
| OS | Ubuntu 18.04+、Windows 10+、macOS 11+ | Ubuntu 20.04+ |

### ソフトウェア要件

| ソフトウェア | バージョン | 備考 |
|--------------|------------|------|
| Python | 3.8 - 3.10 | 3.9推奨 |
| CUDA | 11.7+ | GPU加速用 |
| cuDNN | 8.5+ | CUDAに必須 |
| ffmpeg | 最新版 | 動画処理用 |

## Linux/Ubuntuへのインストール

### ステップ1：システム依存関係のインストール

```bash
# システムアップデート
sudo apt update && sudo apt upgrade -y

# Pythonと開発ツールのインストール
sudo apt install python3.9 python3-pip python3-venv git wget curl

# システムライブラリのインストール
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# ffmpegのインストール
sudo apt install ffmpeg

# NVIDIA driversのインストール（未インストールの場合）
sudo apt install nvidia-driver-525
```

### ステップ2：CUDAのインストール（必要な場合）

```bash
# CUDA 11.8のダウンロードとインストール
wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run
sudo sh cuda_11.8.0_520.61.05_linux.run
```

### ステップ3：リポジトリのクローン

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker
```

### ステップ4：仮想環境の作成

```bash
python3.9 -m venv venv
source venv/bin/activate

# Pythonバージョンの確認
python --version
```

### ステップ5：PyTorchのインストール

```bash
# CUDA 11.8の場合
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# インストール確認
python -c "import torch; print(torch.cuda.is_available())"
```

### ステップ6：依存関係のインストール

```bash
pip install -r requirements.txt

# 追加の依存関係
pip install numpy opencv-python librosa soundfile
```

### ステップ7：モデルのダウンロード

```bash
# モデルディレクトリの作成
mkdir -p checkpoints

# モデルのダウンロード（自動）
bash scripts/download_models.sh

# またはリリースページから手動でダウンロード
# モデルをcheckpoints/ディレクトリに配置
```

## Windowsへのインストール

### ステップ1：Pythonのインストール

1. python.orgからPython 3.9をダウンロード
2. インストール時に「Add Python to PATH」にチェック
3. 確認：`python --version`

### ステップ2：CUDAのインストール

1. NVIDIA WebサイトからCUDA 11.8をダウンロード
2. デフォルト設定でインストール
3. cuDNN 8.9をダウンロードしてインストール

### ステップ3：クローンとセットアップ

```powershell
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python -m venv venv
venv\Scripts\activate
```

### ステップ4：依存関係のインストール

```powershell
# CUDAサポート付きでPyTorchをインストール
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### ステップ5：モデルのダウンロード

GitHubリリースページからモデルをダウンロードし、`checkpoints/`フォルダーに配置してください。

## macOSへのインストール

### ステップ1：依存関係のインストール

```bash
# Homebrewのインストール（未インストールの場合）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Pythonとffmpegのインストール
brew install python@3.9 ffmpeg git
```

### ステップ2：セットアップ

```bash
git clone https://github.com/OpenTalker/SadTalker.git
cd SadTalker

python3.9 -m venv venv
source venv/bin/activate

# PyTorchのインストール（macOSはCPUのみ）
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

注意：macOSはCPUモードで実行されます。GPU加速は利用できません。

## Dockerでのインストール

### Dockerを使用

```bash
# イメージのプル
docker pull ghcr.io/opentalker/sadtalker:latest

# GPUサポートで実行
docker run --gpus all -v $(pwd):/workspace -p 8888:8888 ghcr.io/opentalker/sadtalker:latest
```

### Docker Composeを使用

```yaml
version: '3.8'
services:
  sadtalker:
    image: ghcr.io/opentalker/sadtalker:latest
    volumes:
      - ./workspace:/workspace
    ports:
      - "8888:8888"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
```

## インストール確認

```bash
# 基本機能のテスト
python inference.py --help

# 利用可能なオプションがすべて表示されます
```

## よくある問題

### CUDA メモリ不足

**解決策：**
- バッチサイズを削減：`--batch_size 1`
- より低い解像度を使用：`--size 256`
- モデルオフロードを有効化
- 他のGPUアプリケーションを閉じる

### ライブラリの欠落（Windows）

**解決策：**
- Visual C++ Redistributable 2015-2022をインストール
- CUDAをシステムPATHに追加

### モデルのダウンロード失敗

**解決策：**
- VPNまたはプロキシを使用
- GitHubリリースから手動でダウンロード
- ネットワーク接続を確認

### ffmpegが見つからない

**解決策：**
- Linux：`sudo apt install ffmpeg`
- Windows：ffmpegをPATHに追加
- macOS：`brew install ffmpeg`

## 関連リンク

- [GitHubリポジトリ](https://github.com/OpenTalker/SadTalker)
- [HuggingFace デモ](https://huggingface.co/spaces/fffilo/SadTalker)
- [論文](https://arxiv.org/abs/2303.17550)
- [モデルダウンロード](https://github.com/OpenTalker/SadTalker/releases)
