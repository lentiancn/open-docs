# GitLab 安装指南

> GitLab 安装和配置的完整指南

---

## 系统要求

| 资源 | 最低配置 | 推荐配置 |
|------|----------|----------|
| CPU | 2 核 | 4 核及以上 |
| 内存 | 4 GB | 8 GB 及以上 |
| 存储 | 10 GB | 50 GB 及以上 |
| 操作系统 | Ubuntu、Debian、CentOS、RHEL、Kubernetes | - |

---

## 安装方式

### Omnibus 安装包（Linux 推荐方式）

#### Ubuntu/Debian

```bash
# 安装依赖
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificates tzdata perl

# 添加 GitLab 仓库
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash

# 安装 GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" apt-get install gitlab-ee
```

#### CentOS/RHEL

```bash
# 安装依赖
sudo yum install -y curl policycoreutils openssh-server

# 添加 GitLab 仓库
curl -fsSL https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

# 安装 GitLab
sudo EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-ee
```

### Docker 安装

```bash
# 拉取 GitLab Docker 镜像
docker run --detach \
  --hostname gitlab.example.com \
  --publish 443:443 --publish 80:80 --publish 22:22 \
  --name gitlab \
  --restart always \
  --volume /srv/gitlab/config:/etc/gitlab \
  --volume /srv/gitlab/logs:/var/log/gitlab \
  --volume /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ee:latest
```

### Kubernetes 安装

```bash
# 使用 Helm chart 安装
helm repo add gitlab https://charts.gitlab.io
helm install gitlab gitlab/gitlab \
  --set externalUrl="https://gitlab.example.com" \
  --set certmanager-issuer.email="admin@example.com"
```

---

## 初始配置

### 配置外部 URL

```bash
# 编辑 GitLab 配置文件
sudo vim /etc/gitlab/gitlab.rb

# 设置外部 URL
external_url 'https://gitlab.example.com'

# 重新配置 GitLab
sudo gitlab-ctl reconfigure
```

### 配置 SMTP（邮件）

```bash
# 在 /etc/gitlab/gitlab.rb 中配置 SMTP
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.example.com"
gitlab_rails['smtp_port'] = 587
gitlab_rails['smtp_user_name'] = "smtp_user"
gitlab_rails['smtp_password'] = "smtp_password"
gitlab_rails['smtp_domain'] = "example.com"

# 应用更改
sudo gitlab-ctl reconfigure
```

### 使用 Let's Encrypt 启用 HTTPS

```bash
# 在 /etc/gitlab/gitlab.rb 中配置
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com']

# 重新配置
sudo gitlab-ctl reconfigure
```

---

## 首次登录

1. 通过外部 URL 访问 GitLab
2. 使用用户名 `root` 登录
3. 首次登录时设置密码
4. 创建你的第一个项目

---

## 常用命令

```bash
# 查看状态
sudo gitlab-ctl status

# 启动服务
sudo gitlab-ctl start

# 停止服务
sudo gitlab-ctl stop

# 重启服务
sudo gitlab-ctl restart

# 查看日志
sudo gitlab-ctl tail

# 检查配置
sudo gitlab-rake gitlab:env:info
```

---

## 故障排除

### 安装失败怎么办？

- 检查系统要求
- 确保所有依赖都已安装
- 检查防火墙和 SELinux 设置
- 查看安装日志

### GitLab 无法启动怎么办？

```bash
# 检查端口冲突
sudo netstat -tulpn | grep -E ':(80|443|22)\s'

# 检查磁盘空间
df -h

# 查看日志
sudo gitlab-ctl tail
```

### 性能缓慢怎么办？

- 增加服务器资源
- 启用 Prometheus 监控指标
- 配置适当的交换空间
- 使用 PostgreSQL 调优

---

## 相关资源

- 官方安装文档：https://docs.gitlab.com/ee/install/
- 硬件要求：https://docs.gitlab.com/ee/install/requirements.html
- 社区论坛：https://forum.gitlab.com/
