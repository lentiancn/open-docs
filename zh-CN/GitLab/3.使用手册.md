# GitLab 使用手册

> 全面掌握 GitLab 的使用方法

---

## 快速开始

### 创建第一个项目

1. 登录 GitLab 后，点击「新建项目」按钮
2. 选择项目模板或空白项目
3. 填写项目名称、描述和可见性级别
4. 点击「创建项目」完成初始化

### 克隆项目到本地

```bash
# 克隆 HTTPS
git clone https://gitlab.example.com/username/project.git

# 克隆 SSH
git clone git@gitlab.example.com:username/project.git
```

---

## 代码管理

### 分支操作

```bash
# 创建新分支
git checkout -b feature/new-feature

# 推送分支到远程
git push -u origin feature/new-feature

# 查看所有分支
git branch -a

# 删除本地分支
git branch -d feature/new-feature

# 删除远程分支
git push origin --delete feature/new-feature
```

### 合并请求（Merge Request）

1. 在本地分支完成开发后，推送到远程仓库
2. 打开项目页面，点击「创建合并请求」
3. 填写标题、描述，选择源分支和目标分支
4. 指定审阅者，设置相关标签和里程碑
5. 创建合并请求，等待代码审查

### 代码审查

- **行内评论**：审阅者可以直接在代码行上添加评论
- **审批规则**：可以设置合并所需的审批人数
- **流水线检查**：可以要求流水线通过后才能合并
- **冲突解决**：在合并前需要解决可能的冲突

---

## 问题跟踪

### 创建问题

1. 进入项目 → 问题 → 新建问题
2. 填写标题和描述（支持 Markdown）
3. 设置标签、里程碑、分配者
4. 设置权重和截止日期

### 使用看板

1. 进入项目 → 问题 → 看板
2. 创建列（如：待处理、进行中、已完成）
3. 拖拽问题卡片到对应列
4. 可以按成员或标签筛选

### 里程碑

- 创建里程碑并设置开始和结束日期
- 将相关问题关联到里程碑
- 跟踪里程碑进度

---

## CI/CD 流水线

### .gitlab-ci.yml 基本结构

```yaml
stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - echo "Building..."
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist/
    expire_in: 1 week

test:
  stage: test
  script:
    - echo "Testing..."
    - npm test
  coverage: '/Coverage: \d+\.\d+%/'

deploy:
  stage: deploy
  script:
    - echo "Deploying..."
  only:
    - main
  environment:
    name: production
```

### 常用Runner配置

#### Docker Executor

```yaml
job:
  image: node:18
  services:
    - postgres:14
  variables:
    POSTGRES_DB: test_db
    POSTGRES_USER: test_user
    POSTGRES_PASSWORD: test_password
```

#### 缓存配置

```yaml
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
    - .npm/
```

### 部署环境

- **生产环境**：正式发布使用
- **预发环境**：上线前测试
- **开发环境**：日常开发使用

---

## Wiki 文档

### 创建 Wiki 页面

1. 进入项目 → Wiki → 新建页面
2. 使用 Markdown 编写内容
3. 保存页面

### 侧边栏

- 自动生成目录导航
- 可以自定义侧边栏内容

---

## 容器镜像仓库

### 推送镜像

```bash
# 登录 GitLab Registry
docker login registry.gitlab.example.com

# 标记镜像
docker tag my-image:latest registry.gitlab.example.com/username/project/my-image:latest

# 推送镜像
docker push registry.gitlab.example.com/username/project/my-image:latest
```

### 拉取镜像

```bash
docker pull registry.gitlab.example.com/username/project/my-image:latest
```

---

## 安全扫描

### 自动扫描功能

- **依赖扫描**：检查项目依赖中的安全漏洞
- **容器扫描**：检查 Docker 镜像中的安全问题
- **SAST**：静态应用安全测试
- **DAST**：动态应用安全测试

### 查看安全仪表板

1. 进入项目 → 安全与合规 → 安全仪表板
2. 查看所有漏洞列表
3. 按严重程度筛选
4. 创建漏洞跟踪问题

---

## 项目管理技巧

### 使用模板

- 为新项目设置默认分支保护规则
- 配置项目模板
- 使用项目继承

### 成员管理

- 添加项目成员并设置访问级别
- 使用组管理多个项目
- 配置访问令牌

### Webhooks

- 配置 Webhook 集成外部服务
- 支持触发器：push、merge request、tag 等

---

## 最佳实践

1. **使用功能分支开发**：每个功能或修复使用独立分支
2. **及时提交**：频繁提交，保持提交信息清晰
3. **代码审查**：所有代码必须经过审查才能合并
4. **自动化测试**：确保 CI/CD 流水线包含测试步骤
5. **文档完善**：使用 Wiki 记录项目文档
6. **安全问题**：定期检查安全扫描报告
