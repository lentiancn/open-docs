# Docker 常见问题

常见问题解答。

## 安装问题

### Q: Docker Desktop 在 Windows 上启动失败？

**解决方案**：
1. 在 BIOS 中启用虚拟化
2. 安装/更新 WSL 2
3. 重启电脑
4. 检查是否有冲突软件（VirtualBox、VMware）

### Q: 出现 "docker: permission denied" 错误？

**解决方案**：
```
sudo usermod -aG docker $USER
# 注销并重新登录
```

### Q: 如何查看 Docker 版本？

```
docker --version
docker-compose --version
```

## 镜像问题

### Q: 如何减小 Docker 镜像大小？

**最佳实践**：
1. 使用 alpine 基础镜像
2. 使用多阶段构建
3. 最小化层数
4. 在同一层清理

### Q: 如何不使用缓存构建镜像？

```
docker build --no-cache -t my-image .
```

### Q: 如何删除所有未使用的镜像？

```
docker image prune -a
```

## 容器问题

### Q: 如何保持容器运行？

```
docker run -d nginx tail -f /dev/null
# 或
docker run -d nginx sleep infinity
```

### Q: 容器启动后立即退出？

**原因**：
1. 没有前台进程
2. 进程已结束

**解决方案**：
```
docker run -it image_name /bin/bash
docker run -d image_name tail -f /dev/null
```

### Q: 如何进入运行中的容器？

```
docker exec -it container_id /bin/bash
```

### Q: 如何复制文件到/从容器？

```
# 从容器复制到主机
docker cp container_id:/path/file.txt ./

# 从主机复制到容器
docker cp ./file.txt container_id:/path/
```

## 网络问题

### Q: 如何从主机访问容器？

使用端口映射：
```
docker run -p 8080:80 nginx
```

### Q: 如何连接容器？

创建网络：
```
docker network create my-network
docker run --network my-network -d nginx
```

## Volume 问题

### Q: 如何持久化数据？

使用 volume：
```
docker volume create my-data
docker run -v my-data:/data nginx
```

## Docker Compose

### Q: 代码修改后如何重新构建？

```
docker-compose up -d --build
```

### Q: 如何查看日志？

```
docker-compose logs -f
```

### Q: 如何扩展服务？

```
docker-compose up -d --scale web=3
```

## 性能问题

### Q: Docker 很慢 / 占用太多磁盘？

**解决方案**：
```
docker system prune -a
docker system df
docker volume prune
```

### Q: 如何限制容器资源？

```
docker run -m 512m nginx
docker run --cpus=0.5 nginx
```

## 故障排除

### Q: 如何调试失败的容器？

```
docker logs container_id
docker inspect container_id
```

### Q: 容器网络不工作？

```
sudo systemctl restart docker
docker network ls
```

## 安全问题

### Q: 如何扫描漏洞？

```
docker scan my-image
```

### Q: 应该以 root 运行吗？

不应该，创建非 root 用户：

```
FROM node:18-alpine
RUN addgroup -g 1000 appgroup && \
    adduser -u 1000 -G appgroup -D appuser
USER appuser
```

## Docker vs 虚拟机

### Q: Docker 和虚拟机的区别？

| 方面 | Docker | 虚拟机 |
|------|--------|--------|
| 操作系统 | 共享主机内核 | 独立操作系统 |
| 大小 | MB 级别 | GB 级别 |
| 启动 | 秒级 | 分钟级 |
| 隔离 | 容器级别 | 完全隔离 |

## 学习资源

- 官方文档：https://docs.docker.com
- 交互式实验室：https://labs.play-with-docker.com
- Docker 社区：https://www.docker.com/community
