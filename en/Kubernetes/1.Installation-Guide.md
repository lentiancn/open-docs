# Kubernetes Installation Guide

This guide provides detailed instructions for installing Kubernetes on all major platforms.

---

## Table of Contents

- [Installation Methods](#installation-methods)
- [Learning Environment (Local)](#learning-environment-local)
  - [minikube](#minikube)
  - [kind](#kind)
  - [Docker Desktop](#docker-desktop)
- [Production Environment](#production-environment)
  - [kubeadm](#kubeadm)
  - [Kubernetes on Cloud](#kubernetes-on-cloud)
- [Install kubectl](#install-kubectl)
- [Verify Installation](#verify-installation)
- [Uninstall Kubernetes](#uninstall-kubernetes)

---

## Installation Methods

| Method | Description | Best For |
|--------|-------------|----------|
| **minikube** | Single-node cluster locally | Learning, development |
| **kind** | Kubernetes in Docker | Testing, CI/CD |
| **kubeadm** | Production-grade setup | Production clusters |
| **Cloud Providers** | Managed Kubernetes | Cloud deployments |

---

## Learning Environment (Local)

### minikube (Recommended for Beginners)

minikube runs a single-node Kubernetes cluster on your local machine.

#### Install minikube

**macOS:**
```bash
# Using Homebrew
brew install minikube

# Or download binary
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
sudo install minikube-darwin-amd64 /usr/local/bin/minikube
```

**Linux:**
```bash
# Download binary
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube
```

**Windows:**
```powershell
# Using Chocolatey
choco install minikube

# Or download installer
# Download from: https://github.com/kubernetes/minikube/releases
```

#### Start Cluster

```bash
# Start Kubernetes cluster
minikube start

# Start with specific resources
minikube start --cpus 4 --memory 8192

# Start with specific Kubernetes version
minikube start --kubernetes-version v1.28.0

# Use Docker as driver (default on most systems)
minikube start --driver=docker

# Use VirtualBox
minikube start --driver=virtualbox
```

#### Common Commands

```bash
# Check status
minikube status

# Stop cluster
minikube stop

# Delete cluster
minikube delete

# Access dashboard
minikube dashboard

# Get IP address
minikube ip

# SSH into node
minikube ssh
```

---

### kind

kind (Kubernetes IN Docker) runs Kubernetes clusters using Docker containers as nodes.

#### Install kind

**macOS:**
```bash
# Using Homebrew
brew install kind

# Or download binary
curl -Lo kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-darwin-amd64
```

**Linux:**
```bash
# Download binary
curl -Lo kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod +x kind
mv kind /usr/local/bin/
```

**Windows:**
```powershell
# Using Chocolatey
choco install kind

# Or download
curl -Lo kind.exe https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64
```

#### Create Cluster

```bash
# Create default cluster
kind create cluster

# Create cluster with custom config
kind create cluster --name my-cluster

# Delete cluster
kind delete cluster
```

#### kind-config.yaml Example

```yaml
# kind-config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      - containerPort: 443
        hostPort: 443
        protocol: TCP
```

```bash
# Create cluster with config
kind create cluster --config kind-config.yaml
```

---

### Docker Desktop

Docker Desktop includes a standalone Kubernetes server.

#### Enable Kubernetes

1. Install [Docker Desktop](https://www.docker.com/products/docker-desktop/)
2. Open Docker Desktop Settings
3. Go to Kubernetes
4. Check "Enable Kubernetes"
5. Click "Apply & Restart"

#### Verify Kubernetes

```bash
# Check cluster info
kubectl cluster-info

# Check nodes
kubectl get nodes
```

---

## Production Environment

### kubeadm

kubeadm is the official tool for creating production-grade Kubernetes clusters.

#### Prerequisites

- 2+ CPUs / cores
- 2GB+ RAM per machine
- Network connectivity between nodes
- Ubuntu, Debian, CentOS, RHEL, or Fedora

#### Install kubeadm

**All Linux Distributions:**

```bash
# Update package index
sudo apt-get update

# Install prerequisites
sudo apt-get install -y apt-transport-https ca-certificates curl

# Add Kubernetes GPG key
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

# Add Kubernetes repository
echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list

# Update and install
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```

#### Initialize Master Node

```bash
# Initialize control plane (on master node)
sudo kubeadm init

# Initialize with pod network CIDR
sudo kubeadm init --pod-network-cidr=10.244.0.0/16

# Save join command
kubeadm token create --print-join-command
```

#### Install Network Plugin (CNI)

```bash
# Install Calico
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

# Or install Flannel
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
```

#### Join Worker Nodes

```bash
# Run on each worker node (using the join command from init)
sudo kubeadm join <master-ip>:6443 --token <token> \
    --discovery-token-ca-cert-hash sha256:<hash>
```

#### Verify Installation

```bash
# Check nodes
kubectl get nodes

# Check pods
kubectl get pods --all-namespaces
```

---

## Kubernetes on Cloud

### Amazon EKS

```bash
# Install eksctl
brew install eksctl

# Create cluster
eksctl create cluster \
  --name my-cluster \
  --region us-west-2 \
  --nodegroup-name my-nodes \
  --nodes 3
```

### Google GKE

```bash
# Set project
gcloud config set project my-project

# Create cluster
gcloud container clusters create my-cluster \
  --num-nodes=3 \
  --zone us-central1-a
```

### Azure AKS

```bash
# Create resource group
az group create --name my-resource-group --location eastus

# Create cluster
az aks create \
  --resource-group my-resource-group \
  --name my-cluster \
  --node-count 3 \
  --enable-addons monitoring
```

### Alibaba Cloud ACK

```bash
# Install csctl
curl -fsSL https://aliyuncs.com/csctl/install.sh | bash

# Create cluster
csctl create cluster --name my-cluster
```

---

## Install kubectl

kubectl is the command-line tool for interacting with Kubernetes.

### Install kubectl

**macOS:**
```bash
# Using Homebrew
brew install kubectl

# Or download
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/darwin/amd64/kubectl"
```

**Linux:**
```bash
# Download
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"

# Make executable
chmod +x kubectl

# Move to PATH
sudo mv kubectl /usr/local/bin/
```

**Windows:**
```powershell
# Using Chocolatey
choco install kubernetes-cli

# Or download
curl -LO https://dl.k8s.io/release/v1.28.0/bin/windows/amd64/kubectl.exe
```

### Configure kubectl

```bash
# For minikube
minikube kubectl -- get pods

# Or copy config
mkdir -p ~/.kube
sudo cp /etc/kubernetes/admin.conf ~/.kube/config
sudo chown $(id -u):$(id -g) ~/.kube/config
```

---

## Verify Installation

```bash
# Check kubectl version
kubectl version --client

# Check cluster info
kubectl cluster-info

# List nodes
kubectl get nodes

# List pods (all namespaces)
kubectl get pods --all-namespaces
```

---

## Uninstall Kubernetes

### minikube

```bash
minikube delete
```

### kind

```bash
kind delete cluster
```

### kubeadm

```bash
# Reset nodes
sudo kubeadm reset

# Remove packages
sudo apt-get purge kubeadm kubectl kubelet
sudo apt-get autoremove
```

### Docker Desktop

1. Open Docker Desktop Settings
2. Go to Kubernetes
3. Uncheck "Enable Kubernetes"
4. Click "Apply & Restart"

---

## System Requirements

### For minikube

| Resource | Minimum | Recommended |
|----------|---------|-------------|
| CPU | 2 cores | 4+ cores |
| RAM | 2GB | 4GB+ |
| Disk | 20GB | 50GB+ |

### For Production (per node)

| Resource | Minimum | Recommended |
|----------|---------|-------------|
| CPU | 2 cores | 4+ cores |
| RAM | 4GB | 8GB+ |
| Disk | 20GB | 100GB+ SSD |

---

## Next Steps

- [Usage Guide](./2.使用指南.md)
- [Kubernetes Official Documentation](https://kubernetes.io/docs/)
- [kubectl Reference](https://kubernetes.io/docs/reference/kubectl/)
