# Docker 安装指南

本指南详细介绍 Docker 在所有主要操作系统上的安装方法。

---

## 目录

1. [简介](#简介)
2. [系统要求](#系统要求)
3. [在 Windows 上安装](#在-windows-上安装)
4. [在 macOS 上安装](#在-macos-上安装)
5. [在 Linux 上安装](#在-linux-上安装)
6. [使用包管理器安装](#使用包管理器安装)
7. [安装后配置](#安装后配置)
8. [验证安装](#验证安装)
9. [Docker Compose 安装](#docker-compose-安装)
10. [常见问题](#常见问题)

---

## 简介

### 什么是 Docker？

Docker 是一个开源的容器化平台，用于开发、部署和运行应用程序。Docker 使用容器来打包应用程序及其所有依赖项，确保应用程序在任何环境中都能一致地运行。

### Docker 核心概念

- **镜像（Image）**：只读模板，用于创建容器
- **容器（Container）**：镜像的运行实例
- **仓库（Repository）**：存储镜像的地方
- **Dockerfile**：定义镜像构建脚本

### Docker 版本

| 版本 | 发布日期 | 状态 |
|------|----------|------|
| Docker 25.x | 2024年 | 当前稳定版 |
| Docker 24.x | 2023年 | 支持 |
| Docker 20.x | 2022年 | 支持 |

---

## 系统要求

### Windows

**最低要求：**
- Windows 10 64位 专业版、企业版或教育版（版本 1903 或更高）
- 4GB RAM
- 启用 Hyper-V 和 Containers Windows 功能

**推荐：**
- Windows 11 64位
- 8GB RAM 或更多
- SSD 存储

**不支持：**
- Windows 10 家庭版（需要使用 WSL2 方式安装）
- 32位系统

### macOS

**最低要求：**
- macOS 10.15 (Catalina) 或更高版本
- 4GB RAM

**推荐：**
- macOS 12 或更高版本
- 8GB RAM 或更多

### Linux

**支持的发行版：**
- Ubuntu 20.04 LTS 或更高版本
- Debian 11 或更高版本
- Fedora 35 或更高版本
- CentOS 7 或更高版本
- RHEL 7 或更高版本

**内核要求：**
- Linux 内核 3.10 或更高版本
- 64位系统

---

## 在 Windows 上安装

### 方法一：使用 Docker Desktop（推荐）

#### 1. 下载 Docker Desktop

访问 Docker 官网下载页面：https://www.docker.com/products/docker-desktop/

#### 2. 运行安装程序

1. 双击 `Docker Desktop Installer.exe`
2. 点击 "Ok" 同意安装
3. 等待安装完成
4. 点击 "Close" 完成安装

#### 3. 启动 Docker Desktop

1. 启动 Docker Desktop
2. 等待 Docker 引擎启动（可能需要几分钟）
3. 打开终端验证安装

#### 4. 验证安装

```powershell
docker --version
docker-compose --version
docker run hello-world
```

### 方法二：使用 WSL2（适用于 Windows 10 家庭版）

#### 1. 启用 WSL2

以管理员身份打开 PowerShell，运行：

```powershell
# 启用 WSL
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# 启用虚拟机平台
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# 设置 WSL2 为默认版本
wsl --set-default-version 2
```

#### 2. 安装 Linux 发行版

打开 Microsoft Store，安装 "Ubuntu 20.04" 或其他支持的发行版。

#### 3. 在 WSL2 中安装 Docker

```bash
# 更新包索引
sudo apt-get update

# 安装依赖
sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release

# 添加 Docker GPG 密钥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# 添加 Docker 仓库
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 安装 Docker
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 启动 Docker 服务
sudo service docker start

# 将当前用户添加到 docker 组
sudo usermod -aG docker $USER
```

---

## 在 macOS 上安装

### 方法一：使用 Docker Desktop（推荐）

#### 1. 下载 Docker Desktop

访问：https://www.docker.com/products/docker-desktop/

下载 Apple Silicon（M1/M2）或 Intel 版本的 DMG 文件。

#### 2. 安装 Docker Desktop

1. 双击 DMG 文件
2. 将 Docker.app 拖到 Applications 文件夹
3. 启动 Docker Desktop
4. 等待服务启动完成

#### 3. 验证安装

```bash
docker --version
docker-compose --version
docker run hello-world
```

### 方法二：使用 Homebrew

```bash
# 安装 Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Docker
brew install --cask docker

# 启动 Docker（通过应用程序文件夹或命令行）
open -a Docker
```

---

## 在 Linux 上安装

### Ubuntu/Debian

#### 1. 更新包索引

```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
```

#### 2. 添加 Docker GPG 密钥

```bash
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

#### 3. 添加 Docker 仓库

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

#### 4. 安装 Docker

```bash
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

#### 5. 启动 Docker

```bash
sudo systemctl enable docker
sudo systemctl start docker
```

#### 6. 验证安装

```bash
sudo docker run hello-world
```

### Fedora

#### 1. 添加 Docker 仓库

```bash
sudo dnf -y install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
```

#### 2. 安装 Docker

```bash
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

#### 3. 启动 Docker

```bash
sudo systemctl enable docker
sudo systemctl start docker
```

### CentOS/RHEL

#### 1. 安装依赖

```bash
sudo yum install -y yum-utils
```

#### 2. 添加 Docker 仓库

```bash
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
```

#### 3. 安装 Docker

```bash
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

#### 4. 启动 Docker

```bash
sudo systemctl enable docker
sudo systemctl start docker
```

### Arch Linux

```bash
sudo pacman -S docker docker-compose
sudo systemctl enable docker
sudo systemctl start docker
```

---

## 使用包管理器安装

### snap（适用于 Ubuntu）

```bash
sudo snap install docker
```

### yum/dnf（适用于 RHEL/CentOS/Fedora）

```bash
# 添加仓库
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# 安装
sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin
```

### apt（适用于 Debian/Ubuntu）

```bash
# 安装依赖
sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release

# 添加密钥和仓库
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 安装
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

---

## 安装后配置

### 1. 配置 Docker 开机自启

```bash
sudo systemctl enable docker
sudo systemctl enable containerd
```

### 2. 配置 Docker 镜像加速

中国用户可以配置国内镜像加速：

```bash
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<EOF
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 3. 配置非 root 用户使用 Docker

```bash
sudo usermod -aG docker $USER
# 重新登录后生效
```

### 4. Windows WSL2 配置（可选）

在 `~/.bashrc` 或 `~/.zshrc` 中添加：

```bash
export DOCKER_HOST=$(grep -oP '(?<=host=).*' /etc/resolv.conf 2>/dev/null | head -1)
```

---

## 验证安装

### 1. 检查 Docker 版本

```bash
docker --version
# 输出示例：Docker version 25.0.0, build a1b2c3d

docker-compose --version
# 输出示例：Docker Compose version v2.24.0
```

### 2. 运行测试容器

```bash
docker run hello-world
```

成功输出应包含：
```
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

### 3. 检查 Docker 状态

```bash
docker info
```

### 4. 测试镜像拉取

```bash
docker pull ubuntu:latest
docker run ubuntu:latest echo "Hello from Ubuntu"
```

---

## Docker Compose 安装

Docker Desktop 已包含 Docker Compose。对于 Linux 系统：

### 方法一：作为 Docker 插件安装

安装 `docker-compose-plugin` 包即可：

```bash
sudo apt-get install docker-compose-plugin
# 或
sudo dnf install docker-compose-plugin
```

### 方法二：独立安装

```bash
# 下载最新版本
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 添加执行权限
sudo chmod +x /usr/local/bin/docker-compose

# 验证
docker-compose --version
```

---

## 常见问题

### 1. Docker 启动失败（Windows）

**问题：** Docker Desktop 无法启动

**解决方案：**
- 确保 Hyper-V 已启用
- 确保 BIOS 中已启用虚拟化
- 重启计算机后重试
- 检查是否有其他虚拟化软件冲突

### 2. 权限被拒绝

**问题：** permission denied while trying to connect to the Docker daemon socket

**解决方案：**
```bash
# 将当前用户添加到 docker 组
sudo usermod -aG docker $USER
# 重新登录
```

### 3. 镜像拉取慢

**解决方案：**
- 配置国内镜像加速器（见上文）
- 使用代理
- 检查网络连接

### 4. 端口冲突

**问题：** bind: address already in use

**解决方案：**
```bash
# 查看占用端口的容器
docker ps -a

# 停止相关容器
docker stop <container_id>

# 或修改端口映射
docker run -p 8080:80 <image>
```

### 5. 磁盘空间不足

**解决方案：**
```bash
# 清理停止的容器
docker container prune

# 清理未使用的镜像
docker image prune -a

# 清理构建缓存
docker builder prune

# 清理所有未使用的数据
docker system prune -a
```

### 6. 容器内无法访问网络

**解决方案：**
```bash
# 重启 Docker 服务
sudo systemctl restart docker

# 检查 iptables 规则
sudo iptables -L -n
```

---

## 后续步骤

- 学习 Docker 基本命令
- 编写第一个 Dockerfile
- 使用 Docker Compose 编排多容器应用
- 了解 Docker 网络和存储

---

## 相关资源

- Docker 官网：https://www.docker.com/
- Docker 文档：https://docs.docker.com/
- Docker Hub：https://hub.docker.com/
- Docker Compose：https://docs.docker.com/compose/

---

*最后更新：2024*
