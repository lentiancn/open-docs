# frp 安装指南

本指南详细介绍如何在服务器和客户端安装配置 frp。

## 下载 frp

frp 支持多种操作系统和架构，首先需要从 GitHub 下载对应版本。

### 官方下载地址

访问 GitHub Releases 页面：https://github.com/fatedier/frp/releases

### 选择正确的版本

根据你的操作系统和 CPU 架构选择：

| 操作系统 | CPU 架构 | 文件名示例 |
|---------|---------|-----------|
| Linux | x86_64 | frp_0.52.0_linux_amd64.tar.gz |
| Linux | ARM64 | frp_0.52.0_linux_arm64.tar.gz |
| Linux | ARM | frp_0.52.0_linux_arm.tar.gz |
| Windows | x86_64 | frp_0.52.0_windows_amd64.zip |
| macOS | x86_64 | frp_0.52.0_darwin_amd64.tar.gz |
| macOS | ARM64 | frp_0.52.0_darwin_arm64.tar.gz |

### 下载命令示例

```bash
# 以 Linux x86_64 为例
wget https://github.com/fatedier/frp/releases/download/v0.52.0/frp_0.52.0_linux_amd64.tar.gz

# 解压
tar -xzf frp_0.52.0_linux_amd64.tar.gz
cd frp_0.52.0_linux_amd64
```

## 目录结构说明

解压后的目录结构如下：

```
frp_0.52.0_linux_amd64/
├── frpc          # 客户端可执行文件
├── frpc.toml     # 客户端配置示例
├── frps          # 服务端可执行文件
├── frps.toml     # 服务端配置示例
├── systemd/      # systemd 服务配置目录
│   ├── frpc.service
│   └── frps.service
└── LICENSE       # 许可证文件
```

## 服务端安装（frps）

服务端需要部署在有公网 IP 的服务器上。

### 方法一：直接运行

1. 上传 frps 到服务器
2. 创建配置文件 `frps.toml`：

```toml
# frps.toml
# 服务端监听的端口，客户端通过此端口连接
bindPort = 7000

# Web 控制面板端口
webServer.addr = "0.0.0.0"
webServer.port = 7500
webServer.user = "admin"
webServer.password = "admin"

# 认证配置
auth.method = "token"
auth.token = "your_secret_token"
```

3. 启动 frps：

```bash
# 前台运行（测试用）
./frps -c frps.toml

# 后台运行
nohup ./frps -c frps.toml &
```

### 方法二：systemd 服务（推荐）

适用于长期运行的服务器环境。

1. 复制服务文件：

```bash
sudo cp systemd/frps.service /etc/systemd/system/
```

2. 复制二进制文件和配置：

```bash
sudo cp frps /usr/local/bin/
sudo mkdir -p /etc/frp
sudo cp frps.toml /etc/frp/
```

3. 编辑服务文件（如果需要）：

```bash
sudo nano /etc/systemd/system/frps.service
```

确保 ExecStart 指向正确路径：

```ini
ExecStart=/usr/local/bin/frps -c /etc/frp/frps.toml
```

4. 启动服务：

```bash
# 重新加载 systemd
sudo systemctl daemon-reload

# 启动 frps
sudo systemctl start frps

# 设置开机自启
sudo systemctl enable frps

# 查看状态
sudo systemctl status frps
```

### 方法三：Docker 部署

```bash
# 拉取镜像
docker pull snowdreamtech/frps

# 运行容器
docker run -d --name frps \
  -p 7000:7000 \
  -p 7500:7500 \
  -v ./frps.toml:/etc/frp/frps.toml \
  snowdreamtech/frps
```

## 客户端安装（frpc）

客户端部署在内网需要暴露服务的机器上。

### 方法一：直接运行

1. 上传 frpc 到内网机器
2. 创建配置文件 `frpc.toml`：

```toml
# frpc.toml
# 服务端地址和端口
serverAddr = "your_server_ip"
serverPort = 7000

# 认证配置，需与服务端一致
auth.method = "token"
auth.token = "your_secret_token"

# 代理配置
[[proxies]]
name = "ssh"
type = "tcp"
localIP = "127.0.0.1"
localPort = 22
remotePort = 6000
```

3. 启动 frpc：

```bash
# 前台运行
./frpc -c frpc.toml

# 后台运行
nohup ./frpc -c frpc.toml &
```

### 方法二：systemd 服务

1. 复制服务文件：

```bash
sudo cp systemd/frpc.service /etc/systemd/system/
```

2. 复制二进制文件和配置：

```bash
sudo cp frpc /usr/local/bin/
sudo mkdir -p /etc/frp
sudo cp frpc.toml /etc/frp/
```

3. 启动服务：

```bash
sudo systemctl daemon-reload
sudo systemctl start frpc
sudo systemctl enable frpc
```

### 方法三：Windows 服务

Windows 下可以使用 NSSM 或 Windows Service Wrapper 将 frpc 封装为服务。

```powershell
# 使用 NSSM 安装 frpc 为服务
nssm install frpc "C:\path\to\frpc.exe" "-c C:\path\to\frpc.toml"
nssm start frpc
```

### 方法四：Docker 部署

```bash
docker run -d --name frpc \
  --network host \
  -v ./frpc.toml:/etc/frp/frpc.toml \
  snowdreamtech/frpc
```

## 防火墙配置

确保服务端的以下端口已开放：

| 端口 | 用途 | 必填 |
|-----|------|-----|
| 7000 | frps 客户端连接端口 | 是 |
| 7500 | Web 控制面板 | 否 |
| 6000 | 远程 SSH 端口 | 否 |
| 80/443 | HTTP/HTTPS 穿透 | 否 |

### 使用 firewall-cmd（CentOS/RHEL）

```bash
# 开放端口
firewall-cmd --permanent --add-port=7000/tcp
firewall-cmd --permanent --add-port=7500/tcp
firewall-cmd --reload
```

### 使用 ufw（Ubuntu/Debian）

```bash
sudo ufw allow 7000/tcp
sudo ufw allow 7500/tcp
sudo ufw reload
```

### 使用 iptables

```bash
iptables -A INPUT -p tcp --dport 7000 -j ACCEPT
iptables -A INPUT -p tcp --dport 7500 -j ACCEPT
```

## 验证安装

### 服务端验证

访问控制面板：http://your_server_ip:7500

使用配置的用户名和密码（admin/admin）登录，应该能看到连接状态。

### 客户端验证

查看日志输出，确认连接成功：

```bash
# 查看日志
journalctl -u frpc -f

# 或者查看 nohup 输出
tail -f nohup.out
```

成功连接时应该看到类似输出：

```
[I] [service.go:200] [xxxxx] login to server success, get run id [xxxxx]
```

## 下一步

安装完成后，根据你的需求配置不同的代理类型：

- **TCP 穿透**：适用于 SSH、远程桌面、数据库等
- **HTTP/HTTPS 穿透**：适用于 Web 网站
- **UDP 穿透**：适用于 DNS、视频流等

详细配置方法请参考《使用手册》。
