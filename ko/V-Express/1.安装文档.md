# V-Express 설치 가이드

V-Express는 Tencent AI Lab에서 개발한 초상화 비디오 생성 방법입니다. 참조 이미지, 오디오 및 V-Kps 시퀀스의 제어로 말하는 머리 비디오를 생성합니다.

## 버전 개요

| 버전 | 상태 | 설명 |
|------|------|------|
| V-Express 1.x | 현재 | 주요 릴리스 |

## 시스템 요구사항

### 하드웨어 요구사항

| 구성요소 | 최소 | 권장 |
|---------|------|------|
| GPU | NVIDIA 16GB VRAM | NVIDIA 24GB+ VRAM |
| RAM | 16GB | 32GB+ |
| 저장소 | 50GB | 100GB+ |
| CUDA | 11.8+ | 12.1+ |

### 소프트웨어 요구사항

| 소프트웨어 | 버전 | 참고 |
|-----------|------|------|
| Python | 3.8 - 3.10 | 권장 3.9 |
| CUDA | 11.8+ | GPU 가속 필요 |
| cuDNN | 8.5+ | CUDA에 필요 |
| ffmpeg | 최신 | 비디오 처리 필요 |

## Linux/Ubuntu 설치

### 1단계: 시스템 종속성 설치

```bash
# 시스템 업데이트
sudo apt update && sudo apt upgrade -y

# Python 및 개발 도구 설치
sudo apt install python3.9 python3-pip python3-venv git wget curl

# 시스템 라이브러리 설치
sudo apt install libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1

# ffmpeg 설치
sudo apt install ffmpeg

# git-lfs 설치
sudo apt install git-lfs
```

### 2단계: 프로젝트 복제

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express
```

### 3단계: 가상 환경 생성

```bash
python3.9 -m venv venv
source venv/bin/activate

# Python 버전 확인
python --version
```

### 4단계: PyTorch 설치

```bash
# CUDA 11.8 버전
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

# 설치 확인
python -c "import torch; print(torch.cuda.is_available())"
```

### 5단계: 종속성 설치

```bash
pip install -r requirements.txt
```

### 6단계: 모델 다운로드

```bash
# git-lfs 설치
git lfs install

# HuggingFace에서 모델 복제
git clone https://huggingface.co/tk93/V-Express

# 모델을 올바른 위치로 이동
mv V-Express/model_ckpts model_ckpts
mv V-Express/*.bin model_ckpts/v-express
```

또는 개별적으로 모델 다운로드:

```bash
# 모델 디렉토리 생성
mkdir -p model_ckpts

# 필요한 모델 다운로드:
# - stabilityai/sd-vae-ft-mse
# - run wayml/stable-diffusion-v1-5 (unet 설정만)
# - facebook/wav2vec2-base-960h
# - insightface/buffalo_l
```

## Windows 설치

### 1단계: Python 설치

1. python.org에서 Python 3.9 다운로드
2. 설치 시 "Add Python to PATH" 체크
3. 확인: `python --version`

### 2단계: CUDA 설치

1. NVIDIA 웹사이트에서 CUDA 11.8 다운로드
2. 기본 설정으로 설치
3. cuDNN 8.9 다운로드 및 설치

### 3단계: 복제 및 설정

```powershell
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python -m venv venv
venv\Scripts\activate
```

### 4단계: 종속성 설치

```powershell
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118

pip install -r requirements.txt
```

### 5단계: 모델 다운로드

HuggingFace에서 모델을 다운로드하여 `model_ckpts/` 디렉토리에 배치합니다.

## macOS 설치

### 1단계: 종속성 설치

```bash
# Homebrew 설치 (미설치 시)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Python 및 ffmpeg 설치
brew install python@3.9 ffmpeg git git-lfs
```

### 2단계: 설정

```bash
git clone https://github.com/tencent-ailab/V-Express.git
cd V-Express

python3.9 -m venv venv
source venv/bin/activate

# PyTorch 설치 (macOS는 CPU만 지원)
pip install torch==2.0.1 torchvision==0.15.2

pip install -r requirements.txt
```

참고: macOS는 CPU 모드만 지원하며 GPU 가속을 사용할 수 없습니다.

## 설치 확인

```bash
# 기본 기능 테스트
python inference.py --help
```

## 일반적인 문제

### CUDA 메모리 부족

**해결책:**
- 추론 단계 줄이기: `--num_inference_steps 15`
- 메모리 절약 활성화: `--save_gpu_memory`
- 더 낮은 해상도 사용

### 라이브러리 누락 (Windows)

**해결책:**
- Visual C++ Redistributable 2015-2022 설치
- CUDA를 시스템 PATH에 추가

### 모델 다운로드 실패

**해결책:**
- VPN 또는 프록시 사용
- HuggingFace에서 수동 다운로드
- 네트워크 연결 확인

### ffmpeg를 찾을 수 없음

**해결책:**
- Linux: `sudo apt install ffmpeg`
- Windows: ffmpeg를 PATH에 추가
- macOS: `brew install ffmpeg`

## 중요 참고사항

1. **얼굴 재타겟팅**: 대상 비디오가 참조 이미지와 같은 사람이 아닐 때 얼굴 재타겟팅이 중요합니다. 더 나은 결과를 위해 참조 얼굴과 자세가 더 비슷한 대상 비디오를 선택하세요.

2. **언어 지원**: 모델은 영어에서 더 나은 성능을 보입니다. 다른 언어는 자세히 테스트되지 않았습니다.

3. **이미지 품질**: 최소 512x512 해상도의 선명한 정사각형 얼굴 이미지를 사용하세요.

## 관련 링크

- [GitHub 저장소](https://github.com/tencent-ailab/V-Express)
- [HuggingFace 모델](https://huggingface.co/tk93/V-Express)
- [논문](https://arxiv.org/abs/2406.02511)
- [프로젝트 페이지](https://tenvence.github.io/p/v-express/)
