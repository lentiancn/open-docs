# Docker よくある質問

よくいただく質問と回答。

## インストール

### Q: Docker DesktopがWindowsで起動しない？

**解決策**：
1. BIOSで仮想化を有効にする
2. WSL 2をインストール/アップデート
3. コンピュータを再起動
4. 競合ソフトウェアを確認（VirtualBox、VMware）

### Q: "docker: permission denied"エラー？

**解決策**：
```
sudo usermod -aG docker $USER
# ログアウトして再ログイン
```

### Q: Dockerバージョンを確認方法は？

```
docker --version
docker-compose --version
```

## イメージ

### Q: Dockerイメージのサイズを小さくする方法は？

**ベストプラクティス**：
1. alpineベースイメージを使用
2. マルチステージビルドを使用
3. レイヤー数を最小化
4. 同じレイヤーでクリーンアップ

### Q: キャッシュなしでイメージをビルドする方法は？

```
docker build --no-cache -t my-image .
```

### Q: 未使用のすべてのイメージを削除する方法は？

```
docker image prune -a
```

## コンテナ

### Q: コンテナを運行し続ける方法は？

```
docker run -d nginx tail -f /dev/null
# または
docker run -d nginx sleep infinity
```

### Q: コンテナが起動直後に終了する？

**理由**：
1. フォアグラウンドプロセスがない
2. プロセスが完了した

**解決策**：
```
docker run -it image_name /bin/bash
docker run -d image_name tail -f /dev/null
```

### Q: 実行中のコンテナに入る方法は？

```
docker exec -it container_id /bin/bash
```

### Q: コンテナとの間でファイルをコピーする方法は？

```
# コンテナからホストへコピー
docker cp container_id:/path/file.txt ./

# ホストからコンテナへコピー
docker cp ./file.txt container_id:/path/
```

## ネットワーク

### Q: ホストからコンテナにアクセスする方法は？

ポートマッピングを使用：
```
docker run -p 8080:80 nginx
```

### Q: コンテナを接続する方法は？

ネットワークを作成：
```
docker network create my-network
docker run --network my-network -d nginx
```

## ボリューム

### Q: データを永続化する方法は？

ボリュームを使用：
```
docker volume create my-data
docker run -v my-data:/data nginx
```

## Docker Compose

### Q: コード変更後に再ビルドする方法は？

```
docker-compose up -d --build
```

### Q: ログを表示する方法は？

```
docker-compose logs -f
```

### Q: サービスを拡張する方法は？

```
docker-compose up -d --scale web=3
```

## パフォーマンス

### Q: Dockerが遅い/ディスクを太多く消費する？

**解決策**：
```
docker system prune -a
docker system df
docker volume prune
```

### Q: コンテナリソースを制限する方法は？

```
docker run -m 512m nginx
docker run --cpus=0.5 nginx
```

## トラブルシューティング

### Q: 失敗したコンテナをデバッグする方法は？

```
docker logs container_id
docker inspect container_id
```

### Q: コンテナネットワークが動作しない？

```
sudo systemctl restart docker
docker network ls
```

## セキュリティ

### Q: 脆弱性をスキャンする方法は？

```
docker scan my-image
```

### Q: rootで実行すべきではない？

いいえ、非rootユーザーを作成：

```
FROM node:18-alpine
RUN addgroup -g 1000 appgroup && \
    adduser -u 1000 -G appgroup -D appuser
USER appuser
```

## Docker vs VM

### Q: DockerとVMの違いは？

| 側面 | Docker | VM |
|------|--------|-----|
| OS | ホストカーネルを共有 | 独立したOS |
| サイズ | MBレベル | GBレベル |
| 起動 | 秒単位 | 分単位 |
| 分離 | コンテナレベル | 完全分離 |

## 学習リソース

- 公式ドキュメント：https://docs.docker.com
- インタラクティブラボ：https://labs.play-with-docker.com
- Dockerコミュニティ：https://www.docker.com/community
